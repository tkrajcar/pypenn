This is patch02 to PennMUSH 1.8.4. After applying this patch, you will
have version 1.8.4p02

To apply this patch, save it to a file in your top-level 1.8.4p1 MUSH directory,
and do the following:
        patch -p0 < 1.8.4-patch02
        make install

If you use GNU patch 2.2, you probably want the above to be 'patch -b -p0',
not just 'patch -p0'.

Users need not worry about failed hunks in src/switchinc.c,
hdrs/switches.h, hdrs/cmds.h, or hdrs/funs.h. These files are automatically
rebuilt on compile. On the off chance they appear not to be, simply
rm them and re-run make.

Then @shutdown/reboot your MUSH.
    - Shawn/Raevnos


In this patch:

Major Changes:
 * Wildcard matcher completely rewritten to avoid hangs and to provide
   ansi-aware capturing. [GM]
 * connection_fail_limit now lets you limit the # of connection fails in
   a 10 minute time by any given IP. [GM]

Minor Changes:
 * update-cnf.pl perl script now handles optional config lines, by placing
   A # OPTIONAL above them. This is for message translation. [GM]
 * Config options can now be marked as optional. If they don't exist,
   Penn will not complain in the log. [MG]
 * Player names with spaces no longer need to be in given in quotes for
   @name. Suggested by Minion. [MG]
 * @decompile no longer shows flags which can't be set by players, like
   GOING and CONNECTED. [MG]
 * %il substitution as preparation to get rid of ##. [GM]
 * hardcode: call_attrib is now a wrapper around call_ufun. [GM]
 * The %i<n> substitution, and itext()/inum()/ilev() functions, now work
   for @dolist as well as iter(). [MG]
 * iter() context (itext(), inum(), etc) is no longer propagated through
   ufuns. [MG]
 * @hook/overrides on huh_command are now matched against "huh_command" and
   "huh_command <input>". From a suggestion by Mercutio. [MG]
 * Various help fixes.
 * @list and list() can now show only built-in or only local commands or
   functions. Suggested by Trelane@M*U*S*H. [MG]
 * Mortals can now use @search to find any objects they can examine.
   Suggested by Paige. [MG]
 * @function names can start with numbers again. Requested by Mercutio. [MG]
 * @include and @break now work when entered directly from a client. [MG]
 * The Drop and Give @locks now trigger verb <name>_LOCK`FAILURE attributes
   when you fail to pass them, as described in 'help failure'. Suggested by 
   Cas@BeforeTheDarkness. [MG]
 * Set several attributes used internally AF_NOCOPY so they won't be included
   in @decompile output. Suggested by Paige. [GM]
 * The help for the chat system (@channel) has been rewritten. [MG]
 * autodetect_list now returns 'm' sort for unknown list types instead of
   alphanum, so sorting on strings will now treat numbers in them as
   separate comparisons by default. [GM]
 * setunion(), setdiff(), setinter() now autodetect lists in all cases where
   no sort type is provided instead of just some cases. [GM]
 * The pipe (|) character is no longer valid in channel names. [MG]

Functions:
 * ibreak(), for breaking out of an iter() loop. [Rhost] [MG]
 * New stext() function and %$N sub, equivilent of #$ in @switch, switch*(),
   and reswitch*(), but can be used in nested switches/on user input. [MG]
 * New slev() function, returns the current nesting depth of switches. [MG]
 * maillist() returns a list of @mail messages matching a range, as per
   @mail/list. Suggested by AnneLions. [MG]
 * New sorttype, lattr, sorts a list of attribute names. [MG]

Commands:
 * @channel/combine and @channel/uncombine let you combine spammy connect
   messages for channels into one line. [SW] [GM]
 * @grep now accepts /wild and /regexp switches, for wildcard/globbing and
   regular expression greps (a la wildgrep() and regrep()). Also /nocase
   for case-insensitive greps. Suggested by Paige. [MG]
 * @attribute now allows limiting attribute values through /enum and
   /limit switches. [GM]
 * @ps <pid> shows info for a single queue entry. Suggested by Paige. [MG]
   
Fixes:
 * Off-by-one bug in 'm' sort when using embedded numbers fixed. [GM]
 * Debug output was sometimes sent to the wrong executor. [GM]
 * A crashbug in @search was fixed. Reported by Paige. [GM]
 * A crashbug in lpids() was fixed. Reported by Mercutio. Fixed by Javelin.
 * @search elock class failed to report invalid lock strings. Fixed. [GM]
 * @cpattr and @mvattr could break attribute trees. Reported by Sketch. [MG]
 * benchmark() calculated the average incorrectly. Reported by Cheetah. [DC]
 * map(), iter(), mix() and step() are ansi-aware, now. Using any of the
   list functions without ansi should also be considerably faster. [GM]
 * "look <container>'s <object>" incorrectly stopped working in p1 when
   <object>'s desc was set "nearby". Reported by Yuriko@M*U*SH. [MG]
 * Attribute names are now sorted better with regard to attribute trees,
   hopefully fixing the recurring bug of @wipe leaving branch attributes
   when removing a root attr for good. [MG]


Summary:
 CHANGES.184               |   80 +
 FAQ                       |   10 
 Makefile.in               |    2 
 Patchlevel                |    2 
 game/mushcnf.dst          |   35 
 game/txt/hlp/index.hlp    |  869 +++++++++---------
 game/txt/hlp/pennchat.hlp |  558 ++++++------
 game/txt/hlp/penncmd.hlp  |  265 +++--
 game/txt/hlp/pennconf.hlp |    3 
 game/txt/hlp/pennfunc.hlp |  214 +++-
 game/txt/hlp/pennmail.hlp |   36 
 game/txt/hlp/penntop.hlp  |   28 
 game/txt/hlp/pennv184.hlp |   83 +
 game/txt/hlp/pennvOLD.hlp |    2 
 hdrs/ansi.h               |    1 
 hdrs/atr_tab.h            |   40 
 hdrs/attrib.h             |   10 
 hdrs/command.h            |    4 
 hdrs/conf.h               |   10 
 hdrs/extchat.h            |   22 
 hdrs/externs.h            |   53 -
 hdrs/function.h           |    2 
 hdrs/game.h               |    1 
 hdrs/mushtype.h           |    6 
 hdrs/parse.h              |    1 
 hdrs/sort.h               |   18 
 hdrs/svninfo.h            |    2 
 hdrs/switches.h           |  283 +++---
 hdrs/version.h            |    6 
 po/bg_BG.pox              |  299 +++---
 po/da_DK.pox              |   12 
 po/de_DE.pox              |   12 
 po/es_ES.pox              |   20 
 po/fr_FR.pox              |   20 
 po/hr_HR.pox              |  147 ++-
 po/hu_HU.pox              |   20 
 po/id_ID.pox              |    4 
 po/nl_NL.pox              |   20 
 po/no_NO.pox              |  130 ++
 po/pennmush.pot           | 2138 ++++++++++++++++++++++++----------------------
 po/pl_PL.pox              |   20 
 po/pt_BR.pox              |    4 
 po/ro_RO.pox              |    4 
 po/sv_SE.pox              |   20 
 po/zh_CN.pox              |  325 ++++++
 src/Makefile.in           |    2 
 src/SWITCHES              |    7 
 src/atr_tab.c             |  268 +++++
 src/attrib.c              |   30 
 src/bsd.c                 |   15 
 src/cmds.c                |   50 -
 src/command.c             |   31 
 src/conf.c                |  108 +-
 src/cque.c                |  184 +++
 src/extchat.c             |  152 ++-
 src/extmail.c             |   46 
 src/flags.c               |    3 
 src/function.c            |   18 
 src/fundb.c               |   25 
 src/funlist.c             |  445 ++++-----
 src/funmisc.c             |   82 +
 src/funstr.c              |   40 
 src/funufun.c             |   98 +-
 src/game.c                |   50 -
 src/help.c                |    6 
 src/lock.c                |    9 
 src/look.c                |    7 
 src/markup.c              |    9 
 src/move.c                |    6 
 src/mysocket.c            |    4 
 src/parse.c               |  103 +-
 src/pcre.c                |    4 
 src/player.c              |   79 +
 src/predicat.c            |  394 +++++---
 src/rob.c                 |    3 
 src/set.c                 |  133 +-
 src/sort.c                |  185 ++-
 src/sql.c                 |    2 
 src/switchinc.c           |    7 
 src/utils.c               |  221 +---
 src/wild.c                |  579 ++++--------
 src/wiz.c                 |   38 
 utils/update-cnf.pl       |   62 +
 win32/README.cygwin       |   28 
 84 files changed, 5604 insertions(+), 3770 deletions(-)


Prereq: 1.8.4p1
===================================================================
--- Patchlevel	(.../184p1)	(revision 682)
+++ Patchlevel	(.../184p2)	(revision 682)
@@ -1,3 +1,3 @@
 Do not edit this file. It is maintained by the official PennMUSH patches.
-This is PennMUSH 1.8.4p1
+This is PennMUSH 1.8.4p2
 
Index: Makefile.in
===================================================================
--- Makefile.in	(.../184p1)	(revision 682)
+++ Makefile.in	(.../184p2)	(revision 682)
@@ -3,7 +3,7 @@
 # - System configuration - #
 
 VERSION=1.8.4
-PATCHLEVEL=1
+PATCHLEVEL=2
 
 #
 # This section of the file should be automatically configured by the
Index: src/mysocket.c
===================================================================
--- src/mysocket.c	(.../184p1)	(revision 682)
+++ src/mysocket.c	(.../184p2)	(revision 682)
@@ -467,7 +467,7 @@
  * From UNP, with changes. If nsec > 0, we set the socket
  * nonblocking and connect with timeout. The socket is STILL
  * nonblocking after it returns. If nsec == 0, a normal blocking
- * connect is done. 
+ * connect is done.
  * \param sockfd file descriptor of socket.
  * \param saptr pointer to sockaddr structure with connection data.
  * \param salen length of saptr.
@@ -539,7 +539,7 @@
 }
 
 /* The following functions are from W. Ridhard Steven's libgai,
- * modified by Shawn Wagner for PennMUSH. These arn't full
+ * modified by Shawn Wagner for PennMUSH. These aren't full
  * implementations- they don't handle unix-domain sockets or named
  * services, because we don't need them for what we're doing.  */
 
Index: src/fundb.c
===================================================================
--- src/fundb.c	(.../184p1)	(revision 682)
+++ src/fundb.c	(.../184p2)	(revision 682)
@@ -160,7 +160,7 @@
     lh.count = parse_integer(args[2]);
 
     if (lh.start < 1 || lh.count < 1) {
-      safe_str(T("#-1 ARGUMENT OUT OF RANGE"), buff, bp);
+      safe_str(T(e_argrange), buff, bp);
       return;
     }
 
@@ -773,7 +773,7 @@
       start = parse_integer(args[1]);
       count = parse_integer(args[2]);
       if (start < 1 || count < 1) {
-        safe_str(T("#-1 ARGUMENT OUT OF RANGE"), buff, bp);
+        safe_str(T(e_argrange), buff, bp);
         return;
       }
       break;
@@ -1914,7 +1914,7 @@
   char *wenv[2];
 
   if (nargs > 1 && args[1] && *args[1]) {
-    if (fetch_ufun_attrib(args[1], executor, &ufun, 1)) {
+    if (fetch_ufun_attrib(args[1], executor, &ufun, UFUN_DEFAULT)) {
       report = 1;
     } else {
       safe_str(ufun.errmess, buff, bp);
@@ -2299,9 +2299,7 @@
 /* ARGSUSED */
 FUNCTION(fun_grep)
 {
-  char *tp;
-  int wild;
-  int sensitive;
+  int flags = 0;
 
   dbref it = match_thing(executor, args[0]);
   if (!GoodObject(it)) {
@@ -2318,11 +2316,16 @@
     return;
   }
 
-  sensitive = !strcmp(called_as, "GREP") || !strcmp(called_as, "WILDGREP");
-  wild = !strcmp(called_as, "WILDGREPI") || !strcmp(called_as, "WILDGREP");
-  tp = grep_util(executor, it, args[1], args[2], sensitive, wild);
-  safe_str(tp, buff, bp);
-  mush_free(tp, "grep_util.buff");
+  if (!strcmp(called_as, "GREPI") || !strcmp(called_as, "WILDGREPI")
+      || !strcmp(called_as, "REGREPI"))
+    flags |= GREP_NOCASE;
+
+  if (*called_as == 'W')
+    flags |= GREP_WILD;
+  else if (*called_as == 'R')
+    flags |= GREP_REGEXP;
+
+  grep_util(executor, it, args[1], args[2], buff, bp, flags);
 }
 
 /* Get database size statistics */
Index: src/sql.c
===================================================================
--- src/sql.c	(.../184p1)	(revision 682)
+++ src/sql.c	(.../184p2)	(revision 682)
@@ -481,7 +481,7 @@
     return;
   }
 
-  if (!fetch_ufun_attrib(args[0], executor, &ufun, 1))
+  if (!fetch_ufun_attrib(args[0], executor, &ufun, UFUN_DEFAULT))
     return;
   if (nargs > 2) {
     /* we have an output separator in args[2]. */
Index: src/utils.c
===================================================================
--- src/utils.c	(.../184p1)	(revision 682)
+++ src/utils.c	(.../184p2)	(revision 682)
@@ -137,80 +137,105 @@
 /** Given an attribute [<object>/]<name> pair (which may include #lambda),
  * fetch its value, owner (thing), and pe_flags, and store in the struct
  * pointed to by ufun
- * \param attrname The obj/name of attribute.
+ * \param attrstring The obj/name of attribute.
  * \param executor Dbref of the executing object.
  * \param ufun Pointer to an allocated ufun_attrib struct to fill in.
- * \param accept_lambda true if #lambda can be used.
+ * \param flags A bitwise or of desired UFUN_* flags.
  * \return 0 on failure, true on success.
  */
 bool
-fetch_ufun_attrib(char *attrname, dbref executor, ufun_attrib * ufun,
-                  bool accept_lambda)
+fetch_ufun_attrib(const char *attrstring, dbref executor, ufun_attrib * ufun,
+                  int flags)
 {
+  char *thingname, *attrname;
+  char astring[BUFFER_LEN];
   ATTR *attrib;
-  dbref thing;
-  int pe_flags = PE_UDEFAULT;
 
   if (!ufun)
-    return 0;                   /* We should never NOT receive a ufun. */
+    return 0;
+
+  ufun->contents[0] = '\0';
   ufun->errmess = (char *) "";
+  ufun->thing = executor;
+  ufun->pe_flags = PE_UDEFAULT;
+  ufun->ufun_flags = flags;
 
-  /* find our object and attribute */
-  if (accept_lambda) {
-    parse_anon_attrib(executor, attrname, &thing, &attrib);
+  ufun->thing = executor;
+  thingname = NULL;
+
+  if (!attrstring)
+    return 0;
+  strncpy(astring, attrstring, BUFFER_LEN);
+
+  /* Split obj/attr */
+  if ((flags & UFUN_OBJECT) && ((attrname = strchr(astring, '/')) != NULL)) {
+    thingname = astring;
+    *(attrname++) = '\0';
   } else {
-    parse_attrib(executor, attrname, &thing, &attrib);
+    attrname = astring;
   }
 
-  /* Is it valid? */
-  if (!GoodObject(thing)) {
-    ufun->errmess = (char *) "#-1 INVALID OBJECT";
-    free_anon_attrib(attrib);
-    return 0;
-  } else if (!attrib) {
-    ufun->contents[0] = '\0';
-    ufun->thing = thing;
-    ufun->pe_flags = pe_flags;
-    free_anon_attrib(attrib);
+  if (thingname && (flags & UFUN_LAMBDA) && !strcasecmp(thingname, "#lambda")) {
+    /* It's a lambda. */
+    thingname = NULL;
+    ufun->thing = executor;
+    mush_strncpy(ufun->contents, attrname, BUFFER_LEN);
     return 1;
-  } else if (!Can_Read_Attr(executor, thing, attrib)) {
+  }
+
+  if (thingname) {
+    /* Attribute is on something else. */
+    ufun->thing =
+      noisy_match_result(executor, thingname, NOTYPE, MAT_EVERYTHING);
+    if (!GoodObject(ufun->thing)) {
+      ufun->errmess = (char *) "#-1 INVALID OBJECT";
+      return 0;
+    }
+  }
+
+  attrib = (ATTR *) atr_get(ufun->thing, upcasestr(attrname));
+  // An empty attrib is the same as no attrib.
+  if (attrib == NULL) {
+    if (flags & UFUN_REQUIRE_ATTR) {
+      if (!(flags & UFUN_IGNORE_PERMS) && !Can_Examine(executor, ufun->thing))
+        ufun->errmess = e_atrperm;
+      return 0;
+    } else {
+      return 1;
+    }
+  }
+  if (!(flags & UFUN_IGNORE_PERMS)
+      && !Can_Read_Attr(executor, ufun->thing, attrib)) {
     ufun->errmess = e_atrperm;
-    free_anon_attrib(attrib);
     return 0;
   }
-
-  /* Can we evaluate it? */
-  if (!CanEvalAttr(executor, thing, attrib)) {
+  if (!(flags & UFUN_IGNORE_PERMS)
+      && !CanEvalAttr(executor, ufun->thing, attrib)) {
     ufun->errmess = e_perm;
-    free_anon_attrib(attrib);
     return 0;
   }
 
   /* DEBUG attributes */
-  if (AF_Debug(attrib))
-    pe_flags |= PE_DEBUG;
+  if (AF_Debug(attrib)) {
+    ufun->pe_flags |= PE_DEBUG;
+  }
 
   /* Populate the ufun object */
   mush_strncpy(ufun->contents, atr_value(attrib), BUFFER_LEN);
-  ufun->thing = thing;
-  ufun->pe_flags = pe_flags;
-
-  /* Cleanup */
-  free_anon_attrib(attrib);
 
   /* We're good */
   return 1;
 }
 
 /** Given a ufun, executor, enactor, PE_Info, and arguments for %0-%9,
- * call the ufun with appropriate permissions on values given for
- * wenv_args. The value returned is stored in the buffer pointed to
- * by retval, if given.
+ *  call the ufun with appropriate permissions on values given for
+ *  wenv_args. The value returned is stored in the buffer pointed to
+ *  by ret, if given.
  * \param ufun The ufun_attrib that was initialized by fetch_ufun_attrib
  * \param wenv_args An array of string values for global_eval_context.wenv
  * \param wenv_argc The number of wenv args to use.
  * \param ret If desired, a pointer to a buffer in which the results
- * of the process_expression are stored in.
+ *            of the process_expression are stored in.
  * \param executor The executor.
  * \param enactor The enactor.
  * \param pe_info The pe_info passed to the FUNCTION
@@ -224,6 +249,9 @@
   char rbuff[BUFFER_LEN];
   char *rp;
   char *old_wenv[10];
+  char *saveqs[NUMQ];
+  int iter_nest = -1;
+  int switch_nest = -1;
   int old_args = 0;
   int i;
   int pe_ret;
@@ -231,28 +259,32 @@
 
   struct re_save rsave;
 
-  save_regexp_context(&rsave);
-
   /* Make sure we have a ufun first */
   if (!ufun)
     return 1;
 
   /* If the user doesn't care about the return of the expression,
-   * then use our own rbuff.
-   */
+   * then use our own rbuff.  */
   if (!ret)
     ret = rbuff;
   rp = ret;
 
+  /* Save contexts, globals, regexp vals, etc */
   for (i = 0; i < wenv_argc; i++) {
     old_wenv[i] = global_eval_context.wenv[i];
     global_eval_context.wenv[i] = wenv_args[i];
   }
+
   for (; i < 10; i++) {
     old_wenv[i] = global_eval_context.wenv[i];
     global_eval_context.wenv[i] = NULL;
   }
 
+  save_regexp_context(&rsave);
+  if (ufun->ufun_flags & UFUN_LOCALIZE) {
+    save_global_regs("localize", saveqs);
+  }
+
   /* Set all the regexp patterns to NULL so they are not
    * propogated */
   global_eval_context.re_code = NULL;
@@ -260,11 +292,14 @@
   global_eval_context.re_offsets = NULL;
   global_eval_context.re_from = NULL;
 
-
   /* And now, make the call! =) */
   if (pe_info) {
     old_args = pe_info->arg_count;
     pe_info->arg_count = wenv_argc;
+    iter_nest = pe_info->local_iter_nesting;
+    pe_info->local_iter_nesting = -1;
+    switch_nest = pe_info->local_switch_nesting;
+    pe_info->local_switch_nesting = -1;
   }
 
   ap = ufun->contents;
@@ -277,9 +312,14 @@
     global_eval_context.wenv[i] = old_wenv[i];
   }
   if (pe_info) {
+    pe_info->local_iter_nesting = iter_nest;
+    pe_info->local_switch_nesting = switch_nest;
     pe_info->arg_count = old_args;
   }
 
+  if (ufun->ufun_flags & UFUN_LOCALIZE) {
+    restore_global_regs("localize", saveqs);
+  }
   /* Restore regexp patterns */
   restore_regexp_context(&rsave);
 
@@ -305,97 +345,14 @@
 call_attrib(dbref thing, const char *attrname, const char *wenv_args[],
             int wenv_argc, char *ret, dbref enactor, PE_Info *pe_info)
 {
-  char atrbuf[BUFFER_LEN];
-  char rbuff[BUFFER_LEN];
-  char *rp;
-  char *old_wenv[10];
-  int old_args = 0;
-  int i;
-  int pe_ret;
-  char const *ap;
-  ATTR *attrib;
-  char *saver[NUMQ];
-
-  struct re_save rsave;
-
-  /* Make sure we have a valid object to call first */
-  if (!GoodObject(thing) || IsGarbage(thing))
-    return 0;
-
-  if (attrname == NULL || !*attrname)
-    return 0;
-
-  /* Fetch the attrib contents */
-  attrib = (ATTR *) atr_get(thing, attrname);
-  if (attrib == NULL)
+  ufun_attrib ufun;
+  if (!fetch_ufun_attrib(attrname, thing, &ufun,
+                         UFUN_LOCALIZE | UFUN_REQUIRE_ATTR | UFUN_IGNORE_PERMS))
+  {
     return 0;
-
-  mush_strncpy(atrbuf, atr_value(attrib), BUFFER_LEN);
-
-  if (!*atrbuf) {
-    if (ret)
-      *ret = '\0';
-    return 1;
-  }
-
-  save_global_regs("localize", saver);
-
-  /* Store regepx info */
-  save_regexp_context(&rsave);
-
-  /* If the user doesn't care about the return of the expression,
-   * then use our own rbuff.
-   */
-  if (!ret)
-    ret = rbuff;
-  rp = ret;
-
-  /* Set up %0-%9 */
-  for (i = 0; i < wenv_argc; i++) {
-    old_wenv[i] = global_eval_context.wenv[i];
-    global_eval_context.wenv[i] = (char *) wenv_args[i];
-  }
-  for (; i < 10; i++) {
-    old_wenv[i] = global_eval_context.wenv[i];
-    global_eval_context.wenv[i] = NULL;
   }
-  /* Clear all q-regs */
-  for (i = 0; i < NUMQ; i++) {
-    global_eval_context.renv[i][0] = '\0';
-  }
-
-  /* Set all the regexp patterns to NULL so they are not
-   * propogated */
-  global_eval_context.re_code = NULL;
-  global_eval_context.re_subpatterns = -1;
-  global_eval_context.re_offsets = NULL;
-  global_eval_context.re_from = NULL;
-
-  /* And now, make the call! =) */
-  if (pe_info) {
-    old_args = pe_info->arg_count;
-    pe_info->arg_count = wenv_argc;
-  }
-
-  ap = atrbuf;
-  pe_ret = process_expression(ret, &rp, &ap, thing, thing,
-                              enactor, PE_DEFAULT, PT_DEFAULT, pe_info);
-  *rp = '\0';
-
-  /* Restore the old wenv */
-  for (i = 0; i < 10; i++) {
-    global_eval_context.wenv[i] = old_wenv[i];
-  }
-
-  if (pe_info) {
-    pe_info->arg_count = old_args;
-  }
-
-  /* Restore regexp patterns */
-  restore_regexp_context(&rsave);
-  restore_global_regs("localize", saver);
-
-  return !pe_ret;
+  return !call_ufun(&ufun, (char **) wenv_args, wenv_argc, ret, thing, enactor,
+                    pe_info);
 }
 
 /** Given an exit, find the room that is its source through brute force.
Index: src/extchat.c
===================================================================
--- src/extchat.c	(.../184p1)	(revision 682)
+++ src/extchat.c	(.../184p2)	(revision 682)
@@ -125,6 +125,7 @@
   {"Quiet", 'Q', CU_QUIET, CU_QUIET},
   {"Hide", 'H', CU_HIDE, CU_HIDE},
   {"Gag", 'G', CU_GAG, CU_GAG},
+  {"Combine", 'C', CU_COMBINE, CU_COMBINE},
   {NULL, '\0', 0, 0}
 };
 
@@ -1864,7 +1865,7 @@
 
   /* only printable characters */
   for (p = name; p && *p; p++) {
-    if (!isprint((unsigned char) *p))
+    if (!isprint((unsigned char) *p) || *p == '|')
       return 0;
   }
 
@@ -1886,7 +1887,7 @@
  * \param player the enactor.
  * \param name the name of the channel.
  * \param isyn a yes/no string.
- * \param flag switch indicator: 0=mute, 1=hide, 2=gag
+ * \param flag CU_* option
  * \param silent if 1, no notification of actions.
  */
 void
@@ -1899,6 +1900,11 @@
   int setting = abs(yesno(isyn));
   p = NULL;
 
+  if (!IsPlayer(player) && flag == CU_COMBINE) {
+    notify(player, T("Only players can use that option."));
+	   return;
+  }
+
   if (!name || !*name) {
     p = Chanlist(player);
     if (!p) {
@@ -1907,18 +1913,22 @@
     }
     silent = 1;
     switch (flag) {
-    case 0:
+    case CU_QUIET:
       notify(player, setting ? T("All channels have been muted.")
              : T("All channels have been unmuted."));
       break;
-    case 1:
+    case CU_HIDE:
       notify(player, setting ? T("You hide on all the channels you can.")
              : T("You unhide on all channels."));
       break;
-    case 2:
+    case CU_GAG:
       notify(player, setting ? T("All channels have been gagged.")
              : T("All channels have been ungagged."));
       break;
+    case CU_COMBINE:
+      notify(player, setting ? T("All channels have been combined.")
+             : T("All channels have been uncombined."));
+      break;
     }
   } else {
     test_channel_on(player, name, c);
@@ -1943,7 +1953,7 @@
     }
 
     switch (flag) {
-    case 0:
+    case CU_QUIET:
       /* Mute */
       if (setting) {
         CUtype(u) |= CU_QUIET;
@@ -1962,7 +1972,7 @@
       }
       break;
 
-    case 1:
+    case CU_HIDE:
       /* Hide */
       if (setting) {
         if (!Chan_Can_Hide(c, player) && !Wizard(player)) {
@@ -1986,7 +1996,7 @@
                         ChanName(c));
       }
       break;
-    case 2:
+    case CU_GAG:
       /* Gag */
       if (setting) {
         CUtype(u) |= CU_GAG;
@@ -2003,6 +2013,23 @@
                         ChanName(c));
       }
       break;
+    case CU_COMBINE:
+      /* Combine */
+      if (setting) {
+        CUtype(u) |= CU_COMBINE;
+        if (!silent)
+          notify_format(player,
+                        T
+                        ("Connect messages on channel <%s> will now be combined with others."),
+                        ChanName(c));
+      } else {
+        CUtype(u) &= ~CU_COMBINE;
+        if (!silent)
+          notify_format(player,
+                        T("Connect messages on channel <%s> will no longer be combined with others."),
+                        ChanName(c));
+      }
+      break;
     }
   } while (p != NULL);
 
@@ -2090,7 +2117,7 @@
 
   if (SUPPORT_PUEBLO)
     notify_noenter(player, open_tag("SAMP"));
-  notify_format(player, "%-30s %-5s %8s %-16s %-8s %-3s",
+  notify_format(player, "%-30s %-5s %8s %-16s %-9s %-3s",
                 T("Name"), T("Users"), T("Msgs"), T("Chan Type"), T("Status"),
                 T("Buf"));
   for (c = channels; c; c = c->next) {
@@ -2124,7 +2151,7 @@
         blanks[0] = '\0';
       }
       notify_format(player,
-                    "%-30s%s %s %8ld [%c%c%c%c%c%c%c %c%c%c%c%c%c] [%-3s %c%c] %3d",
+                    "%-30s%s %s %8ld [%c%c%c%c%c%c%c %c%c%c%c%c%c] [%-3s %c%c%c] %3d",
                     ChanName(c), blanks, numusers, ChanNumMsgs(c),
                     Channel_Disabled(c) ? 'D' : '-',
                     Channel_Player(c) ? 'P' : '-',
@@ -2144,6 +2171,7 @@
                     u ? (Chanuser_Gag(u) ? T("Gag") : T("On")) : T("Off"),
                     (u && Chanuser_Quiet(u)) ? 'Q' : ' ',
                     (u && Chanuser_Hide(u)) ? 'H' : ' ',
+                    (u && Chanuser_Combine(u)) ? 'C' : ' ',
                     bufferq_blocks(ChanBufferQ(c)));
     }
   }
@@ -3036,7 +3064,7 @@
   return (num < MAX_PLAYER_CHANS);
 }
 
-
+extern DESC *descriptor_list;
 
 /** Tell players on a channel when someone connects or disconnects.
  * \param player player that is connecting or disconnecting.
@@ -3046,18 +3074,80 @@
 void
 chat_player_announce(dbref player, char *msg, int ungag)
 {
+  DESC *d;
+  size_t msglen;
   CHAN *c;
-  CHANUSER *u;
+  CHANUSER *up, *uv;
+  char buff[BUFFER_LEN], *bp;
+  dbref viewer;
+  bool shared = false;
 
+  msglen = strlen(msg);
+
+  /* Use the regular channel_send() for all non-combined players. */
   for (c = channels; c; c = c->next) {
-    u = onchannel(player, c);
-    if (u) {
+    up = onchannel(player, c);
+    if (up) {
       if (!Channel_Quiet(c) && (Channel_Admin(c) || Channel_Wizard(c)
-                                || (!Chanuser_Hide(u) && !Dark(player)))) {
-        channel_send(c, player, CB_CHECKQUIET | CB_PRESENCE | CB_POSE, msg);
+            || (!Chanuser_Hide(up) && !Dark(player)))) {
+        channel_send(c, player,
+                     CB_NOCOMBINE | CB_CHECKQUIET | CB_PRESENCE | CB_POSE,
+                     msg);
+      }
+      if (ungag) {
+        CUtype(up) &= ~CU_GAG;
+      }
+    }
+  }
+  for (d = descriptor_list; d != NULL; d = d->next) {
+    viewer = d->player;
+    if (d->connected) {
+      shared = false;
+      bp = buff;
+
+      for (c = channels; c; c = c->next) {
+        up = onchannel(player, c);
+        uv = onchannel(viewer, c);
+        if (up && uv) {
+          if (!Channel_Quiet(c) && !Chanuser_Quiet(uv)
+              && (Channel_Admin(c) || Channel_Wizard(c)
+                  || (!Chanuser_Hide(up) && !Dark(player)))) {
+            if (Chanuser_Combine(uv)) {
+              shared = true;
+              safe_str(ChanName(c), buff, &bp);
+              safe_strl(" | ", 3, buff, &bp);
+            }
+          }
+        }
+        if (up && ungag)
+          CUtype(up) &= ~CU_GAG;
+      }
+      
+      bp -= 3;
+      *bp = '\0';   
+
+      if (shared) {
+	char defmsg[BUFFER_LEN], *dmp;
+	char shrtmsg[BUFFER_LEN], *smp;
+	char *accname;
+
+	dmp = defmsg;
+	smp = shrtmsg;
+	
+	accname = mush_strdup(accented_name(player), "chat_announce.name");
+
+	safe_format(shrtmsg, &smp, "%s %s", accname, msg);
+	*smp = '\0';
+          
+        safe_format(defmsg, &dmp, "<%s> %s %s", buff, accname, msg);
+        *dmp = '\0';
+
+	if (!vmessageformat(viewer, "CHATFORMAT", player, NA_INTER_PRESENCE, 6,
+			    "@", buff, shrtmsg, accname, "", defmsg)) 
+	  notify_anything(player, na_one, &viewer, ns_esnotify, NA_INTER_PRESENCE, defmsg);
+	
+	mush_free(accname, "chat_announce.name");
       }
-      if (ungag)
-        CUtype(u) &= ~CU_GAG;
     }
   }
 }
@@ -3401,17 +3491,21 @@
   else if (SW_ISSET(sw, SWITCH_WIPE))
     do_chan_wipe(player, arg_left);
   else if (SW_ISSET(sw, SWITCH_MUTE))
-    do_chan_user_flags(player, arg_left, args_right[1], 0, 0);
+    do_chan_user_flags(player, arg_left, args_right[1], CU_QUIET, 0);
   else if (SW_ISSET(sw, SWITCH_UNMUTE))
-    do_chan_user_flags(player, arg_left, "n", 0, 0);
+    do_chan_user_flags(player, arg_left, "n", CU_QUIET, 0);
   else if (SW_ISSET(sw, SWITCH_HIDE))
-    do_chan_user_flags(player, arg_left, args_right[1], 1, 0);
+    do_chan_user_flags(player, arg_left, args_right[1], CU_HIDE, 0);
   else if (SW_ISSET(sw, SWITCH_UNHIDE))
-    do_chan_user_flags(player, arg_left, "n", 1, 0);
+    do_chan_user_flags(player, arg_left, "n", CU_HIDE, 0);
   else if (SW_ISSET(sw, SWITCH_GAG))
-    do_chan_user_flags(player, arg_left, args_right[1], 2, 0);
+    do_chan_user_flags(player, arg_left, args_right[1], CU_GAG, 0);
   else if (SW_ISSET(sw, SWITCH_UNGAG))
-    do_chan_user_flags(player, arg_left, "n", 2, 0);
+    do_chan_user_flags(player, arg_left, "n", CU_GAG, 0);
+  else if (SW_ISSET(sw, SWITCH_COMBINE))
+    do_chan_user_flags(player, arg_left, args_right[1], CU_COMBINE, 0);
+  else if (SW_ISSET(sw, SWITCH_UNCOMBINE))
+    do_chan_user_flags(player, arg_left, "n", CU_COMBINE, 0);
   else if (SW_ISSET(sw, SWITCH_WHAT))
     do_chan_what(player, arg_left);
   else if (SW_ISSET(sw, SWITCH_BUFFER))
@@ -3515,6 +3609,7 @@
 {
 /* flags:
  *     CB_CHECKQUIET CB_NOSPOOF CB_PRESENCE CB_POSE CB_EMIT CB_SPEECH
+ *     CB_NOCOMBINE
  */
 
   /* These are static only to prevent them from chewing up
@@ -3595,7 +3690,7 @@
         notify(player, blockstr);
         return;
       }
-      // Do we override chatformats?
+      /* Do we override chatformats? */
       if (parse_boolean
           (mogrify(mogrifier, "MOGRIFY`OVERRIDE", player, 6, argv, ""))) {
         override_chatformat = 1;
@@ -3666,7 +3761,7 @@
   }
   *bp = '\0';
 
-  // @chatformat
+  /* @chatformat */
   if (flags & CB_PRESENCE) {
     snprintf(title, BUFFER_LEN, "%s", message);
     snprintf(message, BUFFER_LEN, "%s %s", Name(player), title);
@@ -3695,6 +3790,9 @@
   for (u = ChanUsers(channel); u; u = u->next) {
     current = CUdbref(u);
 
+    if ((flags & CB_NOCOMBINE) && Chanuser_Combine(u)) {
+      continue;
+    }
     if (!(((flags & CB_CHECKQUIET) && Chanuser_Quiet(u)) ||
           Chanuser_Gag(u) || (IsPlayer(current) && !Connected(current)))) {
       if (override_chatformat
@@ -3726,7 +3824,7 @@
  * \endverbatim
  * \param player the enactor.
  * \param name the name of the channel.
- * \param lineinfo point to array containing lines, optoinal start
+ * \param lineinfo point to array containing lines, optional start
  * \param quiet if true, don't show timestamps.
  */
 void
Index: src/Makefile.in
===================================================================
--- src/Makefile.in	(.../184p1)	(revision 682)
+++ src/Makefile.in	(.../184p2)	(revision 682)
@@ -243,6 +243,7 @@
 atr_tab.o: ../hdrs/mymalloc.h
 atr_tab.o: ../hdrs/log.h
 atr_tab.o: ../hdrs/parse.h
+atr_tab.o: ../hdrs/ansi.h
 attrib.o: ../hdrs/copyrite.h
 attrib.o: ../config.h
 attrib.o: ../hdrs/conf.h
@@ -268,6 +269,7 @@
 attrib.o: ../hdrs/lock.h
 attrib.o: ../hdrs/boolexp.h
 attrib.o: ../hdrs/log.h
+attrib.o: ../hdrs/sort.h
 boolexp.o: ../hdrs/copyrite.h
 boolexp.o: ../config.h
 boolexp.o: ../hdrs/conf.h
Index: src/wiz.c
===================================================================
--- src/wiz.c	(.../184p1)	(revision 682)
+++ src/wiz.c	(.../184p2)	(revision 682)
@@ -624,7 +624,7 @@
     global_eval_context.wnxt[j] = global_eval_context.wenv[j];
   for (j = 0; j < NUMQ; j++)
     global_eval_context.rnxt[j] = global_eval_context.renv[j];
-  parse_que(victim, command, player);
+  parse_que(victim, command, player, NULL);
 }
 
 /** Parse a force token command, but don't force with it.
@@ -1167,7 +1167,7 @@
     arg1 = "me";
 
   /* First argument is a player, so we could have a quoted name */
-  if (PLAYER_NAME_SPACES && *arg1 == '\"') {
+  if (*arg1 == '\"') {
     for (; *arg1 && ((*arg1 == '\"') || isspace((unsigned char) *arg1));
          arg1++) ;
     strcpy(tbuf, arg1);
@@ -1768,7 +1768,6 @@
                  struct search_spec *spec)
 {
   int n;
-  int is_wiz;
   const char *class, *restriction;
 
   spec->zone = spec->parent = spec->owner = ANY_OWNER;
@@ -1786,10 +1785,11 @@
   strcpy(spec->cmdstring, "");
   strcpy(spec->listenstring, "");
 
-  is_wiz = Search_All(player) || See_All(player);
   /* set limits on who we search */
-  if (!owner || !*owner || strcasecmp(owner, "all") == 0)
-    spec->owner = is_wiz ? ANY_OWNER : player;
+  if (!owner || !*owner)
+    spec->owner = (See_All(player) || Search_All(player)) ? ANY_OWNER : player;
+  else if (strcasecmp(owner, "all") == 0)
+    spec->owner = ANY_OWNER;    /* Will only show visual objects for mortals */
   else if (strcasecmp(owner, "me") == 0)
     spec->owner = player;
   else
@@ -1931,6 +1931,10 @@
       }
     } else if (string_prefix("elock", class)) {
       spec->lock = parse_boolexp(player, restriction, "Search");
+      if (spec->lock == TRUE_BOOLEXP) {
+        notify(player, T("I don't understand that key."));
+        return -1;
+      }
     } else if (string_prefix("eval", class)) {
       strcpy(spec->eval, restriction);
     } else if (string_prefix("command", class)) {
@@ -1992,6 +1996,7 @@
   struct search_spec spec;
   int count = 0;
   int ret = 0;
+  int vis_only = 0;
   ATTR *a;
   char lbuff[BUFFER_LEN];
 
@@ -2003,13 +2008,18 @@
 
   is_wiz = Search_All(player) || See_All(player);
 
-  if ((spec.owner != ANY_OWNER && spec.owner != Owner(player)) &&
-      !(is_wiz || (spec.type == TYPE_PLAYER) ||
-        (ZMaster(spec.owner) && eval_lock(player, spec.owner, Zone_Lock)))) {
-    notify(player, T("You need a search warrant to do that!"));
-    if (spec.lock != TRUE_BOOLEXP)
-      free_boolexp(spec.lock);
-    return -1;
+  /* vis_only: @searcher doesn't have see_all, and can only examine
+   * objects that they pass the CanExamine() check for.
+   */
+  if (!is_wiz && spec.owner != Owner(player)) {
+    vis_only = 1;
+
+    /* For Zones: If the player passes the zone lock on a shared player,
+     * they are considered to be able to examine everything of that player,
+     * so do not need vis_only. */
+    if (GoodObject(spec.owner) && ZMaster(spec.owner)) {
+      vis_only = !eval_lock(player, spec.owner, Zone_Lock);
+    }
   }
 
   /* make sure player has money to do the search -
@@ -2040,6 +2050,8 @@
       continue;
     if (spec.owner != ANY_OWNER && Owner(n) != spec.owner)
       continue;
+    if (vis_only && !Can_Examine(player, n))
+      continue;
     if (spec.type != NOTYPE && Typeof(n) != spec.type)
       continue;
     if (spec.zone != ANY_OWNER && Zone(n) != spec.zone)
Index: src/conf.c
===================================================================
--- src/conf.c	(.../184p1)	(revision 682)
+++ src/conf.c	(.../184p2)	(revision 682)
@@ -203,29 +203,33 @@
   ,
   {"sql_host", cf_str, options.sql_host, sizeof options.sql_host, 0, "net"}
   ,
-  {"sql_username", cf_str, options.sql_username, sizeof options.sql_username, 0,
-   NULL}
+  {"sql_username", cf_str, options.sql_username, sizeof options.sql_username,
+   CP_GODONLY,
+   "net"}
   ,
-  {"sql_password", cf_str, options.sql_password, sizeof options.sql_password, 0,
-   NULL}
+  {"sql_password", cf_str, options.sql_password, sizeof options.sql_password,
+   CP_GODONLY,
+   "net"}
   ,
-  {"sql_database", cf_str, options.sql_database, sizeof options.sql_database, 0,
-   NULL}
+  {"sql_database", cf_str, options.sql_database, sizeof options.sql_database,
+   CP_GODONLY,
+   "net"}
   ,
   {"forking_dump", cf_bool, &options.forking_dump, 2, 0, "dump"}
   ,
-  {"dump_message", cf_str, options.dump_message, sizeof options.dump_message, 0,
+  {"dump_message", cf_str, options.dump_message, sizeof options.dump_message,
+   CP_OPTIONAL,
    "dump"}
   ,
   {"dump_complete", cf_str, options.dump_complete, sizeof options.dump_complete,
-   0, "dump"}
+   CP_OPTIONAL, "dump"}
   ,
   {"dump_warning_1min", cf_str, options.dump_warning_1min,
    sizeof options.dump_warning_1min,
-   0, "dump"}
+   CP_OPTIONAL, "dump"}
   ,
   {"dump_warning_5min", cf_str, options.dump_warning_5min,
-   sizeof options.dump_warning_5min, 0,
+   sizeof options.dump_warning_5min, CP_OPTIONAL,
    "dump"}
   ,
   {"dump_interval", cf_time, &options.dump_interval, 100000, 0, "dump"}
@@ -238,10 +242,11 @@
   ,
 
   {"money_singular", cf_str, options.money_singular,
-   sizeof options.money_singular, 0,
+   sizeof options.money_singular, CP_OPTIONAL,
    "cosmetic"}
   ,
-  {"money_plural", cf_str, options.money_plural, sizeof options.money_plural, 0,
+  {"money_plural", cf_str, options.money_plural, sizeof options.money_plural,
+   CP_OPTIONAL,
    "cosmetic"}
   ,
   {"player_name_spaces", cf_bool, &options.player_name_spaces, 2, 0,
@@ -267,13 +272,15 @@
    "cosmetic"}
   ,
   {"wizwall_prefix", cf_str, options.wizwall_prefix,
-   sizeof options.wizwall_prefix, 0,
+   sizeof options.wizwall_prefix, CP_OPTIONAL,
    "cosmetic"}
   ,
-  {"rwall_prefix", cf_str, options.rwall_prefix, sizeof options.rwall_prefix, 0,
+  {"rwall_prefix", cf_str, options.rwall_prefix, sizeof options.rwall_prefix,
+   CP_OPTIONAL,
    "cosmetic"}
   ,
-  {"wall_prefix", cf_str, options.wall_prefix, sizeof options.wall_prefix, 0,
+  {"wall_prefix", cf_str, options.wall_prefix, sizeof options.wall_prefix,
+   CP_OPTIONAL,
    "cosmetic"}
   ,
   {"announce_connects", cf_bool, &options.announce_connects, 2, 0, "cosmetic"}
@@ -291,6 +298,8 @@
   ,
   {"max_guests", cf_int, &options.max_guests, 128, 0, "limits"}
   ,
+  {"connect_fail_limit", cf_int, &options.connect_fail_limit, 50, 0, "limits"}
+  ,
   {"idle_timeout", cf_time, &options.idle_timeout, 100000, 0, "limits"}
   ,
   {"unconnected_idle_timeout", cf_time, &options.unconnected_idle_timeout,
@@ -592,7 +601,7 @@
   cnf->handler = handler;
   cnf->loc = loc;
   cnf->max = max;
-  cnf->overridden = 0;
+  cnf->flags = 0;
   cnf->group = group;
   hashadd(name, (void *) cnf, &local_options);
   return cnf;
@@ -1203,15 +1212,19 @@
   /* search conf table for the option; if found, add it, if not found,
    * complain about it. Forbid use of @config to set options without
    * groups (log_wipe_passwd), or the file and message groups (@config/set
-   * output_data=../../.bashrc? Ouch.)  */
+   * output_data=../../.bashrc? Ouch.), or options which only God can see.  */
   for (cp = conftable; cp->name; cp++) {
     int i = 0;
     if ((!source || (cp->group && strcmp(cp->group, "files") != 0
-                     && strcmp(cp->group, "messages") != 0))
+                     && strcmp(cp->group, "messages") != 0
+                     && !(cp->flags & CP_GODONLY)))
         && !strcasecmp(cp->name, opt)) {
       i = cp->handler(opt, val, cp->loc, cp->max, source);
       if (i) {
-        cp->overridden = 1;
+        if (source)
+          cp->flags |= CP_CONFIGSET;
+        else
+          cp->flags |= CP_OVERRIDDEN;
         if (source == 2)
           save_config_option(cp);
       }
@@ -1226,7 +1239,10 @@
         && !strcasecmp(cp->name, opt)) {
       i = cp->handler(opt, val, cp->loc, cp->max, source);
       if (i) {
-        cp->overridden = 1;
+        if (source)
+          cp->flags |= CP_CONFIGSET;
+        else
+          cp->flags |= CP_OVERRIDDEN;
         if (source == 2)
           save_config_option(cp);
       }
@@ -1266,13 +1282,14 @@
   options.ancestor_exit = -1;
   options.ancestor_thing = -1;
   options.ancestor_player = -1;
+  options.connect_fail_limit = 10;
   options.idle_timeout = 0;
   options.unconnected_idle_timeout = 300;
   options.keepalive_timeout = 300;
   options.dump_interval = 3601;
   strcpy(options.dump_message,
-         T("GAME: Dumping database. Game may freeze for a minute"));
-  strcpy(options.dump_complete, T("GAME: Dump complete. Time in."));
+         T("GAME: Saving database. Game may freeze for a few moments."));
+  strcpy(options.dump_complete, T("GAME: Save complete. "));
   options.ident_timeout = 5;
   options.max_logins = 128;
   options.max_guests = 0;
@@ -1291,8 +1308,8 @@
   options.use_quota = 1;
   options.function_side_effects = 1;
   options.empty_attrs = 1;
-  strcpy(options.money_singular, "Penny");
-  strcpy(options.money_plural, "Pennies");
+  strcpy(options.money_singular, T("Penny"));
+  strcpy(options.money_plural, T("Pennies"));
   strcpy(options.log_wipe_passwd, "zap!");
 #ifdef WIN32
   strcpy(options.compressprog, "");
@@ -1332,10 +1349,8 @@
   options.warn_interval = 3600;
   options.use_dns = 1;
   options.safer_ufun = 1;
-  strcpy(options.dump_warning_1min,
-         T("GAME: Database will be dumped in 1 minute."));
-  strcpy(options.dump_warning_5min,
-         T("GAME: Database will be dumped in 5 minutes."));
+  strcpy(options.dump_warning_1min, T("GAME: Database save in 1 minute."));
+  strcpy(options.dump_warning_5min, T("GAME: Database save in 5 minutes."));
   options.noisy_whisper = 0;
   options.possessive_get = 1;
   options.possessive_get_d = 1;
@@ -1375,9 +1390,9 @@
   options.silent_pemit = 0;
   options.max_dbref = 0;
   options.chat_strip_quote = 1;
-  strcpy(options.wizwall_prefix, "Broadcast:");
-  strcpy(options.rwall_prefix, "Admin:");
-  strcpy(options.wall_prefix, "Announcement:");
+  strcpy(options.wizwall_prefix, T("Broadcast:"));
+  strcpy(options.rwall_prefix, T("Admin:"));
+  strcpy(options.wall_prefix, T("Announcement:"));
   strcpy(options.access_file, "access.cnf");
   strcpy(options.names_file, "names.cnf");
   options.object_cost = 10;
@@ -1533,7 +1548,7 @@
    */
   if (conf_recursion == 0) {
     for (cp = conftable; cp->name; cp++) {
-      if (!cp->overridden) {
+      if (!(cp->flags & (CP_OVERRIDDEN | CP_OPTIONAL))) {
         do_rawlog(LT_ERR,
                   "CONFIG: directive '%s' missing from cnf file, using default value.",
                   cp->name);
@@ -1541,7 +1556,7 @@
     }
     for (cp = (PENNCONF *) hash_firstentry(&local_options); cp;
          cp = (PENNCONF *) hash_nextentry(&local_options)) {
-      if (!cp->overridden) {
+      if (!(cp->flags & (CP_OVERRIDDEN | CP_OPTIONAL))) {
         do_rawlog(LT_ERR,
                   "CONFIG: local directive '%s' missing from cnf file. Using default value.",
                   cp->name);
@@ -1607,7 +1622,8 @@
     if (!found) {
       /* It wasn't a group. Is is one or more specific options? */
       for (cp = conftable; cp->name; cp++) {
-        if (cp->group && string_prefix(cp->name, type)) {
+        if (cp->group && (God(player) || !(cp->flags & CP_GODONLY))
+            && string_prefix(cp->name, type)) {
           notify(player, config_to_string(player, cp, lc));
           found = 1;
         }
@@ -1616,7 +1632,8 @@
         /* Ok, maybe a local option? */
         for (cp = (PENNCONF *) hash_firstentry(&local_options); cp;
              cp = (PENNCONF *) hash_nextentry(&local_options)) {
-          if (cp->group && !strcasecmp(cp->name, type)) {
+          if (cp->group && (God(player) || !(cp->flags & CP_GODONLY))
+              && !strcasecmp(cp->name, type)) {
             notify(player, config_to_string(player, cp, lc));
             found = 1;
           }
@@ -1654,13 +1671,15 @@
         show_compile_options(player);
       else {
         for (cp = conftable; cp->name; cp++) {
-          if (cp->group && !strcmp(cp->group, cgp->name)) {
+          if (cp->group && (God(player) || !(cp->flags & CP_GODONLY))
+              && !strcmp(cp->group, cgp->name)) {
             notify(player, config_to_string(player, cp, lc));
           }
         }
         for (cp = (PENNCONF *) hash_firstentry(&local_options); cp;
              cp = (PENNCONF *) hash_nextentry(&local_options)) {
-          if (cp->group && !strcasecmp(cp->group, cgp->name)) {
+          if (cp->group && (God(player) || !(cp->flags & CP_GODONLY))
+              && !strcasecmp(cp->group, cgp->name)) {
             notify(player, config_to_string(player, cp, lc));
           }
         }
@@ -1768,14 +1787,16 @@
 
   if (args[0] && *args[0]) {
     for (cp = conftable; cp->name; cp++) {
-      if (cp->group && !strcasecmp(cp->name, args[0])) {
+      if (cp->group && (God(executor) || !(cp->flags & CP_GODONLY))
+          && !strcasecmp(cp->name, args[0])) {
         safe_str(config_to_string2(executor, cp, 0), buff, bp);
         return;
       }
     }
     for (cp = (PENNCONF *) hash_firstentry(&local_options); cp;
          cp = (PENNCONF *) hash_nextentry(&local_options)) {
-      if (cp->group && !strcasecmp(cp->name, args[0])) {
+      if (cp->group && (God(executor) || !(cp->flags & CP_GODONLY))
+          && !strcasecmp(cp->name, args[0])) {
         safe_str(config_to_string2(executor, cp, 0), buff, bp);
         return;
       }
@@ -1785,7 +1806,7 @@
   } else {
     int first = 1;
     for (cp = conftable; cp->name; cp++) {
-      if (cp->group) {
+      if (cp->group && (God(executor) || !(cp->flags & CP_GODONLY))) {
         if (first)
           first = 0;
         else
@@ -1795,7 +1816,7 @@
     }
     for (cp = (PENNCONF *) hash_firstentry(&local_options); cp;
          cp = (PENNCONF *) hash_nextentry(&local_options)) {
-      if (cp->group) {
+      if (cp->group && (God(executor) || !(cp->flags & CP_GODONLY))) {
         if (first)
           first = 0;
         else
@@ -1818,7 +1839,10 @@
 
   for (cp = conftable; cp->name; cp++) {
     if (cp->group && !strcasecmp(cp->name, param)) {
-      if (cp->handler == cf_bool) {
+      if (cp->flags & CP_GODONLY) {
+        notify(player, T("That option cannot be altered."));
+        return;
+      } else if (cp->handler == cf_bool) {
         cf_bool(param, (state ? "yes" : "no"), cp->loc, cp->max, 1);
         if (state == 0)
           notify(player, T("Disabled."));
Index: src/attrib.c
===================================================================
--- src/attrib.c	(.../184p1)	(revision 682)
+++ src/attrib.c	(.../184p2)	(revision 682)
@@ -25,6 +25,7 @@
 #include "mushdb.h"
 #include "lock.h"
 #include "log.h"
+#include "sort.h"
 #include "confmagic.h"
 
 #ifdef WIN32
@@ -260,7 +261,7 @@
   int comp;
 
   while (**pos) {
-    comp = strcoll(name, AL_NAME(**pos));
+    comp = compare_attr_names(name, AL_NAME(**pos));
     if (comp < 0)
       return NULL;
     if (comp == 0)
@@ -1111,7 +1112,8 @@
   }
   len = strlen(name);
 
-  if (!regexp && !wildcard(name) && name[len - 1] != '`') {
+  /* Must check name[len-1] first as wildcard_count() can destructively modify name */
+  if (!regexp && name[len - 1] != '`' && wildcard_count((char *) name, 1) != -1) {
     ptr = atr_get_noparent(thing, strupper(name));
     if (ptr && (mortal ? Is_Visible_Attr(thing, ptr)
                 : Can_Read_Attr(player, thing, ptr)))
@@ -1164,7 +1166,8 @@
   }
   len = strlen(name);
 
-  if (!regexp && !wildcard(name) && name[len - 1] != '`') {
+  /* Must check name[len-1] first as wildcard_count() can destructively modify name */
+  if (!regexp && name[len - 1] != '`' && wildcard_count((char *) name, 1) != -1) {
     parent = thing;
     if (doparent)
       ptr = atr_get_with_parent(thing, strupper(name), &parent);
@@ -1237,7 +1240,8 @@
   }
   len = strlen(name);
 
-  if (!regexp && !wildcard(name) && name[len - 1] != '`') {
+  /* Must check name[len-1] first as wildcard_count() can destructively modify name */
+  if (!regexp && name[len - 1] != '`' && wildcard_count((char *) name, 1) != -1) {
     ptr = atr_get_with_parent(thing, strupper(name), &parent);
     if (ptr && (mortal ? Is_Visible_Attr(parent, ptr)
                 : Can_Read_Attr(player, parent, ptr)))
@@ -1355,7 +1359,7 @@
 
   comp = 1;
   while (**prev) {
-    comp = strcoll(name, prev[0][0]->name);
+    comp = compare_attr_names(name, prev[0][0]->name);
     if (comp <= 0)
       break;
     *prev = &prev[0][0]->next;
@@ -1548,7 +1552,7 @@
         safe_str(AL_NAME(ptr), atrname, abp);
       }
       if (!just_match)
-        parse_que(thing, s, player);
+        parse_que(thing, s, player, NULL);
     }
   }
 
@@ -1674,7 +1678,7 @@
         }
         if (!just_match) {
           /* do_rawlog(LT_TRACE, "MATCHED %s:", AL_NAME(ptr)); */
-          parse_que(thing, s, player);
+          parse_que(thing, s, player, NULL);
         }
       }
     }
@@ -1750,7 +1754,7 @@
     if (!eval_lock(player, thing, Command_Lock)
         || !eval_lock(player, thing, Use_Lock))
       return 0;
-    parse_que(thing, s, player);
+    parse_que(thing, s, player, NULL);
     return 1;
   }
   return 0;
@@ -1785,6 +1789,7 @@
   int was_hearer;
   int was_listener;
   dbref contents;
+  const char *new;
   if (!EMPTY_ATTRS && s && !*s)
     s = NULL;
   if (IsGarbage(thing)) {
@@ -1888,6 +1893,15 @@
     /* If you made it here, all your dbrefs were ok */
   }
 
+  /* For ENUM and RLIMIT */
+  new = check_attr_value(player, name, s);
+  if (s && !new) {
+    /* Invalid set - Return, don't clear. */
+    return -1;
+  } else if (new) {
+    s = new;
+  }
+
   was_hearer = Hearer(thing);
   was_listener = Listener(thing);
   res = s ? atr_add(thing, name, s, player, (flags & 0x02) ? AF_NOPROG : 0)
Index: src/function.c
===================================================================
--- src/function.c	(.../184p1)	(revision 682)
+++ src/function.c	(.../184p2)	(revision 682)
@@ -470,6 +470,7 @@
   {"HIDDEN", fun_hidden, 1, 1, FN_REG | FN_STRIPANSI},
   {"HOME", fun_home, 1, 1, FN_REG | FN_STRIPANSI},
   {"HOST", fun_hostname, 1, 1, FN_REG | FN_STRIPANSI},
+  {"IBREAK", fun_ibreak, 0, 1, FN_REG | FN_STRIPANSI},
   {"IDLE", fun_idlesecs, 1, 1, FN_REG | FN_STRIPANSI},
   {"IF", fun_if, 2, 3, FN_NOPARSE},
   {"IFELSE", fun_if, 3, 3, FN_NOPARSE},
@@ -502,7 +503,7 @@
   {"LEXITS", fun_dbwalker, 1, 1, FN_REG | FN_STRIPANSI},
   {"LFLAGS", fun_lflags, 0, 1, FN_REG | FN_STRIPANSI},
   {"LINK", fun_link, 2, 3, FN_REG | FN_STRIPANSI},
-  {"LIST", fun_list, 1, 1, FN_REG | FN_STRIPANSI},
+  {"LIST", fun_list, 1, 2, FN_REG | FN_STRIPANSI},
   {"LIT", fun_lit, 1, -1, FN_LITERAL},
   {"LJUST", fun_ljust, 2, 3, FN_REG},
   {"LLOCKFLAGS", fun_lockflags, 0, 1, FN_REG | FN_STRIPANSI},
@@ -535,6 +536,7 @@
   {"LWHO", fun_lwho, 0, 2, FN_REG | FN_STRIPANSI},
   {"LWHOID", fun_lwho, 0, 1, FN_REG | FN_STRIPANSI},
   {"MAIL", fun_mail, 0, 2, FN_REG | FN_STRIPANSI},
+  {"MAILLIST", fun_maillist, 0, 2, FN_REG | FN_STRIPANSI},
   {"MAILFROM", fun_mailfrom, 1, 2, FN_REG | FN_STRIPANSI},
   {"MAILSEND", fun_mailsend, 2, 2, FN_REG},
   {"MAILSTATS", fun_mailstats, 1, 1, FN_REG | FN_STRIPANSI},
@@ -648,8 +650,8 @@
   {"REGRABALL", fun_regrab, 2, 4, FN_REG},
   {"REGRABALLI", fun_regrab, 2, 4, FN_REG},
   {"REGRABI", fun_regrab, 2, 3, FN_REG},
-  {"REGREP", fun_regrep, 3, 3, FN_REG},
-  {"REGREPI", fun_regrep, 3, 3, FN_REG},
+  {"REGREP", fun_grep, 3, 3, FN_REG},
+  {"REGREPI", fun_grep, 3, 3, FN_REG},
   {"REGLATTR", fun_lattr, 1, 2, FN_REG},
   {"REGLATTRP", fun_lattr, 1, 2, FN_REG},
   {"REGNATTR", fun_nattr, 1, 1, FN_REG},
@@ -723,6 +725,8 @@
   {"SUBJ", fun_subj, 1, 1, FN_REG | FN_STRIPANSI},
   {"SWITCH", fun_switch, 3, INT_MAX, FN_NOPARSE},
   {"SWITCHALL", fun_switch, 3, INT_MAX, FN_NOPARSE},
+  {"SLEV", fun_slev, 0, 0, FN_REG},
+  {"STEXT", fun_stext, 1, 1, FN_REG | FN_STRIPANSI},
   {"T", fun_t, 1, 1, FN_REG | FN_STRIPANSI},
   {"TABLE", fun_table, 1, 5, FN_REG},
   {"TEL", fun_tel, 2, 4, FN_REG | FN_STRIPANSI},
@@ -828,10 +832,10 @@
  * \param lc if 1, return functions in lowercase.
  */
 void
-do_list_functions(dbref player, int lc)
+do_list_functions(dbref player, int lc, char *type)
 {
   /* lists all built-in functions. */
-  char *b = list_functions(NULL);
+  char *b = list_functions(type);
   notify_format(player, T("Functions: %s"), lc ? strlower(b) : b);
 }
 
@@ -982,9 +986,7 @@
 }
 
 /** Function initization to perform after reading the config file.
- * This function performs post-config initialization. Specifically,
- * we need the max_globals value from the config file before we
- * can allocate the global user function table here.
+ * This function performs post-config initialization.
  */
 void
 function_init_postconfig(void)
Index: src/cmds.c
===================================================================
--- src/cmds.c	(.../184p1)	(revision 682)
+++ src/cmds.c	(.../184p2)	(revision 682)
@@ -41,7 +41,7 @@
 
 void do_dolist(dbref player, char *list, char *command,
                dbref cause, unsigned int flags);
-void do_list(dbref player, char *arg, int lc);
+void do_list(dbref player, char *arg, int lc, int which);
 void do_writelog(dbref player, char *str, int ltype);
 void do_readcache(dbref player);
 void do_scan(dbref player, char *command, int flag);
@@ -86,6 +86,16 @@
       do_attribute_rename(player, arg_left, arg_right);
     else
       notify(player, T("Permission denied."));
+  } else if (SW_ISSET(sw, SWITCH_LIMIT)) {
+    if (Wizard(player))
+      do_attribute_limit(player, arg_left, AF_RLIMIT, arg_right);
+    else
+      notify(player, T("Permission denied."));
+  } else if (SW_ISSET(sw, SWITCH_ENUM)) {
+    if (Wizard(player))
+      do_attribute_limit(player, arg_left, AF_ENUM, arg_right);
+    else
+      notify(player, T("Permission denied."));
   } else
     do_attribute_info(player, arg_left);
 }
@@ -454,13 +464,24 @@
   }
 }
 
-
 COMMAND(cmd_grep)
 {
-  do_grep(player, arg_left, arg_right, ((SW_ISSET(sw, SWITCH_IPRINT))
-                                        || (SW_ISSET(sw, SWITCH_PRINT))),
-          ((SW_ISSET(sw, SWITCH_IPRINT))
-           || (SW_ISSET(sw, SWITCH_ILIST))));
+  int flags = 0;
+  int print = 0;
+
+  if (SW_ISSET(sw, SWITCH_IPRINT) || SW_ISSET(sw, SWITCH_ILIST)
+      || SW_ISSET(sw, SWITCH_NOCASE))
+    flags |= GREP_NOCASE;
+
+  if (SW_ISSET(sw, SWITCH_REGEXP))
+    flags |= GREP_REGEXP;
+  else if (SW_ISSET(sw, SWITCH_WILD))
+    flags |= GREP_WILD;
+
+  if (SW_ISSET(sw, SWITCH_IPRINT) || SW_ISSET(sw, SWITCH_PRINT))
+    print = 1;
+
+  do_grep(player, arg_left, arg_right, print, flags);
 }
 
 COMMAND(cmd_halt)
@@ -540,13 +561,22 @@
 COMMAND(cmd_list)
 {
   int lc;
+  int which = 3;
+  char *fwhich[3] = { "builtin", "local", "all" };
   lc = SW_ISSET(sw, SWITCH_LOWERCASE);
+  if (SW_ISSET(sw, SWITCH_ALL))
+    which = 3;
+  else if (SW_ISSET(sw, SWITCH_LOCAL))
+    which = 2;
+  else if (SW_ISSET(sw, SWITCH_BUILTIN))
+    which = 1;
+
   if (SW_ISSET(sw, SWITCH_MOTD))
     do_motd(player, MOTD_LIST, "");
   else if (SW_ISSET(sw, SWITCH_FUNCTIONS))
-    do_list_functions(player, lc);
+    do_list_functions(player, lc, fwhich[which - 1]);
   else if (SW_ISSET(sw, SWITCH_COMMANDS))
-    do_list_commands(player, lc);
+    do_list_commands(player, lc, which);
   else if (SW_ISSET(sw, SWITCH_ATTRIBS))
     do_list_attribs(player, lc);
   else if (SW_ISSET(sw, SWITCH_LOCKS))
@@ -558,7 +588,7 @@
   else if (SW_ISSET(sw, SWITCH_ALLOCATIONS))
     do_list_allocations(player);
   else
-    do_list(player, arg_left, lc);
+    do_list(player, arg_left, lc, which);
 }
 
 COMMAND(cmd_lock)
@@ -899,6 +929,8 @@
     do_queue(player, arg_left, QUEUE_SUMMARY);
   else if (SW_ISSET(sw, SWITCH_QUICK))
     do_queue(player, arg_left, QUEUE_QUICK);
+  else if (arg_left && *arg_left && is_uinteger(arg_left))
+    do_queue_single(player, arg_left);
   else
     do_queue(player, arg_left, QUEUE_NORMAL);
 }
Index: src/markup.c
===================================================================
--- src/markup.c	(.../184p1)	(revision 682)
+++ src/markup.c	(.../184p2)	(revision 682)
@@ -703,6 +703,15 @@
 
 }
 
+int
+has_markup(const char *test)
+{
+  /* strtok modifies, so we don't use it. */
+  return (strchr(test, ESC_CHAR)
+          || strchr(test, TAG_START)
+          || strchr(test, TAG_END));
+}
+
 static char *
 parse_tagname(const char *ptr)
 {
Index: src/funmisc.c
===================================================================
--- src/funmisc.c	(.../184p1)	(revision 682)
+++ src/funmisc.c	(.../184p2)	(revision 682)
@@ -472,6 +472,10 @@
   }
 }
 
+#define CLEAR_SWITCH_VALUE(pe) \
+  pe->switch_text[pe->switch_nesting] = NULL; \
+  pe->switch_nesting--; \
+  pe_info->local_switch_nesting--;
 /* ARGSUSED */
 FUNCTION(fun_switch)
 {
@@ -488,6 +492,11 @@
   char *tbuf1 = NULL;
   int first = 1, found = 0, exact = 0;
 
+  if (pe_info->switch_nesting >= MAX_ITERS) {
+    safe_str(T("#-1 TOO MANY SWITCHES"), buff, bp);
+    return;
+  }
+
   if (strstr(called_as, "ALL"))
     first = 0;
 
@@ -500,6 +509,10 @@
                      PE_DEFAULT, PT_DEFAULT, pe_info);
   *dp = '\0';
 
+  pe_info->switch_nesting++;
+  pe_info->local_switch_nesting++;
+  pe_info->switch_text[pe_info->switch_nesting] = mstr;
+
   /* try matching, return match immediately when found */
 
   for (j = 1; j < (nargs - 1); j += 2) {
@@ -528,8 +541,10 @@
       if (!exact)
         mush_free(tbuf1, "replace_string.buff");
       found = 1;
-      if (per || first)
+      if (per || first) {
+        CLEAR_SWITCH_VALUE(pe_info);
         return;
+      }
     }
   }
 
@@ -545,8 +560,38 @@
     if (!exact)
       mush_free(tbuf1, "replace_string.buff");
   }
+  CLEAR_SWITCH_VALUE(pe_info);
+}
+
+/* ARGSUSED */
+FUNCTION(fun_slev)
+{
+  safe_integer(pe_info->local_switch_nesting, buff, bp);
+}
+
+/* ARGSUSED */
+FUNCTION(fun_stext)
+{
+  int i;
+
+  if (!strcasecmp(args[0], "l")) {
+    i = pe_info->local_switch_nesting;
+  } else if (is_strict_integer(args[0])) {
+    i = parse_integer(args[0]);
+  } else {
+    safe_str(T(e_int), buff, bp);
+    return;
+  }
+
+  if (i < 0 || i > pe_info->local_switch_nesting
+      || (pe_info->local_switch_nesting - i) < 0) {
+    safe_str(T(e_argrange), buff, bp);
+    return;
+  }
+  safe_str(pe_info->switch_text[pe_info->local_switch_nesting - i], buff, bp);
 }
 
+/* ARGSUSED */
 FUNCTION(fun_reswitch)
 {
   /* this works a bit like the @switch/regexp command */
@@ -564,6 +609,11 @@
   int erroffset;
   pcre_extra *extra;
 
+  if (pe_info->switch_nesting >= MAX_ITERS) {
+    safe_str(T("#-1 TOO MANY SWITCHES"), buff, bp);
+    return;
+  }
+
   if (strstr(called_as, "ALL"))
     first = 0;
 
@@ -580,6 +630,10 @@
 
   save_regexp_context(&rsave);
 
+  pe_info->switch_nesting++;
+  pe_info->local_switch_nesting++;
+  pe_info->switch_text[pe_info->switch_nesting] = mstr;
+
   /* try matching, return match immediately when found */
 
   for (j = 1; j < (nargs - 1); j += 2) {
@@ -621,6 +675,7 @@
     if (first && found) {
       free_ansi_string(mas);
       restore_regexp_context(&rsave);
+      CLEAR_SWITCH_VALUE(pe_info);
       return;
     }
     /* clear regexp context again here */
@@ -631,6 +686,7 @@
     if (per) {
       free_ansi_string(mas);
       restore_regexp_context(&rsave);
+      CLEAR_SWITCH_VALUE(pe_info);
       return;
     }
   }
@@ -643,9 +699,12 @@
     mush_free(tbuf1, "replace_string.buff");
   }
   free_ansi_string(mas);
+  CLEAR_SWITCH_VALUE(pe_info);
   restore_regexp_context(&rsave);
 }
 
+#undef CLEAR_SWITCH_VALUE
+
 /* ARGSUSED */
 FUNCTION(fun_if)
 {
@@ -838,6 +897,18 @@
 /* ARGSUSED */
 FUNCTION(fun_list)
 {
+  int which = 3;
+  char *fwhich[3] = { "builtin", "local", "all" };
+  if (nargs == 2) {
+    if (!strcasecmp(args[1], "local"))
+      which = 2;
+    else if (!strcasecmp(args[1], "builtin"))
+      which = 1;
+    else if (strcasecmp(args[1], "all")) {
+      safe_str("#-1", buff, bp);
+      return;
+    }
+  }
   if (!args[0] || !*args[0])
     safe_str("#-1", buff, bp);
   else if (string_prefix("motd", args[0]))
@@ -849,11 +920,11 @@
   else if (string_prefix("fullmotd", args[0]) && Hasprivs(executor))
     safe_str(cf_fullmotd_msg, buff, bp);
   else if (string_prefix("functions", args[0]))
-    safe_str(list_functions(NULL), buff, bp);
+    safe_str(list_functions(fwhich[which - 1]), buff, bp);
   else if (string_prefix("@functions", args[0]))
     safe_str(list_functions("local"), buff, bp);
   else if (string_prefix("commands", args[0]))
-    safe_str(list_commands(), buff, bp);
+    safe_str(list_commands(which), buff, bp);
   else if (string_prefix("attribs", args[0]))
     safe_str(list_attribs(), buff, bp);
   else if (string_prefix("locks", args[0]))
@@ -994,7 +1065,7 @@
   unsigned int min = UINT_MAX;
   unsigned int max = 0;
   unsigned int total = 0;
-  int i;
+  int i = 0;
   dbref thing = NOTHING;
 
   if (!is_number(args[1])) {
@@ -1027,12 +1098,13 @@
     }
   }
 
-  for (i = 1; i <= n; i++) {
+  while (i < n) {
     uint64_t start;
     unsigned int elapsed;
     tp = tbuf;
     sp = args[0];
     start = get_tsc();
+    ++i;
     if (process_expression(tbuf, &tp, &sp, executor, caller, enactor,
                            PE_DEFAULT, PT_DEFAULT, pe_info)) {
       *tp = '\0';
Index: src/move.c
===================================================================
--- src/move.c	(.../184p1)	(revision 682)
+++ src/move.c	(.../184p2)	(revision 682)
@@ -685,10 +685,12 @@
       notify(player, T("Sorry, you can't drop exits."));
       return;
     } else if (!eval_lock(player, thing, Drop_Lock)) {
-      notify(player, T("You can't seem to get rid of that."));
+      fail_lock(player, thing, Drop_Lock,
+                T("You can't seem to get rid of that."), NOTHING);
       return;
     } else if (IsRoom(loc) && !eval_lock(player, loc, Drop_Lock)) {
-      notify(player, T("You can't seem to drop things here."));
+      fail_lock(player, loc, Drop_Lock,
+                T("You can't seem to drop things here."), NOTHING);
       return;
     } else if (Sticky(thing) && !Fixed(thing)) {
       notify(thing, T("Dropped."));
Index: src/bsd.c
===================================================================
--- src/bsd.c	(.../184p1)	(revision 682)
+++ src/bsd.c	(.../184p2)	(revision 682)
@@ -2381,22 +2381,11 @@
     if (d->connected) {
       send_prefix(d);
       global_eval_context.cplr = d->player;
-      mush_strncpy(global_eval_context.ccom, command, BUFFER_LEN);
-      global_eval_context.ucom[0] = '\0';
-
-      /* Clear %0-%9 and r(0) - r(9) */
-      for (j = 0; j < 10; j++)
-        global_eval_context.wenv[j] = (char *) NULL;
-      for (j = 0; j < NUMQ; j++)
-        global_eval_context.renv[j][0] = '\0';
-      global_eval_context.process_command_port = d->descriptor;
-      global_eval_context.pe_info = make_pe_info();
-      process_command(d->player, command, d->player, 1);
+      run_user_input(d->player, command);
       send_suffix(d);
       strcpy(global_eval_context.ccom, "");
       strcpy(global_eval_context.ucom, "");
       global_eval_context.cplr = NOTHING;
-      free_pe_info(global_eval_context.pe_info);
     } else {
       j = 0;
       if (!strncmp(command, WHO_COMMAND, strlen(WHO_COMMAND))) {
@@ -4080,7 +4069,7 @@
   count = parse_integer(args[1]);
 
   if (start < 1 || count < 1) {
-    safe_str(T("#-1 ARGUMENT OUT OF RANGE"), buff, bp);
+    safe_str(T(e_argrange), buff, bp);
     return;
   }
 
Index: src/SWITCHES
===================================================================
--- src/SWITCHES	(.../184p1)	(revision 682)
+++ src/SWITCHES	(.../184p2)	(revision 682)
@@ -18,6 +18,7 @@
 CLEAR
 CLONE
 CMD
+COMBINE
 COMMANDS
 CONN
 CONNECT
@@ -40,6 +41,7 @@
 DSTATS
 EMIT
 ENABLE
+ENUM
 EQSPLIT
 ERR
 EXITS
@@ -66,6 +68,8 @@
 JOIN
 LETTER
 LIST
+LIMIT
+LOCAL
 LOCKS
 LOWERCASE
 LSARGS
@@ -78,6 +82,7 @@
 MUTE
 NAME
 NO
+NOCASE
 NOEVAL
 NOFLAGCOPY
 NOISY
@@ -140,6 +145,7 @@
 TRACE
 TYPE
 UNCLEAR
+UNCOMBINE
 UNHIDE
 UNGAG
 UNFOLDER
@@ -151,6 +157,7 @@
 USEFLAG
 WHAT
 WHO
+WILD
 WIPE
 WIZ
 WIZARD
Index: src/funstr.c
===================================================================
--- src/funstr.c	(.../184p1)	(revision 682)
+++ src/funstr.c	(.../184p2)	(revision 682)
@@ -556,11 +556,7 @@
 /* ARGSUSED */
 FUNCTION(fun_strmatch)
 {
-  char tbuf[BUFFER_LEN];
-  char pattern[BUFFER_LEN];
   char *ret[36];
-  char *t;
-  size_t len;
   int matches;
   int i;
   char *qregs[NUMQ];
@@ -571,27 +567,27 @@
 
   /* matches a wildcard pattern for an _entire_ string */
 
-  t = remove_markup(args[0], &len);
-  memcpy(tbuf, t, len);
-  t = remove_markup(args[1], &len);
-  memcpy(pattern, t, len);
-  memset(ret, 0, 36);
-  matches = wild_match_case_r(pattern, tbuf, 0, ret,
-                              NUMQ, match_space, match_space_len);
-  safe_boolean(matches, buff, bp);
-
   if (nargs > 2) {
-    /* Now, assign the captures if desired */
-    nqregs = list2arr(qregs, NUMQ, args[2], ' ');
+    matches = wild_match_case_r(args[1], args[0], 0, ret,
+                                NUMQ, match_space, match_space_len);
+    safe_boolean(matches, buff, bp);
 
-    for (i = 0; i < nqregs; i++) {
-      if (ret[i] && qregs[i][0] && !qregs[i][1]) {
-        qindex = qreg_indexes[(unsigned char) qregs[i][0]];
-        if (qindex >= 0 && global_eval_context.renv[qindex]) {
-          strcpy(global_eval_context.renv[qindex], ret[i]);
+    if (matches) {
+      /* Now, assign the captures, if we have returns. */
+      nqregs = list2arr(qregs, NUMQ, args[2], ' ');
+
+      for (i = 0; i < nqregs; i++) {
+        if (ret[i] && qregs[i][0] && !qregs[i][1]) {
+          qindex = qreg_indexes[(unsigned char) qregs[i][0]];
+          if (qindex >= 0 && global_eval_context.renv[qindex]) {
+            strncpy(global_eval_context.renv[qindex], ret[i], BUFFER_LEN);
+          }
         }
       }
     }
+  } else {
+    matches = wild_match_case_r(args[1], args[0], 0, NULL, 0, NULL, 0);
+    safe_boolean(matches, buff, bp);
   }
 }
 
@@ -2107,7 +2103,7 @@
     if (args[3]) {
       /* we have a transform attr */
       transform = 1;
-      if (!fetch_ufun_attrib(args[3], executor, &transufun, 1)) {
+      if (!fetch_ufun_attrib(args[3], executor, &transufun, UFUN_DEFAULT)) {
         safe_str(T(e_atrperm), buff, bp);
         return;
       }
@@ -2115,7 +2111,7 @@
         if (args[4]) {
           /* we have an attr to use when transform returns an empty string */
           null = 1;
-          if (!fetch_ufun_attrib(args[4], executor, &nullufun, 1)) {
+          if (!fetch_ufun_attrib(args[4], executor, &nullufun, UFUN_DEFAULT)) {
             safe_str(T(e_atrperm), buff, bp);
             return;
           }
Index: src/rob.c
===================================================================
--- src/rob.c	(.../184p1)	(revision 682)
+++ src/rob.c	(.../184p2)	(revision 682)
@@ -386,7 +386,8 @@
         return;
       }
       if (!eval_lock(player, thing, Give_Lock)) {
-        notify(player, T("You can't give that away."));
+        fail_lock(player, thing, Give_Lock,
+                  T("You can't give that away."), NOTHING);
         return;
       }
 
Index: src/funufun.c
===================================================================
--- src/funufun.c	(.../184p1)	(revision 682)
+++ src/funufun.c	(.../184p2)	(revision 682)
@@ -188,9 +188,13 @@
 {
   char rbuff[BUFFER_LEN];
   ufun_attrib ufun;
+  int flags = UFUN_OBJECT;
 
-  if (!fetch_ufun_attrib
-      (args[0], executor, &ufun, (!strcmp(called_as, "ULAMBDA")))) {
+  if (!strcmp(called_as, "ULAMBDA")) {
+    flags |= UFUN_LAMBDA;
+  }
+
+  if (!fetch_ufun_attrib(args[0], executor, &ufun, flags)) {
     safe_str(T(ufun.errmess), buff, bp);
     return;
   }
@@ -235,6 +239,7 @@
   mush_strncpy(ufun.contents, atr_value(a), BUFFER_LEN);
   ufun.pe_flags = pe_flags;
   ufun.errmess = (char *) "";
+  ufun.ufun_flags = UFUN_NONE;
 
   call_ufun(&ufun, args + 1, nargs - 1, rbuff, executor, enactor, pe_info);
 
@@ -250,11 +255,11 @@
 /* ARGSUSED */
 FUNCTION(fun_udefault)
 {
-  dbref thing;
-  ATTR *attrib;
+  ufun_attrib ufun;
   char *dp;
   char const *sp;
   char mstr[BUFFER_LEN];
+  char rbuff[BUFFER_LEN];
   char **xargs;
   int i;
 
@@ -264,49 +269,51 @@
   process_expression(mstr, &dp, &sp, executor, caller, enactor,
                      PE_DEFAULT, PT_DEFAULT, pe_info);
   *dp = '\0';
-  parse_attrib(executor, mstr, &thing, &attrib);
-  if (GoodObject(thing) && attrib && CanEvalAttr(executor, thing, attrib)
-      && Can_Read_Attr(executor, thing, attrib)) {
-    /* Ok, we've got it */
-    /* We must now evaluate all the arguments from args[2] on and
-     * pass them to the function */
-    xargs = NULL;
-    if (nargs > 2) {
-      xargs = mush_calloc(nargs - 2, sizeof(char *), "udefault.xargs");
-      for (i = 0; i < nargs - 2; i++) {
-        xargs[i] = mush_malloc(BUFFER_LEN, "udefault");
-        dp = xargs[i];
-        sp = args[i + 2];
-        process_expression(xargs[i], &dp, &sp, executor, caller, enactor,
-                           PE_DEFAULT, PT_DEFAULT, pe_info);
-        *dp = '\0';
-      }
-    }
-    do_userfn(buff, bp, thing, attrib, nargs - 2, xargs,
-              executor, caller, enactor, pe_info, 0);
+  if (!fetch_ufun_attrib
+      (mstr, executor, &ufun, UFUN_OBJECT | UFUN_REQUIRE_ATTR)) {
+    /* We couldn't get it. Evaluate args[1] and return it */
+    sp = args[1];
 
-    /* Free the xargs */
-    if (nargs > 2) {
-      for (i = 0; i < nargs - 2; i++)
-        mush_free(xargs[i], "udefault");
-      mush_free(xargs, "udefault.xargs");
-    }
+    process_expression(buff, bp, &sp, executor, caller, enactor,
+                       PE_DEFAULT, PT_DEFAULT, pe_info);
     return;
   }
-  /* We couldn't get it. Evaluate args[1] and return it */
-  sp = args[1];
 
-  process_expression(buff, bp, &sp, executor, caller, enactor,
-                     PE_DEFAULT, PT_DEFAULT, pe_info);
+  /* Ok, we've got it */
+  /* We must now evaluate all the arguments from args[2] on and
+   * pass them to the function */
+  xargs = NULL;
+  if (nargs > 2) {
+    xargs = mush_calloc(nargs - 2, sizeof(char *), "udefault.xargs");
+    for (i = 0; i < nargs - 2; i++) {
+      xargs[i] = mush_malloc(BUFFER_LEN, "udefault");
+      dp = xargs[i];
+      sp = args[i + 2];
+      process_expression(xargs[i], &dp, &sp, executor, caller, enactor,
+                         PE_DEFAULT, PT_DEFAULT, pe_info);
+      *dp = '\0';
+    }
+  }
+  call_ufun(&ufun, xargs, nargs - 2, rbuff, executor, enactor, pe_info);
+  safe_str(rbuff, buff, bp);
+
+  /* Free the xargs */
+  if (nargs > 2) {
+    for (i = 0; i < nargs - 2; i++)
+      mush_free(xargs[i], "udefault");
+    mush_free(xargs, "udefault.xargs");
+  }
   return;
+
 }
 
 
 /* ARGSUSED */
 FUNCTION(fun_zfun)
 {
-  ATTR *attrib;
+  ufun_attrib ufun;
   dbref zone;
+  char rbuff[BUFFER_LEN];
 
   zone = Zone(executor);
 
@@ -314,20 +321,15 @@
     safe_str(T("#-1 INVALID ZONE"), buff, bp);
     return;
   }
+
   /* find the user function attribute */
-  attrib = atr_get(zone, upcasestr(args[0]));
-  if (attrib && Can_Read_Attr(executor, zone, attrib)) {
-    if (!CanEvalAttr(executor, zone, attrib)) {
-      safe_str(T(e_perm), buff, bp);
-      return;
-    }
-    do_userfn(buff, bp, zone, attrib, nargs - 1, args + 1, executor, caller,
-              enactor, pe_info, 0);
-    return;
-  } else if (attrib || !Can_Examine(executor, zone)) {
-    safe_str(T(e_atrperm), buff, bp);
+  if (!fetch_ufun_attrib
+      (tprintf("#%d/%s", zone, args[0]), executor, &ufun, UFUN_OBJECT)) {
+    safe_str(T(ufun.errmess), buff, bp);
     return;
   }
-  safe_str(T("#-1 NO SUCH USER FUNCTION"), buff, bp);
-  return;
+
+  call_ufun(&ufun, args + 1, nargs - 1, rbuff, executor, enactor, pe_info);
+
+  safe_str(rbuff, buff, bp);
 }
Index: src/sort.c
===================================================================
--- src/sort.c	(.../184p1)	(revision 682)
+++ src/sort.c	(.../184p2)	(revision 682)
@@ -278,10 +278,12 @@
     case ESC_CHAR:
       while (*s && *s != 'm')
         s++;
+      s++; /* Advance past m */
       break;
     case TAG_START:
       while (*s && *s != TAG_END)
         s++;
+      s++; /* Advance past tag_end */
       break;
     case '0':
     case '1':
@@ -338,9 +340,9 @@
       }
     default:
       safe_chr(*s, buff, &bp);
+      if (*s)
+        s++;
     }
-    if (*s)
-      s++;
   }
   *bp = '\0';
   rec->memo.str.s = mush_strdup(buff, "genrecord");
@@ -501,6 +503,58 @@
   return Compare(res, sr1, sr2) * sort_order;
 }
 
+int
+attr_comp(const void *s1, const void *s2)
+{
+  const s_rec *sr1 = (const s_rec *) s1;
+  const s_rec *sr2 = (const s_rec *) s2;
+
+  return compare_attr_names(sr1->memo.str.s, sr2->memo.str.s);
+
+}
+
+int
+compare_attr_names(const char *attr1, const char *attr2)
+{
+  char word1[BUFFER_LEN + 1], word2[BUFFER_LEN + 1];
+  char *a1, *a2, *next1, *next2;
+  int branches1 = 1, branches2 = 1;
+  int cmp;
+
+  strcpy(word1, attr1);
+  strcpy(word2, attr2);
+
+  a1 = word1;
+  a2 = word2;
+
+  while (a1 && a2) {
+    next1 = strchr(a1, '`');
+    if (next1) {
+      branches1++;
+      *(next1)++ = '\0';
+    }
+    next2 = strchr(a2, '`');
+    if (next2) {
+      branches2++;
+      *(next2)++ = '\0';
+    }
+    cmp = strcoll(a1, a2);
+    if (cmp != 0) {
+      /* Current branch differs */
+      return cmp * sort_order;
+    }
+    if (branches1 != branches2) {
+      /* Current branch is the same, but one attr has more branches */
+      return (branches1 < branches2 ? -1 : 1) * sort_order;
+    }
+    a1 = next1;
+    a2 = next2;
+  }
+  /* All branches were the same */
+  return 0;
+
+}
+
 static int
 si_comp(const void *s1, const void *s2)
 {
@@ -537,7 +591,7 @@
 }
 
 typedef struct _list_type_list_ {
-  char *name;
+  SortType name;
   makerecord make_record;
   qsort_func sorter;
   uint32_t flags;
@@ -561,6 +615,7 @@
 char DBREF_LOCATION_LIST[] = "LOC";
 char DBREF_ATTR_LIST[] = "ATTR";
 char DBREF_ATTRI_LIST[] = "ATTRI";
+char ATTRNAME_LIST[] = "LATTR";
 char *UNKNOWN_LIST = NULL;
 
 list_type_list ltypelist[] = {
@@ -570,7 +625,7 @@
   {DBREF_LIST, gen_dbref, i_comp, 0},
   {NUMERIC_LIST, gen_num, i_comp, 0},
   {FLOAT_LIST, gen_float, f_comp, 0},
-  {MAGIC_LIST, gen_magic, si_comp, 0},
+  {MAGIC_LIST, gen_magic, si_comp, IS_STRING},
   {DBREF_NAME_LIST, gen_db_name, si_comp, IS_DB | IS_STRING},
   {DBREF_NAMEI_LIST, gen_db_name, si_comp, IS_DB | IS_STRING},
   {DBREF_IDLE_LIST, gen_db_idle, i_comp, IS_DB},
@@ -580,42 +635,44 @@
   {DBREF_LOCATION_LIST, gen_db_loc, i_comp, IS_DB},
   {DBREF_ATTR_LIST, gen_db_attr, s_comp, IS_DB | IS_STRING},
   {DBREF_ATTRI_LIST, gen_db_attr, si_comp, IS_DB | IS_STRING},
+  {ATTRNAME_LIST, gen_alphanum, attr_comp, IS_STRING},
   /* This stops the loop, so is default */
   {NULL, gen_alphanum, s_comp, IS_STRING}
 };
 
-char *
+SortType
 get_list_type(char *args[], int nargs, int type_pos, char *ptrs[], int nptrs)
 {
-  static char stype[BUFFER_LEN];
-  int i;
-  char *str;
+  int i, len;
+  char *str, *ptr;
   sort_order = ASCENDING;
   if (nargs >= type_pos) {
     str = args[type_pos - 1];
-    if (str && *str == '-') {
-      str++;
-      sort_order = DESCENDING;
-    }
-    if (str && *str) {
-      copy_up_to(stype, str, ':');
-      for (i = 0; ltypelist[i].name && strcasecmp(ltypelist[i].name, stype);
-           i++) ;
-      /* return ltypelist[i].name; */
-      if (ltypelist[i].name) {
-        return args[type_pos - 1];
+    if (*str) {
+      if (*str == '-') {
+        str++;
+        sort_order = DESCENDING;
       }
+      ptr = strchr(str, ':');
+      if (ptr) {
+        len = ptr - str;
+      } else {
+        len = strlen(str);
+      }
+      for (i = 0; ltypelist[i].name &&
+           strncasecmp(ltypelist[i].name, str, len); i++) ;
+      /* return ltypelist[i].name; */
+      return args[type_pos - 1];
     }
   }
   return autodetect_list(ptrs, nptrs);
 }
 
-char *
+SortType
 get_list_type_noauto(char *args[], int nargs, int type_pos)
 {
-  static char stype[BUFFER_LEN];
-  int i;
-  char *str;
+  int i, len;
+  char *str, *ptr;
   sort_order = ASCENDING;
   if (nargs >= type_pos) {
     str = args[type_pos - 1];
@@ -624,9 +681,14 @@
         str++;
         sort_order = DESCENDING;
       }
-      copy_up_to(stype, str, ':');
-      for (i = 0; ltypelist[i].name && strcasecmp(ltypelist[i].name, stype);
-           i++) ;
+      ptr = strchr(str, ':');
+      if (ptr) {
+        len = ptr - str;
+      } else {
+        len = strlen(str);
+      }
+      for (i = 0; ltypelist[i].name &&
+           strncasecmp(ltypelist[i].name, str, len); i++) ;
       /* return ltypelist[i].name; */
       return args[type_pos - 1];
     }
@@ -639,7 +701,7 @@
  * \param
  */
 int
-gencomp(dbref player, char *a, char *b, char *sort_type)
+gencomp(dbref player, char *a, char *b, SortType sort_type)
 {
   char *ptr;
   int i, len;
@@ -695,7 +757,7 @@
  */
 
 void
-do_gensort(dbref player, char *keys[], char *strs[], int n, char *sort_type)
+do_gensort(dbref player, char *keys[], char *strs[], int n, SortType sort_type)
 {
   char *ptr;
   static char stype[BUFFER_LEN];
@@ -751,6 +813,26 @@
   mush_free(sp, "do_gensort");
 }
 
+SortType
+autodetect_2lists(char *ptrs[], int nptrs, char *ptrs2[], int nptrs2)
+{
+  SortType a = autodetect_list(ptrs, nptrs);
+  SortType b = autodetect_list(ptrs2, nptrs2);
+
+  /* If they're equal, no problem. */
+  if (a == b) {
+    return a;
+  }
+  /* Float and numeric means float. */
+  if ((a == NUMERIC_LIST || a == FLOAT_LIST) &&
+      (b == NUMERIC_LIST || b == FLOAT_LIST)) {
+    return FLOAT_LIST;
+  }
+
+  /* Magic list by default. */
+  return MAGIC_LIST;
+}
+
 typedef enum {
   L_NUMERIC,
   L_FLOAT,
@@ -758,48 +840,33 @@
   L_DBREF
 } ltype;
 
-char *
+SortType
 autodetect_list(char *ptrs[], int nptrs)
 {
-  char *sort_type;
-  ltype lt;
   int i;
+  ltype lt;
+  SortType sort_type = NUMERIC_LIST;
 
   lt = L_NUMERIC;
-  sort_type = NUMERIC_LIST;
-
   for (i = 0; i < nptrs; i++) {
+    /* Just one big chain of fall-throughs =). */
     switch (lt) {
     case L_NUMERIC:
-      if (!is_strict_integer(ptrs[i])) {
-        /* If it's not an integer, see if it's a floating-point number */
-        if (is_strict_number(ptrs[i])) {
-          lt = L_FLOAT;
-          sort_type = FLOAT_LIST;
-        } else if (i == 0) {
-
-          /* If we get something non-numeric, switch to an
-           * alphanumeric guess, unless this is the first
-           * element and we have a dbref.
-           */
-          if (is_objid(ptrs[i])) {
-            lt = L_DBREF;
-            sort_type = DBREF_LIST;
-          } else
-            return ALPHANUM_LIST;
-        }
+      if (is_strict_integer(ptrs[i])) {
+        break;
       }
-      break;
     case L_FLOAT:
-      if (!is_strict_number(ptrs[i]))
-        return ALPHANUM_LIST;
-      break;
+      if (is_strict_number(ptrs[i])) {
+        lt = L_FLOAT;
+        sort_type = FLOAT_LIST;
+      }
     case L_DBREF:
-      if (!is_objid(ptrs[i]))
-        return ALPHANUM_LIST;
-      break;
-    default:
-      return ALPHANUM_LIST;
+      if (is_objid(ptrs[i]) && (i == 0 || lt == L_DBREF)) {
+        lt = L_DBREF;
+        sort_type = DBREF_LIST;
+      }
+    case L_ALPHANUM:
+      return MAGIC_LIST;
     }
   }
   return sort_type;
Index: src/flags.c
===================================================================
--- src/flags.c	(.../184p1)	(revision 682)
+++ src/flags.c	(.../184p2)	(revision 682)
@@ -1477,7 +1477,8 @@
   Flagspace_Lookup(n, ns);
   for (i = 0; i < n->flagbits; i++)
     if ((f = n->flags[i])) {
-      if (has_flag_ns(n, thing, f) && Can_See_Flag(player, thing, f))
+      if (has_flag_ns(n, thing, f) && Can_See_Flag(player, thing, f)
+          && !(f->perms & F_INTERNAL))
         notify_format(player, "%s%s %s = %s", prefix, command, name, f->name);
     }
 }
Index: src/extmail.c
===================================================================
--- src/extmail.c	(.../184p1)	(revision 682)
+++ src/extmail.c	(.../184p2)	(revision 682)
@@ -726,6 +726,52 @@
   return;
 }
 
+FUNCTION(fun_maillist)
+{
+  MAIL *mp;
+  struct mail_selector ms;
+  mail_flag folder;
+  folder_array i;
+  dbref player;
+  int matches = 0;
+
+  if (nargs == 2) {
+    player = match_result(executor, args[0], TYPE_PLAYER,
+                          MAT_ME | MAT_ABSOLUTE | MAT_PMATCH | MAT_TYPE);
+    if (!GoodObject(player)) {
+      safe_str(T(e_match), buff, bp);
+      return;
+    } else if (!controls(executor, player)) {
+      safe_str(T(e_perm), buff, bp);
+      return;
+    }
+  } else {
+    player = executor;
+  }
+
+  if (!parse_msglist((nargs ? args[nargs - 1] : ""), &ms, player)) {
+    safe_str(T(e_range), buff, bp);
+    return;
+  }
+
+  FA_Init(i);
+  folder = AllInFolder(ms) ? player_folder(player) : MSFolder(ms);
+  for (mp = find_exact_starting_point(player); mp && (mp->to == player);
+       mp = mp->next) {
+    if ((mp->to == player) && (All(ms) || Folder(mp) == folder)) {
+      i[Folder(mp)]++;
+      if (mail_match(player, mp, ms, i[Folder(mp)])) {
+        if (matches)
+          safe_chr(' ', buff, bp);
+        safe_integer((int) Folder(mp), buff, bp);
+        safe_chr(':', buff, bp);
+        safe_integer(i[Folder(mp)], buff, bp);
+        matches++;
+      }
+    }
+  }
+}
+
 static char *
 mail_list_time(const char *the_time, bool flag /* 1 for no year */ )
 {
Index: src/funlist.c
===================================================================
--- src/funlist.c	(.../184p1)	(revision 682)
+++ src/funlist.c	(.../184p2)	(revision 682)
@@ -30,8 +30,6 @@
 #include "confmagic.h"
 
 
-static int regrep_helper(dbref who, dbref what, dbref parent,
-                         char const *name, ATTR *atr, void *args);
 enum itemfun_op { IF_DELETE, IF_REPLACE, IF_INSERT };
 static void do_itemfuns(char *buff, char **bp, char *str, char *num,
                         char *word, char *sep, enum itemfun_op flag);
@@ -56,6 +54,19 @@
   ansi_string *as;
   char *aptr;
 
+  /* Since ansi_string is ridiculously slow, we only use it if the string
+   * actually has markup. Unfortunately, freearr(), which is called only for
+   * list2arr_ansi()'d stuff, requires we malloc each item. Sigh. */
+  if (!has_markup(list)) {
+    int ret = list2arr(r, max, list, sep);
+    for (i = 0; i < ret; i++) {
+      /* This is lame, but fortunately, assignment happens after we call
+       * mush_strdup. A-hehehehe. */
+      r[i] = mush_strdup(r[i], "list2arr_item");
+    }
+    return ret;
+  }
+
   as = parse_ansi_string(list);
   aptr = as->text;
 
@@ -162,8 +173,7 @@
   char **ptrs1, **ptrs2, **results;
   char **ptrs3;
   int i, j, nptrs1, nptrs2, nresults;
-  dbref thing;
-  ATTR *attrib;
+  ufun_attrib ufun;
   char sep, isep[2] = { '\0', '\0' }, *osep, osepd[2] = {
   '\0', '\0'};
   int first;
@@ -180,16 +190,11 @@
     osep = osepd;
   }
 
+
+
   /* find our object and attribute */
-  parse_anon_attrib(executor, args[0], &thing, &attrib);
-  if (!GoodObject(thing) || !attrib || !Can_Read_Attr(executor, thing, attrib)) {
-    free_anon_attrib(attrib);
-    return;
-  }
-  if (!CanEvalAttr(executor, thing, attrib)) {
-    free_anon_attrib(attrib);
+  if (!fetch_ufun_attrib(args[0], executor, &ufun, UFUN_DEFAULT))
     return;
-  }
 
   /* Copy the first list, since we need to pass it to two destructive
    * routines.
@@ -219,18 +224,15 @@
     mush_free(ptrs1, "ptrarray");
     mush_free(ptrs2, "ptrarray");
     mush_free(ptrs3, "ptrarray");
-    free_anon_attrib(attrib);
     return;
   }
-  /* Call the user function */
 
+  /* Call the user function */
   lp = list1;
   rp = rlist;
   uargs[0] = lp;
   uargs[1] = isep;
-  do_userfn(rlist, &rp, thing, attrib, 2, uargs,
-            executor, caller, enactor, pe_info, 0);
-  *rp = '\0';
+  call_ufun(&ufun, uargs, 2, rlist, executor, enactor, pe_info);
 
   /* Now that we have our result, put it back into array form. Search
    * through list1 until we find the element position, then copy the
@@ -263,7 +265,6 @@
   mush_free(ptrs2, "ptrarray");
   mush_free(ptrs3, "ptrarray");
   mush_free(results, "ptrarray");
-  free_anon_attrib(attrib);
 }
 
 /* ARGSUSED */
@@ -414,7 +415,7 @@
   if (!delim_check(buff, bp, nargs, args, 4, &sep))
     return;
 
-  if (!fetch_ufun_attrib(args[0], executor, &ufun, 1))
+  if (!fetch_ufun_attrib(args[0], executor, &ufun, UFUN_DEFAULT))
     return;
 
   cp = args[1];
@@ -526,7 +527,7 @@
     check_bool = 1;
 
   /* find our object and attribute */
-  if (!fetch_ufun_attrib(args[0], executor, &ufun, 1))
+  if (!fetch_ufun_attrib(args[0], executor, &ufun, UFUN_DEFAULT))
     return;
 
   /* Go through each argument */
@@ -606,7 +607,7 @@
 {
   char *ptrs[MAX_SORTSIZE];
   int nptrs;
-  char *sort_type;
+  SortType sort_type;
   char sep;
   char outsep[BUFFER_LEN];
 
@@ -635,7 +636,7 @@
   char *ptrs[MAX_SORTSIZE];
   char *keys[MAX_SORTSIZE];
   int nptrs;
-  char *sort_type;
+  SortType sort_type;
   char sep;
   char outsep[BUFFER_LEN];
   int i;
@@ -658,7 +659,7 @@
     strcpy(outsep, args[4]);
 
   /* find our object and attribute */
-  if (!fetch_ufun_attrib(args[0], executor, &ufun, 1))
+  if (!fetch_ufun_attrib(args[0], executor, &ufun, UFUN_DEFAULT))
     return;
 
   nptrs = list2arr_ansi(ptrs, MAX_SORTSIZE, args[1], sep);
@@ -749,7 +750,7 @@
   char sep;
   char **a1, **a2;
   int n1, n2, x1, x2, val;
-  char *sort_type = ALPHANUM_LIST;
+  SortType sort_type = UNKNOWN_LIST;
   int osepl = 0;
   char *osep = NULL, osepd[2] = { '\0', '\0' };
 
@@ -770,6 +771,7 @@
   n2 = list2arr_ansi(a2, MAX_SORTSIZE, args[1], sep);
 
   if (nargs < 4) {
+    sort_type = autodetect_2lists(a1, n1, a2, n2);
     osepd[0] = sep;
     osep = osepd;
     if (sep)
@@ -777,7 +779,6 @@
   } else if (nargs == 4) {
     sort_type = get_list_type_noauto(args, nargs, 4);
     if (sort_type == UNKNOWN_LIST) {
-      sort_type = ALPHANUM_LIST;
       osep = args[3];
       osepl = arglens[3];
     } else {
@@ -787,10 +788,15 @@
         osepl = 1;
     }
   } else if (nargs == 5) {
-    sort_type = get_list_type(args, nargs, 4, a1, n1);
+    sort_type = get_list_type_noauto(args, nargs, 4);
     osep = args[4];
     osepl = arglens[4];
   }
+
+  if (sort_type == UNKNOWN_LIST) {
+    sort_type = autodetect_2lists(a1, n1, a2, n2);
+  }
+
   /* sort each array */
   do_gensort(executor, a1, NULL, n1, sort_type);
   do_gensort(executor, a2, NULL, n2, sort_type);
@@ -879,7 +885,7 @@
   char **a1, **a2;
   int n1, n2, x1, x2, val, orign1, orign2;
   int lastx1, lastx2, found;
-  char *sort_type = ALPHANUM_LIST;
+  SortType sort_type = UNKNOWN_LIST;
   int osepl = 0;
   char *osep = NULL, osepd[2] = { '\0', '\0' };
 
@@ -907,7 +913,6 @@
   } else if (nargs == 4) {
     sort_type = get_list_type_noauto(args, nargs, 4);
     if (sort_type == UNKNOWN_LIST) {
-      sort_type = ALPHANUM_LIST;
       osep = args[3];
       osepl = arglens[3];
     } else {
@@ -917,10 +922,15 @@
         osepl = 1;
     }
   } else if (nargs == 5) {
-    sort_type = get_list_type(args, nargs, 4, a1, n1);
+    sort_type = get_list_type_noauto(args, nargs, 4);
     osep = args[4];
     osepl = arglens[4];
   }
+
+  if (sort_type == UNKNOWN_LIST) {
+    sort_type = autodetect_2lists(a1, n1, a2, n2);
+  }
+
   /* sort each array */
   do_gensort(executor, a1, NULL, n1, sort_type);
   do_gensort(executor, a2, NULL, n2, sort_type);
@@ -1017,7 +1027,7 @@
   char sep;
   char **a1, **a2;
   int n1, n2, x1, x2, val;
-  char *sort_type = ALPHANUM_LIST;
+  SortType sort_type = UNKNOWN_LIST;
   int osepl = 0;
   char *osep = NULL, osepd[2] = { '\0', '\0' };
 
@@ -1045,7 +1055,6 @@
   } else if (nargs == 4) {
     sort_type = get_list_type_noauto(args, nargs, 4);
     if (sort_type == UNKNOWN_LIST) {
-      sort_type = ALPHANUM_LIST;
       osep = args[3];
       osepl = arglens[3];
     } else {
@@ -1055,11 +1064,15 @@
         osepl = 1;
     }
   } else if (nargs == 5) {
-    sort_type = get_list_type(args, nargs, 4, a1, n1);
+    sort_type = get_list_type_noauto(args, nargs, 4);
     osep = args[4];
     osepl = arglens[4];
   }
 
+  if (sort_type == UNKNOWN_LIST) {
+    sort_type = autodetect_2lists(a1, n1, a2, n2);
+  }
+
   /* sort each array */
   do_gensort(executor, a1, NULL, n1, sort_type);
   do_gensort(executor, a2, NULL, n2, sort_type);
@@ -1138,7 +1151,7 @@
   char sep;
   char **a1, **a2;
   int n1, x1, x2;
-  char *sort_type = ALPHANUM_LIST;
+  SortType sort_type = ALPHANUM_LIST;
   int osepl = 0;
   char *osep = NULL, osepd[2] = { '\0', '\0' };
 
@@ -1164,8 +1177,9 @@
   if (nargs >= 2)
     sort_type = get_list_type_noauto(args, nargs, 2);
 
-  if (sort_type == UNKNOWN_LIST)
-    sort_type = ALPHANUM_LIST;
+  if (sort_type == UNKNOWN_LIST) {
+    sort_type = autodetect_list(a1, n1);
+  }
 
   if (nargs < 4) {
     osepd[0] = sep;
@@ -2197,6 +2211,8 @@
   /* Actually, this code has changed so much that the above comment
    * isn't really true anymore. - Talek, 18 Oct 2000
    */
+  char **ptrs = NULL;
+  int nptrs, i;
 
   char sep;
   char *outsep, *list;
@@ -2228,11 +2244,12 @@
 
   outsep = (char *) mush_malloc(BUFFER_LEN, "string");
   list = (char *) mush_malloc(BUFFER_LEN, "string");
-  if (!outsep || !list)
+  if (!outsep || !list) {
     mush_panic("Unable to allocate memory in fun_iter");
-  if (nargs < 4)
+  }
+  if (nargs < 4) {
     strcpy(outsep, " ");
-  else {
+  } else {
     const char *arg4 = args[3];
     char *osep = outsep;
     process_expression(outsep, &osep, &arg4, executor, caller, enactor,
@@ -2251,17 +2268,22 @@
     return;
   }
 
+  /* Split lp up into an ansi-safe list */
+  ptrs = mush_calloc(MAX_SORTSIZE, sizeof(char *), "ptrarray");
+  nptrs = list2arr_ansi(ptrs, MAX_SORTSIZE, lp, sep);
+
   pe_info->iter_nesting++;
+  pe_info->local_iter_nesting++;
   place = &pe_info->iter_inum[pe_info->iter_nesting];
   *place = 0;
   funccount = pe_info->fun_invocations;
   oldbp = *bp;
-  while (lp) {
+  for (i = 0; i < nptrs; i++) {
     if (*place) {
       safe_str(outsep, buff, bp);
     }
     *place = *place + 1;
-    pe_info->iter_itext[pe_info->iter_nesting] = tbuf1 = split_token(&lp, sep);
+    pe_info->iter_itext[pe_info->iter_nesting] = tbuf1 = ptrs[i];
     replace[0] = tbuf1;
     replace[1] = unparse_integer(*place);
     tbuf2 = replace_string2(standard_tokens, replace, args[1]);
@@ -2278,18 +2300,49 @@
     funccount = pe_info->fun_invocations;
     oldbp = *bp;
     mush_free(tbuf2, "replace_string.buff");
+    if (pe_info->iter_break >= 0) {
+      pe_info->iter_break--;
+      break;
+    }
   }
   *place = 0;
   pe_info->iter_itext[pe_info->iter_nesting] = NULL;
   pe_info->iter_nesting--;
+  pe_info->local_iter_nesting--;
   mush_free(outsep, "string");
   mush_free(list, "string");
+  freearr(ptrs, nptrs);
+  mush_free(ptrs, "ptrarray");
+}
+
+/* ARGSUSED */
+FUNCTION(fun_ibreak)
+{
+  int i = 1;
+
+  if (nargs && args[0] && *args[0]) {
+    if (!is_strict_integer(args[0])) {
+      safe_str(T(e_int), buff, bp);
+      return;
+    }
+    i = parse_integer(args[0]);
+  }
+
+  if (i < 0
+      || (i + pe_info->iter_break) >
+      (pe_info->local_iter_nesting - pe_info->dolists)) {
+    safe_str(T(e_range), buff, bp);
+    return;
+  }
+
+  pe_info->iter_break += i;
+
 }
 
 /* ARGSUSED */
 FUNCTION(fun_ilev)
 {
-  safe_integer(pe_info->iter_nesting, buff, bp);
+  safe_integer(pe_info->local_iter_nesting, buff, bp);
 }
 
 /* ARGSUSED */
@@ -2297,14 +2350,19 @@
 {
   int i;
 
-  if (!is_strict_integer(args[0])) {
-    safe_str(T(e_int), buff, bp);
-    return;
+  if (!strcasecmp(args[0], "l")) {
+    i = pe_info->local_iter_nesting;
+  } else {
+    if (!is_strict_integer(args[0])) {
+      safe_str(T(e_int), buff, bp);
+      return;
+    }
+    i = parse_integer(args[0]);
   }
-  i = parse_integer(args[0]);
 
-  if (i < 0 || i > pe_info->iter_nesting || (pe_info->iter_nesting - i) < 0) {
-    safe_str(T("#-1 ARGUMENT OUT OF RANGE"), buff, bp);
+  if (i < 0 || i > pe_info->local_iter_nesting
+      || (pe_info->local_iter_nesting - i) < 0) {
+    safe_str(T(e_argrange), buff, bp);
     return;
   }
 
@@ -2316,14 +2374,19 @@
 {
   int i;
 
-  if (!is_strict_integer(args[0])) {
-    safe_str(T(e_int), buff, bp);
-    return;
+  if (!strcasecmp(args[0], "l"))
+    i = pe_info->local_iter_nesting;
+  else {
+    if (!is_strict_integer(args[0])) {
+      safe_str(T(e_int), buff, bp);
+      return;
+    }
+    i = parse_integer(args[0]);
   }
-  i = parse_integer(args[0]);
 
-  if (i < 0 || i > pe_info->iter_nesting || (pe_info->iter_nesting - i) < 0) {
-    safe_str(T("#-1 ARGUMENT OUT OF RANGE"), buff, bp);
+  if (i < 0 || i > pe_info->local_iter_nesting
+      || (pe_info->local_iter_nesting - i) < 0) {
+    safe_str(T(e_argrange), buff, bp);
     return;
   }
 
@@ -2338,18 +2401,17 @@
    * This function takes delimiters.
    */
 
-  dbref thing;
-  ATTR *attrib;
   char *preserve[10];
-  char const *ap;
-  char *asave, *lp;
+  char *lp;
   char sep;
   int n;
   int step;
-  int funccount;
-  char *oldbp;
   char *osep, osepd[2] = { '\0', '\0' };
-  int pe_flags = PE_DEFAULT;
+  char *wenv[10];
+  ufun_attrib ufun;
+  char rbuff[BUFFER_LEN];
+  char **ptrs = NULL;
+  int nptrs, i;
 
   if (!is_integer(args[2])) {
     safe_str(T(e_int), buff, bp);
@@ -2378,62 +2440,40 @@
     return;
 
   /* find our object and attribute */
-  parse_anon_attrib(executor, args[0], &thing, &attrib);
-  if (!GoodObject(thing) || !attrib || !Can_Read_Attr(executor, thing, attrib)) {
-    free_anon_attrib(attrib);
-    return;
-  }
-  if (!CanEvalAttr(executor, thing, attrib)) {
-    free_anon_attrib(attrib);
+  if (!fetch_ufun_attrib(args[0], executor, &ufun, UFUN_DEFAULT))
     return;
-  }
-  if (AF_Debug(attrib))
-    pe_flags |= PE_DEBUG;
-
-  asave = safe_atr_value(attrib);
 
   /* save our stack */
   save_global_env("step", preserve);
 
-  for (n = 0; n < step; n++) {
-    global_eval_context.wenv[n] = split_token(&lp, sep);
-    if (!lp) {
-      n++;
-      break;
-    }
-  }
-  for (; n < 10; n++)
-    global_eval_context.wenv[n] = NULL;
+  /* Split lp up into an ansi-safe list */
+  ptrs = mush_calloc(MAX_SORTSIZE, sizeof(char *), "ptrarray");
+  nptrs = list2arr_ansi(ptrs, MAX_SORTSIZE, lp, sep);
 
-  ap = asave;
-  process_expression(buff, bp, &ap, thing, executor, enactor,
-                     pe_flags, PT_DEFAULT, pe_info);
-  oldbp = *bp;
-  funccount = pe_info->fun_invocations;
-  while (lp) {
-    safe_str(osep, buff, bp);
+  /* Step through the list. */
+  for (i = 0; i < nptrs;) {
     for (n = 0; n < step; n++) {
-      global_eval_context.wenv[n] = split_token(&lp, sep);
-      if (!lp) {
-        n++;
+      if (i < nptrs) {
+        wenv[n] = ptrs[i++];
+      } else {
         break;
       }
     }
-    for (; n < 10; n++)
-      global_eval_context.wenv[n] = NULL;
-    ap = asave;
-    if (process_expression(buff, bp, &ap, thing, executor, enactor,
-                           pe_flags, PT_DEFAULT, pe_info))
-      break;
-    if (*bp == (buff + BUFFER_LEN - 1) && pe_info->fun_invocations == funccount)
-      break;
-    oldbp = *bp;
-    funccount = pe_info->fun_invocations;
+    for (; n < 10; n++) {
+      wenv[n] = NULL;
+    }
+    if (call_ufun(&ufun, wenv, step, rbuff, executor, enactor, pe_info)) {
+      mush_free(ptrs, "ptrarray");
+      return;
+    }
+    if (i > step) {
+      /* At least second loop */
+      safe_str(osep, buff, bp);
+    }
+    safe_str(rbuff, buff, bp);
   }
-
-  free(asave);
-  free_anon_attrib(attrib);
-  restore_global_env("step", preserve);
+  freearr(ptrs, nptrs);
+  mush_free(ptrs, "ptrarray");
 }
 
 /* ARGSUSED */
@@ -2448,11 +2488,12 @@
   char *lp;
   char *wenv[2];
   char place[16];
-  int placenr = 1;
   char sep;
   int funccount;
   char *osep, osepd[2] = { '\0', '\0' };
   char rbuff[BUFFER_LEN];
+  char **ptrs = NULL;
+  int nptrs, i;
 
   if (!delim_check(buff, bp, nargs, args, 3, &sep))
     return;
@@ -2464,30 +2505,38 @@
   if (!*lp)
     return;
 
-  if (!fetch_ufun_attrib(args[0], executor, &ufun, 1))
+  if (!fetch_ufun_attrib(args[0], executor, &ufun, UFUN_DEFAULT))
     return;
 
   strcpy(place, "1");
 
+  ptrs = mush_calloc(MAX_SORTSIZE, sizeof(char *), "ptrarray");
+  nptrs = list2arr_ansi(ptrs, MAX_SORTSIZE, lp, sep);
+
   /* Build our %0 args */
-  wenv[0] = split_token(&lp, sep);
-  wenv[1] = place;
+  for (i = 0; i < nptrs; i++) {
 
-  call_ufun(&ufun, wenv, 2, rbuff, executor, enactor, pe_info);
-  funccount = pe_info->fun_invocations;
-  safe_str(rbuff, buff, bp);
-  while (lp) {
-    safe_str(osep, buff, bp);
-    strcpy(place, unparse_integer(++placenr));
-    wenv[0] = split_token(&lp, sep);
+    wenv[0] = ptrs[i];
+    snprintf(place, 16, "%d", i + 1);
+    wenv[1] = place;
 
-    if (call_ufun(&ufun, wenv, 2, rbuff, executor, enactor, pe_info))
+    funccount = pe_info->fun_invocations;
+
+    if (call_ufun(&ufun, wenv, 2, rbuff, executor, enactor, pe_info)) {
       break;
+    }
+
+    if (i > 0) {
+      safe_str(osep, buff, bp);
+    }
     safe_str(rbuff, buff, bp);
-    if (*bp == (buff + BUFFER_LEN - 1) && pe_info->fun_invocations == funccount)
+    if (*bp >= (buff + BUFFER_LEN - 1)
+        && pe_info->fun_invocations == funccount) {
       break;
-    funccount = pe_info->fun_invocations;
+    }
   }
+  freearr(ptrs, nptrs);
+  mush_free(ptrs, "ptrarray");
 }
 
 
@@ -2505,9 +2554,9 @@
   char *list[10];
   char sep;
   int funccount;
-  int n;
-  int lists, words;
-  int first = 1;
+  int n, lists;
+  char **ptrs[10] = { NULL };
+  int nptrs[10], i, maxi;
 
   if (nargs > 3) {              /* Last arg must be the delimiter */
     n = nargs;
@@ -2520,34 +2569,52 @@
   if (!delim_check(buff, bp, nargs, args, n, &sep))
     return;
 
-  for (n = 0; n < lists; n++)
-    lp[n] = trim_space_sep(args[n + 1], sep);
-
   /* find our object and attribute */
-  if (!fetch_ufun_attrib(args[0], executor, &ufun, 1))
+  if (!fetch_ufun_attrib(args[0], executor, &ufun, UFUN_DEFAULT))
     return;
 
-  first = 1;
-  while (1) {
-    words = 0;
+  maxi = 0;
+  for (n = 0; n < lists; n++) {
+    lp[n] = trim_space_sep(args[n + 1], sep);
+    if (*lp[n]) {
+      ptrs[n] = mush_calloc(MAX_SORTSIZE, sizeof(char *), "ptrarray");
+      nptrs[n] = list2arr_ansi(ptrs[n], MAX_SORTSIZE, lp[n], sep);
+    } else {
+      ptrs[n] = NULL;
+      nptrs[n] = 0;
+    }
+    if (nptrs[n] > maxi) {
+      maxi = nptrs[n];
+    }
+  }
+
+  for (i = 0; i < maxi; i++) {
     for (n = 0; n < lists; n++) {
-      if (lp[n] && *lp[n]) {
-        list[n] = split_token(&lp[n], sep);
-        if (list[n])
-          words++;
+      if (nptrs[n] > i) {
+        list[n] = ptrs[n][i];
       } else {
         list[n] = NULL;
       }
     }
-    if (!words)
-      return;
-    if (first)
-      first = 0;
-    else
-      safe_chr(sep, buff, bp);
     funccount = pe_info->fun_invocations;
-    call_ufun(&ufun, list, lists, rbuff, executor, enactor, pe_info);
+    if (call_ufun(&ufun, list, lists, rbuff, executor, enactor, pe_info)) {
+      break;
+    }
+    if (i > 0) {
+      safe_chr(sep, buff, bp);
+    }
     safe_str(rbuff, buff, bp);
+    if (*bp == (buff + BUFFER_LEN - 1)
+        && pe_info->fun_invocations == funccount) {
+      break;
+    }
+  }
+
+  for (n = 0; n < lists; n++) {
+    if (ptrs[n]) {
+      freearr(ptrs[n], nptrs[n]);
+      mush_free(ptrs[n], "ptrarray");
+    }
   }
 }
 
@@ -3105,104 +3172,6 @@
   free_ansi_string(as);
 }
 
-
-/** Structure to hold data for regrep */
-struct regrep_data {
-  pcre *re;             /**< Pointer to compiled regular expression */
-  pcre_extra *study;    /**< Pointer to studied data about re */
-  char *buff;           /**< Buffer to store regrep results */
-  char **bp;            /**< Pointer to address of insertion point in buff */
-  int first;            /**< Is this the first match or a later match? */
-};
-
-/* Like grep(), but using a regexp pattern. This same function handles
- *  both regrep and regrepi. */
-FUNCTION(fun_regrep)
-{
-  struct regrep_data reharg;
-  const char *errptr;
-  int erroffset;
-  int flags = 0;
-  bool free_study;
-  dbref it = match_thing(executor, args[0]);
-
-  reharg.first = 0;
-  if (it == NOTHING || it == AMBIGUOUS) {
-    safe_str(T(e_notvis), buff, bp);
-    return;
-  }
-  /* make sure there's an attribute and a pattern */
-  if (!*args[1]) {
-    safe_str(T("#-1 NO SUCH ATTRIBUTE"), buff, bp);
-    return;
-  }
-  if (!*args[2]) {
-    safe_str(T("#-1 INVALID GREP PATTERN"), buff, bp);
-    return;
-  }
-
-  if (strcmp(called_as, "REGREPI") == 0)
-    flags = PCRE_CASELESS;
-
-  if ((reharg.re = pcre_compile(args[2], flags,
-                                &errptr, &erroffset, tables)) == NULL) {
-    /* Matching error. */
-    safe_str(T("#-1 REGEXP ERROR: "), buff, bp);
-    safe_str(errptr, buff, bp);
-    return;
-  }
-  add_check("pcre");
-
-  reharg.study = pcre_study(reharg.re, 0, &errptr);
-  if (errptr != NULL) {
-    safe_str(T("#-1 REGEXP ERROR: "), buff, bp);
-    safe_str(errptr, buff, bp);
-    mush_free(reharg.re, "pcre");
-    return;
-  }
-  if (reharg.study) {
-    add_check("pcre.extra");
-    free_study = true;
-    set_match_limit(reharg.study);
-  } else {
-    free_study = false;
-    reharg.study = default_match_limit();
-  }
-
-  reharg.buff = buff;
-  reharg.bp = bp;
-
-  atr_iter_get(executor, it, args[1], 0, 0, regrep_helper, (void *) &reharg);
-  mush_free(reharg.re, "pcre");
-  if (free_study)
-    mush_free(reharg.study, "pcre.extra");
-}
-
-static int
-regrep_helper(dbref who __attribute__ ((__unused__)),
-              dbref what __attribute__ ((__unused__)),
-              dbref parent __attribute__ ((__unused__)),
-              char const *name __attribute__ ((__unused__)),
-              ATTR *atr, void *args)
-{
-  struct regrep_data *reharg = args;
-  char const *str;
-  size_t slen;
-  int offsets[99];
-
-  str = remove_markup(atr_value(atr), &slen);
-  if (pcre_exec(reharg->re, reharg->study, str, slen - 1, 0, 0, offsets, 99)
-      >= 0) {
-    if (reharg->first != 0)
-      safe_chr(' ', reharg->buff, reharg->bp);
-    else
-      reharg->first = 1;
-    safe_str(AL_NAME(atr), reharg->buff, reharg->bp);
-    return 1;
-  } else
-    return 0;
-}
-
 /* Like grab, but with a regexp pattern. This same function handles
  *  regrab(), regraball(), and the case-insenstive versions. */
 FUNCTION(fun_regrab)
Index: src/lock.c
===================================================================
--- src/lock.c	(.../184p1)	(revision 682)
+++ src/lock.c	(.../184p2)	(revision 682)
@@ -318,10 +318,11 @@
     return 1;
   if (L_FLAGS(lock) & LF_WIZARD)
     return 0;
-  if (L_FLAGS(lock) & LF_OWNER)
-    return player == Owner(thing);
-  if (L_FLAGS(lock) & LF_LOCKED)
-    return Owner(player) == lock->creator;
+  if ((L_FLAGS(lock) & LF_OWNER) && player != Owner(thing))
+    return 0;
+  if ((L_FLAGS(lock) & LF_LOCKED) && player != lock->creator &&
+      Owner(player) != lock->creator)
+    return 0;
   return 1;
 }
 
Index: src/player.c
===================================================================
--- src/player.c	(.../184p1)	(revision 682)
+++ src/player.c	(.../184p2)	(revision 682)
@@ -61,6 +61,72 @@
 
 extern struct db_stat_info current_state;
 
+/* Long IP, just for ipv6.
+ *
+ * Pure ipv6: 8*4+7=39.
+ * ipv6+ipv4 tunneling: 45.
+ * +1 for null, rounded up to nearest multiple of 4.
+ */
+#define IP_LENGTH 48
+/* How many failures to keep track of. */
+#define FAIL_COUNT 100
+typedef struct _fail_info {
+  char ip[IP_LENGTH];           /* Extra long, just for ipv6. */
+  time_t failTime;
+} Fail_Info;
+
+/* This is a rotating buffer of the FAIL_COUNT most recent failures. */
+static Fail_Info ipFails[FAIL_COUNT];
+/* IPFAIL(x) counts x items _BACKWARDS_ from current position. */
+
+static int failIdx = 0;
+#define IPFAIL(x) ipFails[((failIdx + FAIL_COUNT) - x) % FAIL_COUNT]
+
+static int failCount = 0;
+
+/** Check if the given IP has had too many failures to be allowed
+ * to log in.
+ * \param ipaddr The IP address to check.
+ * \retval 1 Okay to log in.
+ * \retval 0 Do not allow to log in.
+ */
+static int
+check_fails(const char *ipaddr)
+{
+  int i;
+  int numFails = 0;
+  time_t since = time(NULL) - 600;
+
+  /* A connect_fail_limit of 0 means none. */
+  if (!CONNECT_FAIL_LIMIT)
+    return 1;
+
+  for (i = 0; i < failCount; i++) {
+    if (IPFAIL(i).failTime > since) {
+      if (!strncmp(ipaddr, IPFAIL(i).ip, IP_LENGTH)) {
+        numFails++;
+        if (numFails >= CONNECT_FAIL_LIMIT) {
+          return 0;
+        }
+      }
+    }
+  }
+  return 1;
+}
+
+static void
+mark_failed(const char *ipaddr)
+{
+  failIdx++;
+  failIdx %= FAIL_COUNT;
+
+  if (failCount < FAIL_COUNT)
+    failCount++;
+  strncpy(IPFAIL(0).ip, ipaddr, IP_LENGTH);
+  IPFAIL(0).failTime = time(NULL);
+}
+
+
 /** Check a player's password against a given string.
  * \param player dbref of player.
  * \param password plaintext password string to check.
@@ -123,6 +189,13 @@
 {
   dbref player;
 
+  if (!check_fails(ip)) {
+    strcpy(errbuf,
+           T
+           ("This IP address has failed too many times. Please try again in 10 minutes."));
+    return NOTHING;
+  }
+
   /* Default error */
   strcpy(errbuf,
          T("Either that player does not exist, or has a different password."));
@@ -131,8 +204,11 @@
     return NOTHING;
 
   /* validate name */
-  if ((player = lookup_player(name)) == NOTHING)
+  if ((player = lookup_player(name)) == NOTHING) {
+    /* Invalid player names are failures, too. */
+    mark_failed(ip);
     return NOTHING;
+  }
 
   /* See if player is allowed to connect like this */
   if (Going(player) || Going_Twice(player)) {
@@ -167,6 +243,7 @@
       /* Increment count of login failures */
       ModTime(player)++;
       check_lastfailed(player, host);
+      mark_failed(ip);
       return NOTHING;
     }
   /* If it's a Guest player, and already connected, search the
Index: src/wild.c
===================================================================
--- src/wild.c	(.../184p1)	(revision 682)
+++ src/wild.c	(.../184p2)	(revision 682)
@@ -9,6 +9,8 @@
  * Thanks go to Andrew Molitor for debugging
  * Thanks also go to Rich $alz for code to benchmark against
  *
+ * Rather thoroughly rewritten by Walker, 2010
+ *
  * Copyright (c) 1993,2000 by T. Alexander Popiel
  * This code is available under the terms of the GPL,
  * see http://www.gnu.org/copyleft/gpl.html for details.
@@ -45,28 +47,8 @@
 /** Maximum number of wildcarded arguments */
 #define NUMARGS (10)
 
-/** Skip across all ansi and pueblo markup. */
-#define SKIP_ANSI(x) do { \
-      if (*x == TAG_START) { \
-        while (*x && (*x != TAG_END)) x++; \
-        if (*x) x++; \
-      } else if (*x == ESC_CHAR) { \
-        while (*x && (*x != 'm')) x++; \
-        if (*x) x++; \
-      } \
-  } while ((*x == TAG_START) || (*x == ESC_CHAR))
-
 const unsigned char *tables = NULL;  /** Pointer to character tables */
 
-static bool wild1
-  (const char *restrict tstr, const char *restrict dstr, int arg,
-   char **wbuf, ssize_t * len, bool cs, char **ary, size_t max);
-static bool wild(const char *restrict s, const char *restrict d, int p, bool cs,
-                 char **ary, size_t max, char *buffer, ssize_t len);
-static bool check_literals(const char *restrict tstr, const char *restrict dstr,
-                           bool cs);
-static char *strip_backslashes(const char *str);
-
 /** Do a wildcard match, without remembering the wild data.
  *
  * This routine will cause crashes if fed NULLs instead of strings.
@@ -79,11 +61,6 @@
 bool
 quick_wild(const char *restrict tstr, const char *restrict dstr)
 {
-  /* quick_wild_new does the real work, but before we call it,
-   * we do some sanity checking.
-   */
-  if (!check_literals(tstr, dstr, 0))
-    return 0;
   return quick_wild_new(tstr, dstr, 0);
 }
 
@@ -100,71 +77,12 @@
 bool
 quick_wild_new(const char *restrict tstr, const char *restrict dstr, bool cs)
 {
-  while (*tstr != '*') {
-    SKIP_ANSI(dstr);
-    switch (*tstr) {
-    case '?':
-      /* Single character match.  Return false if at
-       * end of data.
-       */
-      if (!*dstr)
-        return 0;
-      break;
-    case '\\':
-      /* Escape character.  Move up, and force literal
-       * match of next character.
-       */
-      tstr++;
-      /* FALL THROUGH */
-    default:
-      /* Literal character.  Check for a match.
-       * If matching end of data, return true.
-       */
-      if (NOTEQUAL(cs, *dstr, *tstr))
-        return 0;
-      if (!*dstr)
-        return 1;
-    }
-    tstr++;
-    dstr++;
-  }
-
-  /* Skip over '*'. */
-  tstr++;
-
-  /* Return true on trailing '*'. */
-  if (!*tstr)
-    return 1;
-
-  /* Skip over wildcards. */
-  while ((*tstr == '?') || (*tstr == '*')) {
-    if (*tstr == '?') {
-      if (!*dstr)
-        return 0;
-      dstr++;
-      SKIP_ANSI(dstr);
-    }
-    tstr++;
-  }
-
-  /* Skip over a backslash in the pattern string if it is there. */
-  if (*tstr == '\\')
-    tstr++;
-
-  /* Return true on trailing '*'. */
-  if (!*tstr)
-    return 1;
-
-  /* Scan for possible matches. */
-  while (*dstr) {
-    if (EQUAL(cs, *dstr, *tstr) && quick_wild_new(tstr + 1, dstr + 1, cs))
-      return 1;
-    dstr++;
-    SKIP_ANSI(dstr);
-  }
-  return 0;
+  return wild_match_test(tstr, dstr, cs, NULL, 0);
 }
 
+static bool
+real_atr_wild(const char *restrict tstr,
+              const char *restrict dstr, int *invokes);
 /** Do an attribute name wildcard match.
  *
  * This probably crashes if fed NULLs instead of strings, too.
@@ -181,13 +99,25 @@
 bool
 atr_wild(const char *restrict tstr, const char *restrict dstr)
 {
+  int invokes = 10000;
+  return real_atr_wild(tstr, dstr, &invokes);
+}
+
+static bool
+real_atr_wild(const char *restrict tstr,
+              const char *restrict dstr, int *invokes)
+{
   int starcount;
+  if (*invokes > 0) {
+    (*invokes)--;
+  } else {
+    return 0;
+  }
 
   if (!*tstr)
     return !strchr(dstr, '`');
 
   while (*tstr != '*') {
-    SKIP_ANSI(dstr);
     switch (*tstr) {
     case '?':
       /* Single character match.  Return false if at
@@ -232,7 +162,6 @@
       if (!*dstr || *dstr == '`')
         return 0;
       dstr++;
-      SKIP_ANSI(dstr);
       starcount = 0;
     } else
       starcount++;
@@ -250,10 +179,11 @@
   if (*tstr == '?') {
     /* Scan for possible matches. */
     while (*dstr) {
-      if (*dstr != '`' && atr_wild(tstr + 1, dstr + 1))
+      if (*dstr != '`' && real_atr_wild(tstr + 1, dstr + 1, invokes))
         return 1;
       dstr++;
-      SKIP_ANSI(dstr);
+      if (*invokes <= 0)
+        return 0;
     }
   } else {
     /* Skip over a backslash in the pattern string if it is there. */
@@ -265,232 +195,125 @@
       if (EQUAL(0, *dstr, *tstr)) {
         if (!*(tstr + 1) && *(dstr + 1))
           return 0;             /* No more in pattern string, but more in target */
-        if (atr_wild(tstr + 1, dstr + 1))
+        if (real_atr_wild(tstr + 1, dstr + 1, invokes))
           return 1;
       }
+      if (*invokes <= 0)
+        return 0;
       if (starcount < 2 && *dstr == '`')
         return 0;
       dstr++;
-      SKIP_ANSI(dstr);
     }
   }
   return 0;
 }
 
-/* ---------------------------------------------------------------------------
- * wild1: INTERNAL: do a wildcard match, remembering the wild data.
+/** Wildcard match, possibly case-sensitive, and remember the wild match
+ * start+lengths.
  *
- * DO NOT CALL THIS FUNCTION DIRECTLY - DOING SO MAY RESULT IN
- * SERVER CRASHES AND IMPROPER ARGUMENT RETURN.
+ * This routine will cause crashes if fed NULLs instead of strings.
  *
- * Side Effect: this routine modifies the 'wnxt' global variable,
- * and what it points to.
+ * \param pat pattern to match against.
+ * \param str string to check.
+ * \param cs if 1, case-sensitive; if 0, case-insensitive.
+ * \param matches An int[nmatches*2] to store positions into. The result will
+ *                be [0start, 0len, 1start, 1len, 2start, 2len, ...]
+ * \param nmatches Number of elements ary can hold, divided by 2.
+ * \retval 1 d matches s.
+ * \retval 0 d doesn't match s.
  */
-static bool
-wild1(const char *restrict tstr, const char *restrict dstr, int arg,
-      char **wbuf, ssize_t * len, bool cs, char **ary, size_t max)
+bool
+wild_match_test(const char *restrict pat, const char *restrict str, bool cs,
+                int *matches, int nmatches)
 {
-  const char *datapos;
-  int argpos, numextra;
-
-  while (*tstr != '*') {
-    SKIP_ANSI(dstr);
-    switch (*tstr) {
-    case '?':
-      /* Single character match.  Return false if at
-       * end of data.
-       */
-      if (!*dstr)
-        return 0;
-
-      if (*len >= 2) {
-        ary[arg++] = *wbuf;
-        *(*wbuf)++ = *dstr;
-        *(*wbuf)++ = '\0';
-        *len -= 2;
-      }
-
-      /* Jump to the fast routine if we can. */
+  int i, pi;
+  bool globbing = 0;            /* Are we in a glob match right now? */
+  int pbase = 0, sbase = 0;     /* Guaranteed matched so far. */
+  int matchi = 0, mbase = 0;
+  int slen = strlen(str);
+  char pbuff[BUFFER_LEN];
+  char tbuff[BUFFER_LEN];
 
-      if (arg >= (int) max || *len < 2)
-        return quick_wild_new(tstr + 1, dstr + 1, cs);
-      break;
-    case '\\':
-      /* Escape character.  Move up, and force literal
-       * match of next character.
-       */
-      tstr++;
-      /* FALL THROUGH */
-    default:
-      /* Literal character.  Check for a match.
-       * If matching end of data, return true.
-       */
-      if (NOTEQUAL(cs, *dstr, *tstr))
-        return 0;
-      if (!*dstr)
-        return 1;
-    }
-    tstr++;
-    dstr++;
+  for (i = 0; i < nmatches; i++) {
+    matches[i * 2] = -1;
+    matches[i * 2 + 1] = 0;
   }
 
-  /* If at end of pattern, slurp the rest, and leave. */
-  if (!tstr[1]) {
-    ssize_t tlen;
-    tlen = strlen(dstr);
-    if (tlen < *len) {
-      ary[arg] = *wbuf;
-      strcpy(*wbuf, dstr);
-      *wbuf += tlen + 2;
-      *len -= tlen + 1;
-    }
-    return 1;
+  strncpy(pbuff, remove_markup(pat, NULL), BUFFER_LEN);
+  pbuff[BUFFER_LEN - 1] = '\0';
+  strncpy(tbuff, remove_markup(str, NULL), BUFFER_LEN);
+  tbuff[BUFFER_LEN - 1] = '\0';
+  pat = pbuff;
+  str = tbuff;
+
+  if (!cs) {
+    upcasestr(pbuff);
+    upcasestr(tbuff);
   }
-  /* Remember current position for filling in the '*' return. */
-  datapos = dstr;
-  argpos = arg;
 
-  /* Scan forward until we find a non-wildcard. */
-  do {
-    if (argpos < arg) {
-      /* Fill in arguments if someone put another '*'
-       * before a fixed string.
-       */
-      if (*len >= 1) {
-        ary[argpos++] = *wbuf;
-        *(*wbuf)++ = '\0';
-        *len -= 1;
+  for (i = 0, pi = 0; (sbase + i) < slen;) {
+    switch (pat[pbase + pi]) {
+    case '?':
+      /* No complaints here. Auto-match */
+      if (matchi < nmatches) {
+        matches[matchi * 2] = sbase + i;
+        matches[matchi * 2 + 1] = 1;
       }
-
-      /* Jump to the fast routine if we can. */
-      if (argpos >= (int) max || *len < 2)
-        return quick_wild_new(tstr, dstr, cs);
-
-      /* Fill in any intervening '?'s */
-      while (argpos < arg) {
-        if (*len >= 2) {
-          ary[argpos++] = *wbuf;
-          *(*wbuf)++ = *datapos++;
-          *(*wbuf)++ = '\0';
-          *len -= 2;
+      matchi++;
+      pi++;
+      i++;
+      break;
+    case '*':
+      /* Everything so far is guaranteed matched. */
+      pbase += pi;
+      sbase += i;
+      globbing = 1;
+      i = pi = 0;
+      /* Skip past multiple globs. */
+      while (pat[pbase] == '*') {
+        pbase++;
+        mbase = matchi++;
+        if (mbase < nmatches) {
+          matches[mbase * 2] = sbase;
+          matches[mbase * 2 + 1] = 0;
         }
-        SKIP_ANSI(datapos);
-
-        /* Jump to the fast routine if we can. */
-        if (argpos >= (int) max || *len < 1)
-          return quick_wild_new(tstr, dstr, cs);
       }
-    }
-    /* Skip over the '*' for now... */
-    tstr++;
-    arg++;
-
-    /* Skip over '?'s for now... */
-    numextra = 0;
-    while (*tstr == '?') {
-      if (!*dstr)
-        return 0;
-      tstr++;
-      dstr++;
-      SKIP_ANSI(dstr);
-      arg++;
-      numextra++;
-    }
-  } while (*tstr == '*');
-
-  /* Skip over a backslash in the pattern string if it is there. */
-  if (*tstr == '\\')
-    tstr++;
-
-  /* Check for possible matches.  This loop terminates either at
-   * end of data (resulting in failure), or at a successful match.
-   */
-  if (!*tstr) {
-    while (*dstr) {
-      dstr++;
-      SKIP_ANSI(dstr);
-    }
-  } else {
-    while (1) {
-      if (EQUAL(cs, *dstr, *tstr) &&
-          ((arg < (int) max) ? wild1(tstr, dstr, arg, wbuf, len, cs, ary, max)
-           : quick_wild_new(tstr, dstr, cs)))
+      if (!pat[pbase]) {
+        /* This pattern is the last thing, we match the rest. */
+        if (mbase < nmatches) {
+          matches[mbase * 2 + 1] = slen - sbase;
+        }
+        return 1;
+      }
+      break;
+    case '\\':
+      /* Literal match of the next character, which may be a * or ?. */
+      pi++;
+    default:
+      if (str[sbase + i] == pat[pbase + pi]) {
+        pi++;
+        i++;
         break;
-      if (!*dstr)
+      }
+    case 0:                    /* Pattern is too short to match */
+      /* If we're dealing with a glob, advance it by 1 character. */
+      if (globbing) {
+        if (mbase < nmatches) {
+          /* Up glob length */
+          matches[mbase * 2 + 1]++;
+        }
+        sbase++;
+        /* Reset post-glob matches. */
+        i = pi = 0;
+        matchi = mbase + 1;
+      } else {
         return 0;
-      dstr++;
-      SKIP_ANSI(dstr);
-    }
-  }
-
-  /* Found a match!  Fill in all remaining arguments.
-   * First do the '*'...
-   */
-  {
-    ssize_t datalen;
-    datalen = (dstr - datapos) - numextra;
-    if (datalen + 1 <= *len) {
-      ary[argpos++] = *wbuf;
-      strncpy(*wbuf, datapos, datalen);
-      *wbuf += datalen;
-      *(*wbuf)++ = '\0';
-      *len -= datalen + 1;
-      datapos = dstr - numextra;
-      SKIP_ANSI(datapos);
-    }
-  }
-
-  /* Fill in any trailing '?'s that are left. */
-  while (numextra) {
-    if (argpos >= (int) max || *len < 2)
-      return 1;
-    if (*len >= 2) {
-      ary[argpos++] = *wbuf;
-      *(*wbuf)++ = *datapos++;
-      *(*wbuf)++ = '\0';
-      *len -= 2;
-      numextra--;
+      }
     }
-    SKIP_ANSI(datapos);
-  }
-
-  /* It's done! */
-  return 1;
-}
-
-/* ---------------------------------------------------------------------------
- * wild: do a wildcard match, remembering the wild data.
- *
- * This routine will cause crashes if fed NULLs instead of strings.
- *
- * This function may crash if malloc() fails.
- *
- * Side Effect: this routine modifies the 'wnxt' global variable.
- */
-static bool
-wild(const char *restrict s, const char *restrict d, int p, bool cs,
-     char **ary, size_t max, char *buffer, ssize_t len)
-{
-  /* Do fast match to see if pattern matches. If yes, do it again,
-     remembering this time.. */
-  while ((*s != '*') && (*s != '?')) {
-    SKIP_ANSI(d);
-    if (*s == '\\')
-      s++;
-    if (NOTEQUAL(cs, *d, *s))
-      return 0;
-    if (!*d)
-      return 1;
-    s++;
-    d++;
   }
-
-  /* Do sanity check */
-  if (!check_literals(s, d, cs))
-    return 0;
-
-  /* Do the match. */
-  return wild1(s, d, p, &buffer, &len, cs, ary, max);
+  while (pat[pbase + pi] == '*')
+    pi++;
+  return !pat[pbase + pi];
 }
 
 /** Wildcard match, possibly case-sensitive, and remember the wild data
@@ -504,7 +327,7 @@
  * \param matches An array to store the grabs in
  * \param nmatches Number of elements ary can hold
  * \param data Buffer used to hold the matches. The elements of ary
- *    are set to pointers into this  buffer.
+ *    are set to pointers into this buffer.
  * \param len The number of bytes in data. Twice the length of d should
  *    be enough.
  * \retval 1 d matches s.
@@ -512,14 +335,73 @@
  */
 bool
 wild_match_case_r(const char *restrict s, const char *restrict d, bool cs,
-                  char **matches, size_t nmatches, char *data, ssize_t len)
+                  char **matches, int nmatches, char *data, int len)
 {
-  size_t n;
+  int results[BUFFER_LEN * 2];
+  int n;
 
-  for (n = 0; n < nmatches; n++)
-    matches[n] = NULL;
+  ansi_string *as;
+  char *buff, *maxbuff;
+  char *bp;
+  int curlen, spaceleft;
 
-  return wild(s, d, 0, cs, matches, nmatches, data, len);
+  if (wild_match_test(s, d, cs, results, BUFFER_LEN)) {
+    /* Populate everything. Oi.
+     *
+     * Given that our best best is safe_ansi_string, but that data can be
+     * 2x BUFFER_LEN, we have to do ugly math in order to safely use
+     * safe_ansi_string while still using all of data. Hence all the
+     * math with buff and bp. We sorely need a better string system
+     * than inherent BUFFER_LENs everywhere.
+     *
+     * bp is always pointing to the right spot. We have to point buff
+     * at either bp, or at (data+len) - BUFFER_LEN, whichever is lowest.
+     */
+    if (nmatches > 0 && data && len > 0) {
+      /* For speed purposes, make sure we have an ansi'd string before
+       * we actually use parse_ansi_string */
+      if (has_markup(d)) {
+        as = parse_ansi_string(d);
+        bp = data;
+        maxbuff = data + len - BUFFER_LEN;
+
+        for (n = 0; (n < BUFFER_LEN) && (results[n * 2] >= 0)
+             && n < nmatches && bp < (data + len); n++) {
+          /* Eww, eww, eww, EWWW! */
+          buff = bp;
+          if (buff > maxbuff)
+            buff = maxbuff;
+
+          matches[n] = bp;
+          safe_ansi_string(as, results[n * 2], results[n * 2 + 1], buff, &bp);
+          *(bp++) = '\0';
+        }
+        free_ansi_string(as);
+      } else {
+        for (n = 0, curlen = 0;
+             (results[n * 2] >= 0) && n < nmatches && curlen < len; n++) {
+          spaceleft = len - curlen;
+          if (results[n * 2 + 1] < spaceleft) {
+            spaceleft = results[n * 2 + 1];
+          }
+          matches[n] = data + curlen;
+          strncpy(data + curlen, d + results[n * 2], spaceleft);
+          curlen += spaceleft;
+          data[curlen++] = '\0';
+        }
+      }
+      for (; n < nmatches; n++) {
+        matches[n] = NULL;
+      }
+    }
+    return 1;
+  } else {
+    /* Unset matches. */
+    for (n = 0; n < nmatches; n++) {
+      matches[n] = NULL;
+    }
+  }
+  return 0;
 }
 
 /** Regexp match, possibly case-sensitive, and remember matched subexpressions.
@@ -527,7 +409,7 @@
  * This routine will cause crashes if fed NULLs instead of strings.
  *
  * \param s regexp to match against.
- * \param d string to check.
+ * \param val string to check.
  * \param cs if 1, case-sensitive; if 0, case-insensitive
  * \param matches array to store matched subexpressions in
  * \param nmatches the size of the matches array
@@ -596,8 +478,7 @@
    * with other languages.
    */
   for (i = 0; i < nmatches && (int) i < subpatterns && totallen < len; i++) {
-    // Current data match.
-    /* This is more annoying than a jumping flea up the nose. Since 
+    /* This is more annoying than a jumping flea up the nose. Since
      * ansi_pcre_copy_substring() uses buff, bp instead of char *, len,
      * we have to mangle bp and 'buff' by hand. Sound easy? We also
      * have to make sure that 'buff' + len < BUFFER_LEN. Particularly since
@@ -725,66 +606,52 @@
     return (!d || !*d) ? 1 : 0;
 }
 
-/** Does a string contain a wildcard character (* or ?)?
- * Not used by the wild matching routines, but suitable for outside use.
- * \param s string to check.
- * \retval 1 s contains a * or ?
- * \retval 0 s does not contain a * or ?
+/** Check to see if a string contains either wildcard characters (* or ?), or
+ * backslash-escaped characters. If there are no wildcards but there are escaped characters,
+ * destructively modify the string to remove the escapes, if requested.
+ * \param s string to check
+ * \param unescape If no unescaped wildcards are present, should we modify s to remove escapes?
+ * \retval -1 s contains unescaped wildcards
+ * \retval >-1 number of \-escaped characters remaining in s
  */
-bool
-wildcard(const char *s)
-{
-  if (strchr(s, '*') || strchr(s, '?'))
-    return 1;
-  return 0;
-}
-
-static bool
-check_literals(const char *restrict tstr, const char *restrict dstr, bool cs)
+int
+wildcard_count(char *s, bool unescape)
 {
-  /* Every literal string in tstr must appear, in order, in dstr,
-   * or no match can happen. That is, tstr is the pattern and dstr
-   * is the string-to-match
-   */
-  char tbuf1[BUFFER_LEN];
-  char dbuf1[BUFFER_LEN];
-  const char delims[] = "?*";
-  char *sp, *dp;
-  size_t len = 0;
+  char *c = s;
+  int escapes = 0;
 
-  dp = remove_markup(dstr, &len);
-  memcpy(dbuf1, dp, len);
-  mush_strncpy(tbuf1, strip_backslashes(tstr), BUFFER_LEN);
-  if (!cs) {
-    upcasestr(tbuf1);
-    upcasestr(dbuf1);
-  }
-  dp = dbuf1;
-  sp = strtok(tbuf1, delims);
-  while (sp) {
-    if (!dp || !*dp)
-      return 0;
-    if (!(dp = strstr(dp, sp)))
-      return 0;
-    dp += strlen(sp);
-    sp = strtok(NULL, delims);
+  while (*c) {
+    if (*c == '?' || *c == '*')
+      return -1;
+    else if (*c == '\\') {
+      c++;
+      if (!*c)
+        break;
+      else
+        escapes++;
+    }
+    c++;
   }
-  return 1;
-}
-
 
-static char *
-strip_backslashes(const char *str)
-{
-  /* Remove backslashes from a string, and return it in a static buffer */
-  static char buf[BUFFER_LEN];
-  int i = 0;
+  if (!escapes || !unescape)
+    return escapes;
+  else {
+    char *rep;
 
-  while (*str && (i < BUFFER_LEN - 1)) {
-    if (*str == '\\' && *(str + 1))
-      str++;
-    buf[i++] = *str++;
+    /* There are \-escapes, but no unescaped wildcards.
+     * Modify s to remove one layer of \'s. */
+    c = rep = strchr(s, '\\');
+    while (*c) {
+      if (escapes && *rep == '\\') {
+        rep++;
+        escapes--;
+      }
+      *c = *rep;
+      if (!*rep)
+        break;
+      c++;
+      rep++;
+    }
+    return 0;
   }
-  buf[i] = '\0';
-  return buf;
 }
Index: src/look.c
===================================================================
--- src/look.c	(.../184p1)	(revision 682)
+++ src/look.c	(.../184p2)	(revision 682)
@@ -419,7 +419,7 @@
 look_atrs(dbref player, dbref thing, const char *mstr, int all, int mortal,
           int parent)
 {
-  if (all || (mstr && *mstr && !wildcard(mstr))) {
+  if (all || (mstr && *mstr && !wildcard((char *) mstr))) {
     if (parent) {
       if (!atr_iter_get_parent
           (player, thing, mstr, mortal, 0, look_helper, NULL)
@@ -635,7 +635,7 @@
 {
   dbref thing;
   dbref loc;
-  int near;
+  int near = 0;
 
   if (!GoodObject(Location(player)))
     return;
@@ -729,11 +729,12 @@
         notify(player, T("You can't look at that from here."));
         return;
       }
+      near = nearby(player, box) && nearby(box, thing);
     } else if (thing == AMBIGUOUS) {
       notify(player, T("I can't tell which one you mean."));
       return;
     }
-    near = nearby(player, thing);
+    near = near || nearby(player, thing);
   }
 
   /* once we've determined the object to look at, it doesn't matter whether
Index: src/game.c
===================================================================
--- src/game.c	(.../184p1)	(revision 682)
+++ src/game.c	(.../184p2)	(revision 682)
@@ -111,7 +111,7 @@
 void bind_and_queue(dbref player, dbref cause, char *action, const char *arg,
                     const char *placestr);
 void do_scan(dbref player, char *command, int flag);
-void do_list(dbref player, char *arg, int lc);
+void do_list(dbref player, char *arg, int lc, int which);
 void do_dolist(dbref player, char *list, char *command,
                dbref cause, unsigned int flags);
 void do_uptime(dbref player, int mortal);
@@ -1251,7 +1251,7 @@
        */
       if ((errdblist == errdbtail) || (!fail_commands(player)))
         /* Nope. This is totally unmatched, run generic failure */
-        generic_command_failure(player, cause, unp);
+        generic_command_failure(player, cause, cptr);
     }
   }
 
@@ -1552,6 +1552,8 @@
 {
   char *repl, *command;
   const char *replace[2];
+  PE_Info *pe_info;
+  int i = 0;
 
   replace[0] = arg;
   replace[1] = placestr;
@@ -1562,7 +1564,20 @@
 
   mush_free(repl, "replace_string.buff");
 
-  parse_que(player, command, cause);
+  pe_info = make_pe_info();
+  if (global_eval_context.pe_info->iter_nesting >= 0) {
+    for (i = 0; i <= global_eval_context.pe_info->iter_nesting; i++) {
+      pe_info->iter_inum[i] = global_eval_context.pe_info->iter_inum[i];
+      pe_info->iter_itext[i] =
+        mush_strdup(global_eval_context.pe_info->iter_itext[i], "dolist_arg");
+    }
+  }
+  pe_info->iter_inum[i] = parse_integer(placestr);
+  pe_info->iter_itext[i] = mush_strdup(arg, "dolist_arg");
+  pe_info->iter_nesting = i;
+  pe_info->local_iter_nesting = i;
+  pe_info->dolists = global_eval_context.pe_info->dolists + 1;
+  parse_que(player, command, cause, pe_info);
 
   mush_free(command, "strip_braces.buff");
 }
@@ -1847,7 +1862,7 @@
   if (!command || !*command) {
     notify(player, T("What do you want to do with the list?"));
     if (flags & DOL_NOTIFY)
-      parse_que(player, "@notify me", cause);
+      parse_que(player, "@notify me", cause, NULL);
     return;
   }
 
@@ -1855,7 +1870,7 @@
     if (list[1] != ' ') {
       notify(player, T("Separator must be one character."));
       if (flags & DOL_NOTIFY)
-        parse_que(player, "@notify me", cause);
+        parse_que(player, "@notify me", cause, NULL);
       return;
     }
     delim = list[0];
@@ -1874,7 +1889,7 @@
   if (objstring && !*objstring) {
     /* Blank list */
     if (flags & DOL_NOTIFY)
-      parse_que(player, "@notify me", cause);
+      parse_que(player, "@notify me", cause, NULL);
     return;
   }
 
@@ -1892,7 +1907,7 @@
      *  directly, since we want the command to be queued
      *  _after_ the list has executed.
      */
-    parse_que(player, "@notify me", cause);
+    parse_que(player, "@notify me", cause, NULL);
   }
 }
 
@@ -2356,15 +2371,26 @@
  * \param lc if 1, list in lowercase.
  */
 void
-do_list(dbref player, char *arg, int lc)
+do_list(dbref player, char *arg, int lc, int which)
 {
   if (!arg || !*arg)
     notify(player, T("I don't understand what you want to @list."));
   else if (string_prefix("commands", arg))
-    do_list_commands(player, lc);
-  else if (string_prefix("functions", arg))
-    do_list_functions(player, lc);
-  else if (string_prefix("motd", arg))
+    do_list_commands(player, lc, which);
+  else if (string_prefix("functions", arg)) {
+    switch (which) {
+    case '1':
+      do_list_functions(player, lc, "builtin");
+      break;
+    case '2':
+      do_list_functions(player, lc, "local");
+      break;
+    case '3':
+    default:
+      do_list_functions(player, lc, "all");
+      break;
+    }
+  } else if (string_prefix("motd", arg))
     do_motd(player, MOTD_LIST, "");
   else if (string_prefix("attribs", arg))
     do_list_attribs(player, lc);
Index: src/parse.c
===================================================================
--- src/parse.c	(.../184p1)	(revision 682)
+++ src/parse.c	(.../184p2)	(revision 682)
@@ -51,6 +51,7 @@
 /** Structure for storing DEBUG output in a linked list */
 struct debug_info {
   char *string;         /**< A DEBUG string */
+  dbref executor;
   Debug_Info *prev;     /**< Previous node in the linked list */
   Debug_Info *next;     /**< Next node in the linked list */
 };
@@ -74,6 +75,7 @@
 char e_notvis[] = "#-1 NO SUCH OBJECT VISIBLE";
 char e_disabled[] = "#-1 FUNCTION DISABLED";
 char e_range[] = "#-1 OUT OF RANGE";
+char e_argrange[] = "#-1 ARGUMENT OUT OF RANGE";
 
 #endif
 
@@ -100,6 +102,7 @@
   temp = T("#-1 NO SUCH OBJECT VISIBLE");
   temp = T("#-1 FUNCTION DISABLED");
   temp = T("#-1 OUT OF RANGE");
+  temp = T("#-1 ARGUMENT OUT OF RANGE");
 }
 
 #endif
@@ -371,10 +374,11 @@
 is_strict_number(char const *str)
 {
   char *end;
+  int throwaway;
   if (!str)
     return 0;
   errno = 0;
-  strtod(str, &end);
+  throwaway = strtod(str, &end);
   if (errno == ERANGE || *end != '\0')
     return 0;
   return end > str;
@@ -597,6 +601,11 @@
   pe_info->debug_strings = NULL;
   pe_info->arg_count = 0;
   pe_info->iter_nesting = -1;
+  pe_info->local_iter_nesting = -1;
+  pe_info->iter_break = -1;
+  pe_info->dolists = 0;
+  pe_info->switch_nesting = -1;
+  pe_info->local_switch_nesting = -1;
 
   return pe_info;
 }
@@ -604,6 +613,20 @@
 void
 free_pe_info(PE_Info *pe_info)
 {
+  if (!pe_info)
+    return;
+  if (pe_info->iter_nesting >= 0) {
+    int i;
+    for (i = pe_info->iter_nesting; i >= 0; i--) {
+      mush_free(pe_info->iter_itext[i], "dolist_arg");
+    }
+  }
+  if (pe_info->switch_nesting >= 0) {
+    int j;
+    for (j = pe_info->switch_nesting; j >= 0; j--) {
+      mush_free(pe_info->switch_text[j], "switch_arg");
+    }
+  }
   mush_free(pe_info, "process_expression.pe_info");
   return;
 }
@@ -766,6 +789,7 @@
       node = (Debug_Info *) mush_malloc(sizeof(Debug_Info),
                                         "process_expression.debug_node");
       node->string = debugstr;
+      node->executor = executor;
       node->prev = pe_info->debug_strings;
       node->next = NULL;
       if (node->prev)
@@ -968,7 +992,7 @@
             safe_chr(':', buff, bp);
             safe_integer(CreTime(enactor), buff, bp);
           } else {
-            safe_str("#-1 NO SUCH OBJECT VISIBLE", buff, bp);
+            safe_str(T(e_notvis), buff, bp);
           }
           break;
         case '?':              /* function limits */
@@ -984,7 +1008,7 @@
           if (GoodObject(enactor)) {
             safe_str(accented_name(enactor), buff, bp);
           } else {
-            safe_str("Nothing", buff, bp);
+            safe_str(T(e_notvis), buff, bp);
           }
           break;
         case '+':              /* argument count */
@@ -1013,7 +1037,7 @@
               gender = get_gender(enactor);
             safe_str(absp[gender], buff, bp);
           } else {
-            safe_str("#-1 NO SUCH OBJECT VISIBLE", buff, bp);
+            safe_str(T(e_notvis), buff, bp);
           }
           break;
         case 'B':
@@ -1030,17 +1054,54 @@
           if (!nextc)
             goto exit_sequence;
           (*str)++;
-          if (!isdigit((unsigned char) nextc)) {
-            safe_str(T(e_int), buff, bp);
-            break;
+          if (pe_info->iter_nesting >= 0 && pe_info->local_iter_nesting >= 0) {
+            if (nextc == 'l') {
+              safe_str(pe_info->
+                       iter_itext[pe_info->iter_nesting -
+                                  pe_info->local_iter_nesting], buff, bp);
+              break;
+            }
+            if (!isdigit((unsigned char) nextc)) {
+              safe_str(T(e_int), buff, bp);
+              break;
+            }
+            inum_this = nextc - '0';
+            if (inum_this < 0 || inum_this > pe_info->local_iter_nesting
+                || (pe_info->local_iter_nesting - inum_this) < 0) {
+              safe_str(T(e_argrange), buff, bp);
+            } else {
+              safe_str(pe_info->iter_itext[pe_info->iter_nesting - inum_this],
+                       buff, bp);
+            }
+          } else {
+            safe_str(T(e_argrange), buff, bp);
           }
-          inum_this = nextc - '0';
-          if (inum_this < 0 || inum_this > pe_info->iter_nesting
-              || (pe_info->iter_nesting - inum_this) < 0) {
-            safe_str(T("#-1 ARGUMENT OUT OF RANGE"), buff, bp);
+          break;
+        case '$':
+          nextc = **str;
+          if (!nextc)
+            goto exit_sequence;
+          (*str)++;
+          if (pe_info->switch_nesting >= 0
+              && pe_info->local_switch_nesting >= 0) {
+            if (nextc == 'l') {
+              inum_this = pe_info->local_switch_nesting;
+            } else if (!isdigit((unsigned char) nextc)) {
+              safe_str(T(e_int), buff, bp);
+              break;
+            } else {
+              inum_this = nextc - '0';
+            }
+            if (inum_this < 0 || inum_this > pe_info->local_switch_nesting ||
+                (pe_info->local_switch_nesting - inum_this) < 0) {
+              safe_str(T(e_argrange), buff, bp);
+            } else {
+              safe_str(pe_info->
+                       switch_text[pe_info->switch_nesting - inum_this], buff,
+                       bp);
+            }
           } else {
-            safe_str(pe_info->iter_itext[pe_info->iter_nesting - inum_this],
-                     buff, bp);
+            safe_str(T(e_argrange), buff, bp);
           }
           break;
         case 'U':
@@ -1062,7 +1123,7 @@
           if (GoodObject(enactor)) {
             safe_str(Name(enactor), buff, bp);
           } else {
-            safe_str("#-1 NO SUCH OBJECT VISIBLE", buff, bp);
+            safe_str(T(e_notvis), buff, bp);
           }
           break;
         case 'O':
@@ -1072,7 +1133,7 @@
               gender = get_gender(enactor);
             safe_str(obj[gender], buff, bp);
           } else {
-            safe_str("#-1 NO SUCH OBJECT VISIBLE", buff, bp);
+            safe_str(T(e_notvis), buff, bp);
           }
           break;
         case 'P':
@@ -1082,7 +1143,7 @@
               gender = get_gender(enactor);
             safe_str(poss[gender], buff, bp);
           } else {
-            safe_str("#-1 NO SUCH OBJECT VISIBLE", buff, bp);
+            safe_str(T(e_notvis), buff, bp);
           }
           break;
         case 'Q':
@@ -1110,7 +1171,7 @@
               gender = get_gender(enactor);
             safe_str(subj[gender], buff, bp);
           } else {
-            safe_str("#-1 NO SUCH OBJECT VISIBLE", buff, bp);
+            safe_str(T(e_notvis), buff, bp);
           }
           break;
         case 'T':
@@ -1535,17 +1596,19 @@
       if (strcmp(sourcestr, startpos)) {
         static char dbuf[BUFFER_LEN];
         char *dbp;
+        dbref dbe;
         if (pe_info->debug_strings) {
           while (pe_info->debug_strings->prev)
             pe_info->debug_strings = pe_info->debug_strings->prev;
           while (pe_info->debug_strings->next) {
+            dbe = pe_info->debug_strings->executor;
             dbp = dbuf;
             dbuf[0] = '\0';
             safe_format(dbuf, &dbp, "%s :", pe_info->debug_strings->string);
             *dbp = '\0';
-            if (Connected(Owner(executor)))
-              raw_notify(Owner(executor), dbuf);
-            notify_list(executor, executor, "DEBUGFORWARDLIST", dbuf,
+            if (Connected(Owner(dbe)))
+              raw_notify(Owner(dbe), dbuf);
+            notify_list(dbe, dbe, "DEBUGFORWARDLIST", dbuf,
                         NA_NOLISTEN | NA_NOPREFIX);
             pe_info->debug_strings = pe_info->debug_strings->next;
             mush_free(pe_info->debug_strings->prev,
Index: src/atr_tab.c
===================================================================
--- src/atr_tab.c	(.../184p1)	(revision 682)
+++ src/atr_tab.c	(.../184p2)	(revision 682)
@@ -22,7 +22,9 @@
 #include "log.h"
 #include "parse.h"
 #include "confmagic.h"
+#include "ansi.h"
 
+extern const unsigned char *tables;
 
 /** An alias for an attribute.
  */
@@ -190,6 +192,262 @@
   return 1;
 }
 
+/** Since enum adds a delim before and after the string, edit them out. */
+const char *
+display_attr_limit(ATTR *ap)
+{
+  char *ptr;
+  char *s;
+
+  if (ap->data && (ap->flags & AF_ENUM)) {
+    ptr = atr_value(ap);
+    *(ptr++) = '\0';
+    s = ptr + strlen(ptr);
+    s--;
+    *(s) = '\0';
+    return ptr;
+  } else if (ap->data && (ap->flags & AF_RLIMIT)) {
+    return atr_value(ap);
+  }
+  return "unset";
+}
+
+/** Check an attribute's value against /limit or /enum restrictions.
+ * \player Player attempting to set the attribute. Used for notify()
+ * \param name the attribute name.
+ * \param value The desired attribute value.
+ * \retval The new value to set if valid, NULL if not.
+ */
+const char *
+check_attr_value(dbref player, const char *name, const char *value)
+{
+  /* Check for attribute limits and enums. */
+  ATTR *ap;
+  char *attrval;
+  pcre *re;
+  int subpatterns;
+  const char *errptr;
+  int erroffset;
+  char *ptr, *ptr2;
+  char delim;
+  int len;
+  static char buff[BUFFER_LEN];
+  char vbuff[BUFFER_LEN];
+
+  if (!name || !*name)
+    return value;
+  if (!value)
+    return value;
+
+  upcasestr((char *) name);
+  ap = (ATTR *) ptab_find_exact(&ptab_attrib, name);
+  if (!ap)
+    return value;
+
+  attrval = atr_value(ap);
+  if (!attrval) {
+    return value;
+  }
+
+  if (ap->flags & AF_RLIMIT) {
+    re = pcre_compile(remove_markup(attrval, NULL), PCRE_CASELESS,
+                      &errptr, &erroffset, tables);
+    if (!re)
+      return value;
+
+    subpatterns = pcre_exec(re, default_match_limit(), value, strlen(value),
+                            0, 0, NULL, 0);
+    free(re);
+
+    if (subpatterns >= 0) {
+      return value;
+    } else {
+      notify(player, T("Attribute value does not match the /limit regexp."));
+      return NULL;
+    }
+  } else if (ap->flags & AF_ENUM) {
+    /* Delimiter is always the first character of the enum string.
+     * and the value cannot have the delimiter in it. */
+    delim = *attrval;
+    if (!*value || strchr(value, delim)) {
+      notify_format(player,
+                    T("Value for %s needs to be one of: %s"),
+                    ap->name, display_attr_limit(ap));
+      return NULL;
+    }
+
+    /* We match the enum case-insensitively, BUT we use the case
+     * that is defined in the enum, so we copy the attr value
+     * to buff and use that. */
+    snprintf(buff, BUFFER_LEN, "%s", attrval);
+    upcasestr(buff);
+
+    len = strlen(value);
+    snprintf(vbuff, BUFFER_LEN, "%c%s%c", delim, value, delim);
+    upcasestr(vbuff);
+
+    ptr = strstr(buff, vbuff);
+    if (!ptr) {
+      *(vbuff + len + 1) = '\0';        /* Remove the second delim */
+      ptr = strstr(buff, vbuff);
+    }
+
+    /* Do we have a match? */
+    if (ptr) {
+      /* ptr is pointing at the delim before the value. */
+      ptr++;
+      ptr2 = strchr(ptr, delim);
+      if (!ptr2)
+        return NULL;            /* Shouldn't happen, but sanity check. */
+
+      /* Now we need to copy over the _original case_ version of the
+       * enumerated string. Nasty pointer arithmetic. */
+      strncpy(buff, attrval + (ptr - buff), (int) (ptr2 - ptr));
+      buff[ptr2 - ptr] = '\0';
+      return buff;
+    } else {
+      notify_format(player,
+                    T("Value for %s needs to be one of: %s"),
+                    ap->name, display_attr_limit(ap));
+      return NULL;
+    }
+  }
+  return value;
+}
+
+/** Limit an attribute's possible values, using either an enum or a
+ *  regexp /limit.
+ * \verbatim
+ * Given a name, restriction type and string for an attribute,
+ * set its data value to said data and set a flag for limit or
+ * enum.
+ *
+ * For an enum, the attr's data will be set to
+ * <delim><pattern><delim>, so a simple strstr() can be used when
+ * matching the pattern.
+ *
+ * An optional delimiter can be provided on the left hand side by using
+ * @attr/enum <delim> <attrname>=<enum list>
+ * \endverbatim
+ * \param player the enactor.
+ * \param name the attribute name.
+ * \param type AF_RLIMIT for regexp, AF_ENUM for enum.
+ * \param pattern The allowed pattern for the attribute.
+ */
+void
+do_attribute_limit(dbref player, char *name, int type, char *pattern)
+{
+  ATTR *ap;
+  char buff[BUFFER_LEN];
+  char *ptr, *bp;
+  char delim = ' ';
+  pcre *re;
+  const char *errptr;
+  int erroffset;
+  int unset = 0;
+
+  if (pattern && *pattern) {
+    if (type == AF_RLIMIT) {
+      /* Compile to regexp. */
+      re = pcre_compile(remove_markup(pattern, NULL), PCRE_CASELESS,
+                        &errptr, &erroffset, tables);
+      if (!re) {
+        notify(player, T("Invalid Regular Expression."));
+        return;
+      }
+      /* We only care if it's valid, we're not using it. */
+      free(re);
+
+      /* Copy it to buff to be placed into ap->data. */
+      snprintf(buff, BUFFER_LEN, "%s", pattern);
+    } else if (type == AF_ENUM) {
+      ptr = name;
+      /* Check for a delimiter: @attr/enum | attrname=foo */
+      if ((name = strchr(ptr, ' ')) != NULL) {
+        *(name++) = '\0';
+        if (strlen(ptr) > 1) {
+          notify(player, T("Delimiter must be one character."));
+          return;
+        }
+        delim = *ptr;
+      } else {
+        name = ptr;
+        delim = ' ';
+      }
+
+      /* For speed purposes, we require the pattern to begin and end with
+       * a delimiter. */
+      snprintf(buff, BUFFER_LEN, "%c%s%c", delim, pattern, delim);
+      buff[BUFFER_LEN - 1] = '\0';
+
+      /* For sanity's sake, we'll enforce a properly delimited enum
+       * with a quick and dirty squish().
+       * We already know we start with a delim, hence the +1 =). */
+      for (ptr = buff + 1, bp = buff + 1; *ptr; ptr++) {
+        if (!(*ptr == delim && *(ptr - 1) == delim)) {
+          *(bp++) = *ptr;
+        }
+      }
+      *bp = '\0';
+    } else {
+      /* Err, we got called with the wrong limit type? */
+      notify(player, T("Unknown limit type?"));
+      return;
+    }
+  } else {
+    unset = 1;
+  }
+
+  /* Parse name and perms */
+  if (!name || !*name) {
+    notify(player, T("Which attribute do you mean?"));
+    return;
+  }
+  upcasestr(name);
+  if (*name == '@')
+    name++;
+
+  /* Is this attribute already in the table? */
+  ap = (ATTR *) ptab_find_exact(&ptab_attrib, name);
+
+  if (!ap) {
+    notify(player,
+           T
+           ("I don't know that attribute. Please use @attribute/access to create it, first."));
+    return;
+  }
+
+  if (AF_Internal(ap)) {
+    /* Don't muck with internal attributes */
+    notify(player, T("That attribute's permissions cannot be changed."));
+    return;
+  }
+
+  /* All's good, set the data and the AF_RLIMIT or AF_ENUM flag. */
+  if (ap->data != NULL_CHUNK_REFERENCE) {
+    chunk_delete(ap->data);
+  }
+  /* Clear any extant rlimit or enum flags */
+  ap->flags &= ~(AF_RLIMIT | AF_ENUM);
+  if (unset) {
+    if (ap->data != NULL_CHUNK_REFERENCE) {
+      ap->data = NULL_CHUNK_REFERENCE;
+      notify_format(player, T("%s -- Attribute limit or enum unset."), name);
+    } else {
+      notify_format(player,
+                    T("%s -- Attribute limit or enum already unset."), name);
+    }
+  } else {
+    unsigned char *t = compress(buff);
+    ap->data = chunk_create(t, u_strlen(t), 0);
+    free(t);
+    ap->flags |= type;
+    notify_format(player,
+                  T("%s -- Attribute %s set to: %s"), name,
+                  type == AF_RLIMIT ? "limit" : "enum", display_attr_limit(ap));
+  }
+}
+
 /** Add new standard attributes, or change permissions on them.
  * \verbatim
  * Given the name and permission string for an attribute, add it to
@@ -301,6 +559,11 @@
     return;
   }
 
+  /* Free everything it uses. */
+  if (ap->data != NULL_CHUNK_REFERENCE) {
+    chunk_delete(ap->data);
+  }
+
   /* Ok, take it out of the hash table */
   ptab_delete(&ptab_attrib, name);
   notify_format(player, T("Removed %s from attribute table."), name);
@@ -383,6 +646,11 @@
     return;
   }
   notify_format(player, "%9s: %s", T("Attribute"), AL_NAME(ap));
+  if (ap->flags & AF_RLIMIT) {
+    notify_format(player, "%9s: %s", T("Limit"), display_attr_limit(ap));
+  } else if (ap->flags & AF_ENUM) {
+    notify_format(player, "%9s: %s", T("Enum"), display_attr_limit(ap));
+  }
   notify_format(player,
                 "%9s: %s", T("Flags"), privs_to_string(attr_privs_view,
                                                        AL_FLAGS(ap)));
Index: src/command.c
===================================================================
--- src/command.c	(.../184p1)	(revision 682)
+++ src/command.c	(.../184p2)	(revision 682)
@@ -89,7 +89,7 @@
   {"@ATRLOCK", NULL, cmd_atrlock, CMD_T_ANY | CMD_T_EQSPLIT, 0, 0},
   {"@ATRCHOWN", NULL, cmd_atrchown, CMD_T_ANY | CMD_T_EQSPLIT, 0, 0},
 
-  {"@ATTRIBUTE", "ACCESS DELETE RENAME RETROACTIVE", cmd_attribute,
+  {"@ATTRIBUTE", "ACCESS DELETE RENAME RETROACTIVE LIMIT ENUM", cmd_attribute,
    CMD_T_ANY | CMD_T_EQSPLIT, 0, 0},
   {"@BOOT", "PORT ME SILENT", cmd_boot, CMD_T_ANY, 0, 0},
   {"@BREAK", NULL, cmd_break, CMD_T_ANY | CMD_T_EQSPLIT | CMD_T_RS_NOPARSE, 0,
@@ -97,7 +97,7 @@
   {"@CEMIT", "NOEVAL NOISY SILENT SPOOF", cmd_cemit,
    CMD_T_ANY | CMD_T_EQSPLIT | CMD_T_NOGAGGED, 0, 0},
   {"@CHANNEL",
-   "LIST ADD DELETE RENAME MOGRIFIER NAME PRIVS QUIET NOISY DECOMPILE DESCRIBE CHOWN WIPE MUTE UNMUTE GAG UNGAG HIDE UNHIDE WHAT TITLE BRIEF RECALL BUFFER SET",
+   "LIST ADD DELETE RENAME MOGRIFIER NAME PRIVS QUIET NOISY DECOMPILE DESCRIBE CHOWN WIPE MUTE UNMUTE GAG UNGAG HIDE UNHIDE WHAT TITLE BRIEF RECALL BUFFER SET COMBINE UNCOMBINE",
    cmd_channel,
    CMD_T_ANY | CMD_T_SWITCHES | CMD_T_EQSPLIT | CMD_T_NOGAGGED | CMD_T_RS_ARGS,
    0, 0},
@@ -168,7 +168,7 @@
    "ALIAS BUILTIN CLONE DELETE ENABLE DISABLE PRESERVE RESTORE RESTRICT",
    cmd_function,
    CMD_T_ANY | CMD_T_EQSPLIT | CMD_T_RS_ARGS | CMD_T_NOGAGGED, 0, 0},
-  {"@GREP", "LIST PRINT ILIST IPRINT", cmd_grep,
+  {"@GREP", "LIST PRINT ILIST IPRINT REGEXP WILD NOCASE", cmd_grep,
    CMD_T_ANY | CMD_T_EQSPLIT | CMD_T_RS_NOPARSE | CMD_T_NOGAGGED, 0, 0},
   {"@HALT", "ALL PID", cmd_halt, CMD_T_ANY | CMD_T_EQSPLIT, 0, 0},
   {"@HIDE", "NO OFF YES ON", cmd_hide, CMD_T_ANY, 0, 0},
@@ -186,7 +186,7 @@
   {"@LISTMOTD", NULL, cmd_listmotd, CMD_T_ANY, 0, 0},
 
   {"@LIST",
-   "LOWERCASE MOTD LOCKS FLAGS FUNCTIONS POWERS COMMANDS ATTRIBS ALLOCATIONS",
+   "LOWERCASE MOTD LOCKS FLAGS FUNCTIONS POWERS COMMANDS ATTRIBS ALLOCATIONS ALL BUILTIN LOCAL",
    cmd_list,
    CMD_T_ANY, 0, 0},
   {"@LOCK", NULL, cmd_lock,
@@ -1422,7 +1422,9 @@
   }
 
   /* If we have a hook/override, we use that instead */
-  if (!run_hook_override(cmd, player, commandraw)) {
+  if (!run_hook_override(cmd, player, commandraw) &&
+      !(!strcmp(cmd->name, "HUH_COMMAND") &&
+        run_hook_override(cmd, player, tprintf("HUH_COMMAND %s", ls)))) {
     /* Otherwise, we do hook/before, the command, and hook/after */
     /* But first, let's see if we had an invalid switch */
     if (switch_err && *switch_err) {
@@ -2002,32 +2004,41 @@
  * This function sends a player the list of commands.
  * \param player the enactor.
  * \param lc if true, list is in lowercase rather than uppercase.
+ * \param type 3 = show all, 2 = show only local @commands, 1 = show only built-in @commands
  */
 void
-do_list_commands(dbref player, int lc)
+do_list_commands(dbref player, int lc, int type)
 {
-  char *b = list_commands();
+  char *b = list_commands(type);
   notify_format(player, T("Commands: %s"), lc ? strlower(b) : b);
 }
 
 /** Return a list of defined commands.
  * This function returns a space-separated list of commands as a string.
+ * \param type 3 = show all, 2 = show only local @commands, 1 = show only built-in @commands
  */
 char *
-list_commands(void)
+list_commands(int type)
 {
   COMMAND_INFO *command;
   char *ptrs[BUFFER_LEN / 2];
   static char buff[BUFFER_LEN];
   char *bp;
   int nptrs = 0, i;
+
   command = (COMMAND_INFO *) ptab_firstentry(&ptab_command);
   while (command) {
-    ptrs[nptrs] = (char *) command->name;
-    nptrs++;
+    if (type == 3 || (type == 1 && command->func != cmd_unimplemented) ||
+        (type == 2 && command->func == cmd_unimplemented)) {
+      ptrs[nptrs] = (char *) command->name;
+      nptrs++;
+    }
     command = (COMMAND_INFO *) ptab_nextentry(&ptab_command);
   }
 
+  if (!nptrs)
+    return "";
+
   do_gensort(0, ptrs, NULL, nptrs, ALPHANUM_LIST);
   bp = buff;
   safe_str(ptrs[0], buff, &bp);
Index: src/help.c
===================================================================
--- src/help.c	(.../184p1)	(revision 682)
+++ src/help.c	(.../184p2)	(revision 682)
@@ -72,7 +72,7 @@
     return;
   }
 
-  if (wildcard(arg_left)) {
+  if (wildcard_count(arg_left, 1) == -1) {
     int len = 0;
     char **entries;
 
@@ -479,7 +479,7 @@
     return;
   }
 
-  if (wildcard(args[1])) {
+  if (wildcard_count(args[1], 1) == -1) {
     char **entries;
     int len = 0;
     entries = list_matching_entries(args[1], h, &len);
@@ -588,7 +588,7 @@
   else
     offset = 0;
 
-  if (!wildcard(pattern)) {
+  if (wildcard_count((char *) pattern, 1) >= 0) {
     /* Quick way out, use the other kind of matching */
     char the_topic[LINE_SIZE + 2];
     help_indx *entry = NULL;
Index: src/pcre.c
===================================================================
--- src/pcre.c	(.../184p1)	(revision 682)
+++ src/pcre.c	(.../184p2)	(revision 682)
@@ -1271,6 +1271,7 @@
 
 
 
+
 pcre_get_substring_list(const char *subject, int *ovector, int stringcount,
                         const char ***listptr);
 
@@ -1369,6 +1370,7 @@
 
 
 
+
 pcre_get_substring(const char *subject, int *ovector, int stringcount,
                    int stringnumber, const char **stringptr);
 
@@ -1434,6 +1436,7 @@
 
 
 
+
 pcre_get_named_substring(const pcre * code, const char *subject, int *ovector,
                          int stringcount, const char *stringname,
                          const char **stringptr);
@@ -2318,6 +2321,7 @@
 
 
 
+
 
 
 
Index: src/predicat.c
===================================================================
--- src/predicat.c	(.../184p1)	(revision 682)
+++ src/predicat.c	(.../184p2)	(revision 682)
@@ -44,11 +44,9 @@
 void do_switch(dbref player, char *expression, char **argv,
                dbref cause, int first, int notifyme, int regexp);
 void do_verb(dbref player, dbref cause, char *arg1, char **argv);
-static int grep_util_helper(dbref player, dbref thing, dbref parent,
-                            char const *pattern, ATTR *atr, void *args);
-static int grep_helper(dbref player, dbref thing, dbref parent,
-                       char const *pattern, ATTR *atr, void *args);
-void do_grep(dbref player, char *obj, char *lookfor, int flag, int insensitive);
+static void grep_add_attr(char *buff, char **bp, dbref player, int count,
+                          ATTR *attr, char *atrval);
+void do_grep(dbref player, char *obj, char *lookfor, int print, int flags);
 static int pay_quota(dbref, int);
 extern PRIV attr_privs_view[];
 
@@ -894,10 +892,9 @@
 }
 
 /** Is a name ok for a function?
- * It must start with uppercase alpha or punctuation and may contain only
- * uppercase alpha, numbers, or punctuation thereafter.
- * It must contain at least one uppercase alpha.
- * It may not begin with " : ; & ] \ and # (the special tokens).
+ * It must contain only uppercase alpha, numbers or punctuation, must
+ * contain at least one uppercase alpha, and may not begin with
+ * " : ; & ] \ or # (the special tokens).
  * \param name name to check.
  * \retval 1 name is acceptable.
  * \retval 0 name is not acceptable.
@@ -917,9 +914,6 @@
   case NUMBER_TOKEN:
   case '&':
     return 0;
-  default:
-    if (!isupper((unsigned char) *name) && !ispunct((unsigned char) *name))
-      return 0;
   }
   /* Everything else must be printable and non-space, and we need
    * to find at least one uppercase alpha
@@ -1003,6 +997,8 @@
   char buff[BUFFER_LEN], *bp;
   char const *ap;
   char *tbuf1;
+  PE_Info *pe_info;
+  int i = 0;
 
   if (!argv[1])
     return;
@@ -1029,7 +1025,18 @@
         : local_wild_match(buff, expression)) {
       any = 1;
       tbuf1 = replace_string("#$", expression, argv[a + 1]);
-      parse_que(player, tbuf1, cause);
+      pe_info = make_pe_info();
+      if (global_eval_context.pe_info->switch_nesting >= 0) {
+        for (i = 0; i <= global_eval_context.pe_info->switch_nesting; i++) {
+          pe_info->switch_text[i] =
+            mush_strdup(global_eval_context.pe_info->switch_text[i],
+                        "switch_arg");
+        }
+      }
+      pe_info->switch_text[i] = mush_strdup(expression, "switch_arg");
+      pe_info->switch_nesting = i;
+      pe_info->local_switch_nesting = i;
+      parse_que(player, tbuf1, cause, pe_info);
       mush_free(tbuf1, "replace_string.buff");
     }
   }
@@ -1037,13 +1044,24 @@
   /* do default if nothing has been matched */
   if ((a < MAX_ARG) && !any && argv[a]) {
     tbuf1 = replace_string("#$", expression, argv[a]);
-    parse_que(player, tbuf1, cause);
+    pe_info = make_pe_info();
+    if (global_eval_context.pe_info->switch_nesting >= 0) {
+      for (i = 0; i <= global_eval_context.pe_info->switch_nesting; i++) {
+        pe_info->switch_text[i] =
+          mush_strdup(global_eval_context.pe_info->switch_text[i],
+                      "switch_arg");
+      }
+    }
+    pe_info->switch_text[i] = mush_strdup(expression, "switch_arg");
+    pe_info->switch_nesting = i;
+    pe_info->local_switch_nesting = i;
+    parse_que(player, tbuf1, cause, pe_info);
     mush_free(tbuf1, "replace_string.buff");
   }
 
   /* Pop on @notify me, if requested */
   if (notifyme)
-    parse_que(player, "@notify me", cause);
+    parse_que(player, "@notify me", cause, NULL);
 }
 
 /** Parse possessive matches for the possessor.
@@ -1254,138 +1272,231 @@
     queue_attribute(victim, upcasestr(argv[6]), actor);
 }
 
-/** Structure for passing arguments to grep_util_helper().
- */
-struct guh_args {
-  char *buff;           /**< Buffer for output */
-  char *bp;             /**< Pointer to buff's current position */
-  char *lookfor;        /**< Pattern to grep for */
-  int sensitive;        /**< If 1, case-sensitive match; if 0, insensitive */
+struct regrep_data {
+  pcre *re;             /**< Pointer to compiled regular expression */
+  pcre_extra *study;    /**< Pointer to studied data about re */
+  char *buff;           /**< Buffer to store regrep results, or NULL to report to player */
+  char **bp;            /**< Pointer to address of insertion point in buff, or NULL */
+  int count;            /**< Number of matches found */
 };
 
-static int
-grep_util_helper(dbref player __attribute__ ((__unused__)),
-                 dbref thing __attribute__ ((__unused__)),
-                 dbref parent __attribute__ ((__unused__)),
-                 char const *pattern
-                 __attribute__ ((__unused__)), ATTR *atr, void *args)
+struct grep_data {
+  char *findstr;        /**< String to find */
+  int findlen;              /**< Length of findstr */
+  char *buff;           /**< Buffer to store regrep results, or NULL to report to player */
+  char **bp;            /**< Pointer to address of insertion point in buff, or NULL */
+  int count;            /**< Number of matches found */
+  int flags;            /**< Type of grep: wildcard, case-sensitive */
+};
+
+static void
+grep_add_attr(char *buff, char **bp, dbref player, int count, ATTR *attr,
+              char *atrval)
 {
-  struct guh_args *guh = args;
-  int found = 0;
-  char *s;
-  int len;
 
-  s = (char *) atr_value(atr);  /* warning: static */
-  len = strlen(guh->lookfor);
-  found = 0;
-  while (*s && !found) {
-    if ((guh->sensitive && !strncmp(guh->lookfor, s, len)) ||
-        (!guh->sensitive && !strncasecmp(guh->lookfor, s, len)))
-      found = 1;
-    else
-      s++;
-  }
-  if (found) {
-    if (guh->bp != guh->buff)
-      safe_chr(' ', guh->buff, &guh->bp);
-    safe_str(AL_NAME(atr), guh->buff, &guh->bp);
+  if (buff) {
+    if (count)
+      safe_chr(' ', buff, bp);
+    safe_str(AL_NAME(attr), buff, bp);
+  } else {
+    notify_format(player, "%s%s [#%d%s]:%s %s",
+                  ANSI_HILITE, AL_NAME(attr),
+                  Owner(AL_CREATOR(attr)),
+                  privs_to_letters(attr_privs_view, AL_FLAGS(attr)),
+                  ANSI_END, atrval);
   }
-  return found;
 }
 
+extern const unsigned char *tables;
+
 static int
-wildgrep_util_helper(dbref player __attribute__ ((__unused__)),
-                     dbref thing __attribute__ ((__unused__)),
-                     dbref parent __attribute__ ((__unused__)),
-                     char const *pattern
-                     __attribute__ ((__unused__)), ATTR *atr, void *args)
+grep_helper(dbref player, dbref thing __attribute__ ((__unused__)),
+            dbref parent __attribute__ ((__unused__)),
+            char const *pattern
+            __attribute__ ((__unused__)), ATTR *attr, void *args)
 {
-  struct guh_args *guh = args;
-  int found = 0;
+  struct grep_data *gd = args;
+  char *s;
+  char b1[BUFFER_LEN], b2[BUFFER_LEN];
+  char *tp = b1;
+  int matched = 0;
+  int cs;
 
-  if (quick_wild_new(guh->lookfor, atr_value(atr), guh->sensitive)) {
-    if (guh->bp != guh->buff)
-      safe_chr(' ', guh->buff, &guh->bp);
-    safe_str(AL_NAME(atr), guh->buff, &guh->bp);
-    found = 1;
+  cs = ((gd->flags & GREP_NOCASE) == 0);
+  s = (char *) atr_value(attr); /* warning: static */
+  if (gd->flags & GREP_WILD) {
+    if ((matched = quick_wild_new(gd->findstr, s, cs))) {
+      /* Since, in order for a wildcard match to succeed, the _entire
+         attribute_ value had to match the pattern, not just a substring,
+         highlighting is totally pointless */
+      strcpy(b1, s);
+    }
+  } else {
+    while (s && *s) {
+      if (!
+          (cs ? strncmp(s, gd->findstr, gd->findlen) :
+           strncasecmp(s, gd->findstr, gd->findlen))) {
+        matched = 1;
+        strncpy(b2, s, gd->findlen);
+        b2[gd->findlen] = '\0';
+        s += gd->findlen;
+        safe_format(b1, &tp, "%s%s%s", ANSI_HILITE, b2, ANSI_END);
+      } else {
+        safe_chr(*s, b1, &tp);
+        s++;
+      }
+    }
+    *tp = '\0';
   }
-  return found;
-}
 
-/** Utility function for grep funtions/commands.
- * This function returns a list of attributes on an object that
- * match a name pattern and contain another string.
- * \param player the enactor.
- * \param thing object to check attributes on.
- * \param pattern wildcard or substring pattern for attributes to check.
- * \param lookfor string to find within each attribute.
- * \param sensitive if 1, case-sensitive matching; if 0, case-insensitive.
- * \param wild if 1, wildcard matching, if 0, substring
- * \return string containing list of attribute names with matching data.
- */
-char *
-grep_util(dbref player, dbref thing, char *pattern, char *lookfor,
-          int sensitive, int wild)
-{
-  struct guh_args guh;
+  if (!matched)
+    return 0;
 
-  guh.buff = (char *) mush_malloc(BUFFER_LEN + 1, "grep_util.buff");
-  guh.bp = guh.buff;
-  guh.lookfor = lookfor;
-  guh.sensitive = sensitive;
-  (void) atr_iter_get(player, thing, pattern, 0, 0, wild ? wildgrep_util_helper
-                      : grep_util_helper, &guh);
-  *guh.bp = '\0';
-  return guh.buff;
+  grep_add_attr(gd->buff, gd->bp, player, gd->count, attr, b1);
+  gd->count++;
+  return 1;
 }
 
-/** Structure for grep_helper() arguments. */
-struct gh_args {
-  char *lookfor;        /**< Pattern to look for. */
-  int len;              /**< Length of lookfor. */
-  int insensitive;      /**< if 1, case-insensitive matching; if 0, sensitive */
-};
-
 static int
-grep_helper(dbref player, dbref thing __attribute__ ((__unused__)),
-            dbref parent __attribute__ ((__unused__)),
-            char const *pattern
-            __attribute__ ((__unused__)), ATTR *atr, void *args)
+regrep_helper(dbref player, dbref thing __attribute__ ((__unused__)),
+              dbref parent __attribute__ ((__unused__)),
+              char const *pattern
+              __attribute__ ((__unused__)), ATTR *attr, void *args)
 {
-  struct gh_args *gh = args;
-  int found;
+  struct regrep_data *rgd = args;
   char *s;
-  char tbuf1[BUFFER_LEN];
-  char buf[BUFFER_LEN];
-  char *tbp;
+  int offsets[99];
+  int subpatterns, search = 0;
+  ansi_string *orig, *repl;
+  char rbuff[BUFFER_LEN];
+  char *rbp = rbuff;
 
-  found = 0;
-  tbp = tbuf1;
+  s = atr_value(attr);
+  orig = parse_ansi_string(s);
+  if ((subpatterns =
+       pcre_exec(rgd->re, rgd->study, orig->text, orig->len, search, 0, offsets,
+                 99))
+      < 0) {
+    free_ansi_string(orig);
+    return 0;
+  }
+  while (subpatterns >= 0) {
+    safe_str(ANSI_HILITE, rbuff, &rbp);
+    ansi_pcre_copy_substring(orig, offsets, subpatterns, 0, 0, rbuff, &rbp);
+    safe_str(ANSI_END, rbuff, &rbp);
+    *rbp = '\0';
+    if (offsets[0] >= search) {
+      repl = parse_ansi_string(rbuff);
 
-  s = (char *) atr_value(atr);  /* warning: static */
-  while (s && *s) {
-    if ((gh->insensitive && !strncasecmp(gh->lookfor, s, gh->len)) ||
-        (!gh->insensitive && !strncmp(gh->lookfor, s, gh->len))) {
-      found = 1;
-      strncpy(buf, s, gh->len);
-      buf[gh->len] = '\0';
-      s += gh->len;
-      safe_format(tbuf1, &tbp, "%s%s%s", ANSI_HILITE, buf, ANSI_END);
+      /* Do the replacement */
+      ansi_string_replace(orig, offsets[0], offsets[1] - offsets[0], repl);
+
+      /* Advance search */
+      if (search == offsets[1]) {
+        search = offsets[0] + repl->len;
+        search++;
+      } else {
+        search = offsets[0] + repl->len;
+      }
+
+      free_ansi_string(repl);
+      rbp = rbuff;
+      if (search >= orig->len)
+        break;
+      subpatterns =
+        pcre_exec(rgd->re, rgd->study, orig->text, orig->len, search, 0,
+                  offsets, 99);
+    }
+  }
+  safe_ansi_string(orig, 0, orig->len, rbuff, &rbp);
+  *rbp = '\0';
+  free_ansi_string(orig);
+  grep_add_attr(rgd->buff, rgd->bp, player, rgd->count, attr, rbuff);
+  rgd->count++;
+  return 1;
+}
+
+int
+grep_util(dbref player, dbref thing, char *attrs, char *findstr, char *buff,
+          char **bp, int flags)
+{
+  if (!findstr || !*findstr) {
+    if (buff)
+      safe_str(T("#-1 INVALID GREP PATTERN"), buff, bp);
+    else
+      notify(player, T("What pattern do you want to grep for?"));
+    return 0;
+  }
+
+  if (!attrs || !*attrs)
+    attrs = "**";
+
+  if (flags & GREP_REGEXP) {
+    /* regexp grep */
+    struct regrep_data rgd;
+    const char *errptr;
+    int erroffset;
+    int reflags = 0;
+    bool free_study = false;
+
+    if (flags & GREP_NOCASE)
+      reflags |= PCRE_CASELESS;
+
+    if ((rgd.re = pcre_compile(findstr, reflags,
+                               &errptr, &erroffset, tables)) == NULL) {
+      /* Matching error. */
+      if (buff) {
+        safe_str(T("#-1 REGEXP ERROR: "), buff, bp);
+        safe_str(errptr, buff, bp);
+      } else {
+        notify_format(player, T("Invalid regexp: %s"), errptr);
+      }
+      return 0;
+    }
+    add_check("pcre");
+    rgd.study = pcre_study(rgd.re, 0, &errptr);
+    if (errptr != NULL) {
+      if (buff) {
+        safe_str(T("#-1 REGEXP ERROR: "), buff, bp);
+        safe_str(errptr, buff, bp);
+      } else {
+        notify_format(player, T("Invalid regexp: %s"), errptr);
+      }
+      mush_free(rgd.re, "pcre");
+      return 0;
+    }
+    if (rgd.study) {
+      add_check("pcre.extra");
+      free_study = true;
+      set_match_limit(rgd.study);
     } else {
-      safe_chr(*s, tbuf1, &tbp);
-      s++;
+      rgd.study = default_match_limit();
     }
+    rgd.buff = buff;
+    rgd.bp = bp;
+    rgd.count = 0;
+
+    atr_iter_get(player, thing, attrs, 0, 0, regrep_helper, (void *) &rgd);
+    /* Do itttt */
+    if (free_study)
+      mush_free(rgd.study, "pcre.extra");
+
+    return rgd.count;
+  } else {
+    /* Wildcard or plain substring grep */
+    struct grep_data gd;
+    gd.findstr = findstr;
+    gd.findlen = strlen(findstr);
+    gd.buff = buff;
+    gd.bp = bp;
+    gd.count = 0;
+    gd.flags = flags;
+
+    atr_iter_get(player, thing, attrs, 0, 0, grep_helper, (void *) &gd);
+
+    return gd.count;
   }
-  *tbp = '\0';
 
-  /* if we got it, display it */
-  if (found)
-    notify_format(player, "%s%s [#%d%s]:%s %s",
-                  ANSI_HILITE, AL_NAME(atr),
-                  Owner(AL_CREATOR(atr)),
-                  privs_to_letters(attr_privs_view, AL_FLAGS(atr)),
-                  ANSI_END, tbuf1);
-  return found;
 }
 
 /** The grep command
@@ -1395,19 +1506,16 @@
  * \param player the enactor.
  * \param obj string containing obj/attr pattern to grep through.
  * \param lookfor unparsed string to search for.
- * \param flag if 0, return attribute names; if 1, return attrib text.
- * \param insensitive if 1, case-insensitive match; if 0, sensitive.
+ * \param print if 0, show attribute names; if 1, show attrib text.
+ * \param flags type of grep: wild, regexp, nocase
  */
 void
-do_grep(dbref player, char *obj, char *lookfor, int flag, int insensitive)
+do_grep(dbref player, char *obj, char *lookfor, int print, int flags)
 {
-  struct gh_args gh;
   dbref thing;
   char *pattern;
-  int len;
-  char *tp;
 
-  if ((len = strlen(lookfor)) < 1) {
+  if (!lookfor || !*lookfor) {
     notify(player, T("What pattern do you want to grep for?"));
     return;
   }
@@ -1422,21 +1530,19 @@
   if ((thing = noisy_match_result(player, obj, NOTYPE, MAT_EVERYTHING)) ==
       NOTHING)
     return;
-  if (!Can_Examine(player, thing)) {
-    notify(player, T("Permission denied."));
-    return;
-  }
 
-  if (flag) {
-    gh.lookfor = lookfor;
-    gh.len = len;
-    gh.insensitive = insensitive;
-    if (!atr_iter_get(player, thing, pattern, 0, 0, grep_helper, &gh))
-      notify(player, T("No matching attributes."));
+  if (print) {
+    if (!grep_util(player, thing, pattern, lookfor, NULL, NULL, flags))
+      notify(player, T("No matches."));
   } else {
-    tp = grep_util(player, thing, pattern, lookfor, !insensitive, 0);
-    notify_format(player, T("Matches of '%s' on %s(#%d): %s"), lookfor,
-                  Name(thing), thing, tp);
-    mush_free(tp, "grep_util.buff");
+    char buff[BUFFER_LEN];
+    char *bp = buff;
+
+    if (grep_util(player, thing, pattern, lookfor, buff, &bp, flags)) {
+      *bp = '\0';
+      notify_format(player, T("Matches of '%s' on %s(#%d): %s"), lookfor,
+                    Name(thing), thing, buff);
+    } else
+      notify(player, T("No matches."));
   }
 }
Index: src/switchinc.c
===================================================================
--- src/switchinc.c	(.../184p1)	(revision 682)
+++ src/switchinc.c	(.../184p2)	(revision 682)
@@ -20,6 +20,7 @@
   {"CLEAR", SWITCH_CLEAR},
   {"CLONE", SWITCH_CLONE},
   {"CMD", SWITCH_CMD},
+  {"COMBINE", SWITCH_COMBINE},
   {"COMMANDS", SWITCH_COMMANDS},
   {"CONN", SWITCH_CONN},
   {"CONNECT", SWITCH_CONNECT},
@@ -42,6 +43,7 @@
   {"DSTATS", SWITCH_DSTATS},
   {"EMIT", SWITCH_EMIT},
   {"ENABLE", SWITCH_ENABLE},
+  {"ENUM", SWITCH_ENUM},
   {"EQSPLIT", SWITCH_EQSPLIT},
   {"ERR", SWITCH_ERR},
   {"EXITS", SWITCH_EXITS},
@@ -67,7 +69,9 @@
   {"IPRINT", SWITCH_IPRINT},
   {"JOIN", SWITCH_JOIN},
   {"LETTER", SWITCH_LETTER},
+  {"LIMIT", SWITCH_LIMIT},
   {"LIST", SWITCH_LIST},
+  {"LOCAL", SWITCH_LOCAL},
   {"LOCKS", SWITCH_LOCKS},
   {"LOWERCASE", SWITCH_LOWERCASE},
   {"LSARGS", SWITCH_LSARGS},
@@ -80,6 +84,7 @@
   {"MUTE", SWITCH_MUTE},
   {"NAME", SWITCH_NAME},
   {"NO", SWITCH_NO},
+  {"NOCASE", SWITCH_NOCASE},
   {"NOEVAL", SWITCH_NOEVAL},
   {"NOFLAGCOPY", SWITCH_NOFLAGCOPY},
   {"NOISY", SWITCH_NOISY},
@@ -142,6 +147,7 @@
   {"TRACE", SWITCH_TRACE},
   {"TYPE", SWITCH_TYPE},
   {"UNCLEAR", SWITCH_UNCLEAR},
+  {"UNCOMBINE", SWITCH_UNCOMBINE},
   {"UNFOLDER", SWITCH_UNFOLDER},
   {"UNGAG", SWITCH_UNGAG},
   {"UNHIDE", SWITCH_UNHIDE},
@@ -153,6 +159,7 @@
   {"USEFLAG", SWITCH_USEFLAG},
   {"WHAT", SWITCH_WHAT},
   {"WHO", SWITCH_WHO},
+  {"WILD", SWITCH_WILD},
   {"WIPE", SWITCH_WIPE},
   {"WIZ", SWITCH_WIZ},
   {"WIZARD", SWITCH_WIZARD},
Index: src/set.c
===================================================================
--- src/set.c	(.../184p1)	(revision 682)
+++ src/set.c	(.../184p2)	(revision 682)
@@ -70,80 +70,75 @@
   int i;
   char *newname;
 
-  if ((thing = match_controlled(player, name)) != NOTHING) {
-    newname = mush_strdup(trim_space_sep(newname_, ' '), "name.newname");
-    bon = newname;
+  if ((thing = match_controlled(player, name)) == NOTHING)
+    return;
 
-    /* check for bad name */
-    if ((*newname == '\0') || strchr(newname, '[')) {
-      notify(player, T("Give it what new name?"));
+  newname = mush_strdup(trim_space_sep(newname_, ' '), "name.newname");
+  bon = newname;
+
+  /* check for bad name */
+  if ((*newname == '\0') || strchr(newname, '[')) {
+    notify(player, T("Give it what new name?"));
+    mush_free(newname, "name.newname");
+    return;
+  }
+  /* check for renaming a player */
+  if (IsPlayer(thing)) {
+    // If it has "s, it's surrounding a spaced name, likely. So bon
+    // is beginning of name.
+    // I'm going to cheat here and make it so
+    // @name me="foo"bar names somebody foo, since " is an invalid name.
+    if (*bon == '"') {
+      bon++;
+      eon = bon;
+      while (*eon && *eon != '"') {
+        eon++;
+      }
+      if (*eon) {
+        *eon = '\0';
+      }
+    }
+    if (!ok_player_name(bon, player, thing)) {
+      notify(player, T("You can't give a player that name."));
       mush_free(newname, "name.newname");
       return;
     }
-    /* check for renaming a player */
-    if (IsPlayer(thing)) {
-      // If it has "s, it's surrounding a spaced name, likely. So bon
-      // is beginning of name.
-      // I'm going to cheat here and make it so
-      // @name me="foo"bar names somebody foo, since " is an invalid name.
-      if (*bon == '"') {
-        bon++;
-        eon = bon;
-        while (*eon && *eon != '"') {
-          eon++;
-        }
-        if (*eon) {
-          *eon = '\0';
-        }
-      } else {
-        eon = bon;
-        while (*eon && !isspace((unsigned char) *eon))
-          eon++;
-        if (*eon)
-          *eon = '\0';
-      }
-      if (!ok_player_name(bon, player, thing)) {
-        notify(player, T("You can't give a player that name."));
-        mush_free(newname, "name.newname");
-        return;
-      }
-      /* everything ok, notify */
-      do_log(LT_CONN, 0, 0, "Name change by %s(#%d) to %s",
-             Name(thing), thing, bon);
-      if (Suspect(thing))
-        flag_broadcast("WIZARD", 0,
-                       T("Broadcast: Suspect %s changed name to %s."),
-                       Name(thing), bon);
-      /* everything ok, we can fall through to change the name */
-    } else {
-      bon = newname;
-      if (!ok_name(newname)) {
-        notify(player, T("That is not a reasonable name."));
-        mush_free(newname, "name.newname");
-        return;
-      }
+    /* everything ok, notify */
+    do_log(LT_CONN, 0, 0, "Name change by %s(#%d) to %s",
+           Name(thing), thing, bon);
+    if (Suspect(thing))
+      flag_broadcast("WIZARD", 0,
+                     T("Broadcast: Suspect %s changed name to %s."),
+                     Name(thing), bon);
+    /* everything ok, we can fall through to change the name */
+  } else {
+    bon = newname;
+    if (!ok_name(newname)) {
+      notify(player, T("That is not a reasonable name."));
+      mush_free(newname, "name.newname");
+      return;
     }
+  }
 
-    /* everything ok, change the name */
-    myenv[0] = (char *) mush_malloc(BUFFER_LEN, "string");
-    myenv[1] = (char *) mush_malloc(BUFFER_LEN, "string");
-    mush_strncpy(myenv[0], Name(thing), BUFFER_LEN);
-    strcpy(myenv[1], bon);
-    for (i = 2; i < 10; i++)
-      myenv[i] = NULL;
+  /* everything ok, change the name */
+  myenv[0] = (char *) mush_malloc(BUFFER_LEN, "string");
+  myenv[1] = (char *) mush_malloc(BUFFER_LEN, "string");
+  mush_strncpy(myenv[0], Name(thing), BUFFER_LEN);
+  strcpy(myenv[1], bon);
+  for (i = 2; i < 10; i++)
+    myenv[i] = NULL;
 
-    if (IsPlayer(thing))
-      reset_player_list(thing, Name(thing), NULL, bon, NULL);
-    set_name(thing, bon);
+  if (IsPlayer(thing))
+    reset_player_list(thing, Name(thing), NULL, bon, NULL);
+  set_name(thing, bon);
 
-    if (!AreQuiet(player, thing))
-      notify(player, T("Name set."));
-    real_did_it(player, thing, NULL, NULL, "ONAME", NULL, "ANAME", NOTHING,
-                myenv, NA_INTER_PRESENCE);
-    mush_free(newname, "name.newname");
-    mush_free(myenv[0], "string");
-    mush_free(myenv[1], "string");
-  }
+  if (!AreQuiet(player, thing))
+    notify(player, T("Name set."));
+  real_did_it(player, thing, NULL, NULL, "ONAME", NULL, "ANAME", NOTHING,
+              myenv, NA_INTER_PRESENCE);
+  mush_free(newname, "name.newname");
+  mush_free(myenv[0], "string");
+  mush_free(myenv[1], "string");
 }
 
 /** Change an object's owner.
@@ -519,6 +514,10 @@
                   AL_NAME(atr));
     return;
   }
+  if (AL_FLAGS(atr) & AF_ROOT)
+    flags |= AF_ROOT;
+  else
+    flags &= ~AF_ROOT;
   AL_FLAGS(atr) = flags;
 }
 
@@ -1141,7 +1140,7 @@
    */
   int saved_count = AttrCount(thing);
 
-  if (wildcard(pattern) && AF_Wizard(atr) && !God(player))
+  if (wildcard((char *) pattern) && AF_Wizard(atr) && !God(player))
     return 0;
 
   switch (wipe_atr(thing, AL_NAME(atr), player)) {
Index: src/cque.c
===================================================================
--- src/cque.c	(.../184p1)	(revision 682)
+++ src/cque.c	(.../184p2)	(revision 682)
@@ -63,6 +63,7 @@
   char *rval[NUMQ];             /**< environment, from setq() */
   char *comm;                   /**< command to be executed */
   uint32_t pid;                 /**< Process id of this entry */
+  PE_Info *pe_info;             /**< pe_info for evaluating queue, or NULL */
 } BQUE;
 
 intmap *queue_map = NULL; /**< Intmap for looking up queue entries by pid */
@@ -87,6 +88,7 @@
 static void show_queue(dbref player, dbref victim, int q_type,
                        int q_quiet, int q_all, BQUE *q_ptr, int *tot, int *self,
                        int *del);
+static void show_queue_single(dbref player, BQUE *q, int q_type);
 static void do_raw_restart(dbref victim);
 static int waitable_attr(dbref thing, const char *atr);
 static void shutdown_a_queue(BQUE **head, BQUE **tail);
@@ -204,6 +206,8 @@
     mush_free(point->semattr, "cqueue.semattr");
   if (point->comm)
     mush_free(point->comm, "cqueue.comm");
+  if (point->pe_info)
+    free_pe_info(point->pe_info);
   im_delete(queue_map, point->pid);
   mush_free(point, "cqueue");
 }
@@ -288,21 +292,28 @@
  * \param player the enactor for the queued command.
  * \param command the command to enqueue.
  * \param cause the player or object causing the command to be queued.
+ * \param pe_info the pe_info to use for evaluating the queue, or NULL
  */
 void
-parse_que(dbref player, const char *command, dbref cause)
+parse_que(dbref player, const char *command, dbref cause, PE_Info *pe_info)
 {
   int a;
   BQUE *tmp;
   int pid;
-  if (!IsPlayer(player) && (Halted(player)))
+  if (!IsPlayer(player) && (Halted(player))) {
+    free_pe_info(pe_info);
     return;
-  if (!pay_queue(player, command))      /* make sure player can afford to do it */
+  }
+  if (!pay_queue(player, command)) {
+    /* make sure player can afford to do it */
+    free_pe_info(pe_info);
     return;
+  }
   pid = next_pid();
   if (pid == 0) {
     /* Too many queue entries */
     notify(player, T("Queue entry table full. Try again later."));
+    free_pe_info(pe_info);
     return;
   }
   tmp = mush_malloc(sizeof *tmp, "cqueue");
@@ -314,6 +325,7 @@
   tmp->next = NULL;
   tmp->left = 0;
   tmp->cause = cause;
+  tmp->pe_info = pe_info;
   for (a = 0; a < 10; a++)
     if (!global_eval_context.wnxt[a])
       tmp->env[a] = NULL;
@@ -427,7 +439,7 @@
       /* Skip the ':' */
       command++;
   }
-  parse_que(executor, command, enactor);
+  parse_que(executor, command, enactor, NULL);
   free(start);
   return 1;
 }
@@ -456,7 +468,7 @@
   if (waittill == 0) {
     if (sem != NOTHING)
       add_to_sem(sem, -1, semattr);
-    parse_que(player, command, cause);
+    parse_que(player, command, cause, NULL);
     return;
   }
   if (!pay_queue(player, command))      /* make sure player can afford to do it */
@@ -474,6 +486,7 @@
   tmp->cause = cause;
   tmp->semattr = NULL;
   tmp->next = NULL;
+  tmp->pe_info = NULL;
   for (a = 0; a < 10; a++) {
     if (!global_eval_context.wnxt[a])
       tmp->env[a] = NULL;
@@ -633,6 +646,34 @@
   return i;
 }
 
+void
+run_user_input(dbref player, char *input)
+{
+  BQUE *entry;
+  int i;
+
+  entry = mush_malloc(sizeof *entry, "cqueue");
+  entry->comm = mush_strdup(input, "cqueue.comm");
+  entry->pid = 0;
+  entry->player = player;
+  entry->queued = player;
+  entry->cause = player;
+  entry->sem = NOTHING;
+  entry->semattr = NULL;
+  entry->next = NULL;
+  entry->pe_info = NULL;
+  entry->left = 0;
+
+  for (i = 0; i < 10; i++)
+    entry->env[i] = NULL;
+  for (i = 0; i < NUMQ; i++)
+    entry->rval[i] = NULL;
+
+  do_entry(entry, -1);
+  free_qentry(entry);
+
+}
+
 static int
 do_entry(BQUE *entry, int include_recurses)
 {
@@ -643,9 +684,16 @@
   int local_break_called = 0;
   char *r;
   char const *s;
+  int pt_flag = PT_SEMI;
+
+  if (include_recurses == -1) {
+    include_recurses = 0;
+    pt_flag = PT_NOTHING;
+  }
+
   if (GoodObject(entry->player) && !IsGarbage(entry->player)) {
     save_player = global_eval_context.cplr = entry->player;
-    if (!global_eval_context.include_called) {
+    if (!global_eval_context.include_called && pt_flag != PT_NOTHING) {
       giveto(global_eval_context.cplr, QUEUE_COST);
       add_to(entry->queued, -1);
     }
@@ -660,7 +708,8 @@
         else
           global_eval_context.renv[a][0] = '\0';
       }
-      global_eval_context.process_command_port = 0;
+      if (pt_flag != PT_NOTHING)
+        global_eval_context.process_command_port = 0;
       s = entry->comm;
       global_eval_context.break_called = 0;
       local_break_called = 0;
@@ -668,20 +717,27 @@
       *(global_eval_context.break_replace) = '\0';
       if (!include_recurses) {
         start_cpu_timer();
-        global_eval_context.pe_info = make_pe_info();
+        if (entry->pe_info) {
+          global_eval_context.pe_info = entry->pe_info;
+        } else {
+          global_eval_context.pe_info = make_pe_info();
+        }
       }
       while (!cpu_time_limit_hit && *s) {
         r = global_eval_context.ccom;
         process_expression(global_eval_context.ccom, &r, &s,
                            global_eval_context.cplr, entry->cause,
-                           entry->cause, PE_NOTHING, PT_SEMI,
+                           entry->cause, PE_NOTHING, pt_flag,
                            global_eval_context.pe_info);
         *r = '\0';
         if (*s == ';')
           s++;
         strcpy(tbuf, global_eval_context.ccom);
-        process_command(global_eval_context.cplr, tbuf, entry->cause, 0);
+        process_command(global_eval_context.cplr, tbuf, entry->cause,
+                        (pt_flag == PT_NOTHING));
         if (global_eval_context.break_called) {
+          /* Make sure we process semicolons in @break arg, even from socket */
+          pt_flag = PT_SEMI;
           global_eval_context.break_called = 0;
           local_break_called = 1;
           s = global_eval_context.break_replace;
@@ -711,6 +767,7 @@
           tmp->next = NULL;
           tmp->left = 0;
           tmp->cause = entry->cause;
+          tmp->pe_info = NULL;
           for (a = 0; a < 10; a++) {
             if (global_eval_context.include_called == 1) {
               tmp->env[a] =
@@ -752,7 +809,9 @@
       }
       if (!include_recurses) {
         reset_cpu_timer();
-        free_pe_info(global_eval_context.pe_info);
+        if (!entry->pe_info) {
+          free_pe_info(global_eval_context.pe_info);
+        }
         global_eval_context.pe_info = NULL;
       }
     }
@@ -1320,7 +1379,8 @@
 
   if (qmask & 1) {
     for (tmp = qwait; tmp; tmp = tmp->next) {
-      if (GoodObject(player) && (!Owns(tmp->player, player)))
+      if (GoodObject(player) && GoodObject(tmp->player)
+          && (!Owns(tmp->player, player)))
         continue;
       if (!first)
         safe_chr(' ', buff, bp);
@@ -1330,7 +1390,8 @@
   }
   if (qmask & 2) {
     for (tmp = qsemfirst; tmp; tmp = tmp->next) {
-      if (GoodObject(player) && (!Owns(tmp->player, player)))
+      if (GoodObject(player) && GoodObject(tmp->player)
+          && (!Owns(tmp->player, player)))
         continue;
       if (GoodObject(thing) && (tmp->sem != thing))
         continue;
@@ -1357,36 +1418,42 @@
       if ((LookQueue(player)
            || Owns(tmp->player, player))) {
         (*self)++;
-        if (q_quiet)
-          continue;
-        switch (q_type) {
-        case 1:                /* wait queue */
-          notify_format(player, "(Pid: %u) [%ld]%s: %s",
-                        (unsigned int) tmp->pid, (long) difftime(tmp->left,
-                                                                 mudtime),
-                        unparse_object(player, tmp->player), tmp->comm);
-          break;
-        case 2:                /* semaphore queue */
-          if (tmp->left != 0) {
-            notify_format(player, "(Pid: %u) [#%d/%s/%ld]%s: %s",
-                          (unsigned int) tmp->pid, tmp->sem, tmp->semattr,
-                          (long) difftime(tmp->left, mudtime),
-                          unparse_object(player, tmp->player), tmp->comm);
-          } else {
-            notify_format(player, "(Pid: %u) [#%d/%s]%s: %s",
-                          (unsigned int) tmp->pid, tmp->sem, tmp->semattr,
-                          unparse_object(player, tmp->player), tmp->comm);
-          }
-          break;
-        default:               /* player or object queue */
-          notify_format(player, "(Pid: %u) %s: %s", (unsigned int) tmp->pid,
-                        unparse_object(player, tmp->player), tmp->comm);
-        }
+        if (!q_quiet)
+          show_queue_single(player, tmp, q_type);
       }
     }
   }
 }
 
+/* Show a single queue entry */
+static void
+show_queue_single(dbref player, BQUE *q, int q_type)
+{
+  switch (q_type) {
+  case 1:                      /* wait queue */
+    notify_format(player, "(Pid: %u) [%ld]%s: %s",
+                  (unsigned int) q->pid, (long) difftime(q->left,
+                                                         mudtime),
+                  unparse_object(player, q->player), q->comm);
+    break;
+  case 2:                      /* semaphore queue */
+    if (q->left != 0) {
+      notify_format(player, "(Pid: %u) [#%d/%s/%ld]%s: %s",
+                    (unsigned int) q->pid, q->sem, q->semattr,
+                    (long) difftime(q->left, mudtime),
+                    unparse_object(player, q->player), q->comm);
+    } else {
+      notify_format(player, "(Pid: %u) [#%d/%s]%s: %s",
+                    (unsigned int) q->pid, q->sem, q->semattr,
+                    unparse_object(player, q->player), q->comm);
+    }
+    break;
+  default:                     /* player or object queue */
+    notify_format(player, "(Pid: %u) %s: %s", (unsigned int) q->pid,
+                  unparse_object(player, q->player), q->comm);
+  }
+}
+
 /** Display a player's queued commands.
  * \verbatim
  * This is the top-level function for @ps.
@@ -1457,6 +1524,45 @@
   }
 }
 
+/** Display info for a single queue entry.
+ * \verbatim
+ * This is the top-level function for @ps <pid>.
+ * \endverbatim
+ * \param player the enactor.
+ * \param pidstr the pid for the queue entry to show
+ */
+void
+do_queue_single(dbref player, char *pidstr)
+{
+  uint32_t pid;
+  BQUE *q;
+
+  if (!is_uinteger(pidstr)) {
+    notify(player, T("That is not a valid pid!"));
+    return;
+  }
+
+  pid = parse_uint32(pidstr, NULL, 10);
+  q = im_find(queue_map, pid);
+  if (!q) {
+    notify(player, T("That is not a valid pid!"));
+    return;
+  }
+
+  if (!LookQueue(player) && Owner(player) != Owner(q->player)) {
+    notify(player, T("Permission denied."));
+    return;
+  }
+
+  if (GoodObject(q->sem))
+    show_queue_single(player, q, 2);
+  else if (q->left > 0)
+    show_queue_single(player, q, 1);
+  else
+    show_queue_single(player, q, 0);
+
+}
+
 /** Halt an object, internal use.
  * This function is used to halt objects by other hardcode.
  * See do_halt1() for the softcode interface.
@@ -1533,7 +1639,7 @@
       global_eval_context.wnxt[j] = global_eval_context.wenv[j];
     for (j = 0; j < NUMQ; j++)
       global_eval_context.rnxt[j] = global_eval_context.renv[j];
-    parse_que(player, ncom, player);
+    parse_que(player, ncom, player, NULL);
   }
 }
 
Index: game/txt/hlp/pennchat.hlp
===================================================================
--- game/txt/hlp/pennchat.hlp	(.../184p1)	(revision 682)
+++ game/txt/hlp/pennchat.hlp	(.../184p2)	(revision 682)
@@ -1,38 +1,43 @@
 & CHAT
+& CHAT SYSTEM
 & comsys
   CHAT SYSTEM
 
-  The MUSH has a built-in chat system with many different channels.
-  These channels vary from MUSH to MUSH; ask at your local site or use
-  @channel/list to see which ones are available.
+  PennMUSH has a built-in chat system which allows you to speak to other
+  players who are on the same channel without needing to be in the same room
+  as them. It supports a large number of channels which can be customized and
+  restricted in various ways.
 
-  You can talk to many people on the MUSH via the chat system, without
-  needing to be in the same room as them. Use the "@channel" command
-  to join, leave, or check who is on a channel, and use the "@chat" or
-  "+" command to communicate.
+  Many of the chat system commands take a <channel> argument; you don't need
+  to enter the entire channel name, only as many letters as needed to make it
+  distinct from other channels.
 
-  If you examine yourself, you will see a list of channels that you
-  are currently listening to. Some channels are restricted to wizards
-  or administrators only. See the following help topics for details:
-  @chat, @channel, @cemit, @clock, cwho()
+  You can list, join, and configure channels using the @channel command.
 
-& +
+  To speak on channels, use the @chat command.
+
+See also: @channel, @chat, @cemit, channel functions, CHAN_USEFIRSTMATCH,
+  @chatformat, @clock
 & @chat
+& +
   @chat <channel>=<message>
   +<channel> <message>
 
-  This tells everyone on <channel> your <message>. You can prepend
-  <message> with ':' or ';' to pose instead of talk. This command can
-  also be formatted: +<channel> <message> You do not need to type the
-  complete name of the channel, only as many letters as needed to make
-  it distinct from another channel that you're also on.
+  The @chat command is used to speak on channels. Everyone on the channel
+  will see your message, and it will be added to the channel's recall
+  buffer, if it has one. If <message> begins with a ':' or ';' it will be
+  posed (or semiposed) instead of spoken. You will usually need to join a
+  channel before you can speak on it.
 
-  Note: if you use the '+' form of this command, and you do not use
-  the name of a known channel, your command will be processed as
-  normal, preventing user-defined commands like "+last" from being
-  clobbered by the chat system.
+  +<channel> <message> is short-hand for the @chat command.
 
-See also: chat, CHAN_USEFIRSTMATCH
+  Example:
+  > @chat pub=Hello
+  <Public> Mike says, "Hello"
+  > +pub :waves
+  <Public> Mike waves
+
+See also: @channel, @cemit
 & @CHATFORMAT
   @chatformat <object>[=<message>]
 
@@ -49,7 +54,7 @@
            '@' for a "system" message - such as "Walker has connected."
     %1:  The channel name. e.g: "Public", "Admin", "Softcode"
     %2:  The message as typed (post-evaluation, if necessary) by the
-         speaker.  Be warned, though - If type is '@', then %2 will
+         speaker. Be warned, though - if type is '@', then %2 will
          contain the entire message, and will include the name of
          the speaker that caused it.
     %3:  The speaker name, unless channel is set NO_NAME.
@@ -61,7 +66,7 @@
     the channel is also set NO_TITLE, then %3 will be "Someone".
 
   Continued in 'help @chatformat2'.
-See also: @chat, @pageformat, @message, speak()
+See also: @chat, @pageformat, @message, speak(), mogrify
 & @CHATFORMAT2
   Examples:
 
@@ -98,205 +103,229 @@
 
     @chatformat me=CHAT:%1:[edit(switch(%0,@,%2,speak(if(%4,%4%b)%3,%0%2)),
            &,&amp;,<,&lt;,>,&gt;,%r,<BR>,%b%b,%b&nbsp;)]
-
-See also: @chat, @pageformat, speak()
 & CHAN_USEFIRSTMATCH
   Flag:  CHAN_USEFIRSTMATCH  (any type)
 
-  When this flag is set on an object that uses the chat system,
-  channel name matching will default to the first matching channel in
-  cases of ambiguity. Without this flag, attempting to use an
-  ambiguous partial channel name will produce an error.
+  When this flag is set on an object that uses the chat system, channel name
+  matching will default to the first matching channel in cases of ambiguity.
+  Without this flag, attempting to use an ambiguous partial channel name
+  will produce an error.
 
 See also: CHAT
-& @cemit
-& @nscemit
-  @cemit[/noisy|/silent][/noeval] <channel>=<message>
-  @nscemit[/noisy|/silent][/noeval] <channel>=<message>
+& @CEMIT
+& @NSCEMIT
+& CEMIT()
+& NSCEMIT()
+  @cemit[/nosiy|/silent][/noeval] <channel>=<message>
+  @nscemit[/nosiy|/silent][/noeval] <channel>=<message>
+  cemit(<channel>, <message>[, <noisy>])
+  nscemit(<channel>, <message>[, <noisy>])
 
-  This command allows <message> to be directly broadcasted to the players 
-  on <channel>. A channel prefix is included if the /noisy switch is given,
-  and omitted if /silent is given - the default is controlled by the 
-  noisy_cemit @config option. If the /noeval switch is given, the <message>
-  is not evaluated. This command is intended for use in writing extended 
-  chat systems.
+  @cemit emits <message> on <channel>. It does not include your name. The
+  channel prefix is included if the /noisy switch is given, and omitted if
+  /silent is given - if neither is given, the default behaviour is controlled
+  by the noisy_cemit @config option. The /noeval switch prevents <message> 
+  from being evaluated.
 
-  @nscemit is a wizard-only version that does not include nospoof
-  information in broadcasts.
+  @nscemit is exactly the same, but does not produce nospoof information when
+  used by players with the Can_nspemit @power.
 
-See also: CHAT, cemit(), @chat
+  cemit() and nscemit() work the same as @cemit/silent and @nscemit/silent,
+  respectively. If <noisy> is given as a true value, they work like
+  @cemit/noisy and @nscemit/noisy, respectively, instead.
+
+  @cemit is intended for use in writing extended chat systems. 
+
+See also: @chat
 & @channel
+
+  The @channel command is used to add, join, list and modify channels in the
+  chat system. It takes many different switches.
+
+  Help for @channel system is split into a number of topics. Please see 'help 
+  @channel <topic>' for more, where <topic> is one of the words below. You
+  can also use 'help @channel/<switch>' for help on a particular switch.
+
+  Joining    - How to find, join, and leave channels
+  Other      - Setting channel titles, recalling previous chat messages
+  Admin      - Adding, deleting and modifying channels
+
+See also: CHAT, @chat, @cemit
+& @CHANNEL JOINING
 & @channel/list
 & @channel/what
+& @channel/who
 & @channel/on
+& @channel/join
 & @channel/off
-  @channel/list [<channel-prefix>]
-  @channel/what [<channel-prefix>]
+& @channel/unjoin
+  @channel/list [<prefix>]
+  @channel/what [<prefix>]
+  @channel/who <channel>
   @channel/on <channel>[=<player>]
   @channel/off <channel>[=<player>]
 
-  The basic form of this command allows you to see the available
-  channels, and join or leave a channel. You do not need to type the
-  complete name of the channel, only as many letters as needed to make
-  it distinct from other channels.
+  @channel/list shows a list of all the channels you can see, along with some
+  basic information such as whether you are on the channel, how it's locked,
+  etc. 'help @channel list' explains the output in detail. If a <prefix> is
+  given, only channels whose names begin with <prefix> are shown.
 
-  Wizards may add and remove other players from channels by providing
-  a player name as a second argument.
+  @channel/what shows the name, description, owner, priv flags and buffer
+  size for all channels, or all channels whose names begin with <prefix> if
+  one is given.
 
-  Channels may be restricted in who can join them and/or speak on
-  them. @channel/list will show you the channel's name, number of
-  users, number of message since last restart, access information, and
-  your status. See "help channel-list" for an explanation of how to
-  read the listing.
+  @channel/who lists all the players on the given channel.
 
-  @channel/what will show you the channel's name, access information,
-  and a description of the channel's purpose.
+  @channel/on and @channel/off add or remove you from the given <channel>.
+  You only hear messages for channels you're on, and most channels require you
+  to join them before you can speak on them. /join and /unjoin are aliases for
+  /on and /off.
 
-  More commands are provided in "help @channel2".
-  
-See also: chat
-& @channel2
-& @channel/who
+  Continued in 'help @channel joining2'.
+& @CHANNEL JOINING2
+& @channel/gag
+& @channel/ungag
 & @channel/hide
-& @channel/title
-  @channel/who <channel>
-  @channel/hide <channel>=<yes|no>
-  @channel/title <channel>[=<string>]
+& @channel/unhide
+& @channel/mute
+& @channel/combine
+& @channel/uncombine
+  @channel/gag [<channel>][=<yes|no>]
+  @channel/mute [<channel>][=<yes|no>]
+  @channel/hide [<channel>][=<yes|no>]
+  @channel/combine [<channel>][=<yes|no>]
 
-  The @channel/who command shows you who is currently on a channel, if
-  you are permitted to see it.
+  @channel/gag allows you to stay on a channel but stop receiving messages on
+  it. Channels are automatically ungagged when you disconnect. You cannot
+  speak on channels you're gagging unless they have the "open" priv.
 
-  Some channels allow their users to hide from the @channel/who list.
-  If you're on such a channel and are permitted to hide, you can use
-  @channel/hide <channel>=yes to hide yourself, and @channel/hide
-  <channel>=no to reappear.
+  Channels without the 'quiet' priv broadcast messages when players connect or
+  disconnect from the MUSH. You can use @channel/mute to suppress these
+  messages if you don't want to see them.
 
-  @channel/title lets you set a title to appear before your name when
-  you speak on the channel, or check your current title. If you leave
-  the channel, your title is cleared; use @channel/gag instead (see
-  help @channel3). You should escape any commas in your title with
-  backslashes.
+  On channels with the 'hide_ok' priv, @channel/hide lets you hide from the
+  @channel/who list if you pass the channel's @clock/hide.
 
-  See "help @channel3" for more.
-& @channel3
-& @channel/mute
-& @channel/gag
-& @channel/recall
-  @channel/mute <channel>=<yes|no>
-  @channel/gag <channel>=<yes|no>
-  @channel/recall <channel>[=<lines|duration>[, <start line>]]
+  Connect and disconnect messages across all channels you have marked with
+  @channel/combine will be combined into a single message with a |-separated
+  list of all channel names. Only players can use this.
 
-  Some channels broadcast messages when players connect or disconnect
-  from the MUSH. If you don't want to hear those messages, use
-  @channel/mute <channel>=yes. To resume hearing the messages, use
-  @channel/mute <channel>=no or @channel/unmute <channel>. Leave out
-  <channel> to mute or unmute all channels.
+  For all four of these commands, you can specify a single channel to affect,
+  or omit <channel> to affect all channels you're on. To undo the
+  gag/mute/hide, either use @channel/<switch> [<channel>]=no or
+  @channel/un<switch> [<channel>].
+  
+See also: @channel/who, cstatus(), cowner(), cflags(), channels(),
+  @channel/privs
+& @CHANNEL OTHER
+& @channel/title
+& @channel/recall
+  @channel/title <channel>[=<message>]
+  @channel/recall[/quiet] <channel>[=<lines|duration>[, <start line>]]
 
-  If you want to remain on a channel but not receive any messages on
-  the channel, use @channel/gag <channel>=yes. To resume hearing, use
-  @channel/gag <channel>=no (or @channel/ungag <channel>). When you
-  disconnect, the channel will be automatically ungagged for you.
-  Leave out <channel> to gag or ungag all channels.  If the channel
-  does not have the "open" priv, you can not speak on it while you are
-  gagged.
+  @channel/title lets you set a channel title, which is shown before your name
+  whenever you speak on a channel. If =<message> is omitted, your current
+  title on the channel is shown. Use an empty <message> to clear your title.
 
-  @channel/recall shows you the most recent messages on the channel;
-  the number of messages depends on how the channel is configured, but
-  can be limited by specifying <lines> to show and a <start line> to
-  start display from.  If <lines> is an elapsed time, like '1h',
-  messages from within the given interval will be recalled.  You must
-  be on a channel or able to join it to recall from it.
+  @channel/recall shows you the most recent messages on the channel, if it has
+  been given a recall buffer with @channel/buffer. With no extra arguments,
+  the 10 most recent lines are shown. You can specify either a number of
+  <lines> to show, or a <duration> (such as '1h30m') to show only that many
+  lines/messages that recent. If <start line> is given, lines before the
+  <start line>th will not be shown. Timestamps are shown with the messages
+  unless /quiet is given.
 
-  See "help @channel4" for more.
-& @channel4
+See also: crecall(), cbufferadd(), @channel/buffer
+& @CHANNEL ADMIN
 & @channel/add
-& @channel/delete
-& @channel/desc
-& @channel/rename
-  @channel/add <channel>[=<priv>]
-  @channel/delete <channel>
-  @channel/desc <channel>=<desc>
-  @channel/rename <channel>=<new name>
+& @channel/privs
+& @channel/describe
+& @channel/buffer
+& @channel/decompile
+  @channel/add <channel>[=<privs>]
+  @channel/privs <channel>=<privs>
+  @channel/describe <channel>=<description>
+  @channel/buffer <channel>=<lines>
+  @channel/decompile[/brief] <prefix>
 
-  @channel/add creates a new channel. On some MUSHes, any player
-  can create a new channel, though there will be a cost associated
-  with creation (see @config chat). Possible <priv> specifications:
-  * "player" - players may use the channel
-  * "thing" - things may use the channel
-  * "admin" - only royalty/wizards/chat_privs may use the channel
-  * "wizard" - only wizards may use the channel
-  * "quiet" - channel will not show connection messages
-  * "open" - you may speak even if you aren't listening to the channel
-  * "hide_ok" - you may hide from the channel who list.
-  * "notitles" - chantitles are not displayed in channel messages.
-  * "nonames" - player names are not displayed in channel messages.
-  * "nocemit" - @cemit is prohibited on the channel.
-  * "interact" - Interaction rules (defined in local.c) are applied to 
-    the channel
-  Specifications may be combined, space-separated. Default is determined
-  by the 'channel_flags' @config option, or 'player' if not set.
+  @channel/add creates a new channel named <channel>, with the given <privs>.
+  If you don't specify the <privs>, the defaults set in the channel_flags
+  @config option are used. There may be a limit on the number of channels
+  mortals can create, and a charge for doing so; see '@config chat'.
 
-  @channel/delete removes a channel. You must own it or be Wizard.
-  @channel/desc sets the channel's description, shown on @channel/what.
-    Descriptions are limited to 256 characters. If there are any commas
-    in the description, the whole string should be enclosed in {}'s.
-  @channel/rename is used to rename a channel.
+  @channel/privs changes the privs for <channel>. See 'help @channel privs'
+  for an explaination of all the possible priviledges.
 
-  See "help @channel5" for more. See also "help @clock".
-& @channel5
-& @channel/priv
-& @channel/wipe
-& @channel/buffer
+  @channel/describe sets a description for the channel, which is shown to
+  players in @channel/what. Limited to 256 characters. If the desc includes
+  commas, the whole desc should be enclosed in {}s.
+
+  @channel/buffer sets the maximum number of full-length lines that the
+  channel will buffer for @channel/recall. Many more shorter lines may
+  actually be buffered. Setting it to 0 turns off buffering.
+
+  @channel/decompile produces a decompile of all channels whose name begin
+  with <prefix>, showing the commands needed to recreate the channels. If
+  the /brief switch is also given, commands to re-add members of the channel
+  are omitted.
+
+  Continued in 'help @channel admin2'.
+& @CHANNEL ADMIN2
 & @channel/chown
-  @channel/priv <channel>=<new priv level>
-  @channel/wipe <channel>
-  @channel/buffer <channel>=<lines>
-  @channel/decompile[/brief] <channel>
+& @channel/name
+& @channel/rename
+& @channel/wipe
+& @channel/delete
   @channel/chown <channel>=<new owner>
+  @channel/rename <channel>=<new name>
+  @channel/wipe <channel>
+  @channel/delete <channel>
 
-  The "priv" switch sets the channel's access privileges to those specified.
-  The "wipe" switch clears a channel of players without deleting it.
-  The "buffer" switch sets the maximum number of full-length lines that
-  the channel will buffer for @chan/recall. Many more shorter lines may
-  actually be buffered. Setting it to 0 turns off buffering.
+  @channel/chown changes the owner of <channel>. It can only be used by
+  Wizards.
 
-  The "decompile" and "chown" switches can only be used by Wizards.
-  @channel/decompile produces a decompile of matching channels. If the
-  /brief switch is included, players on the channel aren't listed.
-  @channel/chown allows a Wizard to change the owner of a channel.
+  @channel/rename changes the name of <channel>.
 
-  See "help @channel6" for more.
-& @channel6
+  @channel/wipe removes all players from <channel>.
+
+  @channel/delete completely removes <channel>. It can only be used by
+  Wizards or the owner of <channel>.
+
+  Continued in 'help @channel admin3'.
+See also: @clock
+& @CHANNEL ADMIN3
 & @channel/mogrifier
-& mogrifier
+& chat mogrifying
+& @chat mogrifying
 & mogrify
+& mogrifier
   @channel/mogrifier <channel>=<object>
 
-  The Mogrifier lets you tweak every aspect of a channel's output, before
-  it goes to individual players' @chatformats.
+  @channel/mogrifier sets the mogrifier object for <channel>. <object> must
+  be an object that you control.
 
-  <object> must be an object that you control, and it can have any or all
-  of these attributes which are evaluated when channel messages are generated.
+  Mogrifiers let you tweak every aspect of a channel's output, before it
+  goes to individual players' @chatformats. 
 
-  Before it begins Mogrifying, its MOGRIFY`BLOCK is called, using the same
-  arguments as @chatformat. If MOGRIFY`BLOCK returns a non-empty string, then
-  the resultant string is sent to the player, and the message is not
-  broadcasted.
+  Before it begins mogrifying, <object>'s MOGRIFY`BLOCK attribute is called,
+  with the same arguments as @chatformat. If MOGRIFY`BLOCK returns a
+  non-empty string, then the resultant string is sent back to the player,
+  and no message is broadcast on the channel.
 
-  A number of separate mogrifiers can be used. Check 'help @chat mogrifying'
-  for details.
+  Several different mogrifiers can be used. See 'help mogrify2' for details.
 
-  After all of these are called, MOGRIFY`FORMAT is called. It has the exact
-  same use as @chatformat, but is on a channel-wide level. It receives all
+  After all these mogrifiers are called, MOGRIFY`FORMAT is evaluated. It has
+  the same use as @chatformat, but on a channel-wide level. It receives all
   mogrified text (if any), so is generally intended only for reformatting the
-  whole channel text. It is also overridden by individual @chatformats.
+  whole channel text. It is also overriden by individual @chatformats.
 
-  See 'help @chat mogrifying' for more info and examples.
-& @chat mogrifying
-Mogrifying individual pieces of the channel chatter text:
+  See 'help mogrify2' for info on specific mogrifiers, and 'help mogrify3'
+  for some examples.
+& mogrify2
 
-  If any of these evaluate to a non-null string, they replace that portion
-  of the chat message.
+  There are mogrify attributes for each individual piece of the channel
+  message. If any evaluate to a non-empty string, they replace that portion
+  of the chat message. Each mogrify attribtute is passed six arguments:
 
   %0 - (Depends on the mogrifier.)
   %1 - Channel name (unmogrified).
@@ -305,14 +334,15 @@
   %4 - Player chan title.
   %5 - Player name.
 
+  The mogrify attributes available are:
   MOGRIFY`CHANNAME: %0 = default channel display. (e.g: "<Public>").
   MOGRIFY`TITLE: %0 = The player's title, if any.
   MOGRIFY`PLAYERNAME: %0 = The player's name.
   MOGRIFY`SPEECHTEXT: %0 = "says"
   MOGRIFY`MESSAGE: %0 = <the content of the say, pose, semipose or emit>
 
-  See 'help @chat mogrifying2' for examples.
-& @chat mogrifying2
+  See 'help mogrify3' for examples.
+& mogrify3
 For Talk Like a Pirate Day (Sep 19):
 
   > @create Pirate Filter
@@ -324,7 +354,6 @@
   > &MOGRIFY`CHANNAME Pirate Filter=(%1-Yarr!)
 
 Output:
-
   > +public Hello
   (Public-Yarr!) Buccaneer Walker yo-hos, "Hello"
 
@@ -335,8 +364,8 @@
   We don't need no ninjas!
   (And the message is blocked, won't be sent out).
 
-  See 'help @chat mogrifying3' for another example.
-& @chat mogrifying3
+  See 'help mogrify4' for another example.
+& mogrify4
 For keeping a channel PG and safe, and altering the channel name from
 <Public> to [Public], with a green "Public".
 
@@ -355,29 +384,56 @@
 
   Combine MOGRIFY`FORMAT with speak() and you can have plenty of fun:
   On-channel language systems and more!
+& @channel list
 & channel-list
 Here's the legend for reading the @channel/list output:
 
-Channel Name               Num Users Num Msgs  Access Locks     Status  Buf
-Sample                             1        0 [DPTWQHo jsmvh*] [On  QH]   4
-                                               ||||||| ||||||   |   ||    |
-Channel is DISABLED----------------------------/|||||| ||||||   |   ||    |
-Channel allows PLAYERS--------------------------/||||| ||||||   |   ||    |
-Channel allows THINGS----------------------------/|||| ||||||   |   ||    |
-Channel is Wizard-only (W) or Admin-only (A)------/||| ||||||   |   ||    |
-Channel is QUIET-----------------------------------/|| ||||||   |   ||    |
-Channel is HIDE_OK----------------------------------/| ||||||   |   ||    |
-Channel is OPEN (non-members can speak on it)--------/ ||||||   |   ||    |
-Channel has @clock/join set----------------------------||||||   |   ||    |
-Channel has @clock/speak set----------------------------/||||   |   ||    |
-Channel has @clock/mod set-------------------------------/|||   |   ||    |
-Channel has @clock/see set--------------------------------/||   |   ||    |
-Channel has @clock/hide set--------------------------------/|   |   ||    |
-Player is the owner of the channel--------------------------/   |   ||    |
-Player is currently on/off/gagging the channel------------------/   ||    |
-If on, player has the channel muted---------------------------------/|    |
-If on, player is hiding on the channel-------------------------------/    |
-Size of the channel buffer in full-length lines---------------------------/
+Channel Name               Num Users Num Msgs  Access Locks     Status   Buf
+Sample                             1        0 [DPTWQHo jsmvh*] [On  QHC]   4
+                                               ||||||| ||||||   |   |||    |
+Channel is DISABLED----------------------------/|||||| ||||||   |   |||    |
+Channel allows PLAYERS--------------------------/||||| ||||||   |   |||    |
+Channel allows THINGS----------------------------/|||| ||||||   |   |||    |
+Channel is Wizard-only (W) or Admin-only (A)------/||| ||||||   |   |||    |
+Channel is QUIET-----------------------------------/|| ||||||   |   |||    |
+Channel is HIDE_OK----------------------------------/| ||||||   |   |||    |
+Channel is OPEN (non-members can speak on it)--------/ ||||||   |   |||    |
+Channel has @clock/join set----------------------------||||||   |   |||    |
+Channel has @clock/speak set----------------------------/||||   |   |||    |
+Channel has @clock/mod set-------------------------------/|||   |   |||    |
+Channel has @clock/see set--------------------------------/||   |   |||    |
+Channel has @clock/hide set--------------------------------/|   |   |||    |
+Player is the owner of the channel--------------------------/   |   |||    |
+Player is currently on/off/gagging the channel------------------/   |||    |
+If on, player has the channel muted---------------------------------/||    |
+If on, player is hiding on the channel-------------------------------/|    |
+If on, player has @channel/combined the channel-----------------------/    |
+Size of the channel buffer in full-length lines----------------------------/
+& @channel privs
+& channel-privs
+  The <privs> for @channel/add and @channel/privs should be a space-separated
+  list of priv names, or a string of priv chars, from the list below:
+
+  * "player" (P) - players may use the channel
+  * "object" (O) - non-players may use the channel
+  * "admin" (A) - only royalty/wizards/chat_privs may use the channel
+  * "wizard" (W) - only wizards may use the channel
+  * "quiet" (Q) - channel will not show connection messages
+  * "open" (o) - you may speak even if you aren't listening to the channel
+  * "hide_ok" (H) - you may hide from the channel who list
+  * "notitles" (T) - chantitles are not displayed in channel messages
+  * "nonames" (N) - player names are not displayed in channel messages
+  * "nocemit" (C) - @cemit is prohibited on the channel
+  * "interact" (I) - Interaction rules (defined in local.c) are applied to 
+    the channel
+  * "disabled" (D) - noone can join or speak on the channel
+
+  The default privs are determined by the 'channel_flags' @config option.
+
+  Example:
+    > @channel/add Public=player quiet open nocemit
+
+See also: cflags(), clflags()
 & @clock
   @clock/join <channel>[=<key>]
   @clock/speak <channel>[=<key>]
@@ -385,13 +441,13 @@
   @clock/hide <channel>[=<key>]
   @clock/mod <channel>[=<key>]
 
-  The @clock command modifies the a lock on a chat channel if the
-  extended chat system is in use. If no key is specified, the lock is
-  unlocked. Evaluation locks will not work with @clock.  See help
-  @clock2 for information on using indirect locks.
+  The @clock command modifies the a lock on a chat channel. If no <key> is
+  specified, the lock is removed. Evaluation locks will not work with @clock,
+  but you can use an indirect lock which uses evaluation locks. For an
+  explaination of the <key> argument, see 'help @lock'.
 
   The "join" lock restricts who can join the channel.
-  The "speak" lock restricts who can speak to the channel.
+  The "speak" lock restricts who can speak on the channel.
   The "see" lock restricts who can see the channel on @channel/list
   The "hide" lock restricts @channel/hide if the channel is hide_ok.
   The "mod" lock restricts who can modify the channel. If you pass the
@@ -400,9 +456,7 @@
   When new channels are added, the mod lock is set to the
   creator/owner, and all other locks are unlocked.
 
-  See help @clock2 for how to use indirect locks to lock a channel to
-  anything.
-
+  Continued in 'help @clock2'.
 & @clock2
   You can use indirect @clocks to lock a channel to a lock of any type
   (including evaluation locks) on a VISUAL object. This channel can only
@@ -422,10 +476,12 @@
   You can lock multiple channels to the same object by specfiying a
   specific indirect lock instead of the default one:
 
+  > @lock/user:onechanneljoin #10=flag^foo
   > @clock/join onechannel=@#10/onechanneljoin
+  > @lock/user:anotherchanneljoin #10=flag^bar
   > @clock/join anotherchannel=@#10/anotherchanneljoin
-  > @lock/user:onechanneljoin #10 = 1
-  > @lock/user:anotherchanneljoin #10 = isunfind/1
+
+See also: clock()
 & COWNER()
   cowner(<channel>)
 
@@ -433,16 +489,16 @@
 & CTITLE()
   ctitle(<channel>, <object>)
 
-  Returns <object>'s @chan/title on <channel>. You must either be able
-  to examine the object, or it must be visibly on a channel which you
-  are allowed to join.
+  Returns <object>'s @channel/title on <channel>. You must either be able
+  to examine the object, or it must be visibly on <channel>, and you must
+  either be on <channel> on able to join it.
 & CSTATUS()
   cstatus(<channel>, <object>)
 
   Returns <object>'s status with respect to <channel>, which may be
   "Off", "On", or "Gag". You must either be able to examine the
   object, or it must visible be on the channel; "Off" is returned for
-  objects that you can not see on the channel.
+  objects that you cannot see on the channel.
   
 See also: cwho(), cflags()
 & CDESC()
@@ -454,21 +510,21 @@
   cmsgs(<channel>)
   cbuffer(<channel>)
 
-  Return the description, number of users, number of messages, or
-  buffer size of <channel>, respectively. This information is also
-  displayed in @chan/list.
-  
+  Return the description (@channel/describe), number of users, number of
+  messages in the recall buffer, or buffer size of <channel>, respectively.
+  This information is also displayed in @channel/list and @channel/what.
+
 See also: cbufferadd(), crecall()
 & CBUFFERADD()
   cbufferadd(<channel>, <text>[, <spoof>])
 
-  Adds text to a chan buffer without broadcasting it to all people on
-  the channel.  If <spoof> is true, it will spoof the encator (%#),
-  and you must be able to perform an @nscemit.
+  Adds text to a channel buffer without broadcasting it to all people on
+  the channel. If <spoof> is true, it will spoof the enactor (%#).
 
-  This function is only usable by objects that pass the channel's @clock/mod.
+  This function is only usable by objects that pass the channel's @clock/mod,
+  and who can use the @cemit command (or @nscemit if <spoof> is true).
   
-See also: crecall(), cbuffer()
+See also: crecall(), cbuffer(), @channel/recall, @channel/buffer
 & CWHO()
   cwho(<channel>[, <status>[, <skip gagged?>]])
  
@@ -482,14 +538,6 @@
   included in the results.
 
 See also: cstatus()
-& CEMIT()
-  cemit(<channel>, <message>[, <noisy>])
-
-  Sends a message to all players listening to the given chat channel.
-  See help @cemit for details.
-
-  If the third argument is a true value, the channel name will be
-  prepended to the message, behaving like @cemit/noisy.
 & CFLAGS()
 & CLFLAGS()
   cflags(<channel>)
@@ -497,18 +545,17 @@
   clflags(<channel>)
   clflags(<channel>, <object>)
 
-  With one argument, cflags() returns a list of flags set on the given
-  channel, represented as a string of characters. See 'help channel-list'
-  for the list of flags (they appear in the "Access" column). You must be
-  able to see the channel to use this function.
+  With one argument, cflags() returns a list of priv flags set on the given
+  channel, represented as a string of characters. See 'help @channel privs'
+  for the list. You must be able to see the channel to use this function.
 
   With two arguments, cflags() returns a list of flags for that object on 
   that channel, currently a string consisting of zero or more of 
-  "G" (gagging), "Q" (muted), and "H" (hidden).  You must be able to see 
-  that channel and to examine the object to use this function. If the 
-  object is not on the channel, an error is returned.
+  "G" (gagging), "Q" (muted), and "H" (hidden). You must be able to see that
+  channel and to examine the object to use this function. If the object is
+  not on the channel, an error is returned.
 
-  The clflags versions return a space-separated list of flag names,
+  The clflags() versions return a space-separated list of flag names,
   rather than a string of flag characters.
   
 See also: cstatus()
@@ -517,40 +564,39 @@
   channels(<object>)
   channels(<object>[, <delimiter>])
 
-  With no arguments, channels() returns the list of all channel names
-  which are visible to the player. With two arguments, returns the
-  list of channel names to which the object is listening, delimited by
-  <delimiter>.
+  With no arguments, channels() returns the list of all channel names which
+  are visible to the player. With two arguments, returns the list of channel
+  names to which the object is listening, delimited by <delimiter>.
 
-  With one argument, the behavior is ambiguous. If the argument
-  matches an object, returns the list of names to which the object is
-  listening, space-delimited. If not, it's treated as a no-argument
-  case with a delimiter.
+  With one argument, the behavior is ambiguous. If the argument matches an
+  object, it returns a space-separated list of channels to which the object
+  is listening. If not, it's treated as a no-argument case with a delimiter.
 
-  If you don't have permission to examine the object, you only see
-  those channels to which the object belong for which you have
-  permission to join (or are joined to).
+  If you don't have permission to examine the object, you only see those
+  channels to which the object belong for which you have permission to join
+  (or are joined to).
 & CLOCK()
   clock(<channel>[/<locktype>][, <new lock>])
 
-  With one argument, returns the value of a lock on a channel, if you
-  own the channel or are See_All.  If no locktype is given, "JOIN" is
-  assumed.  With two arguments, sets the lock if you would be able to
-  do so via @clock.
+  With one argument, returns the value of a lock on a channel, if you own the
+  channel or are See_All. If no locktype is given, "JOIN" is assumed. With
+  two arguments, sets the lock if you would be able to do so via @clock.
 
-See also: @clock
+See also: @clock, @lock
 & CRECALL()
   crecall(<channel>[, <lines> [, <start line> [, <osep> [, <timestamps?> ]]]])
 
-  This function is the functional form of @chan/recall, and returns a
+  This function is the functional form of @channel/recall, and returns a
   string containing the recalled lines from the channel, separated by
   <osep>. If <timestamps?> is a true value, the recalled lines will
   include their timestamps; otherwise, they will not.
 
-See also: @channel3, cbufferadd()
+See also: @channel/recall, cbufferadd()
 & Channel functions
   Channel functions work with the channel system.
 
   cbuffer()     cbufferadd()  cdesc()       cemit()       cflags()
   channels()    clflags()     clock()       cmsgs()       cowner()
   crecall()     cstatus()     ctitle()      cusers()      cwho()
+
+See also: CHAT, @channel, @cemit, @clock
Index: game/txt/hlp/pennmail.hlp
===================================================================
--- game/txt/hlp/pennmail.hlp	(.../184p1)	(revision 682)
+++ game/txt/hlp/pennmail.hlp	(.../184p2)	(revision 682)
@@ -152,6 +152,18 @@
   > @mailfilter me=if(strmatch(%3,*U*),1)
 
 See also: mail-folders
+& @mailsignature
+& mailsignature
+
+  @mailsignature <object>[=<signature>]
+  
+  When set, this attribute is evaluated and appended to any @mail messages
+  sent by <object>, unless the @mail/nosig command is used.
+  
+  Example:
+  > @mailsignature me=%r%r-- %n%r%r[u(funny_quote)]
+  
+See also: @mail, mail-sending
 & mail-admin
   
   The @mail command can also take the following switches:
@@ -251,8 +263,8 @@
   Mail functions work with @mail.
 
   folderstats() mail()        maildstats()  mailfrom()    mailfstats()
-  mailsend()    mailstats()   mailstatus()  mailsubject() mailtime()
-  malias()
+  maillist()    mailsend()    mailstats()   mailstatus()  mailsubject()
+  mailtime()    malias()
   
 & FOLDERSTATS()
   folderstats()
@@ -284,6 +296,25 @@
   > think mail(3:2)
   (text of the second message in the player's third folder)
   
+  See also: maillist(), mailfrom()
+& MAILLIST()
+  maillist([<player>, ]<message-list>)
+  
+  maillist() returns a list of all <player>'s @mail messages which match the
+  given <message-list> (the same as @mail/list <message-list>). If no
+  <player> is given, the executor's mail is matched. The <message-list> 
+  argument is described in 'help mail'.
+  
+  Examples:
+    > think maillist()
+    0:1 0:2 0:3
+    > think maillist(all)
+    0:1 0:2 0:3 1:1 1:2
+    > think maillist(1:)
+    1:1 1:2
+    
+See also: mail(), mailfrom()
+
 & MAILFROM()
 & MAILTIME()
 & MAILSTATUS()
@@ -299,6 +330,7 @@
   mailstatus() returns the mail's status characters (as per
   @mail/list)
 
+  See also: mail(), maillist()
 & MAILSTATS()
 & MAILDSTATS()
 & MAILFSTATS()
Index: game/txt/hlp/pennconf.hlp
===================================================================
--- game/txt/hlp/pennconf.hlp	(.../184p1)	(revision 682)
+++ game/txt/hlp/pennconf.hlp	(.../184p2)	(revision 682)
@@ -159,6 +159,9 @@
   max_logins=<number>: The maximum number of connected players.
   max_guests=<number>: The maximum number of connected guests. If 0, 
    no limit. If -1, limited by the number of guest players in the db.
+  connect_fail_limit=<count>: The maximum number of times in a 10 minute
+   period that an IP can attempt to log in and fail. Maximum is 50,
+   0 means no limit.
   idle_timeout=<time>: The number of minutes a connection can be idle
    before getting booted. 0 means no limit.
   unconnected_idle_timeout=<time>: The number of minutes a connection can be 
Index: game/txt/hlp/index.hlp
===================================================================
--- game/txt/hlp/index.hlp	(.../184p1)	(revision 682)
+++ game/txt/hlp/index.hlp	(.../184p2)	(revision 682)
@@ -3,132 +3,133 @@
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  "                         #lambda                   $-commands               
  $-commands2               %                         %!                       
- %#                        %2                        %3                       
- %4                        %:                        %@                       
- %a                        %i                        %i0                      
- %n                        %o                        %p                       
- %s                        %~                        +                        
- 1.50p6                    1.50p7                    1.50p8                   
- 1.50p9                    1.50p10                   1.50p11                  
- 1.50p12                   1.50p13                   1.50p14                  
- 1.50pdune1                1.50pdune2                1.6.0p0                  
- 1.6.0p3                   1.6.0p4                   1.6.0p5                  
- 1.6.1p0                   1.6.1p1                   1.6.10p0                 
- 1.6.10p1                  1.6.10p2                  1.6.10p3                 
- 1.6.10p4                  1.6.10p5                  1.6.10p6                 
- 1.6.2p0                   1.6.2p1                   1.6.3p0                  
+ %#                        %$                        %$0                      
+ %2                        %3                        %4                       
+ %:                        %@                        %a                       
+ %i                        %i0                       %n                       
+ %o                        %p                        %s                       
+ %~                        +                         1.50p6                   
+ 1.50p7                    1.50p8                    1.50p9                   
+ 1.50p10                   1.50p11                   1.50p12                  
+ 1.50p13                   1.50p14                   1.50pdune1               
+ 1.50pdune2                1.6.0p0                   1.6.0p3                  
+ 1.6.0p4                   1.6.0p5                   1.6.1p0                  
+ 1.6.1p1                   1.6.10p0                  1.6.10p1                 
+ 1.6.10p2                  1.6.10p3                  1.6.10p4                 
+ 1.6.10p5                  1.6.10p6                  1.6.2p0                  
 
 For more, see Entries-2
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-2
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- 1.6.3p1                   1.6.3p2                   1.6.3p3                  
- 1.6.3p4                   1.6.3p5                   1.6.3p6                  
- 1.6.3p7                   1.6.4p0                   1.6.4p1                  
- 1.6.4p2                   1.6.5p0                   1.6.5p1                  
- 1.6.5p2                   1.6.5p3                   1.6.5p4                  
- 1.6.6p0                   1.6.7p0                   1.6.7p1                  
- 1.6.7p2                   1.6.7p3                   1.6.7p4                  
- 1.6.7p5                   1.6.7p6                   1.6.8p0                  
- 1.6.8p1                   1.6.9p0                   1.6.9p1                  
- 1.6.9p2                   1.6.9p3                   1.6.9p4                  
- 1.6.9p5                   1.6.9p6                   1.6.9p7                  
- 1.6.9p8                   1.6.9p9                   1.7.0p0                  
- 1.7.0p1                   1.7.0p2                   1.7.0p3                  
- 1.7.0p4                   1.7.0p5                   1.7.0p6                  
- 1.7.0p7                   1.7.0p8                   1.7.0p9                  
- 1.7.0p10                  1.7.0p11                  1.7.1p0                  
+ 1.6.2p1                   1.6.3p0                   1.6.3p1                  
+ 1.6.3p2                   1.6.3p3                   1.6.3p4                  
+ 1.6.3p5                   1.6.3p6                   1.6.3p7                  
+ 1.6.4p0                   1.6.4p1                   1.6.4p2                  
+ 1.6.5p0                   1.6.5p1                   1.6.5p2                  
+ 1.6.5p3                   1.6.5p4                   1.6.6p0                  
+ 1.6.7p0                   1.6.7p1                   1.6.7p2                  
+ 1.6.7p3                   1.6.7p4                   1.6.7p5                  
+ 1.6.7p6                   1.6.8p0                   1.6.8p1                  
+ 1.6.9p0                   1.6.9p1                   1.6.9p2                  
+ 1.6.9p3                   1.6.9p4                   1.6.9p5                  
+ 1.6.9p6                   1.6.9p7                   1.6.9p8                  
+ 1.6.9p9                   1.7.0p0                   1.7.0p1                  
+ 1.7.0p2                   1.7.0p3                   1.7.0p4                  
+ 1.7.0p5                   1.7.0p6                   1.7.0p7                  
+ 1.7.0p8                   1.7.0p9                   1.7.0p10                 
 
 For more, see Entries-3
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-3
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- 1.7.1p1                   1.7.1p2                   1.7.1p3                  
- 1.7.2p0                   1.7.2p1                   1.7.2p2                  
- 1.7.2p3                   1.7.2p4                   1.7.2p5                  
- 1.7.2p6                   1.7.2p7                   1.7.2p8                  
- 1.7.2p9                   1.7.2p10                  1.7.2p11                 
- 1.7.2p12                  1.7.2p13                  1.7.2p14                 
- 1.7.2p15                  1.7.2p16                  1.7.2p17                 
- 1.7.2p18                  1.7.2p19                  1.7.2p20                 
- 1.7.2p21                  1.7.2p22                  1.7.2p23                 
- 1.7.2p24                  1.7.2p25                  1.7.2p26                 
- 1.7.2p27                  1.7.2p28                  1.7.2p29                 
- 1.7.2p30                  1.7.2p31                  1.7.2p32                 
- 1.7.2p33                  1.7.2p34                  1.7.2p35                 
- 1.7.3p0                   1.7.3p1                   1.7.3p2                  
- 1.7.3p3                   1.7.3p4                   1.7.3p5                  
- 1.7.3p6                   1.7.3p7                   1.7.3p8                  
+ 1.7.0p11                  1.7.1p0                   1.7.1p1                  
+ 1.7.1p2                   1.7.1p3                   1.7.2p0                  
+ 1.7.2p1                   1.7.2p2                   1.7.2p3                  
+ 1.7.2p4                   1.7.2p5                   1.7.2p6                  
+ 1.7.2p7                   1.7.2p8                   1.7.2p9                  
+ 1.7.2p10                  1.7.2p11                  1.7.2p12                 
+ 1.7.2p13                  1.7.2p14                  1.7.2p15                 
+ 1.7.2p16                  1.7.2p17                  1.7.2p18                 
+ 1.7.2p19                  1.7.2p20                  1.7.2p21                 
+ 1.7.2p22                  1.7.2p23                  1.7.2p24                 
+ 1.7.2p25                  1.7.2p26                  1.7.2p27                 
+ 1.7.2p28                  1.7.2p29                  1.7.2p30                 
+ 1.7.2p31                  1.7.2p32                  1.7.2p33                 
+ 1.7.2p34                  1.7.2p35                  1.7.3p0                  
+ 1.7.3p1                   1.7.3p2                   1.7.3p3                  
+ 1.7.3p4                   1.7.3p5                   1.7.3p6                  
 
 For more, see Entries-4
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-4
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- 1.7.3p9                   1.7.3p10                  1.7.3p11                 
- 1.7.3p12                  1.7.3p13                  1.7.3p14                 
- 1.7.4p0                   1.7.4p1                   1.7.4p2                  
- 1.7.4p3                   1.7.4p4                   1.7.4p5                  
- 1.7.4p6                   1.7.4p7                   1.7.4p8                  
- 1.7.4p9                   1.7.4p10                  1.7.4p11                 
- 1.7.4p12                  1.7.4p13                  1.7.4p14                 
- 1.7.4p15                  1.7.4p16                  1.7.4p17                 
- 1.7.4p18                  1.7.4p19                  1.7.4p20                 
- 1.7.5p0                   1.7.5p1                   1.7.5p2                  
- 1.7.5p3                   1.7.5p4                   1.7.5p5                  
- 1.7.5p6                   1.7.5p7                   1.7.5p8                  
- 1.7.5p9                   1.7.5p10                  1.7.5p11                 
- 1.7.5p12                  1.7.6p0                   1.7.6p1                  
- 1.7.6p2                   1.7.6p3                   1.7.6p4                  
- 1.7.6p5                   1.7.6p6                   1.7.6p7                  
+ 1.7.3p7                   1.7.3p8                   1.7.3p9                  
+ 1.7.3p10                  1.7.3p11                  1.7.3p12                 
+ 1.7.3p13                  1.7.3p14                  1.7.4p0                  
+ 1.7.4p1                   1.7.4p2                   1.7.4p3                  
+ 1.7.4p4                   1.7.4p5                   1.7.4p6                  
+ 1.7.4p7                   1.7.4p8                   1.7.4p9                  
+ 1.7.4p10                  1.7.4p11                  1.7.4p12                 
+ 1.7.4p13                  1.7.4p14                  1.7.4p15                 
+ 1.7.4p16                  1.7.4p17                  1.7.4p18                 
+ 1.7.4p19                  1.7.4p20                  1.7.5p0                  
+ 1.7.5p1                   1.7.5p2                   1.7.5p3                  
+ 1.7.5p4                   1.7.5p5                   1.7.5p6                  
+ 1.7.5p7                   1.7.5p8                   1.7.5p9                  
+ 1.7.5p10                  1.7.5p11                  1.7.5p12                 
+ 1.7.6p0                   1.7.6p1                   1.7.6p2                  
+ 1.7.6p3                   1.7.6p4                   1.7.6p5                  
 
 For more, see Entries-5
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-5
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- 1.7.6p8                   1.7.6p9                   1.7.6p10                 
- 1.7.6p11                  1.7.6p12                  1.7.6p13                 
- 1.7.6p14                  1.7.6p15                  1.7.6p16                 
- 1.7.7p0                   1.7.7p1                   1.7.7p2                  
- 1.7.7p3                   1.7.7p4                   1.7.7p5                  
- 1.7.7p6                   1.7.7p7                   1.7.7p8                  
- 1.7.7p9                   1.7.7p10                  1.7.7p11                 
- 1.7.7p12                  1.7.7p13                  1.7.7p14                 
- 1.7.7p15                  1.7.7p16                  1.7.7p17                 
- 1.7.7p18                  1.7.7p19                  1.7.7p20                 
- 1.7.7p21                  1.7.7p22                  1.7.7p23                 
- 1.7.7p24                  1.7.7p25                  1.7.7p26                 
- 1.7.7p27                  1.7.7p28                  1.7.7p29                 
- 1.7.7p30                  1.7.7p31                  1.7.7p32                 
- 1.7.7p33                  1.7.7p34                  1.7.7p35                 
- 1.7.7p36                  1.7.7p37                  1.7.7p38                 
+ 1.7.6p6                   1.7.6p7                   1.7.6p8                  
+ 1.7.6p9                   1.7.6p10                  1.7.6p11                 
+ 1.7.6p12                  1.7.6p13                  1.7.6p14                 
+ 1.7.6p15                  1.7.6p16                  1.7.7p0                  
+ 1.7.7p1                   1.7.7p2                   1.7.7p3                  
+ 1.7.7p4                   1.7.7p5                   1.7.7p6                  
+ 1.7.7p7                   1.7.7p8                   1.7.7p9                  
+ 1.7.7p10                  1.7.7p11                  1.7.7p12                 
+ 1.7.7p13                  1.7.7p14                  1.7.7p15                 
+ 1.7.7p16                  1.7.7p17                  1.7.7p18                 
+ 1.7.7p19                  1.7.7p20                  1.7.7p21                 
+ 1.7.7p22                  1.7.7p23                  1.7.7p24                 
+ 1.7.7p25                  1.7.7p26                  1.7.7p27                 
+ 1.7.7p28                  1.7.7p29                  1.7.7p30                 
+ 1.7.7p31                  1.7.7p32                  1.7.7p33                 
+ 1.7.7p34                  1.7.7p35                  1.7.7p36                 
 
 For more, see Entries-6
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-6
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- 1.7.7p39                  1.7.7p40                  1.8.0p0                  
- 1.8.0p1                   1.8.0p2                   1.8.0p3                  
- 1.8.0p4                   1.8.0p5                   1.8.0p6                  
- 1.8.0p7                   1.8.0p8                   1.8.0p9                  
- 1.8.0p10                  1.8.0p11                  1.8.0p12                 
- 1.8.0p13                  1.8.1p0                   1.8.1p1                  
- 1.8.1p2                   1.8.1p3                   1.8.1p4                  
- 1.8.1p5                   1.8.1p6                   1.8.1p7                  
- 1.8.1p8                   1.8.1p9                   1.8.1p10                 
- 1.8.2p0                   1.8.2p1                   1.8.2p2                  
- 1.8.2p3                   1.8.2p4                   1.8.2p5                  
- 1.8.2p6                   1.8.2p7                   1.8.2p8                  
- 1.8.3p0                   1.8.3p1                   1.8.3p2                  
- 1.8.3p3                   1.8.3p4                   1.8.3p5                  
- 1.8.3p6                   1.8.3p7                   1.8.3p8                  
- 1.8.3p9                   1.8.3p10                  1.8.3p11                 
+ 1.7.7p37                  1.7.7p38                  1.7.7p39                 
+ 1.7.7p40                  1.8.0p0                   1.8.0p1                  
+ 1.8.0p2                   1.8.0p3                   1.8.0p4                  
+ 1.8.0p5                   1.8.0p6                   1.8.0p7                  
+ 1.8.0p8                   1.8.0p9                   1.8.0p10                 
+ 1.8.0p11                  1.8.0p12                  1.8.0p13                 
+ 1.8.1p0                   1.8.1p1                   1.8.1p2                  
+ 1.8.1p3                   1.8.1p4                   1.8.1p5                  
+ 1.8.1p6                   1.8.1p7                   1.8.1p8                  
+ 1.8.1p9                   1.8.1p10                  1.8.2p0                  
+ 1.8.2p1                   1.8.2p2                   1.8.2p3                  
+ 1.8.2p4                   1.8.2p5                   1.8.2p6                  
+ 1.8.2p7                   1.8.2p8                   1.8.3p0                  
+ 1.8.3p1                   1.8.3p2                   1.8.3p3                  
+ 1.8.3p4                   1.8.3p5                   1.8.3p6                  
+ 1.8.3p7                   1.8.3p8                   1.8.3p9                  
 
 For more, see Entries-7
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-7
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- 1.8.3p12                  1.8.3p13                  1.8.4p0                  
- 1.8.4p1                   :                         ;                        
+ 1.8.3p10                  1.8.3p11                  1.8.3p12                 
+ 1.8.3p13                  1.8.4p0                   1.8.4p1                  
+ 1.8.4p2                   :                         ;                        
  @-attributes              @-building                @-general                
  @-wizard                  @@                        @@()                     
  @aahear                   @abuy                     @aclone                  
@@ -142,285 +143,290 @@
  @aname                    @apayment                 @areceive                
  @assert                   @asuccess                 @atport                  
  @atrchown                 @atrlock                  @attribute               
- @attribute2               @aufail                   @aunfollow               
 
 For more, see Entries-8
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-8
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- @ause                     @away                     @azenter                 
- @azleave                  @boot                     @break                   
- @buy                      @cemit                    @channel                 
+ @attribute2               @attribute3               @aufail                  
+ @aunfollow                @ause                     @away                    
+ @azenter                  @azleave                  @boot                    
+ @break                    @buy                      @cemit                   
+ @channel                  @channel admin            @channel admin2          
+ @channel admin3           @channel joining          @channel joining2        
+ @channel list             @channel other            @channel privs           
  @channel/add              @channel/buffer           @channel/chown           
- @channel/delete           @channel/desc             @channel/gag             
- @channel/hide             @channel/list             @channel/mogrifier       
- @channel/mute             @channel/off              @channel/on              
- @channel/priv             @channel/recall           @channel/rename          
- @channel/title            @channel/what             @channel/who             
- @channel/wipe             @channel2                 @channel3                
- @channel4                 @channel5                 @channel6                
- @charges                  @chat                     @chat mogrifying         
- @chat mogrifying2         @chat mogrifying3         @chatformat              
- @chatformat2              @chatformat3              @chown                   
- @chownall                 @chzone                   @chzone2                 
- @chzoneall                @clock                    @clock2                  
+ @channel/combine          @channel/decompile        @channel/delete          
+ @channel/describe         @channel/gag              @channel/hide            
+ @channel/join             @channel/list             @channel/mogrifier       
+ @channel/mute             @channel/name             @channel/off             
+ @channel/on               @channel/privs            @channel/recall          
+ @channel/rename           @channel/title            @channel/uncombine       
+ @channel/ungag            @channel/unhide           @channel/unjoin          
+ @channel/what             @channel/who              @channel/wipe            
 
 For more, see Entries-9
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-9
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- @clone                    @command                  @command2                
- @command3                 @comment                  @config                  
- @config attribs           @config chat              @config cmds             
- @config cosmetic          @config cosmetic2         @config costs            
- @config db                @config dump              @config flags            
- @config funcs             @config limits            @config limits2          
- @config limits3           @config limits4           @config log              
- @config net               @config parameters        @config tiny             
- @conformat                @cost                     @cpattr                  
- @create                   @dbck                     @death                   
- @debugforwardlist         @decompile                @decompile2              
- @decompile3               @desc                     @descformat              
- @describe                 @destroy                  @destroy2                
- @dig                      @dig2                     @disable                 
- @doing                    @dolist                   @drain                   
- @drop                     @dump                     @ealias                  
+ @charges                  @chat                     @chat mogrifying         
+ @chatformat               @chatformat2              @chatformat3             
+ @chown                    @chownall                 @chzone                  
+ @chzone2                  @chzoneall                @clock                   
+ @clock2                   @clone                    @command                 
+ @command2                 @command3                 @comment                 
+ @config                   @config attribs           @config chat             
+ @config cmds              @config cosmetic          @config cosmetic2        
+ @config costs             @config db                @config dump             
+ @config flags             @config funcs             @config limits           
+ @config limits2           @config limits3           @config limits4          
+ @config log               @config net               @config parameters       
+ @config tiny              @conformat                @cost                    
+ @cpattr                   @create                   @dbck                    
+ @death                    @debugforwardlist         @decompile               
+ @decompile2               @decompile3               @desc                    
 
 For more, see Entries-10
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-10
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- @edit                     @efail                    @elock                   
- @emit                     @enable                   @enter                   
- @entrances                @eunlock                  @exitformat              
- @failure                  @filter                   @filter2                 
- @find                     @firstexit                @flag                    
- @flag2                    @follow                   @force                   
- @force2                   @forwardlist              @function                
- @function2                @function3                @function4               
- @gedit                    @give                     @grep2                   
- @grep                     @halt                     @haven                   
- @hide                     @hook                     @hook2                   
- @idescformat              @idescribe                @idle                    
- @include                  @infilter                 @inprefix                
- @invformat                @kick                     @lalias                  
- @leave                    @lemit                    @lfail                   
- @link                     @list                     @listen                  
+ @descformat               @describe                 @destroy                 
+ @destroy2                 @dig                      @dig2                    
+ @disable                  @doing                    @dolist                  
+ @drain                    @drop                     @dump                    
+ @ealias                   @edit                     @efail                   
+ @elock                    @emit                     @enable                  
+ @enter                    @entrances                @eunlock                 
+ @exitformat               @failure                  @filter                  
+ @filter2                  @find                     @firstexit               
+ @flag                     @flag2                    @follow                  
+ @force                    @force2                   @forwardlist             
+ @function                 @function2                @function3               
+ @function4                @gedit                    @give                    
+ @grep2                    @grep                     @halt                    
+ @haven                    @hide                     @hook                    
+ @hook2                    @idescformat              @idescribe               
 
 For more, see Entries-11
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-11
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- @listen2                  @listmotd                 @lock                    
- @lock-attribute           @lock-bit                 @lock-carry              
- @lock-channel             @lock-complex             @lock-eval2              
- @lock-evaluation          @lock-evaluation2         @lock-flag               
- @lock-host                @lock-indirect            @lock-list               
- @lock-objid               @lock-owner               @lock-power              
- @lock-simple              @lock-type                @log                     
- @logwipe                  @lset                     @mail                    
- @mailfilter               @mailforwardlist          @malias                  
- @malias2                  @malias3                  @malias4                 
- @malias5                  @message                  @message2                
- @motd                     @move                     @mvattr                  
- @name                     @nameaccent               @nameformat              
- @newpassword              @notify                   @nscemit                 
- @nsemit                   @nslemit                  @nsoemit                 
- @nspemit                  @nsprompt                 @nsremit                 
+ @idle                     @include                  @infilter                
+ @inprefix                 @invformat                @kick                    
+ @lalias                   @leave                    @lemit                   
+ @lfail                    @link                     @list                    
+ @listen                   @listen2                  @listmotd                
+ @lock                     @lock-attribute           @lock-bit                
+ @lock-carry               @lock-channel             @lock-complex            
+ @lock-eval2               @lock-evaluation          @lock-evaluation2        
+ @lock-flag                @lock-host                @lock-indirect           
+ @lock-list                @lock-objid               @lock-owner              
+ @lock-power               @lock-simple              @lock-type               
+ @log                      @logwipe                  @lset                    
+ @mail                     @mailfilter               @mailforwardlist         
+ @mailsignature            @malias                   @malias2                 
+ @malias3                  @malias4                  @malias5                 
+ @message                  @message2                 @motd                    
 
 For more, see Entries-12
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-12
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- @nszemit                  @nuke                     @obuy                    
- @odeath                   @odescribe                @odrop                   
- @oefail                   @oemit                    @oenter                  
- @ofailure                 @ofollow                  @ogive                   
- @oidescribe               @oleave                   @olfail                  
- @omove                    @oname                    @opayment                
- @open                     @oreceive                 @osuccess                
- @otport                   @oufail                   @ounfollow               
- @ouse                     @outpageformat            @outpageformat2          
- @oxenter                  @oxleave                  @oxmove                  
- @oxtport                  @ozenter                  @ozleave                 
- @pageformat               @pageformat2              @parent                  
- @password                 @payment                  @pcreate                 
- @pemit                    @pemit2                   @poll                    
- @poor                     @power                    @power2                  
- @power3                   @prefix                   @pricelist               
+ @move                     @mvattr                   @name                    
+ @nameaccent               @nameformat               @newpassword             
+ @notify                   @nscemit                  @nsemit                  
+ @nslemit                  @nsoemit                  @nspemit                 
+ @nsprompt                 @nsremit                  @nszemit                 
+ @nuke                     @obuy                     @odeath                  
+ @odescribe                @odrop                    @oefail                  
+ @oemit                    @oenter                   @ofailure                
+ @ofollow                  @ogive                    @oidescribe              
+ @oleave                   @olfail                   @omove                   
+ @oname                    @opayment                 @open                    
+ @oreceive                 @osuccess                 @otport                  
+ @oufail                   @ounfollow                @ouse                    
+ @outpageformat            @outpageformat2           @oxenter                 
+ @oxleave                  @oxmove                   @oxtport                 
+ @ozenter                  @ozleave                  @pageformat              
 
 For more, see Entries-13
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-13
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- @prompt                   @ps                       @purge                   
- @quota                    @readcache                @receive                 
- @recycle                  @rejectmotd               @remit                   
- @restart                  @runout                   @rwall                   
- @scan                     @search                   @search2                 
- @search3                  @search4                  @search5                 
- @select                   @set                      @sex                     
- @shutdown                 @sitelock                 @sitelock2               
- @sitelock3                @speechmod                @sql                     
- @squota                   @startup                  @stats                   
- @success                  @sweep                    @switch                  
- @switch2                  @teleport                 @tport                   
- @trigger                  @trigger2                 @tz                      
- @ufail                    @ulock                    @undestroy               
- @unfollow                 @unlink                   @unlock                  
- @unrecycle                @uptime                   @uptime2                 
+ @pageformat2              @parent                   @password                
+ @payment                  @pcreate                  @pemit                   
+ @pemit2                   @poll                     @poor                    
+ @power                    @power2                   @power3                  
+ @prefix                   @pricelist                @prompt                  
+ @ps                       @purge                    @quota                   
+ @readcache                @receive                  @recycle                 
+ @rejectmotd               @remit                    @restart                 
+ @runout                   @rwall                    @scan                    
+ @search                   @search2                  @search3                 
+ @search4                  @search5                  @set                     
+ @sex                      @shutdown                 @sitelock                
+ @sitelock2                @sitelock3                @speechmod               
+ @sql                      @squota                   @startup                 
+ @stats                    @success                  @sweep                   
+ @switch                   @switch2                  @teleport                
 
 For more, see Entries-14
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-14
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- @use                      @uunlock                  @verb                    
- @verb2                    @verb3                    @verb4                   
- @version                  @vrml_url                 @wait                    
- @wait2                    @wait3                    @wall                    
- @warnings                 @warnings2                @warnings3               
- @wcheck                   @whereis                  @wipe                    
- @wizmotd                  @wizwall                  @zemit                   
- @zenter                   @zleave                   \                        
- ]                         ^                         ^-listens                
- `                         `2                        `3                       
- `4                        abode                     abs()                    
- accent()                  accent2                   accent3                  
- accent4                   accname()                 acos()                   
- action lists              action2                   add()                    
- after()                   ahelp                     alias()                  
- align()                   align2                    align3                   
+ @tport                    @trigger                  @trigger2                
+ @tz                       @ufail                    @ulock                   
+ @undestroy                @unfollow                 @unlink                  
+ @unlock                   @unrecycle                @uptime                  
+ @uptime2                  @use                      @uunlock                 
+ @verb                     @verb2                    @verb3                   
+ @verb4                    @version                  @vrml_url                
+ @wait                     @wait2                    @wait3                   
+ @wall                     @warnings                 @warnings2               
+ @warnings3                @wcheck                   @whereis                 
+ @wipe                     @wizmotd                  @wizwall                 
+ @zemit                    @zenter                   @zleave                  
+ \                         ]                         ^                        
+ ^-listens                 `                         `2                       
+ `3                        `4                        abode                    
+ abs()                     accent()                  accent2                  
 
 For more, see Entries-15
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-15
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- align4                    allof()                   alphamax()               
- alphamin()                ancestors                 and()                    
- andflags()                andlpowers()              anews                    
- angles                    anonymous attributes      anonymous2               
- anonymous3                anonymous4                ansi                     
- ansi()                    aposs()                   art()                    
- asin()                    atan()                    atan2()                  
- atrlock()                 attr trees                attr trees2              
- attr trees3               attr trees4               attrcnt()                
- attrib trees              attrib trees2             attrib trees3            
- attrib trees4             attrib-ownership          attrib_set()             
- attribute flags           attribute flags2          attribute flags3         
- attribute functions       attribute list            attribute trees          
- attribute trees2          attribute trees3          attribute trees4         
- attributes                attributes list           attributes2              
- attributes3               attributes4               attrpcnt()               
+ accent3                   accent4                   accname()                
+ acos()                    action lists              action2                  
+ add()                     after()                   ahelp                    
+ alias()                   align()                   align2                   
+ align3                    align4                    allof()                  
+ alphamax()                alphamin()                ancestors                
+ and()                     andflags()                andlflags()              
+ andlpowers()              anews                     angles                   
+ anonymous attributes      anonymous2                anonymous3               
+ anonymous4                ansi                      ansi()                   
+ aposs()                   art()                     asin()                   
+ atan()                    atan2()                   atrlock()                
+ attr trees                attr trees2               attr trees3              
+ attr trees4               attrcnt()                 attrib trees             
+ attrib trees2             attrib trees3             attrib trees4            
+ attrib-ownership          attrib_set()              attribute flags          
 
 For more, see Entries-16
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-16
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- audible                   band()                    baseconv()               
- beep()                    before()                  being killed             
- benchmark()               bitwise functions         bnand()                  
- bnot()                    boolean functions         boolean values           
- boolean2                  boolean3                  bor()                    
- bound()                   brackets()                brief                    
- builder                   buy                       bxor()                   
- caller                    cand()                    capstr()                 
- case()                    caseall()                 cat()                    
- cbuffer()                 cbufferadd()              cd                       
- cdesc()                   ceil()                    cemit()                  
- center()                  cflags()                  ch                       
- chan_usefirstmatch        changes                   channel functions        
- channel-list              channels()                charges2                 
- chat                      checkpass()               children()               
- chown_ok                  chr()                     clflags()                
+ attribute flags2          attribute flags3          attribute functions      
+ attribute list            attribute trees           attribute trees2         
+ attribute trees3          attribute trees4          attributes               
+ attributes list           attributes2               attributes3              
+ attributes4               attrpcnt()                audible                  
+ band()                    baseconv()                beep()                   
+ before()                  being killed              benchmark()              
+ bitwise functions         bnand()                   bnot()                   
+ boolean functions         boolean values            boolean2                 
+ boolean3                  bor()                     bound()                  
+ brackets()                brief                     builder                  
+ buy                       bxor()                    caller                   
+ cand()                    capstr()                  case()                   
+ caseall()                 cat()                     cbuffer()                
+ cbufferadd()              cd                        cdesc()                  
+ ceil()                    cemit()                   center()                 
 
 For more, see Entries-17
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-17
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- clients                   clock()                   clone()                  
- cloudy                    cmds()                    cmsgs()                  
- code                      color                     commands                 
- communication functions   comp()                    comsys                   
- con()                     cond()                    condall()                
- config()                  conn()                    connected                
- connection functions      contact                   control                  
- controls()                convsecs()                convtime()               
- convutcsecs()             copyright                 copyrite                 
- cor()                     cos()                     costs                    
- cowner()                  create()                  crecall()                
- credits                   csecs()                   cstatus()                
- ctime()                   ctitle()                  ctu()                    
- cusers()                  cv                        cwho()                   
- dark                      database                  dbref #                  
- dbref functions           dbref number              dbref2                   
+ cflags()                  ch                        chan_usefirstmatch       
+ changes                   channel functions         channel-list             
+ channel-privs             channels()                charges2                 
+ chat                      chat mogrifying           chat system              
+ checkpass()               children()                chown_ok                 
+ chr()                     clflags()                 clients                  
+ clock()                   clone()                   cloudy                   
+ cmds()                    cmsgs()                   code                     
+ color                     commands                  communication functions  
+ comp()                    comsys                    con()                    
+ cond()                    condall()                 config()                 
+ conn()                    connected                 connection functions     
+ contact                   control                   controls()               
+ convsecs()                convtime()                convutcsecs()            
+ copyright                 copyrite                  cor()                    
+ cos()                     costs                     cowner()                 
 
 For more, see Entries-18
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-18
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- dbrefs                    debug                     debug2                   
- debugforwardlist          dec()                     decode64()               
- decompose()               decrypt()                 default()                
- delete()                  desert                    destroy_ok               
- die()                     dig()                     digest()                 
- dismiss                   dist2d()                  dist3d()                 
- div()                     doing                     doing()                  
- download                  drop                      drop-tos                 
- droptos                   dynhelp()                 e()                      
- edefault()                edit()                    element()                
- elements()                elist()                   elock()                  
- emit()                    empty                     enactor                  
- encode64()                encrypt()                 endtag()                 
- enter                     enter_ok                  entrances()              
- eq()                      escape()                  etimefmt()               
- etimefmt2                 etimefmt3                 eval()                   
+ create()                  crecall()                 credits                  
+ csecs()                   cstatus()                 ctime()                  
+ ctitle()                  ctu()                     cusers()                 
+ cv                        cwho()                    dark                     
+ database                  dbref #                   dbref functions          
+ dbref number              dbref2                    dbrefs                   
+ debug                     debug2                    debugforwardlist         
+ dec()                     decode64()                decompose()              
+ decrypt()                 default()                 delete()                 
+ desert                    destroy_ok                die()                    
+ dig()                     digest()                  dismiss                  
+ dist2d()                  dist3d()                  div()                    
+ doing                     doing()                   download                 
+ drop                      drop-tos                  droptos                  
+ dynhelp()                 e()                       edefault()               
+ edit()                    element()                 elements()               
 
 For more, see Entries-19
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-19
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- evaluation order          evaluation2               events                   
- examine                   executor                  exit()                   
- exits                     exp()                     extract()                
- failure                   fdiv()                    filter()                 
- filterbool()              findable()                first()                  
- firstof()                 fixed                     flag list                
- flag permissions          flags                     flags list               
- flags()                   flags2                    flip()                   
- floating                  floor()                   floordiv()               
- fmod()                    fn()                      fold()                   
- fold2                     folderstats()             follow                   
- followers()               following()               foreach()                
- foreach2                  forwardlist               fraction()               
- fullalias()               fullname()                function list            
- functions                 functions()               functions2               
- gagged                    gender                    get                      
+ elist()                   elock()                   emit()                   
+ empty                     enactor                   encode64()               
+ encrypt()                 endtag()                  enter                    
+ enter_ok                  entrances()               eq()                     
+ escape()                  etimefmt()                etimefmt2                
+ etimefmt3                 eval()                    evaluation order         
+ evaluation2               events                    examine                  
+ executor                  exit()                    exits                    
+ exp()                     extract()                 failure                  
+ fdiv()                    filter()                  filterbool()             
+ findable()                first()                   firstof()                
+ fixed                     flag list                 flag permissions         
+ flags                     flags list                flags()                  
+ flags2                    flip()                    floating                 
+ floor()                   floordiv()                fmod()                   
+ fn()                      fold()                    fold2                    
 
 For more, see Entries-20
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-20
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- get()                     get_eval()                getpids()                
- give                      global commands           globals                  
- go                        going                     going_twice              
- goto                      grab()                    graball()                
- grep()                    grepi()                   gt()                     
- gte()                     halt                      hasattr()                
- hasattrp()                hasattrpval()             hasattrval()             
- hasflag()                 haspower()                hastype()                
- haven                     hear_connect              heavy                    
- height()                  help                      here                     
- hidden()                  home                      home()                   
- homes                     host()                    hostname()               
- html                      html functions            html()                   
- i18n                      idle                      idle()                   
- idlesecs()                if()                      ifelse()                 
- ilev()                    iname()                   inc()                    
+ folderstats()             follow                    followers()              
+ following()               foreach()                 foreach2                 
+ forwardlist               fraction()                fullalias()              
+ fullname()                function list             functions                
+ functions()               functions2                gagged                   
+ gender                    get                       get()                    
+ get_eval()                getpids()                 give                     
+ global commands           globals                   go                       
+ going                     going_twice               goto                     
+ grab()                    graball()                 grep()                   
+ grepi()                   gt()                      gte()                    
+ halt                      hasattr()                 hasattrp()               
+ hasattrpval()             hasattrval()              hasflag()                
+ haspower()                hastype()                 haven                    
+ hear_connect              heavy                     height()                 
+ here                      hidden()                  home                     
 
 For more, see Entries-21
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-21
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
+ home()                    homes                     host()                   
+ hostname()                html                      html functions           
+ html()                    huh_command               i18n                     
+ ibreak()                  idle                      idle()                   
+ idlesecs()                if()                      ifelse()                 
+ ilev()                    iname()                   inc()                    
  index                     index()                   info                     
  information functions     inherit                   insert()                 
  interiors                 interiors2                internationalization     
@@ -428,90 +434,98 @@
  isdaylight()              isdbref()                 isint()                  
  isnum()                   isobjid()                 isword()                 
  itemize()                 items()                   iter()                   
- iter2                     itext()                   judge                    
- jump_ok                   jury_ok                   keepalive                
- kill                      lalign()                  lambda                   
- last                      last & lastlogout         last()                   
- lastip                    lastlogout                lastsite                 
- lattr()                   lattrp()                  lcon()                   
- lcstr()                   ldelete()                 leave                    
- left()                    lemit()                   letq()                   
- lexits()                  lflags()                  license                  
+ iter2                     itext()                   itext2                   
+ judge                     jump_ok                   jury_ok                  
+ keepalive                 kill                      lalign()                 
 
 For more, see Entries-22
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-22
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- light                     link()                    link_ok                  
- linking                   list functions            list()                   
- listen_parent             listening                 listening2               
- listening3                lists                     lit()                    
- ljust()                   llockflags()              llocks()                 
- lmath()                   ln()                      lnum()                   
- loc()                     locale                    localize()               
- locate()                  locate2                   locate3                  
- lock keys                 lock list                 lock types               
- lock types2               lock()                    lockflags()              
- locking                   lockkeys                  locklist                 
- lockowner()               locks                     locks()                  
- locktypes                 locktypes2                log()                    
- logout                    look                      look2                    
- looping                   loud                      lparent()                
- lpids()                   lplayers()                lports()                 
+ lambda                    last                      last & lastlogout        
+ last()                    lastip                    lastlogout               
+ lastsite                  lattr()                   lattrp()                 
+ lcon()                    lcstr()                   ldelete()                
+ leave                     left()                    lemit()                  
+ letq()                    lexits()                  lflags()                 
+ license                   light                     link()                   
+ link_ok                   linking                   list functions           
+ list()                    listen_parent             listening                
+ listening2                listening3                lists                    
+ lit()                     ljust()                   llockflags()             
+ llocks()                  lmath()                   ln()                     
+ lnum()                    loc()                     locale                   
+ localize()                locate()                  locate2                  
+ locate3                   lock keys                 lock list                
+ lock types                lock types2               lock()                   
 
 For more, see Entries-23
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-23
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- lpos()                    lsearch()                 lsearch2                 
- lsearchr()                lset()                    lstats()                 
- lt()                      lte()                     lthings()                
- lvcon()                   lvexits()                 lvplayers()              
- lvthings()                lwho()                    lwhoid()                 
- macros                    macros2                   mail                     
- mail functions            mail()                    mail-admin               
- mail-folders              mail-forward              mail-other               
- mail-reading              mail-sending              maildstats()             
- mailfilter                mailfrom()                mailfstats()             
- mailsend()                mailstats()               mailstatus()             
- mailsubject()             mailtime()                malias()                 
- map()                     mapsql()                  master room              
- match()                   matchall()                matching                 
- math functions            max()                     me                       
- mean()                    median()                  member()                 
+ lockflags()               locking                   lockkeys                 
+ locklist                  lockowner()               locks                    
+ locks()                   locktypes                 locktypes2               
+ log()                     logout                    look                     
+ look2                     looping                   loud                     
+ lparent()                 lpids()                   lplayers()               
+ lports()                  lpos()                    lsearch()                
+ lsearch2                  lsearch3                  lsearchr()               
+ lset()                    lstats()                  lt()                     
+ lte()                     lthings()                 lvcon()                  
+ lvexits()                 lvplayers()               lvthings()               
+ lwho()                    lwhoid()                  macros                   
+ macros2                   mail                      mail functions           
+ mail()                    mail-admin                mail-folders             
+ mail-forward              mail-other                mail-reading             
+ mail-sending              maildstats()              mailfilter               
 
 For more, see Entries-24
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-24
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- merge()                   message()                 mid()                    
- min()                     mistrust                  mix()                    
- mix2                      mod()                     modulo()                 
- modulus()                 mogrifier                 mogrify                  
- money                     money()                   monitor                  
- move                      msecs()                   mssp-request             
- mtime()                   mudname()                 mul()                    
- munge()                   munge2                    munge3                   
- mushcode                  mushcode2                 mwho()                   
- mwhoid()                  myopic                    name()                   
- namegrab()                namegraball()             namelist()               
- nand()                    nattr()                   nattrp()                 
- ncand()                   nchildren()               ncon()                   
- ncond()                   ncondall()                ncor()                   
- nearby()                  neq()                     newbie                   
- newbie2                   newbie3                   news                     
+ mailfrom()                mailfstats()              maillist()               
+ mailsend()                mailsignature             mailstats()              
+ mailstatus()              mailsubject()             mailtime()               
+ malias()                  map()                     mapsql()                 
+ master room               match()                   matchall()               
+ matching                  math functions            max()                    
+ me                        mean()                    median()                 
+ member()                  merge()                   message()                
+ mid()                     min()                     mistrust                 
+ mix()                     mix2                      mod()                    
+ modulo()                  modulus()                 mogrifier                
+ mogrify                   mogrify2                  mogrify3                 
+ mogrify4                  money                     money()                  
+ monitor                   move                      msecs()                  
+ mssp-request              mtime()                   mudname()                
+ mudurl()                  mul()                     munge()                  
 
 For more, see Entries-25
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-25
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- nexits()                  next()                    nextdbref()              
- nlsearch()                nmwho()                   no_command               
- no_leave                  no_log                    no_tel                   
- no_warn                   noaccents                 noleave                  
- non-standard attributes   noname                    nor()                    
- nospace                   nospoof                   not()                    
- nowarn                    nplayers()                nsearch()                
+ munge2                    munge3                    mushcode                 
+ mushcode2                 mwho()                    mwhoid()                 
+ myopic                    name()                    namegrab()               
+ namegraball()             namelist()                nand()                   
+ nattr()                   nattrp()                  ncand()                  
+ nchildren()               ncon()                    ncond()                  
+ ncondall()                ncor()                    nearby()                 
+ neq()                     newbie                    newbie2                  
+ newbie3                   news                      nexits()                 
+ next()                    nextdbref()               nlsearch()               
+ nmwho()                   no_command                no_leave                 
+ no_log                    no_tel                    no_warn                  
+ noaccents                 noleave                   non-standard attributes  
+ noname                    nor()                     nospace                  
+ nospoof                   not()                     nowarn                   
+ nplayers()                nscemit()                 nsearch()                
+
+For more, see Entries-26
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
+& Entries-26
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  nsemit()                  nslemit()                 nsoemit()                
  nspemit()                 nsprompt()                nsremit()                
  nszemit()                 nthings()                 null()                   
@@ -521,11 +535,6 @@
  objects                   objeval()                 objid()                  
  objmem()                  oemit()                   on-vacation              
  opaque                    open()                    open_ok                  
-
-For more, see Entries-26
--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
-& Entries-26
--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  or()                      ord()                     ordinal()                
  orflags()                 orlflags()                orlpowers()              
  orphan                    outputprefix              outputsuffix             
@@ -533,6 +542,11 @@
  paranoid                  parent                    parent()                 
  parents                   parents2                  parents3                 
  parents4                  parents5                  parse()                  
+
+For more, see Entries-27
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
+& Entries-27
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  patchlevels               pcreate()                 pemit()                  
  pfun()                    pfun2                     pfun3                    
  pi()                      pickrand()                pidinfo()                
@@ -542,11 +556,6 @@
  poss()                    power()                   powers list              
  powers list2              powers()                  powers2                  
  prompt()                  prompt_newlines           pueblo                   
-
-For more, see Entries-27
--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
-& Entries-27
--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  pueblo features           pueblo()                  puppet                   
  puppets                   puppets2                  queue                    
  quiet                     quit                      quota()                  
@@ -554,6 +563,11 @@
  randword()                read                      recv()                   
  regedit()                 regeditall()              regeditalli()            
  regediti()                regexp                    regexp classes           
+
+For more, see Entries-28
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
+& Entries-28
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  regexp classes2           regexp examples           regexp syntax            
  regexp syntax2            regexp syntax3            regexp syntax4           
  regexp syntax5            regexp syntax6            regexp syntax7           
@@ -563,11 +577,6 @@
  regnattr()                regnattrp()               regrab()                 
  regraball()               regraballi()              regrabi()                
  regrep()                  regrepi()                                          
-
-For more, see Entries-28
--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
-& Entries-28
--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  regular expression functions                        regxattr()               
  regxattrp()               remainder()               remit()                  
  remove()                  repeat()                  replace()                
@@ -575,6 +584,11 @@
  restrict                  restrict2                 restrict3                
  reswitch()                reswitchall()             reswitchalli()           
  reswitchi()               reverse()                 revwords()               
+
+For more, see Entries-29
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
+& Entries-29
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  right()                   rjust()                   rloc()                   
  rnum()                    room()                    rooms                    
  root()                    round()                   royalty                  
@@ -582,40 +596,41 @@
  s()                       s-function                safe                     
  say                       scan()                    score                    
  scramble()                screenheight              screenwidth              
- search()                  search2                   secs()                   
- secure()                  semaphores                semaphores2              
-
-For more, see Entries-29
--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
-& Entries-29
--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- semaphores3               semaphores4               semaphores5              
- semaphores6               semipose                  sent()                   
- session                   set()                     setdiff()                
- setinter()                setq()                    setq2                    
- setq3                     setr()                    setting-attributes       
- setunion()                sex                       sha0()                   
- shared                    shared players            shared players2          
- shl()                     shr()                     shuffle()                
- sign()                    sin()                     slay                     
- socket commands           softcode                  sort()                   
- sortby()                  sorting                   sortkey()                
- soundex()                 soundex2                  soundlike()              
- soundslike()              space()                   speak()                  
- speak2                    speak3                    speak4                   
- speak5                    speak6                    speak7                   
- speakpenn()               spellnum()                splice()                 
+ search()                  search2                   search3                  
+ secs()                    secure()                  semaphores               
+ semaphores2               semaphores3               semaphores4              
+ semaphores5               semaphores6               semipose                 
+ sent()                    session                   set()                    
+ setdiff()                 setinter()                setq()                   
+ setq2                     setq3                     setr()                   
+ setting-attributes        setunion()                sex                      
+ sha0()                    shared                    shared players           
 
 For more, see Entries-30
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 & Entries-30
 -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
- spoofing                  sql examples              sql functions            
- sql()                     sqlescape()               sqrt()                   
- squish()                  ssl()                     stack                    
- starttime()               stats()                   stddev()                 
- step()                    sticky                    strallof()               
+ shared players2           shl()                     shr()                    
+ shuffle()                 sign()                    sin()                    
+ slay                      slev()                    socket commands          
+ softcode                  sort()                    sortby()                 
+ sorting                   sortkey()                 soundex()                
+ soundex2                  soundlike()               soundslike()             
+ space()                   speak()                   speak2                   
+ speak3                    speak4                    speak5                   
+ speak6                    speak7                    speakpenn()              
+ spellnum()                splice()                  spoofing                 
+ sql examples              sql functions             sql()                    
+ sqlescape()               sqrt()                    squish()                 
+ ssl()                     stack                     starttime()              
+ stats()                   stddev()                  step()                   
+ stext()                   sticky                    strallof()               
  strcat()                  strfirstof()              string functions         
+
+For more, see Entries-31
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
+& Entries-31
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  strings                   stringsecs()              strinsert()              
  stripaccents()            stripansi()               strlen()                 
  strmatch()                strreplace()              sub()                    
@@ -626,17 +641,17 @@
  t()                       table()                   tag()                    
  tagwrap()                 take                      tan()                    
  teach                     tel()                     tel_ok                   
-
-For more, see Entries-31
--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
-& Entries-31
--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  terminfo()                terse                     testlock()               
  textentries()             textfile()                things                   
  think                     time functions            time()                   
  timefmt()                 timefmt2                  timestring()             
  topics                    topics2                   tr()                     
  track_money               translation               transparent              
+
+For more, see Entries-32
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
+& Entries-32
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  trim()                    trimpenn()                trimtiny()               
  trunc()                   trust                     type()                   
  types                     types of objects          u()                      
@@ -647,17 +662,17 @@
  unfollow                  uninspected               unique()                 
  unregistered              unsetq()                  use                      
  user-defined commands     user-defined2             utctime()                
-
-For more, see Entries-32
--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
-& Entries-32
--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  utility functions         v()                       v-function               
  vadd()                    val()                     valid()                  
  vcross()                  vdim()                    vdot()                   
  vector functions          verbose                   verbs                    
  verbs2                    version()                 visible()                
  visual                    vmag()                    vmax()                   
+
+For more, see Entries-33
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
+& Entries-33
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  vmin()                    vmul()                    vrml                     
  vsub()                    vunit()                   warnings                 
  warnings list             warnings list2            where()                  
@@ -667,18 +682,18 @@
  with                      wizard                    wordpos()                
  words()                   wrap()                    xattr()                  
  xattrp()                  xcon()                    xexits()                 
- xget                      xmwho()                   xmwhoid()                
-
-For more, see Entries-33
--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
-& Entries-33
--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
+ xget()                    xmwho()                   xmwhoid()                
  xor()                     xplayers()                xthings()                
  xvcon()                   xvexits()                 xvplayers()              
  xvthings()                xwho()                    xwhoid()                 
  z_tel                     zemit()                   zfun()                   
  zmo                       zmp                       zmr                      
  zmt                       zmwho()                   zone                     
+
+For more, see Entries-34
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
+& Entries-34
+-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
  zone master objects       zone master rooms         zone masters             
  zone objects              zone()                    zones                    
  zones2                    zwho()                                             
Index: game/txt/hlp/pennfunc.hlp
===================================================================
--- game/txt/hlp/pennfunc.hlp	(.../184p1)	(revision 682)
+++ game/txt/hlp/pennfunc.hlp	(.../184p2)	(revision 682)
@@ -504,6 +504,7 @@
 
 See also: BOOLEAN VALUES, nand(), or(), xor(), not()
 & ANDFLAGS()
+& ANDLFLAGS()
   andflags(<object>, <string of flag letters>)
   andlflags(<object>, <list of flag names>)
   
@@ -1805,7 +1806,7 @@
   grep()/wildgrep()/regrep() are case-sensitive. 
   grepi()/wildgrepi()/regrepi() are case-insensitive.
   
-See also: lattr(), WILDCARDS
+See also: @grep, lattr(), WILDCARDS
 & GT()
   gt(<number>, <number>[, ... , <numberN>])
 
@@ -2013,6 +2014,7 @@
     > say insert(meep bleep gleep,-3,GOOP)
     You say, "meep GOOP bleep gleep"
 
+See also: replace(), ldelete(), strinsert()
 & ISDAYLIGHT()
   isdaylight()
 
@@ -2106,7 +2108,8 @@
   replacement occurs before substitution, it cannot be used well in nested
   iter()s, and should not be used on user input or untrusted <list>s, as the
   word will be evaluated. Instead, you can use the %iX substitution, or the 
-  itext() function.
+  itext() function. The substitution '%il' refers to the outermost iter
+  of the current expression, and is intended to replace ##.
   
   The string "#@" will be replaced with the position of the current word
   in <list>. Like "##", the replacement occurs before substitution. Use
@@ -2116,6 +2119,7 @@
   ilev() function can be used to get the current iter() nesting level.
 
   See 'help iter2' for examples.
+See also: itext(), inum(), ilev(), ibreak(), map(), @dolist
 & ITER2   
   Examples:
     > say iter(This is a test string., strlen(%i0))
@@ -2132,7 +2136,7 @@
     You say, "4 2 1 4 7"
 
   This example could be replaced by the use of map() like so:
-    > say map(strlen_fun, This is a test string)
+    > say map(strlen_fun, This is a test string.)
 
     > say iter(lnum(3), ##, ,%r)
     You say, "0
@@ -2140,8 +2144,25 @@
     2"
   
   parse() is an alias for iter().
+& IBREAK()
+  ibreak([<level>])
   
-See also: itext(), inum(), ilev(), map(), @dolist
+  The ibreak() function stops an iter() from running at the end of the
+  current loop. When used in nested iter()s, you can give a <level> to 
+  specify how many iter()s to break from. iter() will stop evaluating at the
+  end of the current loop, and NOT immediately after ibreak() is called.
+  
+  Examples:
+    > say iter(1 2 3 4 5,switch(%i0,3,ibreak())Test %i0!)
+    You say, "Test 1! Test 2! Test 3!"
+    
+    > say iter(1 2 3 4 5,switch(%i0,3,ibreak(),Test %i0!))
+    You say, "Test 1! Test 2! "
+    
+    > say iter(a b c, iter(1 2 3, switch(%i0%i1, 2c, ibreak(2), #$)))
+    You say, "1a 2a 3a 1b 2b 3b 1c "
+    
+See also: iter(), itext(), inum(), ilev()
 & ILEV()
 & ITEXT()
 & INUM()
@@ -2152,13 +2173,19 @@
   %i<n>
   inum(<n>)
 
-  These functions, when called within an iter(), return the equivalent
-  of ## (itext) or #@ (inum), with reference to the <n>th more outermost
-  iter(), where <n>=0 refers to the current iter(), <n>=1 to an iter() in
-  which the current iter() is nested, etc. %i<n> is shorthand for
-  itext(<n>) (up to itext(9)).  ilev() returns the current nesting depth,
-  or -1 if it is outside an iter().  Thus, itext(ilev()) will return
-  the ## of the outermost iter().
+  These functions return the equivilent of ## (itext) or #@ (inum) for iter()
+  and @dolist, where an <n>=0 returns to the current iter or @dolist, <n>=1 
+  refers to the iter()/@dolist which the current iter() or @dolist is nested
+  in, etc. An <n> of "L" can be used to refer to the outermost iter()/@dolist.
+  %i<n> is an alias for itext(<n>), where <n> can be from 0 to 9 (or "L").
+  
+  ilev() returns the current nesting depth, or -1 when used outside an iter()
+  or @dolist. Thus, itext(ilev()) will return the outermost ##, equivilent to
+  %iL.
+  
+  See 'help itext2' for examples.
+See also: iter(), ibreak(), @dolist
+& ITEXT2
 
   Examples:
     > say iter(red blue green, iter(fish shoe, #@:##))
@@ -2172,8 +2199,13 @@
   
     > say iter(red blue green,iter(fish shoe, %i1:%i0))
     You say, "red:fish red:shoe blue:fish blue:shoe green:fish green:shoe"
-  
-See also: iter()
+    
+    > @dolist red blue green=say iter(fish shoe, %i1:%i0)
+    You say, "red:fish red:shoe"
+		You say, "blue:fish blue:shoe"
+    You say, "green:fish green:shoe"
+    
+See also: iter(), @dolist
 & IPADDR()
   ipaddr(<player|descriptor>)
 
@@ -2220,7 +2252,7 @@
   due to buffer limits. In these cases, you can use nattr() and xattr() to
   retrieve the results in smaller pieces.
 
-See also: nattr(), xattr(), hasattr(), examine, wildcards
+See also: nattr(), xattr(), hasattr(), examine, grep(), wildcards
 & NATTR()
 & NATTRP()
 & ATTRCNT()
@@ -2290,7 +2322,8 @@
     You say, "This is a test string"
     > say ldelete(lemon|orange|pear|apple,2 3,|)
     You say, "lemon|apple"
-See also: delete(), remove()
+
+See also: delete(), remove(), insert()
 & LEFT()
   left(<string>, <length>)
 
@@ -2366,12 +2399,28 @@
 
 See also: @link, open()
 & LIST()
-  list(<option>)
- 
-  This function takes the same arguments as the @list command, and
-  returns the same things.
+  list(<option>[, <type>])
+
+  This is the function-equivilent of the @list command, and lists some useful
+  information about the MUSH. <option> can be one of:
   
-See also: @list, flags(), lflags(), config(), functions()
+  motd        : Returns the current @motd
+  wizmotd     : Returns the current @motd/wizard. Wiz/Roy only.
+  downmotd    : Returns the current @motd/down. Wiz/Roy only.
+  fullmotd    : Returns the current @motd/full. Wiz/Roy only.
+  functions   : Returns a list of all built-in functions and @functions.
+  commands    : Returns a list of all built-in commands and @commands.
+  attribs     : Returns all standard attributes.
+  locks       : Returns the built-in lock types. Similar to llocks().
+  flags       : Returns all flags. Similar to lflags().
+  powers      : Returns all @powers.
+
+  "commands"/"functions" return both built-in and local commands/functions by
+  default. You can specify a <type> of either "builtin", "local" or "all" to
+  limit this if you wish.
+
+See also: @list, flags(), lflags(), config(), functions(), @listmotd, @motd,
+  llocks()
 & LIT()
   lit(<string>)
 
@@ -2419,7 +2468,8 @@
 & LN()
   ln(<number>)
  
-  Returns the natural log of <number>.
+  Returns the natural log of <number>. This is equivilent to
+  log(<number>, e).
   
 See also: log()
 & LNUM()
@@ -2682,19 +2732,16 @@
   children(<object>)
   nchildren(<object>)
  
-  This function is similar to the @search command, except it returns
-  just a list of dbref numbers. Some uses are computationally expensive,
-  and cost 100 pennies; see 'help @search' for details. The function must
-  have at least three arguments.  Wizards can specify "all" or <player>
-  for the <player> field; mortals must use "me" or a ZMP whose @lock/zone
-  they pass. If you do not want to restrict something, use "none" for
-  <class> and <restriction>.
+  This function is similar to the @search command, except it returns just a
+  list of dbref numbers. The function must have at least three arguments. You
+  can specify "all" or <player> for the <player> field; for mortals, only
+  objects they can examine are included. If you do not want to restrict
+  something, use "none" for <class> and <restriction>.
 
-  The possible <class>es and <restriction>s are the same as those
-  accepted by @search. lsearch() can accept multiple class/restriction
-  pairs, and applies them in a boolean "AND" fashion, returning only
-  dbrefs that fulfill all restrictions. See 'help @search' for
-  information about them.
+  The possible <class>es and <restriction>s are the same as those accepted
+  by @search. lsearch() can accept multiple class/restriction pairs, and 
+  applies them in a boolean "AND" fashion, returning only dbrefs that
+  fulfill all restrictions. See 'help @search' for information about them.
 
   children() is exactly the same as lsearch([me|all], parent, <object>),
   using "all" for See_All/Search_All players and "me" for others.
@@ -2713,11 +2760,20 @@
   again for each object looked at in the search. Before the per-object
   evaluation, the string "##" is replaced with the object dbref.
 
+  lsearch() is free unless it includes either an eval-class search or
+  an elock search that contains an eval or indirect lock. Otherwise,
+  it costs find_cost pennies to perform the lsearch.
+
   lsearchr() is like an lsearch() run through revwords(). Results are
   returned from highest dbref to lowest.  search() is an alias for
   lsearch().
- 
-  Examples:
+
+  Examples in 'help lsearch3'.
+
+See also: @search, @find, lparent()
+& LSEARCH3
+& SEARCH3
+  lsearch() Examples:
   
   lsearch(all, flags, Wc)                  <-- lists all connected wizards.
   lsearch(me, type, room)                  <-- lists all rooms owned by me.
@@ -2725,6 +2781,13 @@
   lsearch(me, type, room, 100, 200)        <-- same, but only w/db# 100-200
   lsearch(all, eplayer, \[eq(money(##),100)\]) <-- lists all players with 100
                                                    coins.
+  lsearch(all, type, player, elock, (FLAG^WIZARD|FLAG^ROYALTY)&!FLAG^IC)
+                                           ^-- list all wiz and roy players
+                                               that are not IC.
+  lsearch(all, type, player, elock, sex:m*) <- lists all players with an
+                                               @sex beginning with 'm'
+  lsearch(me, elock, !desc:*)              <-- lists all objects you own that
+                                               don't have an @desc set
 & LSTATS()
 & STATS()
   lstats(<player>)
@@ -2799,12 +2862,11 @@
   lwhoid([<viewer>[, <status>]])
 
   lwho() returns a list of the dbref numbers for all currently-connected
-  players. When mortals use this function, the dbref numbers of DARK
+  players. When mortals use this function, the dbref numbers of hidden
   wizards or royalty do NOT appear on the dbref list.
 
-  If a <viewer> is given, and used by an object that can see DARK and
-  Hidden players, lwho() returns the output of lwho() from <viewer>'s
-  point of view.
+  If a <viewer> is given, and used by a See_All object, lwho() returns the
+  output of lwho() from <viewer>'s point of view.
   
   <status> can be used to include "#-1" dbrefs for unconnected ports, and
   must be one of "all", "online" or "offline". It is primarily useful when
@@ -3044,13 +3106,18 @@
 
 See also: ctime(), time(), secs(), convtime(), convsecs()
 & MUDNAME()
+& MUDURL()
   mudname()
- 
-  Returns the name of the MUSH, as set in the 'mud_name' @config option. 
+  mudurl()
+
+  These functions return the name of the MUSH and the MUSH's website address,
+  as set in the 'mud_name' and 'mud_url' @config options.
   
   Example: 
     > say mudname()
     You say, "TestMUSH"
+    > say mudurl()
+    You say, "http://www.testmush.com"
 
 see also: config()
 & MUL()
@@ -3320,14 +3387,14 @@
   nmwho()
 
   nwho() returns a count of all currently-connected players. When mortals 
-  use this function, DARK wizards or royalty are NOT counted. See_All players
-  can specify a <viewer> to get a count of the number of players that 
-  <viewer> can see is online.
+  use this function, hidden players are NOT counted. See_All players can 
+  specify a <viewer> to get a count of the number of players that <viewer>
+  can see is online.
   
-  nmwho() returns a count of all currently connected, non-hidden
-  players.  It's exactly the same as nwho() used by a mortal, and is
-  suitable for use on privileged global objects that always need an
-  unprivileged count of who is online.
+  nmwho() returns a count of all currently connected, non-hidden players.
+  It's exactly the same as nwho() used by a mortal, and is suitable for use
+  on privileged global objects that always need an unprivileged count of 
+  who is online.
 
   These functions are equivilent to words(lwho([<viewer>])) and 
   words(mwho()), but are more efficient, and don't suffer from buffer
@@ -3558,8 +3625,7 @@
     
   The <status> argument for lports() controls whether or not ports which
   are not connected to (ie, at the login screen) are included, and must be
-  one of "all", "online" or "offline". Only See_All players can see
-  unconnected ports.
+  one of "all", "online" or "offline".
 
   These port numbers also appear in the wizard WHO, and can be used
   with @boot/port, page/port, and the functions that return information
@@ -3753,6 +3819,7 @@
     > say replace(blue|red|green|yellow,3,white,|)
     You say, "blue|red|white|yellow"
   
+See also: ldelete(), setdiff(), splice()
 & REST()
   rest(<list>[, <delimiter>])
 
@@ -4220,6 +4287,7 @@
    owner   Sorts dbrefs by their owner dbrefs.
    loc     Sorts dbrefs by their location dbref.
    ctime   Sorts dbrefs by their creation time.
+   lattr   Sorts attribute names.
 
   The special sort key attr:<aname> or attri:<aname> will sort dbrefs
   according to their <aname> attributes. For example: Separating by
@@ -4816,7 +4884,7 @@
   These functions match <string> against the <expr>essions, returning
   the corresponding <list>. If nothing is matched, the <default> is returned.
   switch() and case() return the <str> for the first matching <expr>, while 
-  switchall() and condall() return the corresponding <list> for all <expr>s
+  switchall() and caseall() return the corresponding <list> for all <expr>s
   which match.
 
   switch() and switchall() use wildcard <expr>s, as described in 'help switch
@@ -4826,11 +4894,14 @@
   If the string "#$" appears in the <list> to be evaluated, it will be 
   replaced with the evaluated value of <str> /before/ evaluation of 
   <list>. This is not done in case() and caseall(), for TinyMUSH 3
-  compatibility.
+  compatibility. Note that this replacement happens before evaluation, which
+  makes it unsafe when <str> contains user input, and makes it unsuitable for
+  use in nested switch()es. It is strongly recommended you use the %$<n>
+  substitution or stext() function instead, which solves these problems.
   
   See 'help switch2' for examples.
  
-See also: reswitch(), if(), cond(), firstof()
+See also: reswitch(), stext(), slev(), if(), cond(), firstof()
 & SWITCH2
   Examples:
     > say switch(test, *a*, foo, *b*, bar, *t*, neat, baz)
@@ -4873,6 +4944,32 @@
   the greater/less than check).
 
 See also: WILDCARDS
+& STEXT()
+& SLEV()
+& %$
+& %$0
+  slev()
+  stext([<n>])
+  %$<n>
+  
+  slev() returns the current nesting depth of switch*(), reswitch*() and
+  @switch/@selects. stext() returns the <string> being matched for the
+  current switch, or the <n>th switch where n=0 is the current switch, n=1
+  is the switch the current switch is nested in, and so on. It is a safer
+  replacement for the "#$" token, which (because it is replaced before
+  evaluation) is unsafe with user input, and unsuitable for use in nested
+  switches.
+  
+  stext(L) returns the <string> for the outermost switch, and is equivilent
+  to stext(slev()). %$<n> is equivilent to stext(<n>), for <n>s of 0-9 or L.
+  
+  Example:
+    > &cmd.whois me=$whois *: @pemit %#=switch(pmatch(%0),#-*,
+                                    I don't know '%0', '%0' is %$0)
+    > @switch foo=f*, say switch(bar, b*,%$1 %$0!)
+    You say, "foo bar!"
+    
+See also: switch(), reswitch(), @switch
 & T()
   t(<expression>)
 
@@ -4959,7 +5056,7 @@
 See also: @lock, lock(), elock(), locktypes
 & TEXTFILE()
 & TEXTENTRIES()
-& dynhelp()
+& DYNHELP()
   textfile(<type>, <entry>)
   textentries(<type>, <pattern>[, <osep>])
 
@@ -5770,7 +5867,7 @@
   
     extract(lwho(), <start>, <count>)
 
-  xmwho() does not include dark or hidden players (like mwho()).
+  xmwho() does not include hidden players (like mwho()).
 
   xwhoid() and xmwhoid() return objids instead of dbrefs.
 
@@ -5781,10 +5878,9 @@
   zmwho(<object>)
 
   These functions return the dbrefs of all currently-connected players in
-  locations @chzone'd to <object>. zmwho() does not include dark or hidden
-  players, while zwho() returns all players that the caller can see are
-  online. You must be See_All or pass <object>'s @lock/zone to use these
-  functions.
+  locations @chzone'd to <object>. zmwho() does not include hidden players,
+  while zwho() returns all players that the caller can see are online. You
+  must be See_All or pass <object>'s @lock/zone to use these functions.
   
   See_All players can pass a <viewer> argument to zwho() to get only those
   players that <viewer> can see is online.
Index: game/txt/hlp/pennv184.hlp
===================================================================
--- game/txt/hlp/pennv184.hlp	(.../184p1)	(revision 682)
+++ game/txt/hlp/pennv184.hlp	(.../184p2)	(revision 682)
@@ -1,4 +1,4 @@
-& 1.8.4p1
+& 1.8.4p2
 & changes
 This is a list of changes in this patchlevel which are probably of
 interest to players. More information about new commands and functions
@@ -11,6 +11,87 @@
 A list of the patchlevels associated with each release can
 be read in 'help patchlevels'.
 
+Version 1.8.4 patchlevel 2                                 Dec 06,  2010
+
+Major Changes:
+ * Wildcard matcher completely rewritten to avoid hangs and to provide
+   ansi-aware capturing. [GM]
+ * connection_fail_limit now lets you limit the # of connection fails in
+   a 10 minute time by any given IP. [GM]
+
+Minor Changes:
+ * update-cnf.pl perl script now handles optional config lines, by placing
+   A # OPTIONAL above them. This is for message translation. [GM]
+ * Config options can now be marked as optional. If they don't exist,
+   Penn will not complain in the log. [MG]
+ * Player names with spaces no longer need to be in given in quotes for
+   @name. Suggested by Minion. [MG]
+ * @decompile no longer shows flags which can't be set by players, like
+   GOING and CONNECTED. [MG]
+ * %il substitution as preparation to get rid of ##. [GM]
+ * hardcode: call_attrib is now a wrapper around call_ufun. [GM]
+ * The %i<n> substitution, and itext()/inum()/ilev() functions, now work
+   for @dolist as well as iter(). [MG]
+ * iter() context (itext(), inum(), etc) is no longer propagated through
+   ufuns. [MG]
+ * @hook/overrides on huh_command are now matched against "huh_command" and
+   "huh_command <input>". From a suggestion by Mercutio. [MG]
+ * Various help fixes.
+ * @list and list() can now show only built-in or only local commands or
+   functions. Suggested by Trelane@M*U*S*H. [MG]
+ * Mortals can now use @search to find any objects they can examine.
+   Suggested by Paige. [MG]
+ * @function names can start with numbers again. Requested by Mercutio. [MG]
+ * @include and @break now work when entered directly from a client. [MG]
+ * The Drop and Give @locks now trigger verb <name>_LOCK`FAILURE attributes
+   when you fail to pass them, as described in 'help failure'. Suggested by 
+   Cas@BeforeTheDarkness. [MG]
+ * Set several attributes used internally AF_NOCOPY so they won't be included
+   in @decompile output. Suggested by Paige. [GM]
+ * The help for the chat system (@channel) has been rewritten. [MG]
+ * autodetect_list now returns 'm' sort for unknown list types instead of
+   alphanum, so sorting on strings will now treat numbers in them as
+   separate comparisons by default. [GM]
+ * setunion(), setdiff(), setinter() now autodetect lists in all cases where
+   no sort type is provided instead of just some cases. [GM]
+ * The pipe (|) character is no longer valid in channel names. [MG]
+
+Functions:
+ * ibreak(), for breaking out of an iter() loop. [Rhost] [MG]
+ * New stext() function and %$N sub, equivilent of #$ in @switch, switch*(),
+   and reswitch*(), but can be used in nested switches/on user input. [MG]
+ * New slev() function, returns the current nesting depth of switches. [MG]
+ * maillist() returns a list of @mail messages matching a range, as per
+   @mail/list. Suggested by AnneLions. [MG]
+ * New sorttype, lattr, sorts a list of attribute names. [MG]
+
+Commands:
+ * @channel/combine and @channel/uncombine let you combine spammy connect
+   messages for channels into one line. [SW] [GM]
+ * @grep now accepts /wild and /regexp switches, for wildcard/globbing and
+   regular expression greps (a la wildgrep() and regrep()). Also /nocase
+   for case-insensitive greps. Suggested by Paige. [MG]
+ * @attribute now allows limiting attribute values through /enum and
+   /limit switches. [GM]
+ * @ps <pid> shows info for a single queue entry. Suggested by Paige. [MG]
+   
+Fixes:
+ * Off-by-one bug in 'm' sort when using embedded numbers fixed. [GM]
+ * Debug output was sometimes sent to the wrong executor. [GM]
+ * A crashbug in @search was fixed. Reported by Paige. [GM]
+ * A crashbug in lpids() was fixed. Reported by Mercutio. Fixed by Javelin.
+ * @search elock class failed to report invalid lock strings. Fixed. [GM]
+ * @cpattr and @mvattr could break attribute trees. Reported by Sketch. [MG]
+ * benchmark() calculated the average incorrectly. Reported by Cheetah. [DC]
+ * map(), iter(), mix() and step() are ansi-aware, now. Using any of the
+   list functions without ansi should also be considerably faster. [GM]
+ * "look <container>'s <object>" incorrectly stopped working in p1 when
+   <object>'s desc was set "nearby". Reported by Yuriko@M*U*SH. [MG]
+ * Attribute names are now sorted better with regard to attribute trees,
+   hopefully fixing the recurring bug of @wipe leaving branch attributes
+   when removing a root attr for good. [MG]
+
+& 1.8.4p1
 Version 1.8.4 patchlevel 1                                 Sep 05,  2010
 
 Major Changes:
Index: game/txt/hlp/penntop.hlp
===================================================================
--- game/txt/hlp/penntop.hlp	(.../184p1)	(revision 682)
+++ game/txt/hlp/penntop.hlp	(.../184p2)	(revision 682)
@@ -616,15 +616,18 @@
       Global user-defined commands: all $-commands in the Master Room are
         matched. Local commands are always checked first and ALWAYS negate
         global commands.
+    If still nothing has matched, run huh_command to show a Huh? message
 
-  Because local commands overrule global commands, you can easily
-  prevent a global command from working in a specific room by setting
-  a copy of the global command in that room. Alternatively, if a
-  global command is oddly not working in a room, you should check for
+  Because local $-commands overrule global $-commands, you can easily
+  prevent a global $-command from working in a specific room by setting
+  a copy of the global $-command in that room. Alternatively, if a
+  global $-command is oddly not working in a room, you should check for
   copies of the command word in the room (using @scan). Wizards who want to
   ensure a global $-command always takes precedence over a local one should
   use @command/add and @hook/override, to make the command run as a regular
   game command instead of a softcoded global.
+  
+See also: @command, @hook, $-commands, huh_command
 & %!
 & EXECUTOR
   The executor of a command is the object actually carrying out the
@@ -1616,14 +1619,15 @@
   other character(s) or words are substituted for whatever follows the % 
   symbol. Some common substitutions are:
 
-     %B = a single space (just like [space(1)])
-     %R = a blank line
-     %T = A tab. Note that this may not look right on some screens.
+     %b = a single space (just like [space(1)])
+     %r = a blank line
+     %t = A tab. Note that this may not look right on some screens.
      %# = dbref of the ENACTOR (object that set off the command)
+     %n = the ENACTOR's name
      %N = the ENACTOR's name, first letter capitalized
-     %n = the ENACTOR's name, first letter as-is
      %~ = the ENACTOR's accented name
-     %: = the enactor's unique identifier, like objid(%#)
+     %: = the ENACTOR's unique identifier, like objid(%#)
+     %% = a literal %
      
   Case makes a difference in all substitutions; capitalizing the first
   letter after the % will capitalize the first letter of the resulting
@@ -1639,12 +1643,12 @@
      %p = possessive pronoun: his, her, its, their. Same as poss(%#).
      %a = absolute possessive: his, hers, its, theirs. Same as aposs(%#).
 
-    Case makes a difference: %S will return He, She, It, They. If you need
-    an actual % symbol, use %% to get it.
+    Case makes a difference: %S will return He, She, It, They.
 
   Some attributes can be retrieved via substitutions:
      %va-%vz = the contents of the object's VA-VZ attributes, respectively
      %wa-%wz, %xa-%xz = as above, for WA-WZ and XA-XZ
+  These are the equivilent of get(me/<attribute>).
 
 (continued in help substitutions3)
 & SUBSTITUTIONS3
@@ -1660,6 +1664,8 @@
     %? = The current function invocation and depth counts
     %+ = The number of arguments passed to the current ufun.
     %qN = the equivalent of r(N), a register set by a setq() function.
+    %iN = equivilent of itext(N), the list element for iter()/@dolist.
+    %$N = equivilent of stext(N), the <string> in switch()/@switch.
  
 (continued in help substitutions4)
 & SUBSTITUTIONS4
Index: game/txt/hlp/penncmd.hlp
===================================================================
--- game/txt/hlp/penncmd.hlp	(.../184p1)	(revision 682)
+++ game/txt/hlp/penncmd.hlp	(.../184p2)	(revision 682)
@@ -249,12 +249,19 @@
   @oufail <object>=[<message>]
   @aufail <object>=[<action list>]
  
-  Sets message shown to a player who fails to use an object via
-  the 'use' command (@ufail), message shown to others in the room
+  Sets the message shown to a player who fails to use an object via the 'use'
+  command (because they don't pass the @lock/use), the message shown to
+  others in the room when a player fails to use <object>, and the actions to
+  be taken by <object> when someone fails to use it, respectively.
 
   Note that these attributes are @ufail, NOT @ufailure, for
   TinyMUSH compatibility.
   
+  Although the Use @lock also restricts who can trigger $-commands or
+  ^-listens on an object, these attributes will not be triggered for those
+  failures. Instead, the COMMAND_LOCK`* and LISTEN_LOCK`* attributes are
+  triggered. See 'help failure' for more information.
+  
 See also: use, @use, FAILURE, ACTION LISTS, VERBS
 & @afailure
 & @ofailure
@@ -272,7 +279,7 @@
   "look" inside the room, though failure to pass the lock does not prevent
   the object from looking.
 
-See also: get, move, @lock, ACTION LISTS, VERBS, @succ
+See also: get, move, @lock, ACTION LISTS, VERBS, @success
 & @follow
 & @ofollow
 & @afollow
@@ -349,24 +356,23 @@
   @alias <player>[=<name1>[;<name2>[;...;<nameN>]]]
   @alias <object>[=<string>]
  
-  For players and exits, the ALIAS attribute has special meaning: it
-  contains a list of aliases (separated by semicolons) which can be
-  used instead of its name to refer to the player or exit.
+  For players and exits, the ALIAS attribute has special meaning: it contains
+  a list of aliases (separated by semicolons) which can be used instead of 
+  its name to refer to the player or exit.
   
-  The number of aliases allowed is controlled by the 'max_aliases'
-  @config option. The same rules which apply to player names also
-  apply to aliases, and you cannot use another player's name as your
-  alias (though you can include your own name in your aliases, and can
+  Players can only have a limited number of aliases; the number is controlled
+  by the 'max_aliases' @config option. The same rules which apply to player
+  names also apply to aliases, and you cannot use another player's name as
+  your alias (though you can include your own name in your aliases, and can
   change your name to one of your aliases).
   
-  If the page_aliases @config option is on, the first alias in the
-  list is shown along with the player's name when they page others.
+  If the 'page_aliases' @config option is on, the first alias in the list is 
+  shown along with the player's name when they page others.
   
-  Exits also support including the aliases directly in their name, but
-  doing so in new construction is depreciated and @alias should be used
-  instead.
+  Exits also support including the aliases directly in their name, but doing
+  so in new construction is depreciated and @alias should be used instead.
  
-  For other types of object, @alias has no special meaning.www
+  For other types of object, @alias has no special meaning.
 
 See also: @name, alias(), fullalias()
 & @allquota
@@ -546,6 +552,27 @@
   
   Only Wizards can modify the attribute table.
   
+  Continued in 'help @attribute3'.
+& @attribute3
+  @attribute/limit <attrib>=<regexp pattern>
+  @attribute/enum [<delim>] <attrib>=<list of choices>
+
+  @attribute/limit lets you restrict all _new_ values for an attribute to
+  those that match a regexp pattern. Case insensitive. (Use (?-i) to make
+  your regexp case-sensitive)
+
+  @attribute/enum lets you restrict all _new_ values for an attribute to
+  match an item in a list. It will also perform partial matching on the
+  list, much like a grab. Delimiter is optional, and defaults to a space.
+
+  Examples:
+
+    @attribute/enum sex=male female   <-- requires 'male' or 'female' as @sex
+    @attribute/enum | race=Wookie|Indy 500 <- Your race can be 'wookie' or
+                                              'Indy 500'
+    @attribute/limit score=^\\d+$    <-- @score can only contain digits.
+                                         (Remember, Penn parser eats a \)
+
 See also: ATTRIBUTEs, STANDARD ATTRIBUTES, attribute flags, @set, @atrchown
 & @ause
 & @use
@@ -1309,19 +1336,22 @@
   
   If the string "##" appears anywhere in <action list>, it will be replaced
   with the current element of <list>. The string "#@" is replaced with the
-  position of the current element in the list.
+  position of the current element in the list. Note that these replacements
+  occur before evaluation. It is recommended that you use the itext() and
+  inum() functions instead, which serve the same purpose but are replaced
+  during evaluation. You can also use itext/inum to refer to nested @dolists.
  
   If the /notify switch is given, the command "@notify me" is queued after 
   all copies of <action list> have been queued. This is useful for object
   synchronization with semaphores.
   
   Example:
-    > @dolist a b c=say ## is number #@
+    > @dolist a b c=say %i0 is number [inum(0)]
     You say, "a is number 1"
     You say, "b is number 2"
     You say, "c is number 3"
     
-See also: iter(), map(), @notify, SEMAPHORES, ACTION LISTS
+See also: iter(), itext(), map(), @notify, SEMAPHORES, ACTION LISTS
 & @drain
   @drain[/any][/all] <object>[/<attribute>][=<number>]
   
@@ -1414,8 +1444,6 @@
 See also: edit(), regedit(), ATTRIBUTES,
 & @elock
 & @eunlock
-  @eunlock <object>
-
   @elock <object>[=<key>]
   @eunlock <object>
   
@@ -1849,31 +1877,32 @@
 
 See also: RESTRICT, FUNCTIONS, @startup, fn()
 & @grep
-  @grep[/<switch>] <object>[/<attrs>]=<pattern>
+  @grep[/<switches>] <object>[/<attrs>]=<pattern>
   
-  This command searches attributes in an object for <pattern>. You must be
-  able to examine <object>. @grep takes four switches:
-  @grep/list
-    Lists the names of the attributes on the object containing <pattern>.
-    This is the default.
-  @grep/ilist
-    Same as above, but is case-insensitive when trying to match <pattern>.
-  @grep/print
-    Prints out all the attributes, ansi-highlighting the pattern itself.
-  @grep/iprint
-    Same as above, case-insensitive.
+  @grep returns a list of all attributes on <object> which match <pattern>.
+  If <attrs> is specified, only attributes which match the wildcard pattern
+  <attrs> are checked; it defaults to "*". Use "**" for all attributes.
+  
+  By default, attributes which contain the string <pattern> are returned.
+  However, if the /wild switch is given, <pattern> is treated as a wildcard
+  pattern, and attributes which match the pattern are returned. If the
+  /regexp switch is given, <pattern> is treated as a regular expression,
+  and attributes matching the regexp are returned. Please note that <pattern>
+  will NOT be evaluated, so you can easily grep for code strings.
+  
+  All matches are case-sensitive, unless the /nocase switch is given.
+  
+  @grep only shows a list of matching attributes. However, you can specify
+  the /print switch, in which case attribute values are also shown, with the
+  matching substrings ansi-highlighted if appropriate.
 
   Continued in 'help @grep2'.
 & @grep2
 
-  <attrs> is an optional wildcard pattern specifying attributes to check. If
-  <attrs> is not provided, it defaults to "*". Note that this does not
-  include attribute trees; use "**" to check branch attributes as well.
+  For backwards compatability, the /list switch provides the default
+  behaviour of listing attributes without printing the values, and /ilist and
+  /iprint are aliases for /list/nocase and /print/nocase.
    
-  <pattern> is not treated as a wildcard pattern, so you can grep for
-  patterns containing '*', '?', etc.  Also, <pattern> is NOT PARSED,
-  so '[v(0)]' and the like can be searched for.
-  
 See also: grep(), wildgrep(), regrep(), WILDCARDS
 & @halt
 & @allhalt
@@ -2000,11 +2029,37 @@
   You are in Room Zero. It's very dark here.
   You're done looking.
   
-  > &cmd.say #3=$say *: @remit %L=[if(hasflag(%#,OOC),<OOC>%b)]%n says, "%0"
+  > &cmd.say #3=$say *: @remit %L=if(hasflag(%#,OOC),<OOC>%b)%n says, "%0"
   > @hook/override say=#3, cmd.say
   > @set me=OOC
   > "test
   <OOC> Robert says, "test"
+& HUH_COMMAND
+
+  This internal command is run whenever someone attempts to run a command
+  which doesn't match any built-in or softcoded commands. The huh_command
+  command cannot be run directly, but it can be @hook'd to perform custom
+  actions when an invalid command is entered.
+  
+  Examples:
+    > &cmd.huh #0=$huh_command: @pemit/sil %#=Whu?
+    > @hook/override huh_command=#0, cmd.huh
+    > dsfsdf
+    Whu?
+    
+    > &cmd.huh #0=$huh_command *: @pemit/sil %#=Whu? What is '%0'?
+    > sdfsdf ert
+    Whu? What is 'sdfsdf ert'?
+    
+    > &cmd.huh #0=$huh_command *: &typos %#=add(default(%#/typos,0),1) ;
+      @pemit/sil %#=Huh? %b(Type "help" for help.) ;
+      @break mod(get(%#/typos),10) ; 
+      @wall %n wins %p [ordinal(div(get(%#/typos),10))] typo trophy!
+    > asfdsf (10 times)
+    Huh?  (Type "help" for help.)  (10 times)
+    Announcement: Room Zero shouts, "Dunce wins his first typo trophy!"
+
+See also: @hook, EVALUATION ORDER
 & @idle
   @idle <player>[=<message>]
 
@@ -2076,7 +2131,7 @@
     dbref instead of the executor's dbref, and requires control over
     the enactor or the Can_nspemit power.
 & @list
-  @list/<switch>[/lowercase]
+  @list/<switch>
   @list[/lowercase] <switch>
 
   The @list command lists useful MUSH information.
@@ -2084,7 +2139,7 @@
   Switches include:
   motd        : Alias for @listmotd, shows current messages of the day.
   functions   : Lists all built-in functions and @functions.
-  commands    : Lists all built-in commands.
+  commands    : Lists all built-in commands and @commands.
   attribs     : Lists all standard attributes.
   locks       : Lists the built-in lock types.
   flags       : Alias for @flag/list, shows all flags.
@@ -2093,6 +2148,9 @@
   
   By default, information is shown in upper-case. Add the /lowercase switch
   to show output in lowercase instead.
+  
+  "commands" and "functions" show built-in and local commands/functions by
+  default. The /builtin or /local switches can be given to limit this.
 
 See also: list(), @config, config(), functions(), @stats, @command,
     @function, @flag, @power, @attribute, @listmotd, @motd, locktypes
@@ -2572,10 +2630,6 @@
 
   Changes the name of <object> to <new name>.
 
-  When changing a player's name on games that support multi-word player
-  names, the name should be enclosed in quotes. For example:
-    > @name me="James Bond"
-
   Players can change their name to anything valid which is not currently in
   use by another player, as a name or alias. (They can change their name to
   something from their own @alias.)
@@ -2590,6 +2644,9 @@
     > @alias exit=east;e
     (Old-style)
     > @name exit=East <e>;east;e
+    
+  When <object>'s name is changed, its ONAME and ANAME verb attributes will
+  be triggered. See 'help @oname' for details.
   
 See also: @alias, @oname, name(), fullname()
 & @ONAME
@@ -2949,7 +3006,8 @@
 
 See also: @inprefix, AUDIBLE, @listen
 & @ps
-  @ps[/<switch>] [*<player>]
+  @ps[/<switch>] [<player>]
+  @ps <pid>
   
   @ps is a useful command for MUSHers.  It lists all commands currently on
   your 'to be executed' queue, thus allowing you to identify infinite (or
@@ -2962,8 +3020,10 @@
   the /all switch, and see the full queue. They may also specify a player.
   @ps/summary just displays the queue totals for the whole queue.
   @ps/quick displays the queue totals for just your queue.
+  
+  With a <pid> argument, @ps shows information on a single queue entry.
 
-  Each line includes the proccess id of the queue entry, the object
+  Each line includes the process id of the queue entry, the object
   and attribute being used as a semaphore (If any), the number of
   seconds left before it executes (For waits and semaphores), the
   object that is going to execute the entry, and the command.
@@ -3082,10 +3142,9 @@
   specifying <begin> and <end> as the first and last dbrefs to search.
   
   If a <player> argument is supplied, only objects owned by that player
-  will be listed.  Mortals can only search themselves or a ZMP whose
-  @lock/zone they pass. Those with the Search power can also specify "all"
-  to search all players. Defaults to "me" for mortals, and "all" for
-  players with the Search power.
+  will be listed, or all objects if "all" is used. Mortals attempting to
+  match other players (aside from ZMPs whose @lock/zone they pass) or "all"
+  will only get objects which they can examine.
   
   <class> and <restriction> arguments can be given to filter the match
   results. Possible <class>es include TYPE, NAME, ZONE, PARENT, EXITS,
@@ -3103,7 +3162,7 @@
   If <class>=PARENT, only children of parent <restriction> will be listed.
   For ZONE and PARENT, <restriction> must be specified as a dbref number.
   
-  'help @search2' for more.
+  Continued in 'help @search2'.
 & @search2
   If <class>=FLAGS or LFLAGS, only objects with the list of flags
   specified by <restriction> will be listed. For FLAGS, flags to match
@@ -3123,7 +3182,7 @@
   is a function, is replaced by each dbref sequentially. Classes EPLAYER,
   EROOM, EEXIT, and ETHING work like EVAL but are restricted to a single type.
   
-  See "help @search3" for more.
+  Continued in 'help @search3' for more.
 & @search3
   If <class>=MINDB, only objects with dbrefs of <restriction> or
   higher will be listed. If <class>=MAXDB, only objects with dbrefs
@@ -3140,7 +3199,7 @@
   If <class>=LISTEN, then @search will only return objects that respond to
   <restriction> through a listen.
 
-  See "help @search4" for more.
+  Continued in 'help @search4'.
 & @search4
   
   For the class TYPE=PLAYER, and for PLAYER=<player-name>, anyone may
@@ -3161,7 +3220,8 @@
   cost a number of pennies (the exact amount is configurable; see 
   @config find_cost).
   
-  See "help @search5" for some examples.
+  See 'help @search5' for some examples.
+See also: lsearch(), @find
 & @search5
   Examples:  
     @search all type=player,flags=W      <-- list all Wizard players
@@ -3174,31 +3234,6 @@
                                                   wizard or royalty flags.
     @search wizard_bc command=+who    <-- Forgot what object has your +who?
 
-See also: lsearch, lsearchr 
-& @select
-  @select <string>=<expr1>,<action1>[,<exprN>,<actionN>]...[,<default>]
-  This is similar to @switch, except it only executes the action
-  associated with the first expression which matches <string> - the
-  targets are mutually exclusive. If no target is matched, the default
-  actions are executed. This is equivalent to "@switch/first".
-
-  Example:
-    > &FOO thing = $foo *:@select %0=*a*,:acks,*b*,:bars,*c*,:cheeps,:glurps
-    > foo abc
-    thing acks
-    > foo xxx
-    thing glurps
-
-  The string "#$" in <action>'s will be expanded to the evaluated result
-  of <string> before it is acted on.
-
-  If the /notify switch is given, a "@notify me" is queued after 
-  the selected <action>. This is useful for synchronization with semaphores.
-
-  If the /regexp switch is given, the expressions are case-insensitive regular
-  expressions.
-
-See also: @switch, switch()
 & @set
   @set <object>=[!]<flag> [[!]<flag> ...]
   @<pre-defined attribute> <object>=<value>
@@ -3422,30 +3457,33 @@
   The "here" and "inventory" flags check only your location or
   inventory, respectively. "exits" only checks for AUDIBLE exits.
 & @switch
-  @switch [/<switch>] <string> = <expr1>, <action1> [,<exprN>, 
+  @switch[/<switch>] <string>=<expr1>, <action1> [,<exprN>, 
                                  <actionN>]... [,<default>]
-  For those of you familiar with programming, this command acts like
-  if/then/else or switch/case. It compares <string> against whatever
-  each <expr> evaluates to. If <string> and <expr> match, the action list
+  @select <string>=<expr1>, <action1> [,<exprN>, <actionN>]... [,<default>]
+  
+  For those of you familiar with programming, these command acts like
+  if/then/else or switch/case. It compares <string> against whatever each 
+  <expr> evaluates to. If <string> and <expr> match, the action list 
   associated with that <expr> is carried out. If no match is found, the
-  <default> action list is carried out. 
+  <default> action list is carried out. @switch runs <action>s for all
+  matching <expr>s by default, while @select only runs the <action> for the
+  first matching <expr>.
 
-  The string "#$" in <action>'s will be expanded to the evaluated result
-  of <string> before it is acted on.
+  The string "#$" in <action>'s will be replaced with the evaluated result
+  of <string> before it is acted on. Note that this replacement happens
+  BEFORE the <action> is queued and executed, and does not work well in
+  nested switches. It is recommended that you use the %$N substitution, or
+  the stext() function, instead.
   
-  @switch/all   will carry out the action lists for -all- of the 
-                expressions that match <string>. This is the default.
-  @switch/first will carry out the action list for only the -first-
-                expression that matches <string>. This is the same as
-                @select, and it is less computationally expensive than 
-                /all in many cases.
-  @switch/notify will cause a "@notify me" to be queued after 
-                the selected <action>. 
-  @switch/regexp will cause the expressions to be matched as case-insensitive
-                 regular expressions.
+  @switch/all   runs <action>s for all matching <expr>s. Default for @switch.
+  @switch/first runs <action> for the first matching <expr> only. Same as
+                @select, and often the desired behaviour.
+  @switch/notify queues "@notify me" after the last <action>. 
+  @switch/regexp makes <expr>s case-insensitive regular expressions, not
+                 wildcard/glob patterns.
 
   See 'help @switch2' for examples.
-See also: switch wildcards, @select, switch(), @break
+See also: switch wildcards, switch(), @break, stext(), slev()
 & @switch2
   Examples: 
     > &SWITCH_EX thing=$foo *: @switch %0=*a*, :acks, *b*, :bars, :glurps
@@ -3521,18 +3559,27 @@
 
 See also: @include, ufun()
 & @ulock
+& @uunlock
   @ulock <object>[=<key>]
+  @uunlock <object>
 
-  This is an abbreviation of @lock/use.
-
-  This lock determines who is allowed to "use" the object or to set off
-  any of the $-commands on the object. 
+  These commands set the Use lock for <object> to <key>, or clear the Use
+  lock. They are equivilent to
+    @lock/use <object>[=<key>]
+  and
+    @lock/use <object>
+    
+  The Use lock determines who is allowed to "use" the object or trigger any
+  $-commands or ^-listens on the object.
+  
+  To only lock who can use $-commands, use @lock/command. To only lock who
+  can trigger ^-listens, use @lock/listen.
 
   Example: if I want everyone but Bob to be able to use my toy, I would
   "@ulock toy=!*Bob". If I want only Bob to be able to use it, I would
-  "@ulock toy=*Bob".
+  "@ulock toy==*Bob".
 
-See also: @lock, @uunlock, locktypes
+See also: @lock, use, locktypes
 & @uptime
   @uptime[/mortal]
   
@@ -3576,12 +3623,6 @@
   Removes the lock on <object>. It can take as many switches as @lock can. 
 
 See also: @lock, locktypes
-& @uunlock
-  @uunlock <object>
-
-  Un-use-locks the object.
-  
-See also: @lock, @ulock
 & @version
   @version
   Tells the player the name of the MUSH, which version of the code is 
Index: game/txt/hlp/pennvOLD.hlp
===================================================================
--- game/txt/hlp/pennvOLD.hlp	(.../184p1)	(revision 682)
+++ game/txt/hlp/pennvOLD.hlp	(.../184p2)	(revision 682)
@@ -4417,7 +4417,7 @@
 For information on a specific patchlevel of one of the versions listed,
 type 'help <version>p<patchlevel>'. For example, 'help 1.7.2p3'
 
-1.8.4: 0, 1
+1.8.4: 0, 1, 2
 1.8.3: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13
 1.8.2: 0, 1, 2, 3, 4, 5, 6, 7, 8
 1.8.1: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10
Index: game/mushcnf.dst
===================================================================
--- game/mushcnf.dst	(.../184p1)	(revision 682)
+++ game/mushcnf.dst	(.../184p2)	(revision 682)
@@ -211,9 +211,19 @@
 ### Limits, costs, and other constants
 ###
 
-# name of the monetary units
-money_singular Penny
-money_plural Pennies
+# name of the monetary units. Uncomment before changing. By leaving it
+# commented, the translated value will be used.
+# OPTIONAL
+# money_singular Penny
+# money_plural Pennies
+
+# How many times in a 10 minute period should a given IP address be
+# allowed to attempt to log in before being rejected?
+# If you want this to really be successful, you should probably also
+# block Tor exit nodes at the firewall level:
+# http://doc.norang.ca/iptables.html#sec-3
+# Set to 0 for unlimited.
+connect_fail_limit 10
 
 # Should there be a limit on how long players can be idle?
 # If you want one, set idle_timeout to the # number of MINUTES 
@@ -433,10 +443,13 @@
 # leave messages you don't want blank, but don't comment
 # them out or remove them from the file or you'll get the
 # default messages.
-dump_warning_5min GAME: Database save in 5 minutes.
-dump_warning_1min GAME: Database save in 1 minute.
-dump_message GAME: Saving database. Game may freeze for a few moments.
-dump_complete GAME: Save complete. 
+# Leaving these undefined lets the game use the default, translated
+# messages.
+# OPTIONAL
+# dump_warning_5min GAME: Database save in 5 minutes.
+# dump_warning_1min GAME: Database save in 1 minute.
+# dump_message GAME: Saving database. Game may freeze for a few moments.
+# dump_complete GAME: Save complete. 
 
 
 ### 
@@ -734,9 +747,11 @@
 exits_connect_rooms no
 
 # Prefixes for various broadcast messages
-wizwall_prefix Broadcast:
-rwall_prefix Admin:
-wall_prefix Announcement:
+# Leaving these commented lets the game use the translated default messages.
+# OPTIONAL
+# wizwall_prefix Broadcast:
+# rwall_prefix Admin:
+# wall_prefix Announcement:
 
 # Should we announce connections/disconnections to rooms and on channels?
 # If this is disabled, only MONITOR players will see connect/disconnect.
Index: po/sv_SE.pox
===================================================================
--- po/sv_SE.pox	(.../184p1)	(revision 682)
+++ po/sv_SE.pox	(.../184p2)	(revision 682)
@@ -293,10 +293,6 @@
 msgid "#-1 NO SUCH TYPE"
 msgstr "#-1 INGEN SDAN TYP"
 
-#: src/funufun.c:310
-msgid "#-1 NO SUCH USER FUNCTION"
-msgstr "#-1 INGEN SDAN ANVNDARFUNKTION"
-
 #: src/bsd.c:4485 src/bsd.c:4498
 msgid "#-1 NOT CONNECTED"
 msgstr "#-1 EJ UPPKOPPLAD"
@@ -1520,22 +1516,6 @@
 msgid "GAME: Database consistency check complete."
 msgstr "SPEL: Databasens integritetskontroll utfrd."
 
-#: src/conf.c:570
-msgid "GAME: Database will be dumped in 1 minute."
-msgstr "SPEL: Databasen kommer att dumpas om 1 minut."
-
-#: src/conf.c:572
-msgid "GAME: Database will be dumped in 5 minutes."
-msgstr "SPEL: Databasen kommer att dumpas om 5 minuter."
-
-#: src/conf.c:502
-msgid "GAME: Dump complete. Time in."
-msgstr "SPEL: Dump klar. Fortstt."
-
-#: src/conf.c:501
-msgid "GAME: Dumping database. Game may freeze for a minute"
-msgstr "SPEL: Dumpar databasen. Spelet kan lsa sig ngon minut."
-
 #: game.c:311
 msgid "GAME: ERROR! Database save failed!"
 msgstr "SPEL: FEL! Sparning av databas misslyckades!"
Index: po/ro_RO.pox
===================================================================
--- po/ro_RO.pox	(.../184p1)	(revision 682)
+++ po/ro_RO.pox	(.../184p2)	(revision 682)
@@ -248,10 +248,6 @@
 msgid "#-1 NO SUCH TYPE"
 msgstr "#-1 NU EXISTA ASEMENEA TIP"
 
-#: src/funufun.c:310
-msgid "#-1 NO SUCH USER FUNCTION"
-msgstr "#-1 NU EXISTA ASEMENEA FUNCTIE USER"
-
 #: src/bsd.c:4485 src/bsd.c:4498
 msgid "#-1 NOT CONNECTED"
 msgstr "#-1 NU ESTE CONECTAT"
Index: po/pennmush.pot
===================================================================
--- po/pennmush.pot	(.../184p1)	(revision 682)
+++ po/pennmush.pot	(.../184p2)	(revision 682)
@@ -8,7 +8,7 @@
 msgstr ""
 "Project-Id-Version: PACKAGE VERSION\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2010-08-29 02:00-0500\n"
+"POT-Creation-Date: 2010-12-05 02:00-0600\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
@@ -115,242 +115,296 @@
 msgid "Unknown access option: %s"
 msgstr ""
 
-#: atr_tab.c:216 atr_tab.c:293 atr_tab.c:371
+#: atr_tab.c:265
+msgid "Attribute value does not match the /limit regexp."
+msgstr ""
+
+#: atr_tab.c:274 atr_tab.c:310
+#, c-format
+msgid "Value for %s needs to be one of: %s"
+msgstr ""
+
+#: atr_tab.c:355
+msgid "Invalid Regular Expression."
+msgstr ""
+
+#: atr_tab.c:369
+msgid "Delimiter must be one character."
+msgstr ""
+
+#: atr_tab.c:394
+msgid "Unknown limit type?"
+msgstr ""
+
+#: atr_tab.c:403 atr_tab.c:474 atr_tab.c:551 atr_tab.c:634
 msgid "Which attribute do you mean?"
 msgstr ""
 
-#: atr_tab.c:222 flags.c:2089 flags.c:2099 flags.c:2259 flags.c:2270
+#: atr_tab.c:416
+msgid ""
+"I don't know that attribute. Please use @attribute/access to create it, "
+"first."
+msgstr ""
+
+#: atr_tab.c:422
+msgid "That attribute's permissions cannot be changed."
+msgstr ""
+
+#: atr_tab.c:435
+#, c-format
+msgid "%s -- Attribute limit or enum unset."
+msgstr ""
+
+#: atr_tab.c:438
+#, c-format
+msgid "%s -- Attribute limit or enum already unset."
+msgstr ""
+
+#: atr_tab.c:446
+#, c-format
+msgid "%s -- Attribute %s set to: %s"
+msgstr ""
+
+#: atr_tab.c:480 flags.c:2092 flags.c:2102 flags.c:2262 flags.c:2273
 msgid "I don't understand those permissions."
 msgstr ""
 
-#: atr_tab.c:232
+#: atr_tab.c:490
 msgid "That attribute's permissions can not be changed."
 msgstr ""
 
-#: atr_tab.c:238 atr_tab.c:330
+#: atr_tab.c:496 atr_tab.c:593
 msgid "Invalid attribute name."
 msgstr ""
 
-#: atr_tab.c:244
+#: atr_tab.c:502
 msgid "Critical memory failure - Alert God!"
 msgstr ""
 
-#: atr_tab.c:275
+#: atr_tab.c:533
 #, c-format
 msgid "%s -- Attribute permissions now: %s"
 msgstr ""
 
-#: atr_tab.c:300 atr_tab.c:344 atr_tab.c:382
+#: atr_tab.c:558 atr_tab.c:607 atr_tab.c:645
 msgid "That attribute isn't in the attribute table"
 msgstr ""
 
-#: atr_tab.c:306
+#: atr_tab.c:569
 #, c-format
 msgid "Removed %s from attribute table."
 msgstr ""
 
-#: atr_tab.c:323
+#: atr_tab.c:586
 msgid "Which attributes do you mean?"
 msgstr ""
 
-#: atr_tab.c:337
+#: atr_tab.c:600
 #, c-format
 msgid "The name %s is already used in the attribute table."
 msgstr ""
 
-#: atr_tab.c:355
+#: atr_tab.c:618
 #, c-format
 msgid "Renamed %s to %s in attribute table."
 msgstr ""
 
-#: atr_tab.c:385
+#: atr_tab.c:648
 msgid "Attribute"
 msgstr ""
 
-#: atr_tab.c:387 cmds.c:386 cmds.c:555 game.c:2372
+#: atr_tab.c:650
+msgid "Limit"
+msgstr ""
+
+#: atr_tab.c:652
+msgid "Enum"
+msgstr ""
+
+#: atr_tab.c:655 cmds.c:396 cmds.c:585 game.c:2398
 msgid "Flags"
 msgstr ""
 
-#: atr_tab.c:389
+#: atr_tab.c:657
 msgid "Creator"
 msgstr ""
 
-#: atr_tab.c:404
+#: atr_tab.c:672
 #, c-format
 msgid "Attribs: %s"
 msgstr ""
 
-#: attrib.c:1791 look.c:822 look.c:1580
+#: attrib.c:1796 look.c:823 look.c:1581
 msgid "Garbage is garbage."
 msgstr ""
 
-#: attrib.c:1806 attrib.c:1813 attrib.c:1831
+#: attrib.c:1811 attrib.c:1818 attrib.c:1836
 #, c-format
 msgid "'%s' is not a valid alias."
 msgstr ""
 
-#: attrib.c:1816 attrib.c:1834
+#: attrib.c:1821 attrib.c:1839
 #, c-format
 msgid "'%s' contains too many aliases."
 msgstr ""
 
-#: attrib.c:1819 attrib.c:1837
+#: attrib.c:1824 attrib.c:1842
 msgid "Null aliases are not valid."
 msgstr ""
 
-#: attrib.c:1851
+#: attrib.c:1856
 #, c-format
 msgid "'%s' is not a valid exit name."
 msgstr ""
 
-#: attrib.c:1868
+#: attrib.c:1873
 #, c-format
 msgid "%s should contain only dbrefs."
 msgstr ""
 
-#: attrib.c:1873
+#: attrib.c:1878
 #, c-format
 msgid "Invalid dbref #%d in %s."
 msgstr ""
 
-#: attrib.c:1878
+#: attrib.c:1883
 #, c-format
 msgid "I don't think #%d wants to hear from %s."
 msgstr ""
 
-#: attrib.c:1883
+#: attrib.c:1888
 #, c-format
 msgid "I don't think #%d wants %s's mail."
 msgstr ""
 
-#: attrib.c:1897 set.c:1149
+#: attrib.c:1911 set.c:1148
 #, c-format
 msgid "Attribute %s is SAFE. Set it !SAFE to modify it."
 msgstr ""
 
-#: attrib.c:1904
+#: attrib.c:1918
 #, c-format
 msgid "Unable to remove '%s' because of a protected tree attribute."
 msgstr ""
 
-#: attrib.c:1910
+#: attrib.c:1924
 #, c-format
 msgid ""
 "Unable to set '%s' because of a failure to create a needed parent attribute."
 msgstr ""
 
-#: attrib.c:1915
+#: attrib.c:1929
 msgid "That's not a very good name for an attribute."
 msgstr ""
 
-#: attrib.c:1920
+#: attrib.c:1934
 #, c-format
 msgid "You must set %s first."
 msgstr ""
 
-#: attrib.c:1923
+#: attrib.c:1937
 #, c-format
 msgid "%s is a branch attribute; remove its children first."
 msgstr ""
 
-#: attrib.c:1926
+#: attrib.c:1940
 msgid "That attribute cannot be changed by you."
 msgstr ""
 
-#: attrib.c:1929
+#: attrib.c:1943
 msgid "Too many attributes on that object to add another."
 msgstr ""
 
-#: attrib.c:1932
+#: attrib.c:1946
 msgid "No such attribute to reset."
 msgstr ""
 
-#: attrib.c:1941 command.c:1898
+#: attrib.c:1955 command.c:1900
 msgid "Alias set."
 msgstr ""
 
-#: attrib.c:1943
+#: attrib.c:1957
 msgid "Alias removed."
 msgstr ""
 
-#: attrib.c:1956
+#: attrib.c:1970
 #, c-format
 msgid "%s loses its ears and becomes deaf."
 msgstr ""
 
-#: attrib.c:1960
+#: attrib.c:1974
 #, c-format
 msgid "%s grows ears and can now hear."
 msgstr ""
 
-#: attrib.c:1968
+#: attrib.c:1982
 msgid "Set"
 msgstr ""
 
-#: attrib.c:1968
+#: attrib.c:1982
 msgid "Cleared"
 msgstr ""
 
-#: attrib.c:1998 attrib.c:2005 attrib.c:2071 attrib.c:2078
+#: attrib.c:2012 attrib.c:2019 attrib.c:2085 attrib.c:2092
 msgid "You need to give an object/attribute pair."
 msgstr ""
 
-#: attrib.c:2016 attrib.c:2089 bsd.c:2890 bsd.c:2936 bsd.c:4217 bsd.c:4751
-#: bsd.c:4784 bsd.c:4796 bsd.c:4801 cmds.c:78 cmds.c:83 cmds.c:88
-#: command.c:1700 command.c:1727 command.c:1819 command.c:1901 command.c:2063
-#: cque.c:954 cque.c:1056 cque.c:1107 cque.c:1560 cque.c:1618 cque.c:1735
-#: create.c:100 create.c:119 create.c:237 create.c:302 create.c:311
-#: create.c:315 create.c:367 create.c:371 create.c:389 create.c:625
-#: destroy.c:234 destroy.c:893 extchat.c:1776 extchat.c:1793 extchat.c:1824
-#: extchat.c:3882 flags.c:1543 flags.c:1548 flags.c:1707 function.c:1036
-#: function.c:1290 function.c:1514 function.c:1659 function.c:1705
-#: function.c:1752 funmisc.c:883 game.c:961 game.c:1533 lock.c:714 lock.c:778
-#: lock.c:974 look.c:1340 look.c:1629 malias.c:764 malias.c:869 match.c:478
-#: move.c:539 move.c:868 move.c:883 predicat.c:1231 predicat.c:1426 rob.c:428
-#: set.c:193 set.c:972 set.c:1055 set.c:1092 set.c:1105 set.c:1190
-#: speech.c:1516 warnings.c:294 warnings.c:515 wiz.c:444 wiz.c:567 wiz.c:578
+#: attrib.c:2030 attrib.c:2103 bsd.c:2879 bsd.c:2925 bsd.c:4206 bsd.c:4740
+#: bsd.c:4773 bsd.c:4785 bsd.c:4790 cmds.c:78 cmds.c:83 cmds.c:88 cmds.c:93
+#: cmds.c:98 command.c:1702 command.c:1729 command.c:1821 command.c:1903
+#: command.c:2074 cque.c:1013 cque.c:1115 cque.c:1166 cque.c:1553 cque.c:1666
+#: cque.c:1724 cque.c:1841 create.c:100 create.c:119 create.c:237 create.c:302
+#: create.c:311 create.c:315 create.c:367 create.c:371 create.c:389
+#: create.c:625 destroy.c:234 destroy.c:893 extchat.c:1777 extchat.c:1794
+#: extchat.c:1825 extchat.c:3980 flags.c:1545 flags.c:1550 flags.c:1710
+#: function.c:1038 function.c:1292 function.c:1516 function.c:1661
+#: function.c:1707 function.c:1754 funmisc.c:957 game.c:961 game.c:1533
+#: lock.c:715 lock.c:779 lock.c:975 look.c:1341 look.c:1630 malias.c:764
+#: malias.c:869 match.c:483 move.c:539 move.c:870 move.c:885 predicat.c:1249
+#: rob.c:429 set.c:188 set.c:971 set.c:1054 set.c:1091 set.c:1104 set.c:1189
+#: speech.c:1517 warnings.c:294 warnings.c:515 wiz.c:444 wiz.c:567 wiz.c:578
 #: wiz.c:852 wiz.c:1017 wiz.c:1047
 msgid "Permission denied."
 msgstr ""
 
-#: attrib.c:2024
+#: attrib.c:2038
 #, c-format
 msgid "That attribute is %slocked."
 msgstr ""
 
-#: attrib.c:2030
+#: attrib.c:2044
 msgid "You need to be able to set the attribute to change its lock."
 msgstr ""
 
-#: attrib.c:2037
+#: attrib.c:2051
 msgid "Attribute locked."
 msgstr ""
 
-#: attrib.c:2042
+#: attrib.c:2056
 msgid "Attribute unlocked."
 msgstr ""
 
-#: attrib.c:2046
+#: attrib.c:2060
 msgid "Invalid status on atrlock.. Notify god."
 msgstr ""
 
-#: attrib.c:2052 attrib.c:2122 set.c:987 set.c:1034
+#: attrib.c:2066 attrib.c:2136 set.c:986 set.c:1033
 msgid "No such attribute."
 msgstr ""
 
-#: attrib.c:2099
+#: attrib.c:2113
 msgid "I can't find that player"
 msgstr ""
 
-#: attrib.c:2108
+#: attrib.c:2122
 msgid "You can only chown an attribute to yourself."
 msgstr ""
 
-#: attrib.c:2113
+#: attrib.c:2127
 msgid "Attribute owner changed."
 msgstr ""
 
-#: attrib.c:2117
+#: attrib.c:2131
 msgid "You don't have the permission to chown that."
 msgstr ""
 
@@ -383,7 +437,7 @@
 msgid "%s lock has indirect lock to %s/%s that it can't read"
 msgstr ""
 
-#: bsd.c:263 player.c:128
+#: bsd.c:263 player.c:201
 msgid "Either that player does not exist, or has a different password."
 msgstr ""
 
@@ -436,468 +490,463 @@
 "Quit...%d  Register...%d  Down...%d  Full...%d"
 msgstr ""
 
-#: bsd.c:2509
+#: bsd.c:2498
 #, c-format
 msgid "%ld failed connections since last login."
 msgstr ""
 
-#: bsd.c:2522
+#: bsd.c:2511
 msgid "Your HAVEN flag is set. You cannot receive pages."
 msgstr ""
 
-#: bsd.c:2526
+#: bsd.c:2515
 msgid "Welcome back from vacation! Don't forget to unset your ON-VACATION flag"
 msgstr ""
 
-#: bsd.c:2833 wiz.c:864
+#: bsd.c:2822 wiz.c:864
 msgid "You are politely shown to the door."
 msgstr ""
 
-#: bsd.c:2842
+#: bsd.c:2831
 msgid "You boot an idle self."
 msgstr ""
 
-#: bsd.c:2844
+#: bsd.c:2833
 #, c-format
 msgid "You boot %d idle selves."
 msgstr ""
 
-#: bsd.c:2896 bsd.c:2947
+#: bsd.c:2885 bsd.c:2936
 msgid "That's not a port number."
 msgstr ""
 
-#: bsd.c:2906
+#: bsd.c:2895
 msgid "That port is not active."
 msgstr ""
 
-#: bsd.c:2911 speech.c:577
+#: bsd.c:2900 speech.c:577
 #, c-format
 msgid "You pemit \"%s\" to %s."
 msgstr ""
 
-#: bsd.c:2912 bsd.c:2993 bsd.c:2999
+#: bsd.c:2901 bsd.c:2982 bsd.c:2988
 msgid "a connecting player"
 msgstr ""
 
-#: bsd.c:2952 bsd.c:2964
+#: bsd.c:2941 bsd.c:2953
 msgid "What do you want to page with?"
 msgstr ""
 
-#: bsd.c:2982
+#: bsd.c:2971
 msgid "That port's not active."
 msgstr ""
 
-#: bsd.c:2989
+#: bsd.c:2978
 #, c-format
 msgid "From afar, %s%s%s"
 msgstr ""
 
-#: bsd.c:2991 speech.c:1045
+#: bsd.c:2980 speech.c:1046
 #, c-format
 msgid "Long distance to %s: %s%s%s"
 msgstr ""
 
-#: bsd.c:2996
+#: bsd.c:2985
 #, c-format
 msgid "%s pages: %s"
 msgstr ""
 
-#: bsd.c:2997 speech.c:1048
+#: bsd.c:2986 speech.c:1049
 #, c-format
 msgid "You paged %s with '%s'"
 msgstr ""
 
-#: bsd.c:3307 bsd.c:3361 bsd.c:3415 bsd.c:3496
+#: bsd.c:3296 bsd.c:3350 bsd.c:3404 bsd.c:3485
 msgid "Player Name"
 msgstr ""
 
-#: bsd.c:3307 bsd.c:3361 bsd.c:3416 bsd.c:3496
+#: bsd.c:3296 bsd.c:3350 bsd.c:3405 bsd.c:3485
 msgid "On For"
 msgstr ""
 
-#: bsd.c:3307 bsd.c:3362 bsd.c:3416 bsd.c:3496
+#: bsd.c:3296 bsd.c:3351 bsd.c:3405 bsd.c:3485
 msgid "Idle"
 msgstr ""
 
-#: bsd.c:3327 bsd.c:3380 bsd.c:3461 bsd.c:3532
+#: bsd.c:3316 bsd.c:3369 bsd.c:3450 bsd.c:3521
 msgid "There are no players connected."
 msgstr ""
 
-#: bsd.c:3330
+#: bsd.c:3319
 msgid "There is 1 player connected."
 msgstr ""
 
-#: bsd.c:3333 bsd.c:3386 bsd.c:3467 bsd.c:3538
+#: bsd.c:3322 bsd.c:3375 bsd.c:3456 bsd.c:3527
 #, c-format
 msgid "There are %d players connected."
 msgstr ""
 
-#: bsd.c:3383 bsd.c:3464 bsd.c:3535
+#: bsd.c:3372 bsd.c:3453 bsd.c:3524
 msgid "There is one player connected."
 msgstr ""
 
-#: bsd.c:3416 bsd.c:3496
+#: bsd.c:3405 bsd.c:3485
 msgid "Loc #"
 msgstr ""
 
-#: bsd.c:3416 bsd.c:3496
+#: bsd.c:3405 bsd.c:3485
 msgid "Cmds"
 msgstr ""
 
-#: bsd.c:3416 bsd.c:3497
+#: bsd.c:3405 bsd.c:3486
 msgid "Des"
 msgstr ""
 
-#: bsd.c:3417
+#: bsd.c:3406
 msgid "Host"
 msgstr ""
 
-#: bsd.c:3445 bsd.c:3518
+#: bsd.c:3434 bsd.c:3507
 msgid "Connecting..."
 msgstr ""
 
-#: bsd.c:3497
+#: bsd.c:3486
 msgid "Sent"
 msgstr ""
 
-#: bsd.c:3497
+#: bsd.c:3486
 msgid "Recv"
 msgstr ""
 
-#: bsd.c:3497
+#: bsd.c:3486
 msgid "Pend"
 msgstr ""
 
-#: bsd.c:3610
+#: bsd.c:3599
 #, c-format
 msgid "%s created."
 msgstr ""
 
-#: bsd.c:3611 bsd.c:3633 bsd.c:3636 bsd.c:3854 bsd.c:3857
+#: bsd.c:3600 bsd.c:3622 bsd.c:3625 bsd.c:3843 bsd.c:3846
 msgid "GAME:"
 msgstr ""
 
-#: bsd.c:3613
+#: bsd.c:3602
 #, c-format
 msgid "GAME: Suspect %s created."
 msgstr ""
 
-#: bsd.c:3618
+#: bsd.c:3607
 msgid "has DARK-reconnected."
 msgstr ""
 
-#: bsd.c:3618
+#: bsd.c:3607
 msgid "has DARK-connected."
 msgstr ""
 
-#: bsd.c:3621
+#: bsd.c:3610
 msgid "has HIDDEN-reconnected."
 msgstr ""
 
-#: bsd.c:3622
+#: bsd.c:3611
 msgid "has HIDDEN-connected."
 msgstr ""
 
-#: bsd.c:3624
+#: bsd.c:3613
 msgid "has reconnected."
 msgstr ""
 
-#: bsd.c:3624
+#: bsd.c:3613
 msgid "has connected."
 msgstr ""
 
-#: bsd.c:3630 bsd.c:3852
+#: bsd.c:3619 bsd.c:3841
 #, c-format
 msgid "GAME: Suspect %s"
 msgstr ""
 
-#: bsd.c:3643
+#: bsd.c:3632
 msgid "You are nowhere!"
 msgstr ""
 
-#: bsd.c:3830
+#: bsd.c:3819
 msgid "has partially DARK-disconnected."
 msgstr ""
 
-#: bsd.c:3831
+#: bsd.c:3820
 msgid "has DARK-disconnected."
 msgstr ""
 
-#: bsd.c:3833
+#: bsd.c:3822
 msgid "has partially HIDDEN-disconnected."
 msgstr ""
 
-#: bsd.c:3834
+#: bsd.c:3823
 msgid "has HIDDEN-disconnected."
 msgstr ""
 
-#: bsd.c:3836
+#: bsd.c:3825
 msgid "has partially disconnected."
 msgstr ""
 
-#: bsd.c:3837
+#: bsd.c:3826
 msgid "has disconnected."
 msgstr ""
 
-#: bsd.c:3882
+#: bsd.c:3871
 msgid "You may get 15 minutes of fame and glory in life, but not right now."
 msgstr ""
 
-#: bsd.c:3887 extchat.c:2067
+#: bsd.c:3876 extchat.c:2094
 msgid "cleared"
 msgstr ""
 
-#: bsd.c:3889 extchat.c:2067
+#: bsd.c:3878 extchat.c:2094
 msgid "set"
 msgstr ""
 
-#: bsd.c:3894
+#: bsd.c:3883
 #, c-format
 msgid "Motd %s."
 msgstr ""
 
-#: bsd.c:3898
+#: bsd.c:3887
 #, c-format
 msgid "Wizard motd %s."
 msgstr ""
 
-#: bsd.c:3902
+#: bsd.c:3891
 #, c-format
 msgid "Down motd %s."
 msgstr ""
 
-#: bsd.c:3906
+#: bsd.c:3895
 #, c-format
 msgid "Full motd %s."
 msgstr ""
 
-#: bsd.c:3909
+#: bsd.c:3898
 #, c-format
 msgid "MOTD: %s"
 msgstr ""
 
-#: bsd.c:3911
+#: bsd.c:3900
 #, c-format
 msgid "Wiz MOTD: %s"
 msgstr ""
 
-#: bsd.c:3912
+#: bsd.c:3901
 #, c-format
 msgid "Down MOTD: %s"
 msgstr ""
 
-#: bsd.c:3913
+#: bsd.c:3902
 #, c-format
 msgid "Full MOTD: %s"
 msgstr ""
 
-#: bsd.c:3934
+#: bsd.c:3923
 msgid "Why would you want to do that?"
 msgstr ""
 
-#: bsd.c:3953
+#: bsd.c:3942
 #, c-format
 msgid "Doing set. %d characters lost."
 msgstr ""
 
-#: bsd.c:3956
+#: bsd.c:3945
 msgid "Doing set."
 msgstr ""
 
-#: bsd.c:3974
+#: bsd.c:3963
 #, c-format
 msgid "The current poll is: %s"
 msgstr ""
 
-#: bsd.c:3979
+#: bsd.c:3968
 msgid "Who do you think you are, Gallup?"
 msgstr ""
 
-#: bsd.c:3985
+#: bsd.c:3974
 msgid "Poll reset."
 msgstr ""
 
-#: bsd.c:4000
+#: bsd.c:3989
 #, c-format
 msgid "Poll set to '%s'. %d characters lost."
 msgstr ""
 
-#: bsd.c:4003
+#: bsd.c:3992
 #, c-format
 msgid "Poll set to: %s"
 msgstr ""
 
-#: bsd.c:4083 fundb.c:163 fundb.c:776 funlist.c:2307 funlist.c:2326
-#: parse.c:1040
-msgid "#-1 ARGUMENT OUT OF RANGE"
-msgstr ""
-
-#: bsd.c:4172 bsd.c:4181 bsd.c:4702 bsd.c:4711 cmds.c:438 fundb.c:895
+#: bsd.c:4161 bsd.c:4170 bsd.c:4691 bsd.c:4700 cmds.c:448 fundb.c:895
 #: fundb.c:922
 msgid "#-1 INVALID SECOND ARGUMENT"
 msgstr ""
 
-#: bsd.c:4185 bsd.c:4715 extchat.c:2369 extchat.c:2374 parse.c:97
+#: bsd.c:4174 bsd.c:4704 extchat.c:2397 extchat.c:2402 parse.c:99
 msgid "#-1 PERMISSION DENIED"
 msgstr ""
 
-#: bsd.c:4224 bsd.c:4794
+#: bsd.c:4213 bsd.c:4783
 msgid "Couldn't find that descriptor."
 msgstr ""
 
-#: bsd.c:4232 wiz.c:1424
+#: bsd.c:4221 wiz.c:1424
 msgid "Couldn't find that player."
 msgstr ""
 
-#: bsd.c:4450 funufun.c:314
+#: bsd.c:4439 funufun.c:321
 msgid "#-1 INVALID ZONE"
 msgstr ""
 
-#: bsd.c:4567 bsd.c:4588 bsd.c:4641
+#: bsd.c:4556 bsd.c:4577 bsd.c:4630
 msgid "#-1 NOT CONNECTED"
 msgstr ""
 
-#: bsd.c:4598 bsd.c:4611 bsd.c:4624
+#: bsd.c:4587 bsd.c:4600 bsd.c:4613
 msgid "#-1 FUNCTION REQUIRES ONE ARGUMENT"
 msgstr ""
 
-#: bsd.c:4805
+#: bsd.c:4794
 msgid "Noone is connected to that descriptor."
 msgstr ""
 
-#: bsd.c:4810
+#: bsd.c:4799
 msgid "Connection hidden."
 msgstr ""
 
-#: bsd.c:4812
+#: bsd.c:4801
 msgid "Connection unhidden."
 msgstr ""
 
-#: bsd.c:4826 wiz.c:890
+#: bsd.c:4815 wiz.c:890
 msgid "That player is not online."
 msgstr ""
 
-#: bsd.c:4835
+#: bsd.c:4824
 msgid "You no longer appear on the WHO list."
 msgstr ""
 
-#: bsd.c:4837
+#: bsd.c:4826
 #, c-format
 msgid "%s no longer appears on the WHO list."
 msgstr ""
 
-#: bsd.c:4841
+#: bsd.c:4830
 msgid "You now appear on the WHO list."
 msgstr ""
 
-#: bsd.c:4843
+#: bsd.c:4832
 #, c-format
 msgid "%s now appears on the WHO list."
 msgstr ""
 
-#: bsd.c:4885
+#: bsd.c:4874
 msgid ""
 "\n"
 "*** Inactivity timeout ***\n"
 msgstr ""
 
-#: bsd.c:4895
+#: bsd.c:4884
 msgid ""
 "\n"
 "*** Inactivity limit reached. You are now HIDDEN. ***\n"
 msgstr ""
 
-#: bsd.c:5050 bsd.c:5057
+#: bsd.c:5039 bsd.c:5046
 msgid "GAME: Error writing reboot database!"
 msgstr ""
 
-#: bsd.c:5244
+#: bsd.c:5233
 msgid "GAME: Reboot finished."
 msgstr ""
 
-#: bsd.c:5266
+#: bsd.c:5255
 #, c-format
 msgid "Unable to reboot using executable '%s': %s"
 msgstr ""
 
-#: bsd.c:5275
+#: bsd.c:5264
 msgid "GAME: Reboot w/o disconnect from game account, please wait."
 msgstr ""
 
-#: bsd.c:5280
+#: bsd.c:5269
 #, c-format
 msgid "GAME: Reboot w/o disconnect by %s, please wait."
 msgstr ""
 
-#: cmds.c:170 cmds.c:182
+#: cmds.c:180 cmds.c:192
 msgid "You can't remake the world in your image."
 msgstr ""
 
-#: cmds.c:174
+#: cmds.c:184
 msgid "What did you want to set?"
 msgstr ""
 
-#: cmds.c:188
+#: cmds.c:198
 msgid "Couldn't set that option."
 msgstr ""
 
-#: cmds.c:192
+#: cmds.c:202
 msgid "Option set and saved."
 msgstr ""
 
-#: cmds.c:194
+#: cmds.c:204
 msgid "Option set but not saved (Saves disabled.)"
 msgstr ""
 
-#: cmds.c:197
+#: cmds.c:207
 msgid "Option set."
 msgstr ""
 
-#: cmds.c:498
+#: cmds.c:519
 msgid "You must give a switch for @hook"
 msgstr ""
 
-#: cmds.c:506
+#: cmds.c:527
 msgid "Huh?  (Type \"help\" for help.)"
 msgstr ""
 
-#: cmds.c:553 game.c:2376
+#: cmds.c:583 game.c:2402
 msgid "Locks"
 msgstr ""
 
-#: cmds.c:557 cmds.c:873 game.c:2374
+#: cmds.c:587 cmds.c:903 game.c:2400
 msgid "Powers"
 msgstr ""
 
-#: cmds.c:655 extmail.c:1574
+#: cmds.c:685 extmail.c:1624
 msgid "You cannot do that while gagged."
 msgstr ""
 
-#: cmds.c:725
+#: cmds.c:755
 msgid "@message them with what?"
 msgstr ""
 
-#: cmds.c:728
+#: cmds.c:758
 msgid "Use what attribute for the @message?"
 msgstr ""
 
-#: cmds.c:732
+#: cmds.c:762
 msgid "@message who?"
 msgstr ""
 
-#: cmds.c:1074
+#: cmds.c:1106
 msgid "You can't teleport to nothing!"
 msgstr ""
 
-#: cmds.c:1266
+#: cmds.c:1298
 msgid "Buy for WHAT price?"
 msgstr ""
 
-#: cmds.c:1271
+#: cmds.c:1303
 msgid "You can't buy things by taking money."
 msgstr ""
 
-#: cmds.c:1388
+#: cmds.c:1420
 #, c-format
 msgid "No command found in code by %s - don't start code with functions."
 msgstr ""
@@ -907,532 +956,556 @@
 msgid "%s doesn't know switch %s."
 msgstr ""
 
-#: command.c:1681
+#: command.c:1683
 msgid "This command has not been implemented."
 msgstr ""
 
-#: command.c:1708 command.c:1739
+#: command.c:1710 command.c:1741
 msgid "Bad command name."
 msgstr ""
 
-#: command.c:1714
+#: command.c:1716
 #, c-format
 msgid "Command %s added."
 msgstr ""
 
-#: command.c:1717
+#: command.c:1719
 #, c-format
 msgid "Command %s already exists."
 msgstr ""
 
-#: command.c:1736 command.c:1825 command.c:1916 command.c:2280 command.c:2383
+#: command.c:1738 command.c:1827 command.c:1918 command.c:2291 command.c:2394
 msgid "No such command."
 msgstr ""
 
-#: command.c:1744
+#: command.c:1746
 msgid "Command cloned."
 msgstr ""
 
-#: command.c:1833
+#: command.c:1835
 msgid "You can't delete built-in commands. @command/disable instead."
 msgstr ""
 
-#: command.c:1849
+#: command.c:1851
 #, c-format
 msgid "Removed %s and aliases from command table."
 msgstr ""
 
-#: command.c:1852 command.c:1857
+#: command.c:1854 command.c:1859
 #, c-format
 msgid "Removed %s from command table."
 msgstr ""
 
-#: command.c:1873
+#: command.c:1875
 msgid "You must specify a command."
 msgstr ""
 
-#: command.c:1886
+#: command.c:1888
 msgid ""
 "WARNING: /NOEVAL no longer creates a Noparse command.\n"
 "         Use /NOPARSE if that's what you meant."
 msgstr ""
 
-#: command.c:1893
+#: command.c:1895
 msgid "I can't alias a command to that!"
 msgstr ""
 
-#: command.c:1895
+#: command.c:1897
 msgid "Unable to set alias."
 msgstr ""
 
-#: command.c:1927
+#: command.c:1929
 msgid "How do you want to restrict the command?"
 msgstr ""
 
-#: command.c:1932
+#: command.c:1934
 msgid "Restrict attempt failed."
 msgstr ""
 
-#: command.c:1936
+#: command.c:1938
 msgid "@command is ALWAYS enabled."
 msgstr ""
 
-#: command.c:1942
+#: command.c:1944
 #, c-format
 msgid "Name       : %s (%s)"
 msgstr ""
 
-#: command.c:1955
+#: command.c:1957
 #, c-format
 msgid "Flags      : %s"
 msgstr ""
 
-#: command.c:1957
+#: command.c:1959
 #, c-format
 msgid "Lock       : %s"
 msgstr ""
 
-#: command.c:1965
+#: command.c:1967
 #, c-format
 msgid "Switches   : %s"
 msgstr ""
 
-#: command.c:1967
+#: command.c:1969
 msgid "Switches   :"
 msgstr ""
 
-#: command.c:1980
+#: command.c:1982
 #, c-format
 msgid "Leftside   : %s"
 msgstr ""
 
-#: command.c:1992
+#: command.c:1994
 #, c-format
 msgid "Rightside  : %s"
 msgstr ""
 
-#: command.c:1995
+#: command.c:1997
 #, c-format
 msgid "Arguments  : %s"
 msgstr ""
 
-#: command.c:2010
+#: command.c:2013
 #, c-format
 msgid "Commands: %s"
 msgstr ""
 
-#: command.c:2284
+#: command.c:2295
 msgid "Hooks not allowed with that command."
 msgstr ""
 
-#: command.c:2297
+#: command.c:2308
 msgid "Unknown hook type"
 msgstr ""
 
-#: command.c:2302
+#: command.c:2313
 #, c-format
 msgid "Hook removed from %s."
 msgstr ""
 
-#: command.c:2311
+#: command.c:2322
 msgid "You must give an object."
 msgstr ""
 
-#: command.c:2313
+#: command.c:2324
 msgid "You must give both an object and attribute."
 msgstr ""
 
-#: command.c:2318
+#: command.c:2329
 msgid "Invalid hook object."
 msgstr ""
 
-#: command.c:2329
+#: command.c:2340
 #, c-format
 msgid "Hook set for %s"
 msgstr ""
 
-#: command.c:2363
+#: command.c:2374
 msgid "There are no hooks currently set."
 msgstr ""
 
-#: command.c:2368
+#: command.c:2379
 msgid "The following commands have hooks: "
 msgstr ""
 
-#: conf.c:543
+#: conf.c:552
 msgid "Options affecting attributes"
 msgstr ""
 
-#: conf.c:544
+#: conf.c:553
 msgid "Chat system options"
 msgstr ""
 
-#: conf.c:545
+#: conf.c:554
 msgid "Options affecting command behavior"
 msgstr ""
 
-#: conf.c:546
+#: conf.c:555
 msgid "Compile-time options"
 msgstr ""
 
-#: conf.c:547
+#: conf.c:556
 msgid "Cosmetic options"
 msgstr ""
 
-#: conf.c:548
+#: conf.c:557
 msgid "Costs"
 msgstr ""
 
-#: conf.c:549
+#: conf.c:558
 msgid "Database options"
 msgstr ""
 
-#: conf.c:550
+#: conf.c:559
 msgid "Options affecting dumps and other periodic processes"
 msgstr ""
 
-#: conf.c:551
+#: conf.c:560
 msgid "Files used by the MUSH"
 msgstr ""
 
-#: conf.c:552
+#: conf.c:561
 msgid "Default flags for new objects"
 msgstr ""
 
-#: conf.c:553
+#: conf.c:562
 msgid "Options affecting function behavior"
 msgstr ""
 
-#: conf.c:554
+#: conf.c:563
 msgid "Limits and other constants"
 msgstr ""
 
-#: conf.c:555
+#: conf.c:564
 msgid "Logging options"
 msgstr ""
 
-#: conf.c:556
+#: conf.c:565
 msgid "Message files sent by the MUSH"
 msgstr ""
 
-#: conf.c:557
+#: conf.c:566
 msgid "Networking and connection-related options"
 msgstr ""
 
-#: conf.c:558
+#: conf.c:567
 msgid "TinyMUSH compatibility options"
 msgstr ""
 
-#: conf.c:1274
-msgid "GAME: Dumping database. Game may freeze for a minute"
+#: conf.c:1291
+msgid "GAME: Saving database. Game may freeze for a few moments."
 msgstr ""
 
-#: conf.c:1275
-msgid "GAME: Dump complete. Time in."
+#: conf.c:1292
+msgid "GAME: Save complete. "
 msgstr ""
 
-#: conf.c:1336
-msgid "GAME: Database will be dumped in 1 minute."
+#: conf.c:1311
+msgid "Penny"
 msgstr ""
 
-#: conf.c:1338
-msgid "GAME: Database will be dumped in 5 minutes."
+#: conf.c:1312
+msgid "Pennies"
 msgstr ""
 
-#: conf.c:1644
+#: conf.c:1352
+msgid "GAME: Database save in 1 minute."
+msgstr ""
+
+#: conf.c:1353
+msgid "GAME: Database save in 5 minutes."
+msgstr ""
+
+#: conf.c:1393
+msgid "Broadcast:"
+msgstr ""
+
+#: conf.c:1394
+msgid "Admin:"
+msgstr ""
+
+#: conf.c:1395
+msgid "Announcement:"
+msgstr ""
+
+#: conf.c:1661
 msgid "I only know the following types of options:"
 msgstr ""
 
-#: conf.c:1672
+#: conf.c:1691
 msgid "Use: @config/list <type of options> where type is one of:"
 msgstr ""
 
-#: conf.c:1783
+#: conf.c:1804
 msgid "#-1 NO SUCH CONFIG OPTION"
 msgstr ""
 
-#: conf.c:1824 function.c:1772
+#: conf.c:1843
+msgid "That option cannot be altered."
+msgstr ""
+
+#: conf.c:1848 function.c:1774
 msgid "Disabled."
 msgstr ""
 
-#: conf.c:1826 function.c:1769
+#: conf.c:1850 function.c:1771
 msgid "Enabled."
 msgstr ""
 
-#: conf.c:1830
+#: conf.c:1854
 msgid "That isn't an on/off option."
 msgstr ""
 
-#: conf.c:1834
+#: conf.c:1858
 msgid "No such option."
 msgstr ""
 
-#: conf.c:1841
+#: conf.c:1865
 msgid " Attributes are not compressed in memory."
 msgstr ""
 
-#: conf.c:1844
+#: conf.c:1868
 msgid " Attributes are Huffman compressed in memory."
 msgstr ""
 
-#: conf.c:1847
+#: conf.c:1871
 msgid " Attributes are word compressed in memory."
 msgstr ""
 
-#: conf.c:1850
+#: conf.c:1874
 msgid " Attributes are 8-bit word compressed in memory."
 msgstr ""
 
-#: conf.c:1854
+#: conf.c:1878
 msgid " The MUSH was compiled with SSL support."
 msgstr ""
 
-#: conf.c:1858
+#: conf.c:1882
 msgid " The MUSH was compiled with MySQL support."
 msgstr ""
 
-#: conf.c:1861
+#: conf.c:1885
 msgid " The MUSH was compiled with Postgresql support."
 msgstr ""
 
-#: conf.c:1864
+#: conf.c:1888
 msgid " The MUSH was compiled with Sqlite3 support."
 msgstr ""
 
-#: conf.c:1868
+#: conf.c:1892
 msgid " DNS and ident lookups are handled by a slave process."
 msgstr ""
 
-#: conf.c:1870
+#: conf.c:1894
 msgid " DNS and ident lookups are handled by the MUSH process."
 msgstr ""
 
-#: conf.c:1874
+#: conf.c:1898
 msgid " Extended convtime() is supported."
 msgstr ""
 
-#: conf.c:1876
+#: conf.c:1900
 msgid " convtime() is stricter."
 msgstr ""
 
-#: conf.c:1880
+#: conf.c:1904
 msgid " CPU usage limiting is supported."
 msgstr ""
 
-#: conf.c:1882
+#: conf.c:1906
 msgid " CPU usage limiting is NOT supported."
 msgstr ""
 
-#: conf.c:1886
+#: conf.c:1910
 msgid " Changed help files will be automatically reindexed."
 msgstr ""
 
-#: conf.c:1890
+#: conf.c:1914
 msgid " SSE2 instructions are being used."
 msgstr ""
 
-#: conf.c:1894
+#: conf.c:1918
 msgid " SSE3 instructions are being used."
 msgstr ""
 
-#: conf.c:1898
+#: conf.c:1922
 msgid " Altivec instructions are being used."
 msgstr ""
 
-#: conf.c:1902
+#: conf.c:1926
 msgid " @config/save is enabled."
 msgstr ""
 
-#: conf.c:1904
+#: conf.c:1928
 msgid " @config/save is disabled."
 msgstr ""
 
-#: cque.c:220
+#: cque.c:224
 #, c-format
 msgid "Not enough money to queue command for %s(#%d)."
 msgstr ""
 
-#: cque.c:236
+#: cque.c:240
 #, c-format
 msgid "GAME: Object %s(%s) lost a %s to queue loss."
 msgstr ""
 
-#: cque.c:245
+#: cque.c:249
 #, c-format
 msgid "Runaway object: %s(%s). Commands halted."
 msgstr ""
 
-#: cque.c:305 cque.c:466
+#: cque.c:315 cque.c:478
 msgid "Queue entry table full. Try again later."
 msgstr ""
 
-#: cque.c:692
+#: cque.c:748
 msgid "@break recursion exceeded."
 msgstr ""
 
-#: cque.c:700
+#: cque.c:756
 msgid "@include recursion exceeded."
 msgstr ""
 
-#: cque.c:921
+#: cque.c:980
 msgid "You must specify an object to use for the semaphore."
 msgstr ""
 
-#: cque.c:931
+#: cque.c:990
 msgid "You may not specify a semaphore attribute with the ANY switch."
 msgstr ""
 
-#: cque.c:963
+#: cque.c:1022
 msgid "You may not specify a semaphore count with the ALL switch."
 msgstr ""
 
-#: cque.c:967
+#: cque.c:1026
 msgid "The semaphore count must be an integer."
 msgstr ""
 
-#: cque.c:983
+#: cque.c:1042
 msgid "Drained."
 msgstr ""
 
-#: cque.c:985
+#: cque.c:1044
 msgid "Notified."
 msgstr ""
 
-#: cque.c:1094 cque.c:1102 cque.c:1605 cque.c:1612
+#: cque.c:1153 cque.c:1161 cque.c:1541 cque.c:1548 cque.c:1711 cque.c:1718
 msgid "That is not a valid pid!"
 msgstr ""
 
-#: cque.c:1113
+#: cque.c:1172
 msgid "You cannot adjust the timeout of an indefinite semaphore."
 msgstr ""
 
-#: cque.c:1118
+#: cque.c:1177
 msgid "That is not a valid timestamp."
 msgstr ""
 
-#: cque.c:1184
+#: cque.c:1243
 #, c-format
 msgid "Queue entry with pid %u updated."
 msgstr ""
 
-#: cque.c:1206
+#: cque.c:1265
 msgid "#-1 INVALID PID"
 msgstr ""
 
-#: cque.c:1425 set.c:182
+#: cque.c:1492 set.c:177
 msgid "I couldn't find that player."
 msgstr ""
 
-#: cque.c:1428 rob.c:187 rob.c:352 speech.c:567
+#: cque.c:1495 rob.c:187 rob.c:352 speech.c:567
 msgid "I don't know who you mean!"
 msgstr ""
 
-#: cque.c:1434
+#: cque.c:1501
 msgid "Queue for : all"
 msgstr ""
 
-#: cque.c:1436
+#: cque.c:1503
 #, c-format
 msgid "Queue for : %s"
 msgstr ""
 
-#: cque.c:1440
+#: cque.c:1507
 msgid "Player Queue:"
 msgstr ""
 
-#: cque.c:1443
+#: cque.c:1510
 msgid "Object Queue:"
 msgstr ""
 
-#: cque.c:1446
+#: cque.c:1513
 msgid "Wait Queue:"
 msgstr ""
 
-#: cque.c:1449
+#: cque.c:1516
 msgid "Semaphore Queue:"
 msgstr ""
 
-#: cque.c:1452
+#: cque.c:1519
 msgid "------------  Queue Done  ------------"
 msgstr ""
 
-#: cque.c:1455
+#: cque.c:1522
 #, c-format
 msgid ""
 "Totals: Player...%d/%d[%ddel]  Object...%d/%d[%ddel]  Wait...%d/%d[%ddel]  "
 "Semaphore...%d/%d"
 msgstr ""
 
-#: cque.c:1478 cque.c:1583 cque.c:1585
+#: cque.c:1584 cque.c:1689 cque.c:1691
 msgid "Halted"
 msgstr ""
 
-#: cque.c:1564
+#: cque.c:1670
 msgid "You may not use @halt obj=command on this object."
 msgstr ""
 
-#: cque.c:1573
+#: cque.c:1679
 msgid "All of your objects have been halted."
 msgstr ""
 
-#: cque.c:1576
+#: cque.c:1682
 #, c-format
 msgid "All objects for %s have been halted."
 msgstr ""
 
-#: cque.c:1578
+#: cque.c:1684
 #, c-format
 msgid "All of your objects have been halted by %s."
 msgstr ""
 
-#: cque.c:1646
+#: cque.c:1752
 #, c-format
 msgid "Queue entry with pid %u halted."
 msgstr ""
 
-#: cque.c:1660
+#: cque.c:1766
 msgid "You do not have the power to bring the world to a halt."
 msgstr ""
 
-#: cque.c:1666
+#: cque.c:1772
 #, c-format
 msgid "Your objects have been globally halted by %s"
 msgstr ""
 
-#: cque.c:1684
+#: cque.c:1790
 msgid "You do not have the power to restart the world."
 msgstr ""
 
-#: cque.c:1696
+#: cque.c:1802
 #, c-format
 msgid "Your objects are being globally restarted by %s"
 msgstr ""
 
-#: cque.c:1741
+#: cque.c:1847
 #, c-format
 msgid "All objects for %s are being restarted."
 msgstr ""
 
-#: cque.c:1745
+#: cque.c:1851
 #, c-format
 msgid "All of your objects are being restarted by %s."
 msgstr ""
 
-#: cque.c:1749
+#: cque.c:1855
 #, c-format
 msgid "Restarting: %s's %s(%s)"
 msgstr ""
 
-#: cque.c:1751
+#: cque.c:1857
 #, c-format
 msgid "Restarting: %s(%s), by %s"
 msgstr ""
 
-#: cque.c:1756
+#: cque.c:1862
 msgid "All of your objects are being restarted."
 msgstr ""
 
-#: cque.c:1758
+#: cque.c:1864
 #, c-format
 msgid "Restarting: %s(%s)"
 msgstr ""
@@ -1492,7 +1565,7 @@
 msgid "Unlink what?"
 msgstr ""
 
-#: create.c:233 match.c:476 wiz.c:984
+#: create.c:233 match.c:481 wiz.c:984
 msgid "I don't know which one you mean!"
 msgstr ""
 
@@ -1586,7 +1659,7 @@
 "Warning: @CLONE/PRESERVE on an object with WIZ, ROY, @powers, or @warnings."
 msgstr ""
 
-#: create.c:614 set.c:121
+#: create.c:614 set.c:117
 msgid "That is not a reasonable name."
 msgstr ""
 
@@ -1822,720 +1895,743 @@
 msgid "GAME: Database consistency check complete."
 msgstr ""
 
-#: extchat.c:158 extchat.c:178 extchat.c:1199 extchat.c:1333 extchat.c:1343
-#: extchat.c:1398 extchat.c:1622 extchat.c:2756 extchat.c:3790
+#: extchat.c:159 extchat.c:179 extchat.c:1200 extchat.c:1334 extchat.c:1344
+#: extchat.c:1399 extchat.c:1623 extchat.c:2784 extchat.c:3888
 msgid "CHAT: I don't recognize that channel."
 msgstr ""
 
-#: extchat.c:161 extchat.c:181 extchat.c:1336 extchat.c:1401 extchat.c:1500
+#: extchat.c:162 extchat.c:182 extchat.c:1337 extchat.c:1402 extchat.c:1501
 msgid "CHAT: I don't know which channel you mean."
 msgstr ""
 
-#: extchat.c:1020
+#: extchat.c:1021
 msgid "CHAT: Partial matches are:"
 msgstr ""
 
-#: extchat.c:1173 extchat.c:3750 extchat.c:3868
+#: extchat.c:1174 extchat.c:3848 extchat.c:3966
 msgid "You need to specify a channel."
 msgstr ""
 
-#: extchat.c:1177 extchat.c:1700
+#: extchat.c:1178 extchat.c:1701
 msgid "What do you want to do with the channel?"
 msgstr ""
 
-#: extchat.c:1196 extchat.c:3787
+#: extchat.c:1197 extchat.c:3885
 #, c-format
 msgid "CHAT: You can't do that with channel <%s>."
 msgstr ""
 
-#: extchat.c:1215 extchat.c:1312
+#: extchat.c:1216 extchat.c:1313
 msgid "I don't understand what you want to do."
 msgstr ""
 
-#: extchat.c:1224 extchat.c:1239 extchat.c:1285
+#: extchat.c:1225 extchat.c:1240 extchat.c:1286
 msgid "Invalid target."
 msgstr ""
 
-#: extchat.c:1230 extchat.c:1348
+#: extchat.c:1231 extchat.c:1349
 #, c-format
 msgid "Sorry, wrong type of thing for channel <%s>."
 msgstr ""
 
-#: extchat.c:1235 extchat.c:1323
+#: extchat.c:1236 extchat.c:1324
 msgid "Guests are not allowed to join channels."
 msgstr ""
 
-#: extchat.c:1245 extchat.c:1277 extchat.c:1375
+#: extchat.c:1246 extchat.c:1278 extchat.c:1376
 #, c-format
 msgid "%s is already on channel <%s>."
 msgstr ""
 
-#: extchat.c:1255
+#: extchat.c:1256
 msgid ""
 "CHAT: Warning: Target does not meet channel join permissions! (joining "
 "anyway)"
 msgstr ""
 
-#: extchat.c:1257 extchat.c:1360
+#: extchat.c:1258 extchat.c:1361
 msgid "Permission to join denied."
 msgstr ""
 
-#: extchat.c:1263
+#: extchat.c:1264
 #, c-format
 msgid "CHAT: %s joins you to channel <%s>."
 msgstr ""
 
-#: extchat.c:1266
+#: extchat.c:1267
 #, c-format
 msgid "CHAT: You join %s to channel <%s>."
 msgstr ""
 
-#: extchat.c:1273 extchat.c:1371
+#: extchat.c:1274 extchat.c:1372
 msgid "has joined this channel."
 msgstr ""
 
-#: extchat.c:1289
+#: extchat.c:1290
 msgid "Guests may not leave channels."
 msgstr ""
 
-#: extchat.c:1298 extchat.c:1413
+#: extchat.c:1299 extchat.c:1414
 msgid "has left this channel."
 msgstr ""
 
-#: extchat.c:1301
+#: extchat.c:1302
 #, c-format
 msgid "CHAT: %s removes you from channel <%s>."
 msgstr ""
 
-#: extchat.c:1304
+#: extchat.c:1305
 #, c-format
 msgid "CHAT: You remove %s from channel <%s>."
 msgstr ""
 
-#: extchat.c:1307 extchat.c:1417
+#: extchat.c:1308 extchat.c:1418
 #, c-format
 msgid "%s is not on channel <%s>."
 msgstr ""
 
-#: extchat.c:1330
+#: extchat.c:1331
 #, c-format
 msgid "CHAT: You are already on channel <%s>."
 msgstr ""
 
-#: extchat.c:1358
+#: extchat.c:1359
 msgid ""
 "CHAT: Warning: You don't meet channel join permissions! (joining anyway)"
 msgstr ""
 
-#: extchat.c:1365
+#: extchat.c:1366
 #, c-format
 msgid "CHAT: You join channel <%s>."
 msgstr ""
 
-#: extchat.c:1388
+#: extchat.c:1389
 msgid "Guests are not allowed to leave channels."
 msgstr ""
 
-#: extchat.c:1395
+#: extchat.c:1396
 #, c-format
 msgid "CHAT: You are not on channel <%s>."
 msgstr ""
 
-#: extchat.c:1414
+#: extchat.c:1415
 #, c-format
 msgid "CHAT: You leave channel <%s>."
 msgstr ""
 
-#: extchat.c:1491
+#: extchat.c:1492
 msgid "Don't you have anything to say?"
 msgstr ""
 
-#: extchat.c:1504
+#: extchat.c:1505
 msgid "CHAT: You may wish to set the CHAN_USEFIRSTMATCH flag on yourself."
 msgstr ""
 
-#: extchat.c:1514
+#: extchat.c:1515
 msgid "CHAT: No such channel."
 msgstr ""
 
-#: extchat.c:1538 extchat.c:1634
+#: extchat.c:1539 extchat.c:1635
 #, c-format
 msgid "Sorry, you're not the right type to be on channel <%s>."
 msgstr ""
 
-#: extchat.c:1545
+#: extchat.c:1546
 #, c-format
 msgid "Sorry, you're not allowed to speak on channel <%s>."
 msgstr ""
 
-#: extchat.c:1548 extchat.c:2889
+#: extchat.c:1549 extchat.c:2917
 msgid "No such channel."
 msgstr ""
 
-#: extchat.c:1556 extchat.c:1649
+#: extchat.c:1557 extchat.c:1650
 msgid "You must be on that channel to speak on it."
 msgstr ""
 
-#: extchat.c:1559 extchat.c:1652
+#: extchat.c:1560 extchat.c:1653
 msgid "You must stop gagging that channel to speak on it."
 msgstr ""
 
-#: extchat.c:1565
+#: extchat.c:1566
 msgid "What do you want to say to that channel?"
 msgstr ""
 
-#: extchat.c:1607
+#: extchat.c:1608
 msgid "That is not a valid channel."
 msgstr ""
 
-#: extchat.c:1612
+#: extchat.c:1613
 msgid "I don't recognize that channel."
 msgstr ""
 
-#: extchat.c:1615
+#: extchat.c:1616
 msgid "I don't know which channel you mean."
 msgstr ""
 
-#: extchat.c:1640
+#: extchat.c:1641
 #, c-format
 msgid "Sorry, you're not allowed to @cemit on channel <%s>."
 msgstr ""
 
-#: extchat.c:1658
+#: extchat.c:1659
 msgid "What do you want to emit?"
 msgstr ""
 
-#: extchat.c:1666
+#: extchat.c:1667
 #, c-format
 msgid "Cemit to channel %s: %s"
 msgstr ""
 
-#: extchat.c:1692 extchat.c:2028
+#: extchat.c:1693 extchat.c:2055
 msgid "You must specify a channel."
 msgstr ""
 
-#: extchat.c:1696
+#: extchat.c:1697
 msgid "Guests may not modify channels."
 msgstr ""
 
-#: extchat.c:1711
+#: extchat.c:1712
 msgid "No more room for channels."
 msgstr ""
 
-#: extchat.c:1715
+#: extchat.c:1716
 msgid "The channel needs a shorter name."
 msgstr ""
 
-#: extchat.c:1719
+#: extchat.c:1720
 msgid "Invalid name for a channel."
 msgstr ""
 
-#: extchat.c:1723
+#: extchat.c:1724
 msgid "You already own too many channels."
 msgstr ""
 
-#: extchat.c:1728
+#: extchat.c:1729
 msgid "CHAT: The channel needs a more unique name."
 msgstr ""
 
-#: extchat.c:1737
+#: extchat.c:1738
 msgid "You can't create channels of that type."
 msgstr ""
 
-#: extchat.c:1741
+#: extchat.c:1742
 msgid "Warning: channel will be created disabled."
 msgstr ""
 
-#: extchat.c:1744
+#: extchat.c:1745
 #, c-format
 msgid "You can't afford the %d %s."
 msgstr ""
 
-#: extchat.c:1751 extchat.c:1758
+#: extchat.c:1752 extchat.c:1759
 msgid "CHAT: No more memory for channels!"
 msgstr ""
 
-#: extchat.c:1770
+#: extchat.c:1771
 #, c-format
 msgid "CHAT: Channel <%s> created."
 msgstr ""
 
-#: extchat.c:1787
+#: extchat.c:1788
 msgid "Channel removed."
 msgstr ""
 
-#: extchat.c:1802
+#: extchat.c:1803
 msgid "The channel needs a more unique new name."
 msgstr ""
 
-#: extchat.c:1807
+#: extchat.c:1808
 msgid "That name is too long."
 msgstr ""
 
-#: extchat.c:1815
+#: extchat.c:1816
 #, c-format
 msgid "has renamed %s to %s."
 msgstr ""
 
-#: extchat.c:1819
+#: extchat.c:1820
 msgid "Channel renamed."
 msgstr ""
 
-#: extchat.c:1830
+#: extchat.c:1831
 msgid "You can't make channels that type."
 msgstr ""
 
-#: extchat.c:1834
+#: extchat.c:1835
 msgid "Warning: channel will be disabled."
 msgstr ""
 
-#: extchat.c:1838
+#: extchat.c:1839
 #, c-format
 msgid "Invalid or same permissions on channel <%s>. No changes made."
 msgstr ""
 
-#: extchat.c:1843
+#: extchat.c:1844
 #, c-format
 msgid "Permissions on channel <%s> changed."
 msgstr ""
 
-#: extchat.c:1905
-msgid "You are not on any channels."
+#: extchat.c:1904
+msgid "Only players can use that option."
 msgstr ""
 
 #: extchat.c:1911
+msgid "You are not on any channels."
+msgstr ""
+
+#: extchat.c:1917
 msgid "All channels have been muted."
 msgstr ""
 
-#: extchat.c:1912
+#: extchat.c:1918
 msgid "All channels have been unmuted."
 msgstr ""
 
-#: extchat.c:1915
+#: extchat.c:1921
 msgid "You hide on all the channels you can."
 msgstr ""
 
-#: extchat.c:1916
+#: extchat.c:1922
 msgid "You unhide on all channels."
 msgstr ""
 
-#: extchat.c:1919
+#: extchat.c:1925
 msgid "All channels have been gagged."
 msgstr ""
 
-#: extchat.c:1920
+#: extchat.c:1926
 msgid "All channels have been ungagged."
 msgstr ""
 
-#: extchat.c:1941 extchat.c:2035
+#: extchat.c:1929
+msgid "All channels have been combined."
+msgstr ""
+
+#: extchat.c:1930
+msgid "All channels have been uncombined."
+msgstr ""
+
+#: extchat.c:1951 extchat.c:2062
 #, c-format
 msgid "You are not on channel <%s>."
 msgstr ""
 
-#: extchat.c:1953
+#: extchat.c:1963
 #, c-format
 msgid "You will no longer hear connection messages on channel <%s>."
 msgstr ""
 
-#: extchat.c:1960
+#: extchat.c:1970
 #, c-format
 msgid "You will now hear connection messages on channel <%s>."
 msgstr ""
 
-#: extchat.c:1971
+#: extchat.c:1981
 #, c-format
 msgid "You are not permitted to hide on channel <%s>."
 msgstr ""
 
-#: extchat.c:1978
+#: extchat.c:1988
 #, c-format
 msgid "You no longer appear on channel <%s>'s who list."
 msgstr ""
 
-#: extchat.c:1985
+#: extchat.c:1995
 #, c-format
 msgid "You now appear on channel <%s>'s who list."
 msgstr ""
 
-#: extchat.c:1996
+#: extchat.c:2006
 #, c-format
 msgid "You will no longer hear messages on channel <%s>."
 msgstr ""
 
-#: extchat.c:2002
+#: extchat.c:2012
 #, c-format
 msgid "You will now hear messages on channel <%s>."
 msgstr ""
 
-#: extchat.c:2041
+#: extchat.c:2023
+#, c-format
+msgid "Connect messages on channel <%s> will now be combined with others."
+msgstr ""
+
+#: extchat.c:2029
+#, c-format
+msgid ""
+"Connect messages on channel <%s> will no longer be combined with others."
+msgstr ""
+
+#: extchat.c:2068
 #, c-format
 msgid "You have no title set on <%s>."
 msgstr ""
 
-#: extchat.c:2043
+#: extchat.c:2070
 #, c-format
 msgid "Your title on <%s> is '%s'."
 msgstr ""
 
-#: extchat.c:2052
+#: extchat.c:2079
 msgid "Title too long."
 msgstr ""
 
-#: extchat.c:2059
+#: extchat.c:2086
 msgid "Invalid character in title."
 msgstr ""
 
-#: extchat.c:2066
+#: extchat.c:2093
 #, c-format
 msgid "Title %s for %schannel <%s>."
 msgstr ""
 
-#: extchat.c:2094 flags.c:2038 malias.c:278
+#: extchat.c:2121 flags.c:2041 malias.c:278
 msgid "Name"
 msgstr ""
 
-#: extchat.c:2094
+#: extchat.c:2121
 msgid "Users"
 msgstr ""
 
-#: extchat.c:2094
+#: extchat.c:2121
 msgid "Msgs"
 msgstr ""
 
-#: extchat.c:2094
+#: extchat.c:2121
 msgid "Chan Type"
 msgstr ""
 
-#: extchat.c:2094
+#: extchat.c:2121
 msgid "Status"
 msgstr ""
 
-#: extchat.c:2095
+#: extchat.c:2122
 msgid "Buf"
 msgstr ""
 
-#: extchat.c:2144
+#: extchat.c:2171
 msgid "Gag"
 msgstr ""
 
-#: extchat.c:2144
+#: extchat.c:2171
 msgid "On"
 msgstr ""
 
-#: extchat.c:2144
+#: extchat.c:2171
 msgid "Off"
 msgstr ""
 
-#: extchat.c:2190 extchat.c:2237 extchat.c:2286 extchat.c:2342 extchat.c:2396
-#: extchat.c:2440
+#: extchat.c:2218 extchat.c:2265 extchat.c:2314 extchat.c:2370 extchat.c:2424
+#: extchat.c:2468
 msgid "#-1 NO CHANNEL GIVEN"
 msgstr ""
 
-#: extchat.c:2195 extchat.c:2202 extchat.c:2242 extchat.c:2249 extchat.c:2308
-#: extchat.c:2347 extchat.c:2359 extchat.c:2401 extchat.c:2413 extchat.c:2445
-#: extchat.c:3166 extchat.c:3253 extchat.c:3295
+#: extchat.c:2223 extchat.c:2230 extchat.c:2270 extchat.c:2277 extchat.c:2336
+#: extchat.c:2375 extchat.c:2387 extchat.c:2429 extchat.c:2441 extchat.c:2473
+#: extchat.c:3256 extchat.c:3343 extchat.c:3385
 msgid "#-1 NO SUCH CHANNEL"
 msgstr ""
 
-#: extchat.c:2198 extchat.c:2245 extchat.c:2311 extchat.c:2350 extchat.c:2404
-#: extchat.c:2448
+#: extchat.c:2226 extchat.c:2273 extchat.c:2339 extchat.c:2378 extchat.c:2432
+#: extchat.c:2476
 msgid "#-1 AMBIGUOUS CHANNEL NAME"
 msgstr ""
 
-#: extchat.c:2223 extchat.c:2367
+#: extchat.c:2251 extchat.c:2395
 msgid "#-1 NOT ON CHANNEL"
 msgstr ""
 
-#: extchat.c:2291
+#: extchat.c:2319
 msgid "#-1 NO TEXT GIVEN"
 msgstr ""
 
-#: extchat.c:2319
+#: extchat.c:2347
 msgid "#-1 CHANNEL DOES NOT HAVE A BUFFER"
 msgstr ""
 
-#: extchat.c:2472
+#: extchat.c:2500
 #, c-format
 msgid "CHAT: %s has removed all users from <%s>."
 msgstr ""
 
-#: extchat.c:2495
+#: extchat.c:2523
 msgid "CHAT: Wipe that silly grin off your face instead."
 msgstr ""
 
-#: extchat.c:2500
+#: extchat.c:2528
 #, c-format
 msgid "CHAT: Channel <%s> wiped."
 msgstr ""
 
-#: extchat.c:2522
+#: extchat.c:2550
 msgid "CHAT: Only a channel modifier can do that."
 msgstr ""
 
-#: extchat.c:2530 extchat.c:3132 match.c:480 set.c:585
+#: extchat.c:2558 extchat.c:3222 match.c:485 set.c:584
 msgid "I can't see that here."
 msgstr ""
 
-#: extchat.c:2532 extchat.c:3134
+#: extchat.c:2560 extchat.c:3224
 msgid "I don't know which thing you mean."
 msgstr ""
 
-#: extchat.c:2537
+#: extchat.c:2565
 #, c-format
 msgid "CHAT: Channel <%s> no longer mogrified by %s."
 msgstr ""
 
-#: extchat.c:2543
+#: extchat.c:2571
 #, c-format
 msgid "CHAT: Channel <%s> isn't being mogrified."
 msgstr ""
 
-#: extchat.c:2549
+#: extchat.c:2577
 msgid "CHAT: You must control the mogrifier."
 msgstr ""
 
-#: extchat.c:2554
+#: extchat.c:2582
 #, c-format
 msgid "CHAT: Channel <%s> now mogrified by %s."
 msgstr ""
 
-#: extchat.c:2575
+#: extchat.c:2603
 msgid "CHAT: Only a Wizard can do that."
 msgstr ""
 
-#: extchat.c:2582
+#: extchat.c:2610
 msgid "CHAT: Invalid owner."
 msgstr ""
 
-#: extchat.c:2590
+#: extchat.c:2618
 #, c-format
 msgid "CHAT: Channel <%s> now owned by %s."
 msgstr ""
 
-#: extchat.c:2644
+#: extchat.c:2672
 #, c-format
 msgid "CHAT: Channel <%s> resists."
 msgstr ""
 
-#: extchat.c:2674
+#: extchat.c:2702
 msgid "CHAT: I don't understand that key."
 msgstr ""
 
-#: extchat.c:2683
+#: extchat.c:2711
 #, c-format
 msgid "CHAT: Joinlock on <%s> reset."
 msgstr ""
 
-#: extchat.c:2684
+#: extchat.c:2712
 #, c-format
 msgid "CHAT: Joinlock on <%s> set."
 msgstr ""
 
-#: extchat.c:2690
+#: extchat.c:2718
 #, c-format
 msgid "CHAT: Speaklock on <%s> reset."
 msgstr ""
 
-#: extchat.c:2691
+#: extchat.c:2719
 #, c-format
 msgid "CHAT: Speaklock on <%s> set."
 msgstr ""
 
-#: extchat.c:2697
+#: extchat.c:2725
 #, c-format
 msgid "CHAT: Seelock on <%s> reset."
 msgstr ""
 
-#: extchat.c:2698
+#: extchat.c:2726
 #, c-format
 msgid "CHAT: Seelock on <%s> set."
 msgstr ""
 
-#: extchat.c:2704
+#: extchat.c:2732
 #, c-format
 msgid "CHAT: Hidelock on <%s> reset."
 msgstr ""
 
-#: extchat.c:2705
+#: extchat.c:2733
 #, c-format
 msgid "CHAT: Hidelock on <%s> set."
 msgstr ""
 
-#: extchat.c:2711
+#: extchat.c:2739
 #, c-format
 msgid "CHAT: Modlock on <%s> reset."
 msgstr ""
 
-#: extchat.c:2712
+#: extchat.c:2740
 #, c-format
 msgid "CHAT: Modlock on <%s> set."
 msgstr ""
 
-#: extchat.c:2739
+#: extchat.c:2767
 #, c-format
 msgid "Description: %s"
 msgstr ""
 
-#: extchat.c:2740
+#: extchat.c:2768
 #, c-format
 msgid "Owner: %s"
 msgstr ""
 
-#: extchat.c:2742
+#: extchat.c:2770
 #, c-format
 msgid "Mogrifier: %s (#%d)"
 msgstr ""
 
-#: extchat.c:2745
+#: extchat.c:2773
 #, c-format
 msgid "Flags: %s"
 msgstr ""
 
-#: extchat.c:2749
+#: extchat.c:2777
 #, c-format
 msgid "Recall buffer: %dk, with %d lines stored."
 msgstr ""
 
-#: extchat.c:2788
+#: extchat.c:2816
 #, c-format
 msgid "CHAT: You don't have permission to decompile <%s>."
 msgstr ""
 
-#: extchat.c:2837
+#: extchat.c:2865
 msgid "CHAT: No channel matches that string."
 msgstr ""
 
-#: extchat.c:2854 look.c:204 speech.c:373 speech.c:992
+#: extchat.c:2882 look.c:204 speech.c:373 speech.c:992
 msgid "and"
 msgstr ""
 
-#: extchat.c:2868
+#: extchat.c:2896
 msgid "There are no connected players on that channel."
 msgstr ""
 
-#: extchat.c:2870
+#: extchat.c:2898
 #, c-format
 msgid "Members of channel <%s> are:"
 msgstr ""
 
-#: extchat.c:2892
+#: extchat.c:2920
 msgid "I can't tell which channel you mean."
 msgstr ""
 
-#: extchat.c:2906 function.c:864
+#: extchat.c:2934 function.c:868
 msgid "#-1 INVALID ARGUMENT"
 msgstr ""
 
-#: extchat.c:2928
+#: extchat.c:2956
 msgid "#-1 NO PERMISSIONS FOR CHANNEL"
 msgstr ""
 
-#: extchat.c:2971
+#: extchat.c:2999
 msgid "CHAT: New description too long."
 msgstr ""
 
-#: extchat.c:2984
+#: extchat.c:3012
 #, c-format
 msgid "CHAT: Channel <%s> description cleared."
 msgstr ""
 
-#: extchat.c:2988
+#: extchat.c:3016
 #, c-format
 msgid "CHAT: Channel <%s> description set."
 msgstr ""
 
-#: extchat.c:3079
+#: extchat.c:3169
 msgid "Channels:"
 msgstr ""
 
-#: extchat.c:3085
+#: extchat.c:3175
 msgid "Channels: *NONE*"
 msgstr ""
 
-#: extchat.c:3169
+#: extchat.c:3259
 msgid "#-2 AMBIGUOUS CHANNEL MATCH"
 msgstr ""
 
-#: extchat.c:3191
+#: extchat.c:3281
 msgid "#-1 NO SUCH LOCK TYPE"
 msgstr ""
 
-#: extchat.c:3306
+#: extchat.c:3396
 msgid "#-1 NO RECALL BUFFER"
 msgstr ""
 
-#: extchat.c:3441
+#: extchat.c:3535
 msgid "You must specify a type of lock!"
 msgstr ""
 
-#: extchat.c:3717
+#: extchat.c:3815
 #, c-format
 msgid "To channel %s: %s"
 msgstr ""
 
-#: extchat.c:3757
+#: extchat.c:3855
 msgid "Which line do you want to start recall from?"
 msgstr ""
 
-#: extchat.c:3771 extchat.c:3779
+#: extchat.c:3869 extchat.c:3877
 msgid "How many lines did you want to recall?"
 msgstr ""
 
-#: extchat.c:3796
+#: extchat.c:3894
 msgid "CHAT: You must be able to join a channel to recall from it."
 msgstr ""
 
-#: extchat.c:3800
+#: extchat.c:3898
 msgid "CHAT: That channel doesn't have a recall buffer."
 msgstr ""
 
-#: extchat.c:3815
+#: extchat.c:3913
 msgid "CHAT: Nothing to recall."
 msgstr ""
 
-#: extchat.c:3819
+#: extchat.c:3917
 #, c-format
 msgid "CHAT: Recall from channel <%s>"
 msgstr ""
 
-#: extchat.c:3846
+#: extchat.c:3944
 msgid "CHAT: End recall"
 msgstr ""
 
-#: extchat.c:3850
+#: extchat.c:3948
 #, c-format
 msgid "CHAT: To recall the entire buffer, use @chan/recall %s=0"
 msgstr ""
 
-#: extchat.c:3872
+#: extchat.c:3970
 msgid "You need to specify the number of lines to buffer."
 msgstr ""
 
-#: extchat.c:3877
+#: extchat.c:3975
 msgid "Invalid buffer size."
 msgstr ""
 
-#: extchat.c:3892
+#: extchat.c:3990
 #, c-format
 msgid "CHAT: Channel buffering disabled for channel <%s>."
 msgstr ""
 
-#: extchat.c:3897
+#: extchat.c:3995
 #, c-format
 msgid "CHAT: Channel buffering already disabled for channel <%s>."
 msgstr ""
 
-#: extchat.c:3905
+#: extchat.c:4003
 #, c-format
 msgid "CHAT: Resizing buffer of channel <%s>"
 msgstr ""
 
-#: extchat.c:3910
+#: extchat.c:4008
 #, c-format
 msgid "CHAT: Buffering enabled on channel <%s>."
 msgstr ""
 
-#: extmail.c:222 extmail.c:1168
+#: extmail.c:222 extmail.c:1218
 msgid "(no subject)"
 msgstr ""
 
@@ -2588,92 +2684,92 @@
 msgid "MAIL: What do you want to do with the messages?"
 msgstr ""
 
-#: extmail.c:420
+#: extmail.c:421
 msgid "MAIL: Unknown status."
 msgstr ""
 
-#: extmail.c:468
+#: extmail.c:469
 msgid "MAIL: All messages in all folders untagged."
 msgstr ""
 
-#: extmail.c:470
+#: extmail.c:471
 msgid "MAIL: All messages in all folders tagged."
 msgstr ""
 
-#: extmail.c:475
+#: extmail.c:476
 #, c-format
 msgid "MAIL: Msg #%d:%d untagged"
 msgstr ""
 
-#: extmail.c:478
+#: extmail.c:479
 #, c-format
 msgid "MAIL: Msg #%d:%d tagged"
 msgstr ""
 
-#: extmail.c:488
+#: extmail.c:489
 msgid "MAIL: All messages in all folders uncleared."
 msgstr ""
 
-#: extmail.c:490
+#: extmail.c:491
 msgid "MAIL: All messages in all folders cleared."
 msgstr ""
 
-#: extmail.c:498
+#: extmail.c:499
 #, c-format
 msgid "MAIL: Unread Msg #%d:%d cleared! Use @mail/unclear %d:%d to recover."
 msgstr ""
 
-#: extmail.c:503
+#: extmail.c:504
 #, c-format
 msgid "MAIL: Msg #%d:%d uncleared."
 msgstr ""
 
-#: extmail.c:504
+#: extmail.c:505
 #, c-format
 msgid "MAIL: Msg #%d:%d cleared."
 msgstr ""
 
-#: extmail.c:513
+#: extmail.c:514
 msgid "MAIL: All messages in all folders unread."
 msgstr ""
 
-#: extmail.c:515
+#: extmail.c:517
 msgid "MAIL: All messages in all folders marked as read."
 msgstr ""
 
-#: extmail.c:521
+#: extmail.c:523
 #, c-format
 msgid "MAIL: Msg #%d:%d unread"
 msgstr ""
 
-#: extmail.c:523
+#: extmail.c:526
 #, c-format
 msgid "MAIL: Msg #%d:%d marked as read"
 msgstr ""
 
-#: extmail.c:533 extmail.c:591
+#: extmail.c:537 extmail.c:595
 msgid "MAIL: You don't have any matching messages!"
 msgstr ""
 
-#: extmail.c:560
+#: extmail.c:564
 msgid "MAIL: Invalid folder specification"
 msgstr ""
 
-#: extmail.c:577
+#: extmail.c:581
 #, c-format
 msgid "MAIL: All messages filed in folder %d [%s]"
 msgstr ""
 
-#: extmail.c:583
+#: extmail.c:587
 #, c-format
 msgid "MAIL: Msg %d:%d filed in folder %d [%s]"
 msgstr ""
 
-#: extmail.c:629 extmail.c:631
+#: extmail.c:633 extmail.c:635
 msgid "Folder:"
 msgstr ""
 
-#: extmail.c:636
+#: extmail.c:640
 #, c-format
 msgid ""
 "From: %-55s %s\n"
@@ -2681,320 +2777,320 @@
 "Status: %s"
 msgstr ""
 
-#: extmail.c:640
+#: extmail.c:644
 msgid " (Conn)"
 msgstr ""
 
-#: extmail.c:643
+#: extmail.c:647
 #, c-format
 msgid "Subject: %s"
 msgstr ""
 
-#: extmail.c:660
+#: extmail.c:664
 msgid "MAIL: You don't have that many matching messages!"
 msgstr ""
 
-#: extmail.c:689
+#: extmail.c:693
 #, c-format
 msgid ""
 "---------------------------  MAIL (folder %2d)  "
 "------------------------------"
 msgstr ""
 
-#: extmail.c:796
+#: extmail.c:846
 msgid "MAIL: Mailbox purged."
 msgstr ""
 
-#: extmail.c:829
+#: extmail.c:879
 msgid "MAIL: To whom should I forward?"
 msgstr ""
 
-#: extmail.c:839
+#: extmail.c:889
 msgid "MAIL: You have no messages to forward."
 msgstr ""
 
-#: extmail.c:860
+#: extmail.c:910
 msgid "MAIL: You can't reply to nonexistant mail."
 msgstr ""
 
-#: extmail.c:876 extmail.c:979
+#: extmail.c:926 extmail.c:1029
 #, c-format
 msgid "No such unique player: %s."
 msgstr ""
 
-#: extmail.c:891
+#: extmail.c:941
 #, c-format
 msgid "MAIL: %d messages forwarded."
 msgstr ""
 
-#: extmail.c:917
+#: extmail.c:967
 msgid "MAIL: I can't figure out who you want to mail to."
 msgstr ""
 
-#: extmail.c:921
+#: extmail.c:971
 msgid "MAIL: I can't figure out what you want to send."
 msgstr ""
 
-#: extmail.c:959
+#: extmail.c:1009
 msgid "MAIL: You can't reply to nonexistent mail."
 msgstr ""
 
-#: extmail.c:1093
+#: extmail.c:1143
 #, c-format
 msgid "Failed attempt to forward @mail to #%d"
 msgstr ""
 
-#: extmail.c:1102 extmail.c:1244
+#: extmail.c:1152 extmail.c:1294
 #, c-format
 msgid "MAIL: You sent your message to %s."
 msgstr ""
 
-#: extmail.c:1106
+#: extmail.c:1156
 #, c-format
 msgid "MAIL: Your message was not sent to %s due to a mail forwarding problem."
 msgstr ""
 
-#: extmail.c:1128
+#: extmail.c:1178
 msgid "MAIL: You cannot send mail to non-existent people."
 msgstr ""
 
-#: extmail.c:1133
+#: extmail.c:1183
 msgid "MAIL: You probably don't wanna send mail saying 'clear'."
 msgstr ""
 
-#: extmail.c:1139
+#: extmail.c:1189
 #, c-format
 msgid "MAIL: %s is not accepting mail from you right now."
 msgstr ""
 
-#: extmail.c:1146
+#: extmail.c:1196
 #, c-format
 msgid "MAIL: %s's mailbox is full. Can't send."
 msgstr ""
 
-#: extmail.c:1246
+#: extmail.c:1296
 #, c-format
 msgid "MAIL: You have a new message (%d) from %s."
 msgstr ""
 
-#: extmail.c:1269
+#: extmail.c:1319
 msgid "The postal service issues a warrant for your arrest."
 msgstr ""
 
-#: extmail.c:1286
+#: extmail.c:1336
 msgid "You annihilate the post office. All messages cleared."
 msgstr ""
 
-#: extmail.c:1303
+#: extmail.c:1353
 msgid "Go get some bugspray."
 msgstr ""
 
-#: extmail.c:1310 extmail.c:1410 extmail.c:1810 wiz.c:728
+#: extmail.c:1360 extmail.c:1460 extmail.c:1860 wiz.c:728
 #, c-format
 msgid "%s: No such player."
 msgstr ""
 
-#: extmail.c:1315
+#: extmail.c:1365
 #, c-format
 msgid "Mail cleared for %s(#%d)."
 msgstr ""
 
-#: extmail.c:1320
+#: extmail.c:1370
 #, c-format
 msgid "Bad object #%d has mail."
 msgstr ""
 
-#: extmail.c:1322
+#: extmail.c:1372
 #, c-format
 msgid "%s(#%d) has mail but is not a player."
 msgstr ""
 
-#: extmail.c:1328
+#: extmail.c:1378
 #, c-format
 msgid "Mail database top is %d, actual message count is %d. Fixing."
 msgstr ""
 
-#: extmail.c:1332
+#: extmail.c:1382
 msgid "Mail sanity check completed."
 msgstr ""
 
-#: extmail.c:1336
+#: extmail.c:1386
 #, c-format
 msgid "Fixing mail for #%d."
 msgstr ""
 
-#: extmail.c:1367
+#: extmail.c:1417
 msgid "Mail sanity fix completed."
 msgstr ""
 
-#: extmail.c:1369
+#: extmail.c:1419
 msgid "That is not a debugging option."
 msgstr ""
 
-#: extmail.c:1414 extmail.c:1814
+#: extmail.c:1464 extmail.c:1864
 msgid "The post office protects privacy!"
 msgstr ""
 
-#: extmail.c:1422
+#: extmail.c:1472
 #, c-format
 msgid "There are %d messages in the mail spool."
 msgstr ""
 
-#: extmail.c:1435
+#: extmail.c:1485
 #, c-format
 msgid "MAIL: There are %d msgs in the mail spool, %d unread, %d cleared."
 msgstr ""
 
-#: extmail.c:1453
+#: extmail.c:1503
 #, c-format
 msgid "MAIL: There are %d old msgs in the mail spool, totalling %d characters."
 msgstr ""
 
-#: extmail.c:1457
+#: extmail.c:1507
 #, c-format
 msgid "MAIL: There are %d new msgs in the mail spool, totalling %d characters."
 msgstr ""
 
-#: extmail.c:1461
+#: extmail.c:1511
 #, c-format
 msgid ""
 "MAIL: There are %d cleared msgs in the mail spool, totalling %d characters."
 msgstr ""
 
-#: extmail.c:1476
+#: extmail.c:1526
 #, c-format
 msgid "%s sent %d messages."
 msgstr ""
 
-#: extmail.c:1477
+#: extmail.c:1527
 #, c-format
 msgid "%s has %d messages."
 msgstr ""
 
-#: extmail.c:1506
+#: extmail.c:1556
 #, c-format
 msgid "Mail statistics for %s:"
 msgstr ""
 
-#: extmail.c:1509
+#: extmail.c:1559
 #, c-format
 msgid "%d messages sent, %d unread, %d cleared."
 msgstr ""
 
-#: extmail.c:1511
+#: extmail.c:1561
 #, c-format
 msgid "%d messages received, %d unread, %d cleared."
 msgstr ""
 
-#: extmail.c:1516
+#: extmail.c:1566
 #, c-format
 msgid "%d messages sent, %d unread, %d cleared, totalling %d characters."
 msgstr ""
 
-#: extmail.c:1520
+#: extmail.c:1570
 #, c-format
 msgid "%d messages received, %d unread, %d cleared, totalling %d characters."
 msgstr ""
 
-#: extmail.c:1525
+#: extmail.c:1575
 #, c-format
 msgid "Last is dated %s"
 msgstr ""
 
-#: extmail.c:1550
+#: extmail.c:1600
 msgid "MAIL: Invalid mail command."
 msgstr ""
 
-#: extmail.c:1614 extmail.c:1631 funcrypt.c:332
+#: extmail.c:1664 extmail.c:1681 funcrypt.c:332
 msgid "#-1 NO SUCH PLAYER"
 msgstr ""
 
-#: extmail.c:1638
+#: extmail.c:1688
 msgid "#-1 FOLDER MUST BE INTEGER"
 msgstr ""
 
-#: extmail.c:1698
+#: extmail.c:1748
 msgid "#-1 INVALID MESSAGE OR PLAYER"
 msgstr ""
 
-#: extmail.c:1729
+#: extmail.c:1779
 msgid "Permission denied"
 msgstr ""
 
-#: extmail.c:1735
+#: extmail.c:1785
 msgid "Invalid message specification"
 msgstr ""
 
-#: extmail.c:1788
+#: extmail.c:1838
 msgid "#-? fun_mailstats called with invalid called_as!"
 msgstr ""
 
-#: extmail.c:2483 extmail.c:2580
+#: extmail.c:2533 extmail.c:2630
 msgid "MAIL: Invalid message specification"
 msgstr ""
 
-#: extmail.c:2491 extmail.c:2501 extmail.c:2508 extmail.c:2518 extmail.c:2525
-#: extmail.c:2535
+#: extmail.c:2541 extmail.c:2551 extmail.c:2558 extmail.c:2568 extmail.c:2575
+#: extmail.c:2585
 msgid "MAIL: Invalid age"
 msgstr ""
 
-#: extmail.c:2495 extmail.c:2512 extmail.c:2529
+#: extmail.c:2545 extmail.c:2562 extmail.c:2579
 msgid "MAIL: Message ages must be integers"
 msgstr ""
 
-#: extmail.c:2541 extmail.c:2546
+#: extmail.c:2591 extmail.c:2596
 msgid "MAIL: Invalid dbref #"
 msgstr ""
 
-#: extmail.c:2553 extmail.c:2558
+#: extmail.c:2603 extmail.c:2608
 msgid "MAIL: Invalid player"
 msgstr ""
 
-#: extmail.c:2614
+#: extmail.c:2664
 msgid "Read "
 msgstr ""
 
-#: extmail.c:2616
+#: extmail.c:2666
 msgid "Unread "
 msgstr ""
 
-#: extmail.c:2618
+#: extmail.c:2668
 msgid "Cleared "
 msgstr ""
 
-#: extmail.c:2620
+#: extmail.c:2670
 msgid "Urgent "
 msgstr ""
 
-#: extmail.c:2622
+#: extmail.c:2672
 msgid "Mass "
 msgstr ""
 
-#: extmail.c:2624
+#: extmail.c:2674
 msgid "Fwd "
 msgstr ""
 
-#: extmail.c:2626
+#: extmail.c:2676
 msgid "Tagged"
 msgstr ""
 
-#: extmail.c:2652 extmail.c:2686
+#: extmail.c:2702 extmail.c:2736
 #, c-format
 msgid "MAIL: %d messages in folder %d [%s] (%d unread, %d cleared)."
 msgstr ""
 
-#: extmail.c:2657 extmail.c:2691
+#: extmail.c:2707 extmail.c:2741
 #, c-format
 msgid "MAIL: Warning! Limit on inbox messages is %d!"
 msgstr ""
 
-#: extmail.c:2663 extmail.c:2689
+#: extmail.c:2713 extmail.c:2739
 msgid ""
 "\n"
 "MAIL: You have no mail.\n"
 msgstr ""
 
-#: extmail.c:2835
+#: extmail.c:2885
 #, c-format
 msgid "You sent your message to the '%s' alias"
 msgstr ""
@@ -3015,309 +3111,309 @@
 msgid " Flags: "
 msgstr ""
 
-#: flags.c:1534 flags.c:1697
+#: flags.c:1535 flags.c:1699
 #, c-format
 msgid "Internal error: Unable to find flagspace '%s'!"
 msgstr ""
 
-#: flags.c:1538
+#: flags.c:1540
 #, c-format
 msgid "%s - I don't recognize that flag."
 msgstr ""
 
-#: flags.c:1564 flags.c:1573
+#: flags.c:1566 flags.c:1575
 #, c-format
 msgid "%s is no longer listening."
 msgstr ""
 
-#: flags.c:1582
+#: flags.c:1584
 #, c-format
 msgid "Exit %s is no longer broadcasting."
 msgstr ""
 
-#: flags.c:1590
+#: flags.c:1592
 msgid "Audible exits in this room have been deactivated."
 msgstr ""
 
-#: flags.c:1596
+#: flags.c:1598
 msgid "This room is no longer broadcasting."
 msgstr ""
 
-#: flags.c:1597
+#: flags.c:1599
 msgid "Your contents can no longer be heard from outside."
 msgstr ""
 
-#: flags.c:1607 flags.c:1668
+#: flags.c:1609 flags.c:1670
 msgid " (already)"
 msgstr ""
 
-#: flags.c:1608
+#: flags.c:1610
 msgid " reset."
 msgstr ""
 
-#: flags.c:1618
+#: flags.c:1620
 msgid "Warning: Setting trust flag on zoned object"
 msgstr ""
 
-#: flags.c:1625 flags.c:1634
+#: flags.c:1627 flags.c:1636
 #, c-format
 msgid "%s is now listening."
 msgstr ""
 
-#: flags.c:1644
+#: flags.c:1646
 #, c-format
 msgid "Exit %s is now broadcasting."
 msgstr ""
 
-#: flags.c:1652
+#: flags.c:1654
 msgid "Audible exits in this room have been activated."
 msgstr ""
 
-#: flags.c:1657
+#: flags.c:1659
 msgid "This room is now broadcasting."
 msgstr ""
 
-#: flags.c:1658
+#: flags.c:1660
 msgid "Your contents can now be heard from outside."
 msgstr ""
 
-#: flags.c:1669
+#: flags.c:1671
 msgid " set."
 msgstr ""
 
-#: flags.c:1702
+#: flags.c:1705
 #, c-format
 msgid "%s - I don't recognize that power."
 msgstr ""
 
-#: flags.c:1719
+#: flags.c:1722
 #, c-format
 msgid "%s - %s removed."
 msgstr ""
 
-#: flags.c:1721
+#: flags.c:1724
 #, c-format
 msgid "%s - %s (already) removed."
 msgstr ""
 
-#: flags.c:1726
+#: flags.c:1729
 #, c-format
 msgid "%s - %s (already) granted."
 msgstr ""
 
-#: flags.c:1729
+#: flags.c:1732
 #, c-format
 msgid "%s - %s granted."
 msgstr ""
 
-#: flags.c:1738
+#: flags.c:1741
 msgid "CLEARED"
 msgstr ""
 
-#: flags.c:1738
+#: flags.c:1741
 msgid "SET"
 msgstr ""
 
-#: flags.c:2035 flags.c:2076 flags.c:2139
+#: flags.c:2038 flags.c:2079 flags.c:2142
 #, c-format
 msgid "No such %s."
 msgstr ""
 
-#: flags.c:2039
+#: flags.c:2042
 msgid "Character"
 msgstr ""
 
-#: flags.c:2040
+#: flags.c:2043
 msgid "Aliases"
 msgstr ""
 
-#: flags.c:2041
+#: flags.c:2044
 msgid "Type(s)"
 msgstr ""
 
-#: flags.c:2043
+#: flags.c:2046
 msgid "Perms"
 msgstr ""
 
-#: flags.c:2045
+#: flags.c:2048
 msgid "ResetPrms"
 msgstr ""
 
-#: flags.c:2071 flags.c:2134 flags.c:2200
+#: flags.c:2074 flags.c:2137 flags.c:2203
 msgid "You don't have enough magic for that."
 msgstr ""
 
-#: flags.c:2080
+#: flags.c:2083
 #, c-format
 msgid "How do you want to restrict that %s?"
 msgstr ""
 
-#: flags.c:2108
+#: flags.c:2111
 #, c-format
 msgid "Permissions on %s %s set."
 msgstr ""
 
-#: flags.c:2143
+#: flags.c:2146
 #, c-format
 msgid "What type do you want to make that %s?"
 msgstr ""
 
-#: flags.c:2152 flags.c:2240
+#: flags.c:2155 flags.c:2243
 msgid "I don't understand the list of types."
 msgstr ""
 
-#: flags.c:2162
+#: flags.c:2165
 #, c-format
 msgid ""
 "Objects of other types already have this %s set. Search for them and remove "
 "it first."
 msgstr ""
 
-#: flags.c:2169
+#: flags.c:2172
 #, c-format
 msgid "Type of %s %s set."
 msgstr ""
 
-#: flags.c:2204
+#: flags.c:2207
 #, c-format
 msgid "You must provide a name for the %s."
 msgstr ""
 
-#: flags.c:2209
+#: flags.c:2212
 #, c-format
 msgid "%s names must be longer than one character."
 msgstr ""
 
-#: flags.c:2214
+#: flags.c:2217
 #, c-format
 msgid "%s names may not contain spaces."
 msgstr ""
 
-#: flags.c:2219
+#: flags.c:2222
 #, c-format
 msgid "That's not a valid %s name."
 msgstr ""
 
-#: flags.c:2225
+#: flags.c:2228
 msgid "You must provide more information."
 msgstr ""
 
-#: flags.c:2230 flags.c:2432
+#: flags.c:2233 flags.c:2435
 #, c-format
 msgid "%s characters must be single characters."
 msgstr ""
 
-#: flags.c:2247 flags.c:2438
+#: flags.c:2250 flags.c:2441
 #, c-format
 msgid "Letter conflicts with the %s %s."
 msgstr ""
 
-#: flags.c:2283
+#: flags.c:2286
 #, c-format
 msgid "Unknown failure adding %s."
 msgstr ""
 
-#: flags.c:2302 flags.c:2419 flags.c:2471 flags.c:2510 flags.c:2571
+#: flags.c:2305 flags.c:2422 flags.c:2474 flags.c:2513 flags.c:2574
 msgid "You don't look like God."
 msgstr ""
 
-#: flags.c:2306
+#: flags.c:2309
 msgid "You must provide a name for the alias."
 msgstr ""
 
-#: flags.c:2314
+#: flags.c:2317
 #, c-format
 msgid "%s aliases must be longer than one character."
 msgstr ""
 
-#: flags.c:2319
+#: flags.c:2322
 #, c-format
 msgid "%s aliases may not contain spaces."
 msgstr ""
 
-#: flags.c:2325
+#: flags.c:2328
 #, c-format
 msgid "Internal error: Unknown flag space '%s'!"
 msgstr ""
 
-#: flags.c:2331
+#: flags.c:2334
 #, c-format
 msgid "That alias already matches the %s %s."
 msgstr ""
 
-#: flags.c:2337 flags.c:2425 flags.c:2477 flags.c:2520 flags.c:2577
+#: flags.c:2340 flags.c:2428 flags.c:2480 flags.c:2523 flags.c:2580
 #, c-format
 msgid "I don't know that %s."
 msgstr ""
 
-#: flags.c:2341
+#: flags.c:2344
 #, c-format
 msgid "That %s is disabled."
 msgstr ""
 
-#: flags.c:2345
+#: flags.c:2348
 #, c-format
 msgid "That isn't an alias of the %s %s."
 msgstr ""
 
-#: flags.c:2352
+#: flags.c:2355
 #, c-format
 msgid "That's the %s's name, not an alias."
 msgstr ""
 
-#: flags.c:2358
+#: flags.c:2361
 msgid "Unknown failure deleting alias."
 msgstr ""
 
-#: flags.c:2366
+#: flags.c:2369
 msgid "Unknown failure adding alias."
 msgstr ""
 
-#: flags.c:2444
+#: flags.c:2447
 #, c-format
 msgid "Letter for %s %s set to '%c'."
 msgstr ""
 
-#: flags.c:2448
+#: flags.c:2451
 #, c-format
 msgid "Letter for %s %s cleared."
 msgstr ""
 
-#: flags.c:2481
+#: flags.c:2484
 #, c-format
 msgid "That %s is already disabled."
 msgstr ""
 
-#: flags.c:2486
+#: flags.c:2489
 #, c-format
 msgid "%s %s disabled."
 msgstr ""
 
-#: flags.c:2515
+#: flags.c:2518
 #, c-format
 msgid "Internal error: Unknown flagspace '%s'!"
 msgstr ""
 
-#: flags.c:2524
+#: flags.c:2527
 msgid "There are probably easier ways to crash your MUSH."
 msgstr ""
 
-#: flags.c:2550
+#: flags.c:2553
 #, c-format
 msgid "%s %s deleted."
 msgstr ""
 
-#: flags.c:2581
+#: flags.c:2584
 #, c-format
 msgid "That %s is not disabled."
 msgstr ""
 
-#: flags.c:2586
+#: flags.c:2589
 #, c-format
 msgid "%s %s enabled."
 msgstr ""
 
-#: flags.c:2658
+#: flags.c:2661
 msgid " (disabled)"
 msgstr ""
 
@@ -3329,7 +3425,7 @@
 msgid "#-1 CONVERSION ERROR"
 msgstr ""
 
-#: funcrypt.c:84 funcrypt.c:164 parse.c:101
+#: funcrypt.c:84 funcrypt.c:164 parse.c:103
 msgid "#-1 FUNCTION DISABLED"
 msgstr ""
 
@@ -3341,158 +3437,158 @@
 msgid "#-1 SEPARATOR MUST BE ONE CHARACTER"
 msgstr ""
 
-#: function.c:835
+#: function.c:839
 #, c-format
 msgid "Functions: %s"
 msgstr ""
 
-#: function.c:1041 function.c:1079
+#: function.c:1043 function.c:1081
 msgid "There's already a function with that name."
 msgstr ""
 
-#: function.c:1046 function.c:1085 function.c:1524
+#: function.c:1048 function.c:1087 function.c:1526
 msgid "Invalid function name."
 msgstr ""
 
-#: function.c:1052 function.c:1671
+#: function.c:1054 function.c:1673
 msgid "That's not a builtin function."
 msgstr ""
 
-#: function.c:1058
+#: function.c:1060
 msgid "Function cloned."
 msgstr ""
 
-#: function.c:1093 function.c:1303 function.c:1710 function.c:1758
-#: function.c:1791
+#: function.c:1095 function.c:1305 function.c:1712 function.c:1760
+#: function.c:1793
 msgid "No such function."
 msgstr ""
 
-#: function.c:1100
+#: function.c:1102
 msgid "You cannot alias @functions."
 msgstr ""
 
-#: function.c:1107
+#: function.c:1109
 msgid "Alias added."
 msgstr ""
 
-#: function.c:1294
+#: function.c:1296
 msgid "Restrict what function?"
 msgstr ""
 
-#: function.c:1298
+#: function.c:1300
 msgid "Do what with the function?"
 msgstr ""
 
-#: function.c:1309
+#: function.c:1311
 msgid "Builtin function"
 msgstr ""
 
-#: function.c:1314
+#: function.c:1316
 msgid "Restrictions unchanged."
 msgstr ""
 
-#: function.c:1316
+#: function.c:1318
 msgid "Restrictions modified."
 msgstr ""
 
-#: function.c:1460
+#: function.c:1462
 msgid "No global user-defined functions exist."
 msgstr ""
 
-#: function.c:1471
+#: function.c:1473
 msgid "Function Name                   Dbref #    Attrib"
 msgstr ""
 
-#: function.c:1489
+#: function.c:1491
 msgid "User functions:"
 msgstr ""
 
-#: function.c:1518
+#: function.c:1520
 msgid "You must specify an object and an attribute."
 msgstr ""
 
-#: function.c:1535
+#: function.c:1537
 msgid "No permission to control object."
 msgstr ""
 
-#: function.c:1539
+#: function.c:1541
 msgid "No permission to examine object."
 msgstr ""
 
-#: function.c:1553
+#: function.c:1555
 msgid "Expected between 1 and 5 arguments."
 msgstr ""
 
-#: function.c:1589
+#: function.c:1591
 msgid "Function added."
 msgstr ""
 
-#: function.c:1594
+#: function.c:1596
 msgid "You cannot change that built-in function."
 msgstr ""
 
-#: function.c:1627
+#: function.c:1629
 msgid "Function updated."
 msgstr ""
 
-#: function.c:1664
+#: function.c:1666
 msgid "Restore what?"
 msgstr ""
 
-#: function.c:1676
+#: function.c:1678
 msgid "That function isn't deleted!"
 msgstr ""
 
-#: function.c:1681
+#: function.c:1683
 msgid "Restored."
 msgstr ""
 
-#: function.c:1717
+#: function.c:1719
 msgid "Function alias deleted."
 msgstr ""
 
-#: function.c:1721 function.c:1730
+#: function.c:1723 function.c:1732
 msgid "You can't delete that @function."
 msgstr ""
 
-#: function.c:1725 function.c:1735
+#: function.c:1727 function.c:1737
 msgid "Function deleted."
 msgstr ""
 
-#: function.c:1763
+#: function.c:1765
 msgid "You can't disable aliases."
 msgstr ""
 
-#: function.c:1824
+#: function.c:1826
 #, c-format
 msgid "Name      : %s() (%s%s)"
 msgstr ""
 
-#: function.c:1923
+#: function.c:1925
 #, c-format
 msgid "Flags     : %s"
 msgstr ""
 
-#: function.c:1927
+#: function.c:1929
 #, c-format
 msgid "Location  : #%d/%s\n"
 msgstr ""
 
-#: function.c:1935
+#: function.c:1937
 msgid "(Commas okay in last argument)"
 msgstr ""
 
-#: function.c:1941
+#: function.c:1943
 #, c-format
 msgid "Arguments : %d %s"
 msgstr ""
 
-#: function.c:1943
+#: function.c:1945
 #, c-format
 msgid "Arguments : At least %d %s"
 msgstr ""
 
-#: function.c:1946
+#: function.c:1948
 #, c-format
 msgid "Arguments : %d to %d %s"
 msgstr ""
@@ -3514,7 +3610,7 @@
 msgid "#-1 BAD ARGUMENT FORMAT TO GET_EVAL"
 msgstr ""
 
-#: fundb.c:890 game.c:1594
+#: fundb.c:890 game.c:1609
 msgid "#-1 INVALID LOCATION"
 msgstr ""
 
@@ -3571,56 +3667,56 @@
 msgid "#-1 BAD ARGUMENT FORMAT TO ATTRIB_SET"
 msgstr ""
 
-#: fundb.c:2313 funlist.c:3136
+#: fundb.c:2311
 msgid "#-1 NO SUCH ATTRIBUTE"
 msgstr ""
 
-#: fundb.c:2317 funlist.c:3140
+#: fundb.c:2315 predicat.c:1425
 msgid "#-1 INVALID GREP PATTERN"
 msgstr ""
 
-#: fundb.c:2391 fundb.c:2395
+#: fundb.c:2394 fundb.c:2398
 msgid "#-1 ARGUMENT MUST BE OBJ/ATTR"
 msgstr ""
 
-#: fundb.c:2424 fundb.c:2446
+#: fundb.c:2427 fundb.c:2449
 msgid "#-1 INVALID OBJECT"
 msgstr ""
 
-#: funlist.c:216
+#: funlist.c:221
 msgid "#-1 LISTS MUST BE OF EQUAL SIZE"
 msgstr ""
 
-#: funlist.c:1248 funmisc.c:456
+#: funlist.c:1262 funmisc.c:456
 msgid "#-1 NUMBER OUT OF RANGE"
 msgstr ""
 
-#: funlist.c:1718 funlist.c:2024
+#: funlist.c:1732 funlist.c:2038
 msgid "#-1 CAN ONLY TEST ONE ELEMENT"
 msgstr ""
 
-#: funlist.c:2160
+#: funlist.c:2174
 msgid "#-1 NEED A WORD"
 msgstr ""
 
-#: funlist.c:2166
+#: funlist.c:2180
 msgid "#-1 TOO MANY WORDS"
 msgstr ""
 
-#: funlist.c:2173
+#: funlist.c:2187
 msgid "#-1 NUMBER OF WORDS MUST BE EQUAL"
 msgstr ""
 
-#: funlist.c:2212
+#: funlist.c:2228
 msgid "#-1 TOO MANY ITERS"
 msgstr ""
 
-#: funlist.c:2362
+#: funlist.c:2424
 msgid "#-1 STEP OUT OF RANGE"
 msgstr ""
 
-#: funlist.c:2770 funlist.c:2785 funlist.c:2878 funlist.c:2893 funlist.c:3009
-#: funlist.c:3150 funlist.c:3158 funlist.c:3241 funlist.c:3249
+#: funlist.c:2837 funlist.c:2852 funlist.c:2945 funlist.c:2960 funlist.c:3076
+#: funlist.c:3210 funlist.c:3218 predicat.c:1449 predicat.c:1460
 msgid "#-1 REGEXP ERROR: "
 msgstr ""
 
@@ -3721,20 +3817,24 @@
 msgid "#-1 UNABLE TO ALLOCATE MEMORY"
 msgstr ""
 
-#: funmisc.c:795
+#: funmisc.c:496 funmisc.c:613
+msgid "#-1 TOO MANY SWITCHES"
+msgstr ""
+
+#: funmisc.c:857
 msgid "#-1 FUNCTION (SOUNDEX) REQUIRES A SINGLE WORD ARGUMENT"
 msgstr ""
 
-#: funmisc.c:814
+#: funmisc.c:876
 msgid "#-1 FUNCTION (SOUNDLIKE) REQUIRES TWO ONE-WORD ARGUMENTS"
 msgstr ""
 
-#: funmisc.c:1020
+#: funmisc.c:1094
 #, c-format
 msgid "I don't think #%d wants to hear from you."
 msgstr ""
 
-#: funmisc.c:1051 funmisc.c:1054
+#: funmisc.c:1126 funmisc.c:1129
 #, c-format
 msgid "Average: %.2f   Min: %u   Max: %u"
 msgstr ""
@@ -3811,63 +3911,63 @@
 msgid "#-1 INVALID DBREF"
 msgstr ""
 
-#: funstr.c:647 funstr.c:789 funstr.c:1450
+#: funstr.c:643 funstr.c:785 funstr.c:1446
 msgid "#-1 STRING LENGTHS MUST BE EQUAL"
 msgstr ""
 
-#: funstr.c:719 funstr.c:727 funstr.c:757 funstr.c:765
+#: funstr.c:715 funstr.c:723 funstr.c:753 funstr.c:761
 msgid "#-1 TR CANNOT ACCEPT NONPRINTING CHARS"
 msgstr ""
 
-#: funstr.c:864
+#: funstr.c:860
 msgid "#-1 ARGUMENT MUST BE NON-NEGATIVE INTEGER"
 msgstr ""
 
-#: funstr.c:944 funstr.c:995 funstr.c:1047 funstr.c:1066
+#: funstr.c:940 funstr.c:991 funstr.c:1043 funstr.c:1062
 msgid "#-1 FILL ARGUMENT MAY NOT BE ZERO-LENGTH"
 msgstr ""
 
-#: funstr.c:1416
+#: funstr.c:1412
 msgid "#-1 FUNCTION (ORD) EXPECTS ONE CHARACTER"
 msgstr ""
 
-#: funstr.c:1425 funstr.c:1443
+#: funstr.c:1421 funstr.c:1439
 msgid "#-1 UNPRINTABLE CHARACTER"
 msgstr ""
 
-#: funstr.c:1439
+#: funstr.c:1435
 msgid "#-1 THIS ISN'T UNICODE"
 msgstr ""
 
-#: funstr.c:1632
+#: funstr.c:1628
 msgid "#-1 WIDTH TOO SMALL"
 msgstr ""
 
-#: funstr.c:1923 funstr.c:1948
+#: funstr.c:1919 funstr.c:1944
 msgid "#-1 INVALID ALIGN STRING"
 msgstr ""
 
-#: funstr.c:1962
+#: funstr.c:1958
 msgid "#-1 CANNOT HAVE COLUMNS OF NEGATIVE SIZE"
 msgstr ""
 
-#: funstr.c:1966 funstr.c:1972
+#: funstr.c:1962 funstr.c:1968
 msgid "#-1 CANNOT HAVE COLUMNS THAT LARGE"
 msgstr ""
 
-#: funstr.c:1977
+#: funstr.c:1973
 msgid "#-1 NOT ENOUGH COLUMNS FOR ALIGN"
 msgstr ""
 
-#: funstr.c:1981
+#: funstr.c:1977
 msgid "#-1 TOO MANY COLUMNS FOR ALIGN"
 msgstr ""
 
-#: funstr.c:1987 funstr.c:2022
+#: funstr.c:1983 funstr.c:2018
 msgid "#-1 INVALID NUMBER OF ARGUMENTS TO ALIGN"
 msgstr ""
 
-#: funstr.c:1992 funstr.c:2027
+#: funstr.c:1988 funstr.c:2023
 msgid "#-1 FILLER MUST BE ONE CHARACTER"
 msgstr ""
 
@@ -3888,18 +3988,14 @@
 msgid "#-1 INVALID TIMESTRING"
 msgstr ""
 
-#: funufun.c:57 parse.c:1261
+#: funufun.c:57 parse.c:1322
 msgid "#-1 FUNCTION ("
 msgstr ""
 
-#: funufun.c:59 parse.c:1263
+#: funufun.c:59 parse.c:1324
 msgid ") NOT FOUND"
 msgstr ""
 
-#: funufun.c:331
-msgid "#-1 NO SUCH USER FUNCTION"
-msgstr ""
-
 #: game.c:185
 msgid "Permission denied. Invalid checkpoint interval."
 msgstr ""
@@ -3955,7 +4051,7 @@
 msgstr ""
 
 #: game.c:1281 game.c:1288 look.c:663 look.c:685 look.c:712 look.c:720
-#: move.c:555 move.c:563 move.c:599 move.c:875 move.c:1044 speech.c:564
+#: move.c:555 move.c:563 move.c:599 move.c:877 move.c:1046 speech.c:564
 msgid "I don't see that here."
 msgstr ""
 
@@ -3980,117 +4076,117 @@
 msgid "Logged."
 msgstr ""
 
-#: game.c:1598
+#: game.c:1613
 msgid "#-1 NO COMMAND"
 msgstr ""
 
-#: game.c:1703
+#: game.c:1718
 msgid "Sorry, you are in an invalid location."
 msgstr ""
 
-#: game.c:1707
+#: game.c:1722
 msgid "What command do you want to scan for?"
 msgstr ""
 
-#: game.c:1714
+#: game.c:1729
 msgid "Matches on contents of this room:"
 msgstr ""
 
-#: game.c:1729
+#: game.c:1744
 #, c-format
 msgid "Matched here: %s  [%d:%s]"
 msgstr ""
 
-#: game.c:1735
+#: game.c:1750
 msgid "Matches on carried objects:"
 msgstr ""
 
-#: game.c:1749
+#: game.c:1764
 #, c-format
 msgid "Matched self: %s  [%d:%s]"
 msgstr ""
 
-#: game.c:1760
+#: game.c:1775
 msgid "Matches on zone master room of location:"
 msgstr ""
 
-#: game.c:1775
+#: game.c:1790
 #, c-format
 msgid "Matched zone of location: %s  [%d:%s]"
 msgstr ""
 
-#: game.c:1787
+#: game.c:1802
 msgid "Matches on personal zone master room:"
 msgstr ""
 
-#: game.c:1799
+#: game.c:1814
 #, c-format
 msgid "Matched personal zone: %s  [%d:%s]"
 msgstr ""
 
-#: game.c:1810
+#: game.c:1825
 msgid "Matches on objects in the Master Room:"
 msgstr ""
 
-#: game.c:1848
+#: game.c:1863
 msgid "What do you want to do with the list?"
 msgstr ""
 
-#: game.c:1856
+#: game.c:1871
 msgid "Separator must be one character."
 msgstr ""
 
-#: game.c:2037
+#: game.c:2052
 msgid "Error -- cannot execute uptime."
 msgstr ""
 
-#: game.c:2119
+#: game.c:2134
 msgid "Up since"
 msgstr ""
 
-#: game.c:2123
+#: game.c:2138
 msgid "Last reboot"
 msgstr ""
 
-#: game.c:2125
+#: game.c:2140
 msgid "Total reboots"
 msgstr ""
 
-#: game.c:2129
+#: game.c:2144
 msgid "Time now"
 msgstr ""
 
-#: game.c:2134
+#: game.c:2149
 msgid "Time of last database save"
 msgstr ""
 
-#: game.c:2142 game.c:2149 game.c:2156 game.c:2164
+#: game.c:2157 game.c:2164 game.c:2171 game.c:2179
 #, c-format
 msgid "%29s: %ld minutes %ld seconds, at %s."
 msgstr ""
 
-#: game.c:2143
+#: game.c:2158
 msgid "Time until next database save"
 msgstr ""
 
-#: game.c:2150
+#: game.c:2165
 msgid "Time until next dbck check"
 msgstr ""
 
-#: game.c:2157
+#: game.c:2172
 msgid "Time until next purge"
 msgstr ""
 
-#: game.c:2165
+#: game.c:2180
 msgid "Time until next @warnings"
 msgstr ""
 
-#: game.c:2181
+#: game.c:2196
 #, c-format
 msgid "PennMUSH Uptime: %ld days %ld hours %ld minutes %ld seconds"
 msgstr ""
 
-#: game.c:2362 game.c:2380
+#: game.c:2377 game.c:2406
 msgid "I don't understand what you want to @list."
 msgstr ""
 
@@ -4164,84 +4260,84 @@
 msgid "#-1 UNAVAILABLE"
 msgstr ""
 
-#: lock.c:662
+#: lock.c:663
 msgid "Unknown lock type."
 msgstr ""
 
-#: lock.c:666
+#: lock.c:667
 msgid "The character '|' may not be used in lock names."
 msgstr ""
 
-#: lock.c:675
+#: lock.c:676
 msgid "That is not a valid lock name."
 msgstr ""
 
-#: lock.c:705
+#: lock.c:706
 #, c-format
 msgid "%s(%s) - %s (already) unlocked."
 msgstr ""
 
-#: lock.c:709
+#: lock.c:710
 #, c-format
 msgid "%s(%s) - %s unlocked."
 msgstr ""
 
-#: lock.c:746
+#: lock.c:747
 msgid "I don't see what you want to lock!"
 msgstr ""
 
-#: lock.c:749
+#: lock.c:750
 msgid "I don't know which one you want to lock!"
 msgstr ""
 
-#: lock.c:753
+#: lock.c:754
 msgid "You can't lock that!"
 msgstr ""
 
-#: lock.c:757
+#: lock.c:758
 msgid "Why would you want to lock garbage?"
 msgstr ""
 
-#: lock.c:767
+#: lock.c:768 wiz.c:1935
 msgid "I don't understand that key."
 msgstr ""
 
-#: lock.c:773
+#: lock.c:774
 #, c-format
 msgid "%s(%s) - %s locked."
 msgstr ""
 
-#: lock.c:949
+#: lock.c:950
 msgid "No lock name given."
 msgstr ""
 
-#: lock.c:963
+#: lock.c:964
 msgid "Unrecognized lock flag."
 msgstr ""
 
-#: lock.c:969
+#: lock.c:970
 msgid "No such lock."
 msgstr ""
 
-#: lock.c:985
+#: lock.c:986
 msgid "lock flags unset"
 msgstr ""
 
-#: lock.c:985
+#: lock.c:986
 msgid "lock flags set"
 msgstr ""
 
-#: lock.c:1006
+#: lock.c:1007
 #, c-format
 msgid "Unlocked zone %s - automatically zone-locking to itself"
 msgstr ""
 
-#: lock.c:1014
+#: lock.c:1015
 #, c-format
 msgid "Zone %s really should have a more secure zone-lock."
 msgstr ""
 
-#: lock.c:1019
+#: lock.c:1020
 #, c-format
 msgid ""
 "Warning: Zone %s may have loose zone lock. Lock zones to =player, not player"
@@ -4328,7 +4424,7 @@
 msgid "%s [#%d%s] is veiled"
 msgstr ""
 
-#: look.c:427 look.c:431 look.c:437 look.c:442 predicat.c:1435 set.c:939
+#: look.c:427 look.c:431 look.c:437 look.c:442 set.c:938
 msgid "No matching attributes."
 msgstr ""
 
@@ -4336,11 +4432,11 @@
 msgid "You see nothing special."
 msgstr ""
 
-#: look.c:559 look.c:924
+#: look.c:559 look.c:925
 msgid "Contents:"
 msgstr ""
 
-#: look.c:561 look.c:932
+#: look.c:561 look.c:933
 msgid "Obvious exits:"
 msgstr ""
 
@@ -4361,257 +4457,257 @@
 msgid "You can't look at that from here."
 msgstr ""
 
-#: look.c:733
+#: look.c:734
 msgid "I can't tell which one you mean."
 msgstr ""
 
-#: look.c:754
+#: look.c:755
 msgid "You can't see that from here."
 msgstr ""
 
-#: look.c:768 look.c:922
+#: look.c:769 look.c:923
 msgid "Carrying:"
 msgstr ""
 
-#: look.c:847 look.c:935
+#: look.c:848 look.c:936
 msgid " is owned by "
 msgstr ""
 
-#: look.c:876
+#: look.c:877
 #, c-format
 msgid "Owner: %s  Zone: %s  %s: %d"
 msgstr ""
 
-#: look.c:879
+#: look.c:880
 #, c-format
 msgid "Parent: %s"
 msgstr ""
 
-#: look.c:883
+#: look.c:884
 #, c-format
 msgid "%s Lock [#%d%s]: %s"
 msgstr ""
 
-#: look.c:888
+#: look.c:889
 #, c-format
 msgid "Powers: %s"
 msgstr ""
 
-#: look.c:892
+#: look.c:893
 #, c-format
 msgid "Warnings checked: %s"
 msgstr ""
 
-#: look.c:895
+#: look.c:896
 #, c-format
 msgid "Created: %s"
 msgstr ""
 
-#: look.c:897
+#: look.c:898
 #, c-format
 msgid "Last Modification: %s"
 msgstr ""
 
-#: look.c:948
+#: look.c:949
 msgid "Exits:"
 msgstr ""
 
-#: look.c:952
+#: look.c:953
 msgid "No exits."
 msgstr ""
 
-#: look.c:956
+#: look.c:957
 #, c-format
 msgid "Dropped objects go to: %s"
 msgstr ""
 
-#: look.c:963
+#: look.c:964
 #, c-format
 msgid "Home: %s"
 msgstr ""
 
-#: look.c:967
+#: look.c:968
 #, c-format
 msgid "Location: %s"
 msgstr ""
 
-#: look.c:989
+#: look.c:990
 #, c-format
 msgid "Source: %s"
 msgstr ""
 
-#: look.c:995
+#: look.c:996
 msgid "Destination: *UNLINKED*"
 msgstr ""
 
-#: look.c:998
+#: look.c:999
 msgid "Destination: *HOME*"
 msgstr ""
 
-#: look.c:1002
+#: look.c:1003
 #, c-format
 msgid "Destination: %s"
 msgstr ""
 
-#: look.c:1023
+#: look.c:1024
 #, c-format
 msgid "You have unlimited %s."
 msgstr ""
 
-#: look.c:1026
+#: look.c:1027
 #, c-format
 msgid "You have %d %s."
 msgstr ""
 
-#: look.c:1029
+#: look.c:1030
 #, c-format
 msgid "You may give unlimited %s"
 msgstr ""
 
-#: look.c:1095
+#: look.c:1096
 msgid "You aren't carrying anything."
 msgstr ""
 
-#: look.c:1097
+#: look.c:1098
 msgid "You are carrying:"
 msgstr ""
 
-#: look.c:1125 look.c:1135
+#: look.c:1126 look.c:1136
 msgid "Invalid range argument"
 msgstr ""
 
-#: look.c:1147
+#: look.c:1148
 #, c-format
 msgid "*** %d objects found ***"
 msgstr ""
 
-#: look.c:1180
+#: look.c:1181
 msgid "Invalid parameter."
 msgstr ""
 
-#: look.c:1185
+#: look.c:1186
 msgid "Listening in ROOM:"
 msgstr ""
 
-#: look.c:1191 look.c:1216 look.c:1254
+#: look.c:1192 look.c:1217 look.c:1255
 #, c-format
 msgid "%s is listening."
 msgstr ""
 
-#: look.c:1193 look.c:1218 look.c:1256
+#: look.c:1194 look.c:1219 look.c:1257
 #, c-format
 msgid "%s [owner: %s] is listening."
 msgstr ""
 
-#: look.c:1200
+#: look.c:1201
 #, c-format
 msgid "%s (this room) [speech]. (connected)"
 msgstr ""
 
-#: look.c:1203
+#: look.c:1204
 #, c-format
 msgid "%s (this room) [speech]."
 msgstr ""
 
-#: look.c:1206
+#: look.c:1207
 #, c-format
 msgid "%s (this room) [commands]."
 msgstr ""
 
-#: look.c:1208
+#: look.c:1209
 #, c-format
 msgid "%s (this room) [broadcasting]."
 msgstr ""
 
-#: look.c:1225 look.c:1263
+#: look.c:1226 look.c:1264
 #, c-format
 msgid "%s [speech]. (connected)"
 msgstr ""
 
-#: look.c:1227 look.c:1265
+#: look.c:1228 look.c:1266
 #, c-format
 msgid "%s [speech]."
 msgstr ""
 
-#: look.c:1230 look.c:1268
+#: look.c:1231 look.c:1269
 #, c-format
 msgid "%s [commands]."
 msgstr ""
 
-#: look.c:1235
+#: look.c:1236
 msgid "Listening EXITS:"
 msgstr ""
 
-#: look.c:1241
+#: look.c:1242
 #, c-format
 msgid "%s [broadcasting]."
 msgstr ""
 
-#: look.c:1247
+#: look.c:1248
 msgid "Listening in your INVENTORY:"
 msgstr ""
 
-#: look.c:1286
+#: look.c:1287
 msgid "You must specify a valid player name."
 msgstr ""
 
-#: look.c:1290
+#: look.c:1291
 msgid "That player does not seem to exist."
 msgstr ""
 
-#: look.c:1294
+#: look.c:1295
 msgid "That player wishes to have some privacy."
 msgstr ""
 
-#: look.c:1295
+#: look.c:1296
 #, c-format
 msgid "%s tried to locate you and failed."
 msgstr ""
 
-#: look.c:1299
+#: look.c:1300
 #, c-format
 msgid "%s is at: %s."
 msgstr ""
 
-#: look.c:1302
+#: look.c:1303
 #, c-format
 msgid "%s has just located your position."
 msgstr ""
 
-#: look.c:1362
+#: look.c:1363
 #, c-format
 msgid "%s(#%d) [from: %s(#%d)]"
 msgstr ""
 
-#: look.c:1369
+#: look.c:1370
 #, c-format
 msgid "%s(#%d) [dropto]"
 msgstr ""
 
-#: look.c:1376
+#: look.c:1377
 #, c-format
 msgid "%s(#%d) [home]"
 msgstr ""
 
-#: look.c:1388 wiz.c:1222 wiz.c:1389
+#: look.c:1389 wiz.c:1222 wiz.c:1389
 msgid "Nothing found."
 msgstr ""
 
-#: look.c:1391
+#: look.c:1392
 msgid "----------  Entrances Done  ----------"
 msgstr ""
 
-#: look.c:1394 wiz.c:1344
+#: look.c:1395 wiz.c:1344
 #, c-format
 msgid "Totals: Rooms...%d  Exits...%d  Things...%d  Players...%d"
 msgstr ""
 
-#: look.c:1503
+#: look.c:1504
 #, c-format
 msgid "@@ No attributes match '%s'. @@"
 msgstr ""
 
-#: look.c:1564
+#: look.c:1565
 msgid "What do you want to @decompile?"
 msgstr ""
 
@@ -4805,26 +4901,26 @@
 msgid "MAIL: %s removed from alias %s"
 msgstr ""
 
-#: markup.c:1144
+#: markup.c:1153
 msgid "Inspecting ansi string"
 msgstr ""
 
-#: markup.c:1145
+#: markup.c:1154
 #, c-format
 msgid "  Text: %s"
 msgstr ""
 
-#: markup.c:1146
+#: markup.c:1155
 #, c-format
 msgid "  Nmarkups: %d"
 msgstr ""
 
-#: markup.c:1152
+#: markup.c:1161
 #, c-format
 msgid "    %d (%s): (start: %d end: %d) start_code: %s stop_code: %s"
 msgstr ""
 
-#: markup.c:1157
+#: markup.c:1166
 msgid "Inspecting ansi string complete"
 msgstr ""
 
@@ -4879,22 +4975,22 @@
 msgid "%s is now the first exit in %s."
 msgstr ""
 
-#: move.c:580 move.c:799
+#: move.c:580 move.c:801
 #, c-format
 msgid "%s was taken from you."
 msgstr ""
 
-#: move.c:581 move.c:631 move.c:800
+#: move.c:581 move.c:631 move.c:802
 #, c-format
 msgid "%s took you."
 msgstr ""
 
-#: move.c:583 move.c:802
+#: move.c:583 move.c:804
 #, c-format
 msgid "You take %s from %s."
 msgstr ""
 
-#: move.c:587 move.c:806
+#: move.c:587 move.c:808
 #, c-format
 msgid "takes %s from %s."
 msgstr ""
@@ -4953,150 +5049,150 @@
 msgid "Sorry, you can't drop exits."
 msgstr ""
 
-#: move.c:688
+#: move.c:689
 msgid "You can't seem to get rid of that."
 msgstr ""
 
-#: move.c:691
+#: move.c:693
 msgid "You can't seem to drop things here."
 msgstr ""
 
-#: move.c:694
+#: move.c:696
 msgid "Dropped."
 msgstr ""
 
-#: move.c:699 move.c:702 move.c:823 move.c:826
+#: move.c:701 move.c:704 move.c:825 move.c:828
 #, c-format
 msgid "%s drops you."
 msgstr ""
 
-#: move.c:708 move.c:830
+#: move.c:710 move.c:832
 #, c-format
 msgid "You drop %s."
 msgstr ""
 
-#: move.c:711 move.c:833
+#: move.c:713 move.c:835
 #, c-format
 msgid "drops %s."
 msgstr ""
 
-#: move.c:759
+#: move.c:761
 msgid "You can't empty that from here."
 msgstr ""
 
-#: move.c:840
+#: move.c:842
 #, c-format
 msgid "You remove 1 object from %s."
 msgstr ""
 
-#: move.c:842
+#: move.c:844
 #, c-format
 msgid "You remove %d objects from %s."
 msgstr ""
 
-#: move.c:887
+#: move.c:889
 msgid "Sorry, you must remain beside yourself!"
 msgstr ""
 
-#: move.c:911
+#: move.c:913
 msgid "You can't leave."
 msgstr ""
 
-#: move.c:985
+#: move.c:987
 msgid "I can't tell which one to follow."
 msgstr ""
 
-#: move.c:993
+#: move.c:995
 msgid "You don't see that here."
 msgstr ""
 
-#: move.c:997
+#: move.c:999
 msgid "You can only follow players and things."
 msgstr ""
 
-#: move.c:1001
+#: move.c:1003
 msgid "You chase your tail for a while and feel silly."
 msgstr ""
 
-#: move.c:1006
+#: move.c:1008
 #, c-format
 msgid "You're already following %s."
 msgstr ""
 
-#: move.c:1012
+#: move.c:1014
 msgid "You're not allowed to follow."
 msgstr ""
 
-#: move.c:1019
+#: move.c:1021
 #, c-format
 msgid "You are following: %s"
 msgstr ""
 
-#: move.c:1020
+#: move.c:1022
 #, c-format
 msgid "You are followed by: %s"
 msgstr ""
 
-#: move.c:1040
+#: move.c:1042
 msgid "I can't tell which one to stop following."
 msgstr ""
 
-#: move.c:1049
+#: move.c:1051
 #, c-format
 msgid "You're not following %s."
 msgstr ""
 
-#: move.c:1057
+#: move.c:1059
 msgid "You stop following anyone."
 msgstr ""
 
-#: move.c:1078
+#: move.c:1080
 msgid "I don't recognize who you want to dismiss."
 msgstr ""
 
-#: move.c:1083
+#: move.c:1085
 #, c-format
 msgid "%s isn't following you."
 msgstr ""
 
-#: move.c:1091
+#: move.c:1093
 msgid "You dismiss all your followers."
 msgstr ""
 
-#: move.c:1111
+#: move.c:1113
 msgid "I don't recognize who you want to desert."
 msgstr ""
 
-#: move.c:1118
+#: move.c:1120
 #, c-format
 msgid "%s isn't following you, nor vice versa."
 msgstr ""
 
-#: move.c:1128
+#: move.c:1130
 msgid "You desert everyone you're leading or following."
 msgstr ""
 
-#: move.c:1179
+#: move.c:1181
 #, c-format
 msgid "You begin following %s."
 msgstr ""
 
-#: move.c:1180
+#: move.c:1182
 #, c-format
 msgid "%s begins following you."
 msgstr ""
 
-#: move.c:1226 move.c:1340
+#: move.c:1228 move.c:1342
 #, c-format
 msgid "You stop following %s."
 msgstr ""
 
-#: move.c:1227 move.c:1368
+#: move.c:1229 move.c:1370
 #, c-format
 msgid "%s stops following you."
 msgstr ""
 
-#: move.c:1402
+#: move.c:1404
 #, c-format
 msgid "You follow %s."
 msgstr ""
@@ -5110,208 +5206,226 @@
 msgid "[%s(#%d)'s %s(#%d)] "
 msgstr ""
 
-#: parse.c:89
+#: parse.c:91
 msgid "#-1 ARGUMENT MUST BE INTEGER"
 msgstr ""
 
-#: parse.c:90
+#: parse.c:92
 msgid "#-1 ARGUMENTS MUST BE INTEGERS"
 msgstr ""
 
-#: parse.c:91
+#: parse.c:93
 msgid "#-1 ARGUMENT MUST BE POSITIVE INTEGER"
 msgstr ""
 
-#: parse.c:92
+#: parse.c:94
 msgid "#-1 ARGUMENTS MUST BE POSITIVE INTEGERS"
 msgstr ""
 
-#: parse.c:93
+#: parse.c:95
 msgid "#-1 ARGUMENT MUST BE NUMBER"
 msgstr ""
 
-#: parse.c:94
+#: parse.c:96
 msgid "#-1 ARGUMENTS MUST BE NUMBERS"
 msgstr ""
 
-#: parse.c:95
+#: parse.c:97
 msgid "#-1 FUNCTION INVOCATION LIMIT EXCEEDED"
 msgstr ""
 
-#: parse.c:96
+#: parse.c:98
 msgid "#-1 CALL LIMIT EXCEEDED"
 msgstr ""
 
-#: parse.c:98
+#: parse.c:100
 msgid "#-1 NO PERMISSION TO GET ATTRIBUTE"
 msgstr ""
 
-#: parse.c:99
+#: parse.c:101
 msgid "#-1 NO MATCH"
 msgstr ""
 
-#: parse.c:100 sort.c:335
+#: parse.c:102 sort.c:337
 msgid "#-1 NO SUCH OBJECT VISIBLE"
 msgstr ""
 
-#: parse.c:102
+#: parse.c:104
 msgid "#-1 OUT OF RANGE"
 msgstr ""
 
-#: parse.c:690
+#: parse.c:105
+msgid "#-1 ARGUMENT OUT OF RANGE"
+msgstr ""
+
+#: parse.c:713
 msgid "CPU usage exceeded."
 msgstr ""
 
-#: parse.c:1312
+#: parse.c:1373
 msgid "#-1 FUNCTION RECURSION LIMIT EXCEEDED"
 msgstr ""
 
-#: parse.c:1409
+#: parse.c:1470
 #, c-format
 msgid "#-1 FUNCTION (%s) EXPECTS "
 msgstr ""
 
-#: parse.c:1414
+#: parse.c:1475
 msgid " OR "
 msgstr ""
 
-#: parse.c:1417
+#: parse.c:1478
 msgid "AT LEAST "
 msgstr ""
 
-#: parse.c:1420
+#: parse.c:1481
 msgid "BETWEEN "
 msgstr ""
 
-#: parse.c:1422
+#: parse.c:1483
 msgid " AND "
 msgstr ""
 
-#: parse.c:1425
+#: parse.c:1486
 msgid " ARGUMENTS BUT GOT "
 msgstr ""
 
-#: parse.c:1466
+#: parse.c:1527
 msgid "#-1 @FUNCTION ("
 msgstr ""
 
-#: parse.c:1468
+#: parse.c:1529
 msgid ") MISSING ATTRIBUTE ("
 msgstr ""
 
-#: player.c:150
+#: player.c:195
+msgid ""
+"This IP address has failed too many times. Please try again in 10 minutes."
+msgstr ""
+
+#: player.c:226
 msgid "Guest connections not allowed."
 msgstr ""
 
-#: player.c:160
+#: player.c:236
 msgid "Player connections not allowed."
 msgstr ""
 
-#: player.c:179
+#: player.c:256
 msgid "Too many guests are connected now."
 msgstr ""
 
-#: player.c:329
+#: player.c:406
 #, c-format
 msgid "[%s] Registration of %s\n"
 msgstr ""
 
-#: player.c:333
+#: player.c:410
 msgid "This is an automated message.\n"
 msgstr ""
 
-#: player.c:335
+#: player.c:412
 #, c-format
 msgid "Your requested player, %s, has been created.\n"
 msgstr ""
 
-#: player.c:336
+#: player.c:413
 #, c-format
 msgid "The password is %s\n"
 msgstr ""
 
-#: player.c:338
+#: player.c:415
 #, c-format
 msgid "To access this character, connect to %s and type:\n"
 msgstr ""
 
-#: player.c:459
+#: player.c:536
 msgid "The old password that you entered was incorrect."
 msgstr ""
 
-#: player.c:461
+#: player.c:538
 msgid "Bad new password."
 msgstr ""
 
-#: player.c:464
+#: player.c:541
 msgid "You have changed your password."
 msgstr ""
 
-#: player.c:495
+#: player.c:572
 #, c-format
 msgid "Last connect was from %s on %s."
 msgstr ""
 
-#: player.c:503
+#: player.c:580
 #, c-format
 msgid "Last FAILED connect was from %s."
 msgstr ""
 
-#: player.c:530
+#: player.c:607
 #, c-format
 msgid "%s on %s"
 msgstr ""
 
-#: predicat.c:495
+#: predicat.c:493
 msgid "Sorry, there is no more room in the database."
 msgstr ""
 
-#: predicat.c:500
+#: predicat.c:498
 #, c-format
 msgid "Sorry, you don't have enough %s."
 msgstr ""
 
-#: predicat.c:505
+#: predicat.c:503
 msgid "Sorry, your building quota has run out."
 msgstr ""
 
-#: predicat.c:548
+#: predicat.c:546
 #, c-format
 msgid "GAME: %s(%s) spent %d %s."
 msgstr ""
 
-#: predicat.c:556
+#: predicat.c:554
 #, c-format
 msgid "GAME: %s(%s) tried to spend %d %s."
 msgstr ""
 
-#: predicat.c:1116
+#: predicat.c:1134
 #, c-format
 msgid "%s message from %s: %s"
 msgstr ""
 
-#: predicat.c:1120
+#: predicat.c:1138
 #, c-format
 msgid "[%d:%02d] %s message sent to %s."
 msgstr ""
 
-#: predicat.c:1203
+#: predicat.c:1221
 msgid "What was the victim of the verb?"
 msgstr ""
 
-#: predicat.c:1209
+#: predicat.c:1227
 msgid "What do you want to do with the verb?"
 msgstr ""
 
-#: predicat.c:1215
+#: predicat.c:1233
 msgid "What do you want to do the verb?"
 msgstr ""
 
-#: predicat.c:1411
+#: predicat.c:1427 predicat.c:1519
 msgid "What pattern do you want to grep for?"
 msgstr ""
 
-#: predicat.c:1438
+#: predicat.c:1452 predicat.c:1463
+#, c-format
+msgid "Invalid regexp: %s"
+msgstr ""
+
+#: predicat.c:1536 predicat.c:1546
+msgid "No matches."
+msgstr ""
+
+#: predicat.c:1543
 #, c-format
 msgid "Matches of '%s' on %s(#%d): %s"
 msgstr ""
@@ -5423,7 +5537,7 @@
 msgid "You can't afford that."
 msgstr ""
 
-#: rob.c:349 rob.c:358 rob.c:575
+#: rob.c:349 rob.c:358 rob.c:576
 msgid "Give to whom?"
 msgstr ""
 
@@ -5435,97 +5549,97 @@
 msgid "You can't give an object to itself!"
 msgstr ""
 
-#: rob.c:389
+#: rob.c:390
 msgid "You can't give that away."
 msgstr ""
 
-#: rob.c:394
+#: rob.c:395
 #, c-format
 msgid "%s doesn't want anything from you."
 msgstr ""
 
-#: rob.c:400
+#: rob.c:401
 #, c-format
 msgid "%s doesn't want that."
 msgstr ""
 
-#: rob.c:409
+#: rob.c:410
 #, c-format
 msgid "You gave %s to %s."
 msgstr ""
 
-#: rob.c:416
+#: rob.c:417
 #, c-format
 msgid "%s gave you to %s."
 msgstr ""
 
-#: rob.c:422
+#: rob.c:423
 #, c-format
 msgid "%s gave you %s."
 msgstr ""
 
-#: rob.c:437
+#: rob.c:438
 msgid "What is this, a holdup?"
 msgstr ""
 
-#: rob.c:441
+#: rob.c:442
 #, c-format
 msgid "You must specify a positive number of %s."
 msgstr ""
 
-#: rob.c:448
+#: rob.c:449
 #, c-format
 msgid "You don't have that many %s to give!"
 msgstr ""
 
-#: rob.c:458 rob.c:473 rob.c:497
+#: rob.c:459 rob.c:474 rob.c:498
 #, c-format
 msgid "%s refuses your money."
 msgstr ""
 
-#: rob.c:492
+#: rob.c:493
 msgid "Feeling poor today?"
 msgstr ""
 
-#: rob.c:502
+#: rob.c:503
 #, c-format
 msgid "You get %d in change."
 msgstr ""
 
-#: rob.c:504
+#: rob.c:505
 #, c-format
 msgid "You paid %d %s."
 msgstr ""
 
-#: rob.c:519
+#: rob.c:520
 #, c-format
 msgid "You give %d %s to %s."
 msgstr ""
 
-#: rob.c:522
+#: rob.c:523
 #, c-format
 msgid "You took %d %s from %s!"
 msgstr ""
 
-#: rob.c:527
+#: rob.c:528
 #, c-format
 msgid "%s gives you %d %s."
 msgstr ""
 
-#: rob.c:530
+#: rob.c:531
 #, c-format
 msgid "%s took %d %s from you!"
 msgstr ""
 
-#: rob.c:559
+#: rob.c:560
 msgid "Did you want to give something *to* someone?"
 msgstr ""
 
-#: rob.c:566
+#: rob.c:567
 msgid "Give what?"
 msgstr ""
 
-#: rob.c:582
+#: rob.c:583
 msgid "I don't know what you mean."
 msgstr ""
 
@@ -5533,288 +5647,288 @@
 msgid "GAME: Game shutdown by system operator"
 msgstr ""
 
-#: set.c:79
+#: set.c:81
 msgid "Give it what new name?"
 msgstr ""
 
-#: set.c:106
+#: set.c:102
 msgid "You can't give a player that name."
 msgstr ""
 
-#: set.c:115
+#: set.c:111
 #, c-format
 msgid "Broadcast: Suspect %s changed name to %s."
 msgstr ""
 
-#: set.c:140
+#: set.c:136
 msgid "Name set."
 msgstr ""
 
-#: set.c:188
+#: set.c:183
 msgid "Players always own themselves."
 msgstr ""
 
-#: set.c:198
+#: set.c:193
 msgid "You must carry the object to @chown it."
 msgstr ""
 
-#: set.c:202
+#: set.c:197
 msgid "You cannot @CHOWN/PRESERVE. Use normal @CHOWN."
 msgstr ""
 
-#: set.c:213
+#: set.c:208
 msgid "That player doesn't have enough money or quota to receive that object."
 msgstr ""
 
-#: set.c:221
+#: set.c:216
 msgid "Owner changed."
 msgstr ""
 
-#: set.c:297
+#: set.c:292
 msgid "Circular zone broken."
 msgstr ""
 
-#: set.c:306
+#: set.c:301
 msgid "Overly deep zone chain broken."
 msgstr ""
 
-#: set.c:326
+#: set.c:321
 #, c-format
 msgid ""
 "Warning: WIZ flag reset on #%d because @CHOWN/PRESERVE is to a third party."
 msgstr ""
 
-#: set.c:334
+#: set.c:329
 #, c-format
 msgid ""
 "Warning: @CHOWN/PRESERVE on an object (#%d) with WIZ, ROY, INHERIT, or "
 "@power privileges."
 msgstr ""
 
-#: set.c:371
+#: set.c:366
 msgid "That object is already in that zone."
 msgstr ""
 
-#: set.c:381
+#: set.c:376
 msgid "You don't have the power to shift reality."
 msgstr ""
 
-#: set.c:394
+#: set.c:389
 msgid "You cannot move that object to that zone."
 msgstr ""
 
-#: set.c:400
+#: set.c:395
 msgid "You shouldn't zone objects to themselves!"
 msgstr ""
 
-#: set.c:409
+#: set.c:404
 msgid "You can't make circular zones!"
 msgstr ""
 
-#: set.c:416
+#: set.c:411
 msgid "Overly deep zone chain."
 msgstr ""
 
-#: set.c:432
+#: set.c:427
 msgid "Warning: @chzoning admin-owned object!"
 msgstr ""
 
-#: set.c:456
+#: set.c:451
 msgid "Warning: @chzoning a privileged player."
 msgstr ""
 
-#: set.c:458
+#: set.c:453
 msgid "Warning: @chzoning a TRUST player."
 msgstr ""
 
-#: set.c:462
+#: set.c:457
 msgid "Zone changed."
 msgstr ""
 
-#: set.c:489
+#: set.c:484
 #, c-format
 msgid "You cannot change that flag on %s/%s"
 msgstr ""
 
-#: set.c:498
+#: set.c:493
 #, c-format
 msgid "%s/%s - %s reset."
 msgstr ""
 
-#: set.c:504
+#: set.c:499
 #, c-format
 msgid "%s/%s - %s set."
 msgstr ""
 
-#: set.c:518
+#: set.c:513
 #, c-format
 msgid "You cannot set attrib flags on %s/%s"
 msgstr ""
 
-#: set.c:543
+#: set.c:542
 msgid "What flag do you want to set?"
 msgstr ""
 
-#: set.c:554
+#: set.c:553
 msgid "Unrecognized attribute flag."
 msgstr ""
 
-#: set.c:560
+#: set.c:559
 msgid "No attribute found to change."
 msgstr ""
 
-#: set.c:589
+#: set.c:588
 msgid "What do you want to set?"
 msgstr ""
 
-#: set.c:611
+#: set.c:610
 msgid "Only God can set himself!"
 msgstr ""
 
-#: set.c:618
+#: set.c:617
 msgid "You may not set attributes."
 msgstr ""
 
-#: set.c:627
+#: set.c:626
 msgid "You must specify a flag to set."
 msgstr ""
 
-#: set.c:669
+#: set.c:668
 msgid "What do you want to copy from?"
 msgstr ""
 
-#: set.c:676
+#: set.c:675
 msgid "What object do you want to copy the attribute from?"
 msgstr ""
 
-#: set.c:689
+#: set.c:688
 msgid "No such attribute to copy from."
 msgstr ""
 
-#: set.c:694
+#: set.c:693
 msgid "Permission to read attribute denied."
 msgstr ""
 
-#: set.c:703
+#: set.c:702
 msgid "What do you want to copy to?"
 msgstr ""
 
-#: set.c:727
+#: set.c:726
 #, c-format
 msgid "Attribute %s (%d copies)"
 msgstr ""
 
-#: set.c:728
+#: set.c:727
 msgid "moved"
 msgstr ""
 
-#: set.c:728
+#: set.c:727
 msgid "copied"
 msgstr ""
 
-#: set.c:732
+#: set.c:731
 #, c-format
 msgid "Unable to %s attribute."
 msgstr ""
 
-#: set.c:733
+#: set.c:732
 msgid "move"
 msgstr ""
 
-#: set.c:733
+#: set.c:732
 msgid "copy"
 msgstr ""
 
-#: set.c:771
+#: set.c:770
 msgid "No such attribute, try set instead."
 msgstr ""
 
-#: set.c:775
+#: set.c:774
 msgid "You need to control an attribute to edit it."
 msgstr ""
 
-#: set.c:880 set.c:882 set.c:887 set.c:889
+#: set.c:879 set.c:881 set.c:886 set.c:888
 #, c-format
 msgid "%s - Set: %s"
 msgstr ""
 
-#: set.c:913 set.c:919
+#: set.c:912 set.c:918
 msgid "I need to know what you want to edit."
 msgstr ""
 
-#: set.c:930
+#: set.c:929
 msgid "Nothing to do."
 msgstr ""
 
-#: set.c:961
+#: set.c:960
 msgid "I need to know what attribute to trigger."
 msgstr ""
 
-#: set.c:976
+#: set.c:975
 msgid "You can't trigger God!"
 msgstr ""
 
-#: set.c:985
+#: set.c:984
 #, c-format
 msgid "%s - Triggered."
 msgstr ""
 
-#: set.c:1011
+#: set.c:1010
 msgid "I need to know what attribute to include."
 msgstr ""
 
-#: set.c:1022
+#: set.c:1021
 msgid "You can't include God!"
 msgstr ""
 
-#: set.c:1058
+#: set.c:1057
 msgid "Used."
 msgstr ""
 
-#: set.c:1110
+#: set.c:1109
 msgid "A thing cannot be its own ancestor!"
 msgstr ""
 
-#: set.c:1117
+#: set.c:1116
 msgid "You are not allowed to be your own ancestor!"
 msgstr ""
 
-#: set.c:1122
+#: set.c:1121
 msgid "Too many ancestors."
 msgstr ""
 
-#: set.c:1129
+#: set.c:1128
 msgid "Parent changed."
 msgstr ""
 
-#: set.c:1153
+#: set.c:1152
 #, c-format
 msgid "Unable to wipe attribute %s"
 msgstr ""
 
-#: set.c:1158
+#: set.c:1157
 #, c-format
 msgid "Attribute %s cannot be wiped because a child attribute cannot be wiped."
 msgstr ""
 
-#: set.c:1195
+#: set.c:1194
 msgid "That object is protected."
 msgstr ""
 
-#: set.c:1202
+#: set.c:1201
 msgid "No attributes wiped."
 msgstr ""
 
-#: set.c:1205
+#: set.c:1204
 msgid "One attribute wiped."
 msgstr ""
 
-#: set.c:1208
+#: set.c:1207
 #, c-format
 msgid "%d attributes wiped."
 msgstr ""
 
-#: speech.c:115 speech.c:157 speech.c:614 speech.c:1342
+#: speech.c:115 speech.c:157 speech.c:614 speech.c:1343
 msgid "You may not speak here!"
 msgstr ""
 
@@ -5845,7 +5959,7 @@
 msgid "I can't find that room."
 msgstr ""
 
-#: speech.c:229 speech.c:1385 speech.c:1447
+#: speech.c:229 speech.c:1386 speech.c:1448
 msgid "You may not speak there!"
 msgstr ""
 
@@ -5904,7 +6018,7 @@
 msgid "%s whispers%s."
 msgstr ""
 
-#: speech.c:572 speech.c:1382
+#: speech.c:572 speech.c:1383
 #, c-format
 msgid "I'm sorry, but %s wishes to be left alone now."
 msgstr ""
@@ -5976,49 +6090,49 @@
 msgid "You are set HAVEN and cannot receive pages."
 msgstr ""
 
-#: speech.c:1013
+#: speech.c:1014
 msgid "From afar"
 msgstr ""
 
-#: speech.c:1015
+#: speech.c:1016
 msgid " (to "
 msgstr ""
 
-#: speech.c:1024
+#: speech.c:1025
 msgid " pages"
 msgstr ""
 
-#: speech.c:1158
+#: speech.c:1159
 msgid "From "
 msgstr ""
 
-#: speech.c:1376
+#: speech.c:1377
 msgid "I can't find that."
 msgstr ""
 
-#: speech.c:1379
+#: speech.c:1380
 msgid "There can't be anything in that!"
 msgstr ""
 
-#: speech.c:1391
+#: speech.c:1392
 #, c-format
 msgid "You remit, \"%s\" in %s"
 msgstr ""
 
-#: speech.c:1444
+#: speech.c:1445
 msgid "Too many containers."
 msgstr ""
 
-#: speech.c:1452
+#: speech.c:1453
 #, c-format
 msgid "You lemit: \"%s\""
 msgstr ""
 
-#: speech.c:1512
+#: speech.c:1513
 msgid "Invalid zone."
 msgstr ""
 
-#: speech.c:1521
+#: speech.c:1522
 #, c-format
 msgid "You zemit, \"%s\" in zone %s"
 msgstr ""
@@ -6344,7 +6458,7 @@
 msgid "You can't force God!"
 msgstr ""
 
-#: wiz.c:733 wiz.c:2009
+#: wiz.c:733
 msgid "You need a search warrant to do that!"
 msgstr ""
 
@@ -6699,23 +6813,23 @@
 msgid "Unknown zone."
 msgstr ""
 
-#: wiz.c:1956
+#: wiz.c:1960
 msgid "You must give a list of power names."
 msgstr ""
 
-#: wiz.c:1963
+#: wiz.c:1967
 msgid "You must give a string of flag characters."
 msgstr ""
 
-#: wiz.c:1970
+#: wiz.c:1974
 msgid "You must give a list of flag names."
 msgstr ""
 
-#: wiz.c:1975
+#: wiz.c:1979
 msgid "Unknown search class."
 msgstr ""
 
-#: wiz.c:2020
+#: wiz.c:2030
 #, c-format
 msgid "Searches cost %d %s."
 msgstr ""
Index: po/fr_FR.pox
===================================================================
--- po/fr_FR.pox	(.../184p1)	(revision 682)
+++ po/fr_FR.pox	(.../184p2)	(revision 682)
@@ -313,10 +313,6 @@
 msgid "#-1 NO SUCH TYPE"
 msgstr "#-1 PAS DE TEL TYPE"
 
-#: src/funufun.c:310
-msgid "#-1 NO SUCH USER FUNCTION"
-msgstr "#-1 PAS DE TELLE FONCTION UTILISATEUR"
-
 #: src/bsd.c:4485 src/bsd.c:4498
 msgid "#-1 NOT CONNECTED"
 msgstr "#-1 NON CONNECTE"
@@ -1498,22 +1494,6 @@
 msgid "GAME: Database consistency check complete."
 msgstr "MESSAGE SYSTEME: La vrification de la consistence de la DB est acheve."
 
-#: src/conf.c:570
-msgid "GAME: Database will be dumped in 1 minute."
-msgstr "JEU: Sauvegarde de la DB dans 1 minute."
-
-#: src/conf.c:572
-msgid "GAME: Database will be dumped in 5 minutes."
-msgstr "JEU: Sauvegarde de la DB dans 5 minutes."
-
-#: src/conf.c:502
-msgid "GAME: Dump complete. Time in."
-msgstr "JEU: Sauvegarde effectue. Le jeu reprend."
-
-#: src/conf.c:501
-msgid "GAME: Dumping database. Game may freeze for a minute"
-msgstr "JEU: Sauvegarde de la base de donnes. Il se peut que le jeu s'interrompe quelques instants."
-
 #: game.c:311
 msgid "GAME: ERROR! Database save failed!"
 msgstr "JEU: ERREUR! Echec de sauvegarde!"
Index: po/es_ES.pox
===================================================================
--- po/es_ES.pox	(.../184p1)	(revision 682)
+++ po/es_ES.pox	(.../184p2)	(revision 682)
@@ -264,10 +264,6 @@
 msgid "#-1 NO SUCH TYPE"
 msgstr "#-1 NO HAY TAL TIPO"
 
-#: src/funufun.c:310
-msgid "#-1 NO SUCH USER FUNCTION"
-msgstr "#-1 NO HAY TAL FUNCION DE USUARIO"
-
 #: src/bsd.c:4485 src/bsd.c:4498
 msgid "#-1 NOT CONNECTED"
 msgstr "#-1 NO ESTA CONECTADO"
@@ -1362,22 +1358,6 @@
 msgid "GAME: Database consistency check complete."
 msgstr "JUEGO: Control de consistencia de base de datos completo."
 
-#: src/conf.c:570
-msgid "GAME: Database will be dumped in 1 minute."
-msgstr "JUEGO: La base de datos sera volcada en 1 minuto."
-
-#: src/conf.c:572
-msgid "GAME: Database will be dumped in 5 minutes."
-msgstr "JUEGO: La base de datos ser volcada en 5 minutos."
-
-#: src/conf.c:502
-msgid "GAME: Dump complete. Time in."
-msgstr "JUEGO: Vuelco completo. Volviendo."
-
-#: src/conf.c:501
-msgid "GAME: Dumping database. Game may freeze for a minute"
-msgstr "JUEGO: Volcando base de datos. El juego puede congelarse por un minuto"
-
 #: game.c:311
 msgid "GAME: ERROR! Database save failed!"
 msgstr "JUEGO: ERROR! Grabacin de la base de datos fall!"
Index: po/bg_BG.pox
===================================================================
--- po/bg_BG.pox	(.../184p1)	(revision 682)
+++ po/bg_BG.pox	(.../184p2)	(revision 682)
@@ -37,7 +37,7 @@
 
 #: conf.c:1594
 msgid " The MUSH was compiled with SSL support."
-msgstr " \" MUSH-      SSL.\""
+msgstr " MUSH-      SSL."
 
 #: wiz.c:1605
 #, c-format
@@ -118,7 +118,7 @@
 
 #: parse.c:83
 msgid "#-1 CALL LIMIT EXCEEDED"
-msgstr "\"#-1     "
+msgstr "#-1     "
 
 #: src/funlist.c:1456 src/funlist.c:1680
 msgid "#-1 CAN ONLY TEST ONE ELEMENT"
@@ -130,7 +130,7 @@
 
 #: funstr.c:1990
 msgid "#-1 FILLER MUST BE ONE CHARACTER"
-msgstr "\"#-1      "
+msgstr "#-1      "
 
 #: src/extmail.c:1496
 msgid "#-1 FOLDER MUST BE INTEGER"
@@ -142,7 +142,7 @@
 
 #: funmath.c:1631
 msgid "#-1 FROM BASE OUT OF RANGE"
-msgstr "\"#-1    \""
+msgstr "#-1    "
 
 #: src/parse.c:671 src/parse.c:759
 msgid "#-1 FUNCTION ("
@@ -170,11 +170,11 @@
 
 #: bsd.c:4955 bsd.c:4966
 msgid "#-1 FUNCTION REQUIRES ONE ARGUMENT"
-msgstr "\"#-1    \""
+msgstr "#-1    "
 
 #: funmath.c:1033 funmath.c:1066
 msgid "#-1 IMAGINARY NUMBER"
-msgstr "\"#-1  \""
+msgstr "#-1  "
 
 #: src/funmath.c:949 src/funmath.c:972
 msgid "#-1 INFINITY"
@@ -182,19 +182,19 @@
 
 #: funstr.c:1953
 msgid "#-1 INVALID ALIGN STRING"
-msgstr "\"#-1   \""
+msgstr "#-1   "
 
 #: funmath.c:73
 msgid "#-1 INVALID ANGLE TYPE"
-msgstr "\"#-1   \""
+msgstr "#-1   "
 
 #: funstr.c:418
 msgid "#-1 INVALID DBREF"
-msgstr "\"#-1  DBREF\""
+msgstr "#-1  DBREF"
 
 #: help.c:454
 msgid "#-1 INVALID ENTRY"
-msgstr "\"#-1  \""
+msgstr "#-1  "
 
 #: src/fundb.c:1618 src/funlist.c:2324 src/funlist.c:2367
 msgid "#-1 INVALID GREP PATTERN"
@@ -218,11 +218,11 @@
 
 #: funstr.c:369 funstr.c:425
 msgid "#-1 INVALID THIRD ARGUMENT"
-msgstr "\"#-1   \""
+msgstr "#-1   "
 
 #: funtime.c:95
 msgid "#-1 INVALID TIME ZONE"
-msgstr "\"#-1   \""
+msgstr "#-1   "
 
 #: src/funufun.c:293
 msgid "#-1 INVALID ZONE"
@@ -234,7 +234,7 @@
 
 #: funmath.c:1643
 msgid "#-1 MALFORMED NUMBER"
-msgstr "\"#-1  \""
+msgstr "#-1  "
 
 #: src/funlist.c:1778
 msgid "#-1 NEED A WORD"
@@ -246,15 +246,15 @@
 
 #: game.c:1352
 msgid "#-1 NO COMMAND"
-msgstr "\"#-1  \""
+msgstr "#-1  "
 
 #: help.c:512
 msgid "#-1 NO ENTRY"
-msgstr "\"#-1  \""
+msgstr "#-1  "
 
 #: help.c:464
 msgid "#-1 NO INDEX FOR FILE"
-msgstr "\"#-1   \""
+msgstr "#-1   "
 
 #: src/fundb.c:118 src/fundb.c:137 src/fundb.c:460 src/funstr.c:118\nsrc/funstr.c:131 src/funstr.c:144 src/funstr.c:157
 msgid "#-1 NO MATCH"
@@ -300,17 +300,13 @@
 msgid "#-1 NO SUCH TYPE"
 msgstr "#-1   "
 
-#: src/funufun.c:310
-msgid "#-1 NO SUCH USER FUNCTION"
-msgstr "#-1    "
-
 #: src/bsd.c:4485 src/bsd.c:4498
 msgid "#-1 NOT CONNECTED"
 msgstr "#-1  "
 
 #: funstr.c:1977
 msgid "#-1 NOT ENOUGH COLUMNS FOR ALIGN"
-msgstr "\"#-1    \""
+msgstr "#-1    "
 
 #: extchat.c:1525
 msgid "#-1 NOT ON CHANNEL"
@@ -346,7 +342,7 @@
 
 #: funmath.c:1057
 msgid "#-1 ROOT OUT OF RANGE"
-msgstr "\"#-1 ROOT-   \""
+msgstr "#-1 ROOT-   "
 
 #: src/function.c:118
 msgid "#-1 SEPARATOR MUST BE ONE CHARACTER"
@@ -362,15 +358,15 @@
 
 #: funstr.c:1034
 msgid "#-1 THIS ISN'T UNICODE"
-msgstr "\"#-1    \""
+msgstr "#-1    "
 
 #: funmath.c:1636
 msgid "#-1 TO BASE OUT OF RANGE"
-msgstr "\"#-1  \""
+msgstr "#-1  "
 
 #: funstr.c:1981
 msgid "#-1 TOO MANY COLUMNS FOR ALIGN"
-msgstr "\"#-1     \""
+msgstr "#-1     "
 
 #: src/funlist.c:1815
 msgid "#-1 TOO MANY ITERS"
@@ -382,7 +378,7 @@
 
 #: help.c:516 help.c:519
 msgid "#-1 UNAVAILABLE"
-msgstr "\"#-1 \""
+msgstr "#-1 "
 
 #: src/funmath.c:1385
 msgid "#-1 UNKNOWN OPERATION"
@@ -390,11 +386,11 @@
 
 #: funstr.c:1021 funstr.c:1038
 msgid "#-1 UNPRINTABLE CHARACTER"
-msgstr "\"#-1  \""
+msgstr "#-1  "
 
 #: funcrypt.c:160 funcrypt.c:183
 msgid "#-1 UNSUPPORTED DIGEST TYPE"
-msgstr "\"#-1   \""
+msgstr "#-1   "
 
 #: src/funmath.c:420 src/funmath.c:462 src/funmath.c:501 src/funmath.c:540\nsrc/funmath.c:598 src/funmath.c:632
 msgid "#-1 VECTORS MUST BE SAME DIMENSIONS"
@@ -402,7 +398,7 @@
 
 #: funmath.c:761
 msgid "#-1 VECTORS MUST BE THREE-DIMENSIONAL"
-msgstr "\"#-1     \""
+msgstr "#-1     "
 
 #: src/funstr.c:1097
 msgid "#-1 WIDTH TOO SMALL"
@@ -450,7 +446,7 @@
 #: wiz.c:1745
 #, c-format
 msgid "%d sitelocks removed."
-msgstr "\"%d   .\""
+msgstr "%d   ."
 
 #: src/bsd.c:3405
 #, c-format
@@ -460,17 +456,17 @@
 #: flags.c:2283
 #, c-format
 msgid "%s %s deleted."
-msgstr "\"%s %s  .\""
+msgstr "%s %s  ."
 
 #: flags.c:2223
 #, c-format
 msgid "%s %s disabled."
-msgstr "\"%s %s .\""
+msgstr "%s %s ."
 
 #: flags.c:2319
 #, c-format
 msgid "%s %s enabled."
-msgstr "\"%s %s .\""
+msgstr "%s %s ."
 
 #: src/look.c:969
 #, c-format
@@ -495,12 +491,12 @@
 #: flags.c:1357
 #, c-format
 msgid "%s - I don't recognize that flag."
-msgstr "\"%s -    .\""
+msgstr "%s -    ."
 
 #: flags.c:1515
 #, c-format
 msgid "%s - I don't recognize that power."
-msgstr "\"%s -    .\""
+msgstr "%s -    ."
 
 #: src/atr_tab.c:226
 #, c-format
@@ -510,7 +506,7 @@
 #: look.c:706
 #, c-format
 msgid "%s Lock [#%d%s]: %s"
-msgstr "\"%s  [#%d%s]: %s\""
+msgstr "%s  [#%d%s]: %s"
 
 #: src/look.c:954 src/look.c:979 src/look.c:1019
 #, c-format
@@ -520,12 +516,12 @@
 #: flags.c:2112
 #, c-format
 msgid "%s aliases may not contain spaces."
-msgstr "\"%s      .\""
+msgstr "%s      ."
 
 #: flags.c:2107
 #, c-format
 msgid "%s aliases must be longer than one character."
-msgstr "\"  %s    -   .\""
+msgstr "  %s    -   ."
 
 #: destroy.c:353
 #, c-format
@@ -545,12 +541,12 @@
 #: speech.c:332
 #, c-format
 msgid "%s can't hear you."
-msgstr "\"%s     .\""
+msgstr "%s     ."
 
 #: flags.c:2028 flags.c:2169
 #, c-format
 msgid "%s characters must be single characters."
-msgstr "\" %s    .\""
+msgstr " %s    ."
 
 #: src/create.c:388
 #, c-format
@@ -570,7 +566,7 @@
 #: move.c:641 move.c:644
 #, c-format
 msgid "%s drops you."
-msgstr "\"%s  .\""
+msgstr "%s  ."
 
 #: src/rob.c:213
 #, c-format
@@ -625,7 +621,7 @@
 #: attrib.c:1508
 #, c-format
 msgid "%s is a branch attribute; remove its children first."
-msgstr "\"%s   ;    .\""
+msgstr "%s   ;    ."
 
 #: src/extchat.c:803 src/extchat.c:835
 #, c-format
@@ -645,7 +641,7 @@
 #: look.c:954 look.c:979 look.c:1019
 #, c-format
 msgid "%s is listening."
-msgstr "\"%s .\""
+msgstr "%s ."
 
 #: src/flags.c:1067 src/flags.c:1073
 #, c-format
@@ -655,17 +651,17 @@
 #: speech.c:708
 #, c-format
 msgid "%s is not accepting any pages."
-msgstr "\"%s    .\""
+msgstr "%s    ."
 
 #: speech.c:713
 #, c-format
 msgid "%s is not accepting your pages."
-msgstr "\"%s     .\""
+msgstr "%s     ."
 
 #: speech.c:703
 #, c-format
 msgid "%s is not connected."
-msgstr "\"%s    .\""
+msgstr "%s    ."
 
 #: src/extchat.c:865
 #, c-format
@@ -720,17 +716,17 @@
 #: warnings.c:162
 #, c-format
 msgid "%s lock has eval-lock that uses a nonexistant attribute '%s'."
-msgstr "\"%s   eval-lock,     '%s'.\""
+msgstr "%s   eval-lock,     '%s'."
 
 #: warnings.c:173
 #, c-format
 msgid "%s lock has indirect lock to %s/%s that it can't read"
-msgstr "\" %s      %s/%s,      \""
+msgstr " %s      %s/%s,      "
 
 #: warnings.c:145 warnings.c:169
 #, c-format
 msgid "%s lock refers to garbage object"
-msgstr "\"%s      \""
+msgstr "%s      "
 
 #: src/attrib.c:949
 #, c-format
@@ -745,12 +741,12 @@
 #: flags.c:2016
 #, c-format
 msgid "%s names may not contain spaces."
-msgstr "\" %s     .\""
+msgstr " %s     ."
 
 #: flags.c:2011
 #, c-format
 msgid "%s names must be longer than one character."
-msgstr "\"  %s    -   .\""
+msgstr "  %s    -   ."
 
 #: src/player.c:486
 #, c-format
@@ -765,12 +761,12 @@
 #: bsd.c:4130
 #, c-format
 msgid "%s pages: %s"
-msgstr "\"%s : %s\""
+msgstr "%s : %s"
 
 #: rob.c:284
 #, c-format
 msgid "%s refuses your money."
-msgstr "\"%s     .\""
+msgstr "%s     ."
 
 #: src/speech.c:179
 #, c-format
@@ -780,7 +776,7 @@
 #: speech.c:378
 #, c-format
 msgid "%s senses: %s%s%s"
-msgstr "\"%s : %s%s%s\""
+msgstr "%s : %s%s%s"
 
 #: src/extmail.c:1335
 #, c-format
@@ -790,7 +786,7 @@
 #: attrib.c:1474
 #, c-format
 msgid "%s should contain only dbrefs."
-msgstr "\"%s     dbrefs.\""
+msgstr "%s     dbrefs."
 
 #: src/bsd.c:2100
 #, c-format
@@ -810,7 +806,7 @@
 #: move.c:526 move.c:572
 #, c-format
 msgid "%s took you."
-msgstr "\"%s  .\""
+msgstr "%s  ."
 
 #: src/rob.c:156
 #, c-format
@@ -855,27 +851,27 @@
 #: lock.c:541
 #, c-format
 msgid "%s(%s) - %s (already) unlocked."
-msgstr "\"%s(%s) - %s () .\""
+msgstr "%s(%s) - %s () ."
 
 #: lock.c:603
 #, c-format
 msgid "%s(%s) - %s locked."
-msgstr "\"%s(%s) - %s .\""
+msgstr "%s(%s) - %s ."
 
 #: lock.c:544
 #, c-format
 msgid "%s(%s) - %s unlocked."
-msgstr "\"%s(%s) - %s .\""
+msgstr "%s(%s) - %s ."
 
 #: set.c:482
 #, c-format
 msgid "%s/%s - %s reset."
-msgstr "\"%s/%s - %s .\""
+msgstr "%s/%s - %s ."
 
 #: set.c:487
 #, c-format
 msgid "%s/%s - %s set."
-msgstr "\"%s/%s - %s .\""
+msgstr "%s/%s - %s ."
 
 #: src/extmail.c:1260 src/extmail.c:1668 src/wiz.c:673 src/wiz.c:1277
 #, c-format
@@ -996,7 +992,7 @@
 #: extchat.c:3027
 #, c-format
 msgid "CHAT: Buffering enabled on channel <%s>."
-msgstr "\":    <%s>  .\""
+msgstr ":    <%s>  ."
 
 #: extchat.c:1150
 #, c-format
@@ -1031,12 +1027,12 @@
 #: extchat.c:3014
 #, c-format
 msgid "CHAT: Channel buffering already disabled for channel <%s>."
-msgstr "\":       <%s>.\""
+msgstr ":       <%s>."
 
 #: extchat.c:3009
 #, c-format
 msgid "CHAT: Channel buffering disabled for channel <%s>."
-msgstr "\":    <%s>  .\""
+msgstr ":    <%s>  ."
 
 #: extchat.c:1595
 #, c-format
@@ -1071,12 +1067,12 @@
 #: extchat.c:2958
 #, c-format
 msgid "CHAT: Recall from channel <%s>"
-msgstr "\":    <%s>\""
+msgstr ":    <%s>"
 
 #: extchat.c:3021
 #, c-format
 msgid "CHAT: Resizing buffer of channel <%s>"
-msgstr "\":       <%s>\""
+msgstr ":       <%s>"
 
 #: extchat.c:1586
 #, c-format
@@ -1101,7 +1097,17 @@
 #: extchat.c:3016
 #, c-format
 msgid "CHAT: To recall the entire buffer, use @chan/recall %s=0"
-msgstr "\":     ,  @chan/recall %s=0\""
+msgstr ":     ,  @chan/recall %s=0"
+
+#: extchat.c:1331
+#, c-format
+msgid "CHAT: You are already on channel <%s>."
+msgstr ":      <%s>."
+
+#: extchat.c:1385
+#, c-format
+msgid "CHAT: You are not on channel <%s>."
+msgstr ":      <%s>."
 
 #: src/extchat.c:757
 #, c-format
@@ -1151,12 +1157,12 @@
 #: command.c:1318
 #, c-format
 msgid "Command %s added."
-msgstr "\" %s  .\""
+msgstr " %s  ."
 
 #: access.c:400
 #, c-format
 msgid "Comment: %s"
-msgstr "\": %s\""
+msgstr ": %s"
 
 #: src/version.c:48
 #, c-format
@@ -1181,7 +1187,7 @@
 #: extchat.c:2186
 #, c-format
 msgid "Description: %s"
-msgstr "\": %s\""
+msgstr ": %s"
 
 #: look.c:828
 #, c-format
@@ -1227,7 +1233,7 @@
 
 #: function.c:1018
 msgid "Expected between 1 and 5 arguments."
-msgstr "\"  1  5 .\""
+msgstr "  1  5 ."
 
 #: wiz.c:109
 #, c-format
@@ -1252,17 +1258,17 @@
 #: wiz.c:936
 #, c-format
 msgid "Flags value: %s"
-msgstr "\"  : %s\""
+msgstr "  : %s"
 
 #: flags.c:1284
 #, c-format
 msgid "Flags: %s"
-msgstr "\": %s\""
+msgstr ": %s"
 
 #: bsd.c:4123
 #, c-format
 msgid "From afar, %s%s%s"
-msgstr "\" afar, %s%s%s\""
+msgstr " afar, %s%s%s"
 
 #: extmail.c:471
 #, c-format
@@ -1284,14 +1290,6 @@
 msgid "Function Name                   Dbref #    Attrib"
 msgstr "                    Dbref #    "
 
-#: src/conf.c:570
-msgid "GAME: Database will be dumped in 1 minute."
-msgstr ":       1 ."
-
-#: src/conf.c:572
-msgid "GAME: Database will be dumped in 5 minutes."
-msgstr ":       5 ."
-
 #: src/wiz.c:2295
 #, c-format
 msgid "GAME: Reboot w/o disconnect by %s, please wait."
@@ -1299,7 +1297,7 @@
 
 #: bsd.c:294
 msgid "GAME: SSL connections must be dropped, sorry."
-msgstr "\": SSL     , .\""
+msgstr ": SSL     , ."
 
 #: src/game.c:273
 #, c-format
@@ -1326,8 +1324,8 @@
 "Here are the entries which match '%s':\n"
 "%s"
 msgstr ""
-"\" ,    '%s':\n"
-"%s\""
+" ,    '%s':\n"
+"%s"
 
 #: look.c:787
 #, c-format
@@ -1337,17 +1335,17 @@
 #: command.c:1352
 #, c-format
 msgid "Hook removed from %s."
-msgstr "\"  %s  .\""
+msgstr "  %s  ."
 
 #: command.c:1375
 #, c-format
 msgid "Hook set for %s"
-msgstr "\"  %s  \""
+msgstr "  %s  "
 
 #: flags.c:1882
 #, c-format
 msgid "How do you want to restrict that %s?"
-msgstr "\"     %s?\""
+msgstr "     %s?"
 
 #: src/game.c:999
 msgid "Huh?  (Type \"help\" for help.)"
@@ -1356,17 +1354,17 @@
 #: speech.c:686
 #, c-format
 msgid "I can't find who you're trying to page with: %s"
-msgstr "\"       : %s\""
+msgstr "       : %s"
 
 #: look.c:669 look.c:677 move.c:534 move.c:542
 #, c-format
 msgid "I can't tell which %s."
-msgstr "\"     %s.\""
+msgstr "     %s."
 
 #: flags.c:2125 flags.c:2162 flags.c:2214 flags.c:2253 flags.c:2310
 #, c-format
 msgid "I don't know that %s."
-msgstr "\"   %s.\""
+msgstr "   %s."
 
 #: src/boolexp.c:265
 #, c-format
@@ -1395,7 +1393,7 @@
 #: speech.c:692
 #, c-format
 msgid "I'm not sure who you want to page with: %s"
-msgstr "\"  ,     : %s\""
+msgstr "  ,     : %s"
 
 #: src/speech.c:611 src/speech.c:1371
 #, c-format
@@ -1404,12 +1402,12 @@
 
 #: wiz.c:807
 msgid "If you want to quit, use QUIT."
-msgstr "\"   ,  QUIT.\""
+msgstr "   ,  QUIT."
 
 #: attrib.c:1479
 #, c-format
 msgid "Invalid dbref #%d in %s."
-msgstr "\" dbref #%d  %s.\""
+msgstr " dbref #%d  %s."
 
 #: src/game.c:860
 #, c-format
@@ -1463,17 +1461,17 @@
 #: flags.c:2045 flags.c:2175
 #, c-format
 msgid "Letter conflicts with the %s %s."
-msgstr "\"     %s %s.\""
+msgstr "     %s %s."
 
 #: flags.c:2185
 #, c-format
 msgid "Letter for %s %s cleared."
-msgstr "\"  %s %s  .\""
+msgstr "  %s %s  ."
 
 #: flags.c:2181
 #, c-format
 msgid "Letter for %s %s set to '%c'."
-msgstr "\"  %s %s    '%c'.\""
+msgstr "  %s %s    '%c'."
 
 #: create.c:156 create.c:296
 #, c-format
@@ -1488,7 +1486,7 @@
 #: bsd.c:4125
 #, c-format
 msgid "Long distance to %s: %s%s%s"
-msgstr "\"   %s: %s%s%s\""
+msgstr "   %s: %s%s%s"
 
 #: src/extmail.c:763
 #, c-format
@@ -1710,7 +1708,7 @@
 #: access.c:397
 #, c-format
 msgid "Matched line %d: %s %s"
-msgstr "\"  %d: %s %s\""
+msgstr "  %d: %s %s"
 
 #: src/game.c:1296
 #, c-format
@@ -1745,7 +1743,7 @@
 #: wiz.c:1890
 #, c-format
 msgid "Name %s locked."
-msgstr "\" %s  .\""
+msgstr " %s  ."
 
 #: src/wiz.c:131
 #, c-format
@@ -1755,7 +1753,7 @@
 #: cmds.c:1069
 #, c-format
 msgid "No command found in code by %s - don't start code with functions."
-msgstr "\"       %s -     .\""
+msgstr "       %s -     ."
 
 #: src/bsd.c:3090
 #, c-format
@@ -1765,7 +1763,7 @@
 #: flags.c:1839 flags.c:1878 flags.c:1941
 #, c-format
 msgid "No such %s."
-msgstr "\"  %s.\""
+msgstr "  %s."
 
 #: src/extmail.c:747 src/extmail.c:859
 #, c-format
@@ -1775,7 +1773,7 @@
 #: flags.c:1964
 #, c-format
 msgid "Objects of other types already have this %s set. Search for them and remove it first."
-msgstr "\"       %s .      .\""
+msgstr "       %s .      ."
 
 #: wiz.c:175 wiz.c:181 wiz.c:195
 #, c-format
@@ -1800,7 +1798,7 @@
 #: extchat.c:2318
 #, c-format
 msgid "Owner: %s"
-msgstr "\" %s\""
+msgstr " %s"
 
 #: src/wiz.c:910
 #, c-format
@@ -1825,7 +1823,7 @@
 #: flags.c:1910
 #, c-format
 msgid "Permissions on %s %s set."
-msgstr "\"  %s %s  .\""
+msgstr "  %s %s  ."
 
 #: src/extchat.c:1210
 #, c-format
@@ -1835,7 +1833,7 @@
 #: wiz.c:995
 #, c-format
 msgid "Powers value: %s"
-msgstr "\"  : %s\""
+msgstr "  : %s"
 
 #: look.c:716
 #, c-format
@@ -1850,7 +1848,7 @@
 #: extchat.c:2192
 #, c-format
 msgid "Recall buffer: %dk, with %d lines stored."
-msgstr "\"  : %dk,  %d  .\""
+msgstr "  : %dk,  %d  ."
 
 #: bsd.c:275
 msgid "Registration successful! You will receive your password by email."
@@ -1864,7 +1862,7 @@
 #: command.c:1347
 #, c-format
 msgid "Removed %s from command table."
-msgstr "\" %s   .\""
+msgstr " %s   ."
 
 #: src/atr_tab.c:288
 #, c-format
@@ -1894,7 +1892,7 @@
 #: wiz.c:1754
 #, c-format
 msgid "Site %s banned"
-msgstr "\" %s  \""
+msgstr " %s  "
 
 #: src/wiz.c:2026
 #, c-format
@@ -1914,7 +1912,7 @@
 #: extchat.c:1429
 #, c-format
 msgid "Sorry, you're not allowed to @cemit on channel <%s>."
-msgstr "\",    @cemit   <%s>.\""
+msgstr ",    @cemit   <%s>."
 
 #: src/extchat.c:927 src/extchat.c:1034
 #, c-format
@@ -1939,22 +1937,22 @@
 #: flags.c:2218
 #, c-format
 msgid "That %s is already disabled."
-msgstr "\" %s   .\""
+msgstr " %s   ."
 
 #: flags.c:2129
 #, c-format
 msgid "That %s is disabled."
-msgstr "\"%s  .\""
+msgstr "%s  ."
 
 #: flags.c:2314
 #, c-format
 msgid "That %s is not disabled."
-msgstr "\" %s   .\""
+msgstr " %s   ."
 
 #: flags.c:2119
 #, c-format
 msgid "That alias already matches the %s %s."
-msgstr "\"     %s %s.\""
+msgstr "     %s %s."
 
 #: src/attrib.c:1022
 #, c-format
@@ -2024,7 +2022,7 @@
 
 #: flags.c:1542
 msgid "There are probably easier ways to crash your MUSH."
-msgstr "\",    -    MUSH-\""
+msgstr ",    -    MUSH-"
 
 #: bsd.c:3922
 msgid "There is 1 player connected."
@@ -2037,7 +2035,7 @@
 #: extchat.c:1836
 #, c-format
 msgid "Title %s for %schannel <%s>."
-msgstr "\" %s  %s <%s>.\""
+msgstr " %s  %s <%s>."
 
 #: src/player.c:301
 #, c-format
@@ -2051,7 +2049,7 @@
 #: flags.c:1971
 #, c-format
 msgid "Type of %s %s set."
-msgstr "\"  %s %s  .\""
+msgstr "  %s %s  ."
 
 #: src/set.c:638
 #, c-format
@@ -2066,7 +2064,7 @@
 #: speech.c:745
 #, c-format
 msgid "Unable to page:%s"
-msgstr "\"   : %s\""
+msgstr "   : %s"
 
 #: bsd.c:274
 msgid "Unable to register that player with that email address."
@@ -2075,7 +2073,7 @@
 #: speech.c:355
 #, c-format
 msgid "Unable to whisper to:%s"
-msgstr "\"    :%s\""
+msgstr "    :%s"
 
 #: src/access.c:547
 #, c-format
@@ -2085,7 +2083,7 @@
 #: flags.c:2081
 #, c-format
 msgid "Unknown failure adding %s."
-msgstr "\"     %s.\""
+msgstr "     %s."
 
 #: src/warnings.c:301
 #, c-format
@@ -2095,7 +2093,7 @@
 #: lock.c:880
 #, c-format
 msgid "Unlocked zone %s - automatically zone-locking to itself"
-msgstr "\"  %s -      \""
+msgstr "  %s -      "
 
 #: src/conf.c:799
 msgid "Use: @config/list <type of options> where type is one of:"
@@ -2104,12 +2102,12 @@
 #: warnings.c:232
 #, c-format
 msgid "Variable exit has empty %s attribute"
-msgstr "\"    %s \""
+msgstr "    %s "
 
 #: warnings.c:227
 #, c-format
 msgid "Variable exit has no %s attribute"
-msgstr "\"   %s \""
+msgstr "   %s "
 
 #: warnings.c:119
 #, c-format
@@ -2130,17 +2128,17 @@
 
 #: destroy.c:329
 msgid "Warning: Target is set SAFE, but scheduling for destruction anyway."
-msgstr "\":    SAFE,      .\""
+msgstr ":    SAFE,      ."
 
 #: set.c:328
 #, c-format
 msgid "Warning: WIZ flag reset on #%d because @CHOWN/PRESERVE is to a third party."
-msgstr "\": WIZ     #%d  @CHOWN/PRESERV    .\""
+msgstr ": WIZ     #%d  @CHOWN/PRESERV    ."
 
 #: lock.c:893
 #, c-format
 msgid "Warning: Zone %s may have loose zone lock. Lock zones to =player, not player"
-msgstr "\":  %s      .    =,  \""
+msgstr ":  %s      .    =,  "
 
 #: src/look.c:733
 #, c-format
@@ -2149,7 +2147,7 @@
 
 #: bsd.c:3796
 msgid "Welcome back from vacation! Don't forget to unset your ON-VACATION flag"
-msgstr "\",     ?!      ON-VACATION \""
+msgstr ",     ?!      ON-VACATION "
 
 #: src/look.c:1294
 msgid "What do you want to @decompile?"
@@ -2162,7 +2160,7 @@
 #: flags.c:1945
 #, c-format
 msgid "What type do you want to make that %s?"
-msgstr "\"      %s?\""
+msgstr "      %s?"
 
 #: src/bsd.c:4279
 #, c-format
@@ -2211,7 +2209,7 @@
 #: wiz.c:776
 #, c-format
 msgid "You booted unconnected port %s!"
-msgstr "\"    %s!\""
+msgstr "    %s!"
 
 #: attrib.c:1078
 msgid "You can only chown an attribute to yourself."
@@ -2237,7 +2235,7 @@
 #: set.c:474
 #, c-format
 msgid "You cannot change that flag on %s/%s"
-msgstr "\"      %s/%s\""
+msgstr "      %s/%s"
 
 #: src/set.c:469
 #, c-format
@@ -2266,7 +2264,7 @@
 #: move.c:649
 #, c-format
 msgid "You drop %s."
-msgstr "\"  %s.\""
+msgstr "  %s."
 
 #: move.c:1128
 #, c-format
@@ -2276,7 +2274,7 @@
 #: rob.c:182
 #, c-format
 msgid "You gave %s to %s."
-msgstr "\"  %s  %s.\""
+msgstr "  %s  %s."
 
 #: src/rob.c:261
 #, c-format
@@ -2324,11 +2322,11 @@
 
 #: cque.c:662
 msgid "You may not specify a semaphore attribute with the ANY switch."
-msgstr "\"        ANY.\""
+msgstr "        ANY."
 
 #: cque.c:690
 msgid "You may not specify a semaphore count with the ALL switch."
-msgstr "\"        ALL.\""
+msgstr "        ALL."
 
 #: src/cque.c:913
 msgid "You may not use @halt obj=command on this object."
@@ -2344,17 +2342,12 @@
 
 #: cmds.c:424
 msgid "You must give a switch for @hook"
-msgstr "\"     @hook\""
+msgstr "     @hook"
 
 #: flags.c:2006
 #, c-format
 msgid "You must provide a name for the %s."
-msgstr "\"     %s.\""
-
-#: attrib.c:1505
-#, c-format
-msgid "You must set %s first."
-msgstr "\"?????? ?? ???????? ????? %s.\""
+msgstr "     %s."
 
 #: src/rob.c:230
 #, c-format
@@ -2396,7 +2389,7 @@
 #: destroy.c:1170
 #, c-format
 msgid "You own an object in a circular zone chain: %s"
-msgstr "\"     :  %s\""
+msgstr "     :  %s"
 
 #: destroy.c:1143
 #, c-format
@@ -2436,12 +2429,12 @@
 #: move.c:527
 #, c-format
 msgid "You take %s from %s."
-msgstr "\"  %s  %s.\""
+msgstr "  %s  %s."
 
 #: move.c:573
 #, c-format
 msgid "You take %s."
-msgstr "\"  %s.\""
+msgstr "  %s."
 
 #: src/rob.c:279
 #, c-format
@@ -2451,7 +2444,7 @@
 #: speech.c:395
 #, c-format
 msgid "You whisper, \"%s\"%s."
-msgstr "\", \"%s\"%s.\""
+msgstr ", \"%s\"%s."
 
 #: src/destroy.c:336
 #, c-format
@@ -2495,7 +2488,7 @@
 #: move.c:845
 #, c-format
 msgid "You're not following %s."
-msgstr "\"  %s.\""
+msgstr "  %s."
 
 #: src/destroy.c:410
 #, c-format
@@ -2508,7 +2501,7 @@
 
 #: timer.c:158
 msgid "Your ON-VACATION flag is set! If you're back, clear it."
-msgstr "\" ON-VACATION   !  ,   .\""
+msgstr " ON-VACATION   !  ,   ."
 
 #: src/rob.c:143
 #, c-format
@@ -2538,7 +2531,7 @@
 #: lock.c:888
 #, c-format
 msgid "Zone %s really should have a more secure zone-lock."
-msgstr "\" %s    - .\""
+msgstr " %s    - ."
 
 #: src/wiz.c:959
 #, c-format
@@ -2600,18 +2593,10 @@
 msgid "possibly unlocked thing missing succ/osucc/drop/odrop"
 msgstr "    succ/osucc/drop/odrop"
 
-#: funstr.c:88
-msgid "pronoun:feminine,objective"
-msgstr "\"&#1084;&#1077;&#1089;&#1090;&#1086;&#1080;&#1084;&#1077;&#1085;&#1080;&#1077;: &#1078;&#1077;&#1085;&#1089;&#1082;&#1080; &#1088;&#1086;&#1076;, &#1086;&#1090;&#1085;&#1086;&#1089;&#1080;&#1090;&#1077;&#1083;&#1085;&#1086; &#1082;&#1098;&#1084; &#1076;&#1086;&#1087;&#1098;&#1083;&#1085;&#1077;&#1085;&#1080;&#1077;&#1090;&#1086;\""
-
-#: funstr.c:98
-msgid "pronoun:plural,objective"
-msgstr "\"&#1084;&#1077;&#1089;&#1090;&#1086;&#1080;&#1084;&#1077;&#1085;&#1080;&#1077;: &#1084;&#1085;&#1086;&#1078;&#1077;&#1089;&#1090;&#1074;&#1077;&#1085;&#1086;, &#1094;&#1077;&#1083;\""
-
 #: move.c:529
 #, c-format
 msgid "takes %s from %s."
-msgstr "\" %s  %s.\""
+msgstr " %s  %s."
 
 #: move.c:492 move.c:534
 #, c-format
Index: po/de_DE.pox
===================================================================
--- po/de_DE.pox	(.../184p1)	(revision 682)
+++ po/de_DE.pox	(.../184p2)	(revision 682)
@@ -219,10 +219,6 @@
 msgid "#-1 NO SUCH PLAYER"
 msgstr "#-1 SPIELER NICHT VORHANDEN"
 
-#: src/funufun.c:310
-msgid "#-1 NO SUCH USER FUNCTION"
-msgstr "#-1 DIESE BENUTZERFUNKTION IST NICHT VORHANDEN"
-
 #: src/bsd.c:4485 src/bsd.c:4498
 msgid "#-1 NOT CONNECTED"
 msgstr "#-1 NICHT VERBUNDEN"
@@ -956,14 +952,6 @@
 msgid "GAME: Database consistency check complete."
 msgstr "SPIEL: Datenbankprfung abgeschlossen."
 
-#: src/conf.c:572
-msgid "GAME: Database will be dumped in 5 minutes."
-msgstr "GAME: Datenbank wird in 5 Minuten gesichert."
-
-#: src/conf.c:501
-msgid "GAME: Dumping database. Game may freeze for a minute"
-msgstr "SPIEL: Datenbank wird ausgeschrieben. Das Spiel knnte jetzt fr ein Mintchen stehenbleiben."
-
 #: game.c:311
 msgid "GAME: ERROR! Database save failed!"
 msgstr "GAME: FEHLER! Speicherung der Datenbank fehlgeschlagen!"
Index: po/zh_CN.pox
===================================================================
--- po/zh_CN.pox	(.../184p1)	(revision 682)
+++ po/zh_CN.pox	(.../184p2)	(revision 682)
@@ -0,0 +1,325 @@
+# SOME DESCRIPTIVE TITLE.\nCopyright (C) YEAR Free Software Foundation, Inc.\nFIRST AUTHOR <EMAIL@ADDRESS>, YEAR.\n
+#, fuzzy
+msgid ""
+msgstr ""
+"Project-Id-Version: PACKAGE VERSION\n"
+"POT-Creation-Date: 2004-11-04 13:52-0600\n"
+"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
+"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
+"Language-Team: LANGUAGE <LL@li.org>\n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=gb2312\n"
+"Content-Transfer-Encoding: 8bit"
+
+#: src/funmath.c:218 src/funmath.c:250
+msgid "#-1 ARGUMENT MUST END IN AN INTEGER"
+msgstr "#-1 "
+
+#: src/fundb.c:657
+msgid "#-1 INVALID LOCATION"
+msgstr "#-1 "
+
+#: src/extmail.c:1549
+msgid "#-1 INVALID MESSAGE OR PLAYER"
+msgstr "#-1 "
+
+#: src/funufun.c:293
+msgid "#-1 INVALID ZONE"
+msgstr "#-1 "
+
+#: src/conf.c:926
+msgid "#-1 NO SUCH CONFIG OPTION"
+msgstr "#-1 "
+
+#: src/fundb.c:1851
+msgid "#-1 NO SUCH LOCK TYPE"
+msgstr "#-1 "
+
+#: src/extmail.c:1468 src/extmail.c:1489
+msgid "#-1 NO SUCH PLAYER"
+msgstr "#-1 "
+
+#: src/fundb.c:907
+msgid "#-1 NO SUCH TYPE"
+msgstr "#-1 "
+
+#: src/funmath.c:850 src/funmath.c:876 src/funmath.c:930 src/funmath.c:954\nsrc/funmath.c:977 src/funmath.c:1238 src/funstr.c:212 src/funstr.c:234\nsrc/funstr.c:254 src/funstr.c:281 src/funtime.c:152
+msgid "#-1 OUT OF RANGE"
+msgstr "#-1 ~{3,3v76N'~}"
+
+#: src/extmail.c:1471 src/extmail.c:1492 src/extmail.c:1531 src/fundb.c:122\nsrc/fundb.c:141 src/fundb.c:169 src/fundb.c:261 src/fundb.c:303\nsrc/fundb.c:341 src/fundb.c:789 src/fundb.c:953 src/fundb.c:1114\nsrc/fundb.c:1139 src/fundb.c:1248 src/fundb.c:1442 src/fundb.c:1456\nsrc/fundb.c:1466 src/fundb.c:1477 src/fundb.c:1487 src/fundb.c:1502\nsrc/fundb.c:1512 src/fundb.c:1522 src/fundb.c:1537 src/fundb.c:1651\nsrc/fundb.c:1737 src/fundb.c:1741 src/fundb.c:1748 src/fundb.c:1752\nsrc/fundb.c:1858 src/fundb.c:1872 src/funlist.c:1966 src/funmisc.c:60\nsrc/funmisc.c:72 src/funmisc.c:84 src/funmisc.c:96 src/funmisc.c:108\nsrc/funmisc.c:120 src/funmisc.c:134 src/funstr.c:778 src/funufun.c:118\nsrc/funufun.c:149 src/funufun.c:300 src/wiz.c:2155 src/wiz.c:2167\nsrc/wiz.c:2189 src/wiz.c:2202
+msgid "#-1 PERMISSION DENIED"
+msgstr "#-1 "
+
+#: src/extmail.c:1370
+#, c-format
+msgid "%d messages received, %d unread, %d cleared."
+msgstr "%d%d%d"
+
+#: src/extmail.c:1375
+#, c-format
+msgid "%d messages sent, %d unread, %d cleared, totalling %d characters."
+msgstr "%d%d%d%d"
+
+#: src/extmail.c:1368
+#, c-format
+msgid "%d messages sent, %d unread, %d cleared."
+msgstr "%d %d %d "
+
+#: src/wiz.c:686
+#, c-format
+msgid "%d objects = %d rooms, %d exits, %d things, %d players, %d garbage."
+msgstr "%d = %d%d%d%d%d"
+
+#: src/move.c:862
+#, c-format
+msgid "%s begins following you."
+msgstr "%s"
+
+#: src/rob.c:213
+#, c-format
+msgid "%s gave you %s."
+msgstr "%s~{0Q~}%s~{8xAKDc!#~}"
+
+#: src/move.c:332
+#, c-format
+msgid "%s goes home."
+msgstr "%s "
+
+#: src/destroy.c:344
+#, c-format
+msgid "%s has scheduled your room %s to be destroyed."
+msgstr "%s%s"
+
+#: src/look.c:1057
+#, c-format
+msgid "%s is at: %s."
+msgstr "%s%s"
+
+#: src/flags.c:1127 src/flags.c:1133
+#, c-format
+msgid "%s is now listening."
+msgstr "%s"
+
+#: src/speech.c:179
+#, c-format
+msgid "%s says, \"%s\""
+msgstr "%s%s"
+
+#: src/move.c:918 src/move.c:1063
+#, c-format
+msgid "%s stops following you."
+msgstr "%s"
+
+#: src/look.c:1053
+#, c-format
+msgid "%s tried to locate you and failed."
+msgstr "%s"
+
+#: src/move.c:495
+#, c-format
+msgid "%s was taken from you."
+msgstr "%s"
+
+#: src/extmail.c:1260 src/extmail.c:1668 src/wiz.c:673 src/wiz.c:1277
+#, c-format
+msgid "%s: No such player."
+msgstr "%s"
+
+#: src/warnings.c:450
+msgid "@wcheck complete."
+msgstr "@wcheck "
+
+#: src/attrib.c:937
+msgid "Alias set."
+msgstr "~{1pC{IhVCMj1O!#~}"
+
+#: src/cque.c:924
+#, c-format
+msgid "All objects for %s have been halted."
+msgstr "%s"
+
+#: src/wiz.c:273
+#, c-format
+msgid "All quotas changed to %d."
+msgstr "%d"
+
+#: src/attrib.c:1111
+msgid "Attribute owner changed."
+msgstr "~{JtPTKySPU_1d8|!#~}"
+
+#: src/extmail.c:1166
+#, c-format
+msgid "Bad object #%d has mail."
+msgstr "(#%d)"
+
+#: extchat.c:1569
+#, c-format
+msgid "CHAT: Joinlock on <%s> set."
+msgstr "<%s>"
+
+#: src/extchat.c:859
+#, c-format
+msgid "CHAT: You remove %s from channel <%s>."
+msgstr "%s<%s>"
+
+#: src/destroy.c:1325
+msgid "GAME: Database consistency check complete."
+msgstr "~{SNO7#:J}>]?bR;VBPT<l2iMj1O!#~}"
+
+#: src/extchat.c:846
+msgid "Guests may not leave channels."
+msgstr "~{7C?MIm7]2;D\@k?*F55@!#~}"
+
+#: src/lock.c:362
+msgid "I don't see what you want to lock!"
+msgstr "s&#20320;v&#38145;NII"
+
+#: src/speech.c:611 src/speech.c:1371
+#, c-format
+msgid "I'm sorry, but %s wishes to be left alone now."
+msgstr "%s"
+
+#: src/version.c:37
+#, c-format
+msgid "Last restarted: %s"
+msgstr "%s"
+
+#: src/extmail.c:763
+#, c-format
+msgid "MAIL: %d messages forwarded."
+msgstr "%d"
+
+#: src/extmail.c:2504
+#, c-format
+msgid "MAIL: %d messages in folder %d [%s] (%d unread, %d cleared)."
+msgstr "%d%d [%s](%d%d)"
+
+#: src/extmail.c:984
+#, c-format
+msgid "MAIL: %s is not accepting mail from you right now."
+msgstr "%s"
+
+#: src/extmail.c:432
+#, c-format
+msgid "MAIL: All messages filed in folder %d [%s]"
+msgstr "%d[%s]"
+
+#: src/malias.c:378
+msgid "MAIL: I cannot find that player."
+msgstr "MAIL: "
+
+#: src/malias.c:158
+msgid "MAIL: Invalid character in mail alias."
+msgstr "~{SJOd#:SJ<~1pC{@o4fTZ7G7(5D5DWV7{!#~}"
+
+#: src/malias.c:629 src/malias.c:732
+#, c-format
+msgid "MAIL: Mail Alias '%s' not found."
+msgstr "%s"
+
+#: src/extmail.c:1294
+#, c-format
+msgid "MAIL: There are %d msgs in the mail spool, %d unread, %d cleared."
+msgstr "%d%d%d"
+
+#: src/extmail.c:1312
+#, c-format
+msgid "MAIL: There are %d old msgs in the mail spool, totalling %d characters."
+msgstr "%d%d"
+
+#: src/extmail.c:393 src/extmail.c:446
+msgid "MAIL: You don't have any matching messages!"
+msgstr "~{SJOd#:C;SPF%Ed5DPE<~#!~}"
+
+#: src/extmail.c:1090
+#, c-format
+msgid "MAIL: You sent your message to %s."
+msgstr "%s"
+
+#: src/wiz.c:2069
+msgid "Name removed."
+msgstr "~{C{WV1;I>3}AK!#~}"
+
+#: src/bsd.c:3090
+#, c-format
+msgid "No entry for '%s'."
+msgstr "%s"
+
+#: src/look.c:785
+msgid "No exits."
+msgstr "~{C;SP3v?Z!#~}"
+
+#: src/look.c:395
+msgid "No matching attributes."
+msgstr "~{C;SPF%Ed5DJtPT!#~}"
+
+#: src/rob.c:102
+msgid "Sorry, you can only kill players and objects."
+msgstr "~{6T2;Fp#,DcV;D\I15tMf<R:M6TOs!#~}"
+
+#: src/destroy.c:238
+msgid "That object is set SAFE. You must set it !SAFE before destroying it."
+msgstr "(SAFE)(!SAFE)"
+
+#: src/player.c:299
+#, c-format
+msgid "The password is %s\n"
+msgstr "%s\n"
+
+#: src/extmail.c:1281
+#, c-format
+msgid "There are %d messages in the mail spool."
+msgstr "~{SJ<~3X@o92SP~}%d~{7bSJ<~!#~}"
+
+#: src/access.c:547
+#, c-format
+msgid "Unknown access option: %s"
+msgstr "%s"
+
+#: src/extchat.c:1254 src/extchat.c:1364
+#, c-format
+msgid "You are not on channel <%s>."
+msgstr "<%s>"
+
+#: src/move.c:359 src/move.c:412 src/move.c:430
+msgid "You can't go that way."
+msgstr "~{Dc2;D\W_DGLuB7!#~}"
+
+#: src/wiz.c:359
+msgid "You can't teleport rooms."
+msgstr "adsfakldsfjkldasfjladsf"
+
+#: src/move.c:568 src/rob.c:191
+msgid "You don't have that!"
+msgstr "~{DcC;SPDG8v#!~}"
+
+#: src/look.c:853
+#, c-format
+msgid "You have %d %s."
+msgstr "%d%s"
+
+#: src/rob.c:230
+#, c-format
+msgid "You must specify a positive number of %s."
+msgstr "%s"
+
+#: src/rob.c:263
+#, c-format
+msgid "You paid %d %s."
+msgstr "%d%s"
+
+#: src/move.c:917 src/move.c:1036
+#, c-format
+msgid "You stop following %s."
+msgstr "%s"
+
+#: src/extchat.c:1329
+#, c-format
+msgid "You will now hear messages on channel <%s>."
+msgstr "<%s>"
+
+#: src/bsd.c:3419
+msgid "Your HAVEN flag is set. You cannot receive pages."
+msgstr "HAVEN"
+
Index: po/da_DK.pox
===================================================================
--- po/da_DK.pox	(.../184p1)	(revision 682)
+++ po/da_DK.pox	(.../184p2)	(revision 682)
@@ -248,10 +248,6 @@
 msgid "#-1 NO SUCH TYPE"
 msgstr "#-1 DEN TYPE FINDES IKKE"
 
-#: src/funufun.c:310
-msgid "#-1 NO SUCH USER FUNCTION"
-msgstr "#-1 DEN BRUGERFUNKTION FINDES IKKE"
-
 #: src/bsd.c:4485 src/bsd.c:4498
 msgid "#-1 NOT CONNECTED"
 msgstr "#-1 IKKE FORBUNDET"
@@ -864,14 +860,6 @@
 msgid "GAME: Database consistency check complete."
 msgstr "SPIL: Databasecheck komplet."
 
-#: src/conf.c:570
-msgid "GAME: Database will be dumped in 1 minute."
-msgstr "SPIL: Databasen gemmes om 5 minutter."
-
-#: src/conf.c:572
-msgid "GAME: Database will be dumped in 5 minutes."
-msgstr "SPIL: Databasen gemmes om 5 minutter."
-
 #: src/destroy.c:1322
 msgid "GAME: Performing database consistency check."
 msgstr "SPIL: Databasecheck komplet."
Index: po/hr_HR.pox
===================================================================
--- po/hr_HR.pox	(.../184p1)	(revision 682)
+++ po/hr_HR.pox	(.../184p2)	(revision 682)
@@ -553,10 +553,6 @@
 msgid "#-1 NO SUCH TYPE"
 msgstr "#-1 TAJ TIP NE POSTOJI"
 
-#: src/funufun.c:310
-msgid "#-1 NO SUCH USER FUNCTION"
-msgstr "#-1 TA KORISNIKA FUNKCIJA NE POSTOJI"
-
 #: extchat.c:2279
 msgid "#-1 NO TEXT GIVEN"
 msgstr "#-1 NIJE ZADAN TEKST"
@@ -646,6 +642,10 @@
 msgid "#-1 TOO MANY ITERS"
 msgstr "#-1 PREVIE ITERA"
 
+#: funmisc.c:495 funmisc.c:612
+msgid "#-1 TOO MANY SWITCHES"
+msgstr "#-1 PREVIE SWITCHEVA"
+
 #: src/funlist.c:1782
 msgid "#-1 TOO MANY WORDS"
 msgstr "#-1 PREVIE RIJEI"
@@ -838,6 +838,21 @@
 msgid "%s - Triggered."
 msgstr "%s - Okinuto."
 
+#: atr_tab.c:440
+#, c-format
+msgid "%s -- Attribute %s set to: %s"
+msgstr "%s -- Atribut %s postavljen na: %s"
+
+#: atr_tab.c:432
+#, c-format
+msgid "%s -- Attribute limit or enum already unset."
+msgstr "%s -- Atributova granica ili enum je ve maknut."
+
+#: atr_tab.c:429
+#, c-format
+msgid "%s -- Attribute limit or enum unset."
+msgstr "%s -- Atributova granica ili enum maknut."
+
 #: src/atr_tab.c:226
 #, c-format
 msgid "%s -- Attribute permissions now: %s"
@@ -1479,6 +1494,10 @@
 msgid "Address: %s"
 msgstr "Adresa: %s"
 
+#: conf.c:1386
+msgid "Admin:"
+msgstr "Administratorima:"
+
 #: src/destroy.c:405
 msgid "Alas, your efforts of mercy are in vain."
 msgstr "Naalost, tvoj pokuaj milosra je uzaludan."
@@ -1515,6 +1534,10 @@
 msgid "All but wizards"
 msgstr "Svi osim administratora"
 
+#: extchat.c:1924
+msgid "All channels have been combined."
+msgstr "Svi kanali su kombinirani."
+
 #: extchat.c:1597
 msgid "All channels have been gagged."
 msgstr "Gag stavljen na sve kanale."
@@ -1523,6 +1546,10 @@
 msgid "All channels have been muted."
 msgstr "Vie nee uti poruke o spajanjima ni na jednom kanalu."
 
+#: extchat.c:1925
+msgid "All channels have been uncombined."
+msgstr "Svi kanali su odkombinirani."
+
 #: extchat.c:1598
 msgid "All channels have been ungagged."
 msgstr "Gag maknut sa svih kanala."
@@ -1568,6 +1595,10 @@
 msgid "All"
 msgstr "Svi"
 
+#: conf.c:1387
+msgid "Announcement:"
+msgstr "Obavijest:"
+
 #: wiz.c:1810
 msgid "Any name matching these wildcard patterns is banned:"
 msgstr "Svako ime koje se podudara s ovim uzorcima je banano:"
@@ -1629,6 +1660,10 @@
 msgid "Attribute unlocked."
 msgstr "Atribut otkljuan."
 
+#: atr_tab.c:259
+msgid "Attribute value does not match the /limit regexp."
+msgstr "Atributova vrijednost se ne podudara sa /limitovim regexpom."
+
 #: atr_tab.c:349
 msgid "Attribute"
 msgstr "Atribut"
@@ -1685,6 +1720,10 @@
 msgid "Broadcast: Suspect %s tried to kill %s(#%d)."
 msgstr "Obavijest: Sumnjivi igra '%s' pokua ubiti korisnika '%s'(#%d)."
 
+#: conf.c:1385
+msgid "Broadcast:"
+msgstr "Odaslana poruka:"
+
 #: extchat.c:2085
 msgid "Buf"
 msgstr "Buf"
@@ -2092,6 +2131,16 @@
 msgid "Compiler: %s"
 msgstr "Compiler: %s"
 
+#: extchat.c:2024
+#, c-format
+msgid "Connect messages on channel <%s> will no longer be combined with others."
+msgstr "Poruke o spajanju na kanalu <%s> vie nee biti kombinirane s ostalima."
+
+#: extchat.c:2018
+#, c-format
+msgid "Connect messages on channel <%s> will now be combined with others."
+msgstr "Poruke o spajanju na kanalu <%s> e sada biti kombinirane s ostalima."
+
 #: bsd.c:4386 bsd.c:4395
 msgid "Connecting..."
 msgstr "Spajanje u tijeku..."
@@ -2184,6 +2233,10 @@
 msgid "Default flags for new objects"
 msgstr "Defaultni flagovi za nove objekte"
 
+#: atr_tab.c:364
+msgid "Delimiter must be one character."
+msgstr "Razdvojnik mora biti jedan znak."
+
 #: access.c:429
 msgid "Denied connections are not logged"
 msgstr "Odbijena spajanja se ne biljee u log"
@@ -2317,6 +2370,10 @@
 msgid "Enabled."
 msgstr "Ukljueno."
 
+#: atr_tab.c:647
+msgid "Enum"
+msgstr "Enum"
+
 #: src/game.c:1465
 msgid "Error -- cannot execute uptime."
 msgstr "Greka -- ne mogu izvriti uptime."
@@ -2493,21 +2550,13 @@
 msgid "GAME: Database consistency check complete."
 msgstr "IGRA: Provjera konzistencije baze podataka gotova."
 
-#: src/conf.c:570
-msgid "GAME: Database will be dumped in 1 minute."
-msgstr "IGRA: Baza podataka e biti snimljena za 1 minutu."
-
-#: src/conf.c:572
-msgid "GAME: Database will be dumped in 5 minutes."
-msgstr "IGRA: Baza podataka e biti snimljena za 5 minuta."
-
-#: src/conf.c:502
-msgid "GAME: Dump complete. Time in."
-msgstr "IGRA: Snimanje gotovo."
+#: conf.c:1343
+msgid "GAME: Database save in 1 minute."
+msgstr "IGRA: Snimanje baze podataka za 1 minutu."
 
-#: src/conf.c:501
-msgid "GAME: Dumping database. Game may freeze for a minute"
-msgstr "IGRA: Snimam bazu podataka. Server bi se mogao zablokirati na krae vrijeme"
+#: conf.c:1345
+msgid "GAME: Database save in 5 minutes."
+msgstr "IGRA: Snimanje baze podataka za 5 minuta."
 
 #: game.c:311
 msgid "GAME: ERROR! Database save failed!"
@@ -2559,6 +2608,14 @@
 msgid "GAME: SSL connections must be dropped, sorry."
 msgstr "IGRA: SSL veze se moraju prekinuti, ao mi je."
 
+#: conf.c:1282
+msgid "GAME: Save complete. "
+msgstr "IGRA: Snimanje gotovo. "
+
+#: conf.c:1281
+msgid "GAME: Saving database. Game may freeze for a few moments."
+msgstr "IGRA: Snimam bazu podataka. Igra bi se mogla zamrznuti na nekoliko trenutaka."
+
 #: src/game.c:273
 #, c-format
 msgid "GAME: Shutdown by %s"
@@ -2796,6 +2853,10 @@
 msgid "I don't know that %s."
 msgstr "Navedena stvar (%s) mi nije poznata."
 
+#: atr_tab.c:410
+msgid "I don't know that attribute. Please use @attribute/access to create it, first."
+msgstr "Ne znam za taj atribut. Molim te, prvo upotrijebi @attribute/access da ga stvori."
+
 #: rob.c:390
 msgid "I don't know what you mean."
 msgstr "Ne znam na to misli."
@@ -2975,6 +3036,10 @@
 msgid "Internal error: weird object type."
 msgstr "Unutarnja greka: udan tip objekta."
 
+#: atr_tab.c:350
+msgid "Invalid Regular Expression."
+msgstr "Neispravan regularan izraz."
+
 #: atr_tab.c:202 atr_tab.c:293
 msgid "Invalid attribute name."
 msgstr "Neispravno ime atributa."
@@ -3034,6 +3099,11 @@
 msgid "Invalid range argument"
 msgstr "Argument nije u ispravnom rasponu"
 
+#: predicat.c:1444 predicat.c:1455
+#, c-format
+msgid "Invalid regexp: %s"
+msgstr "Neispravan regexp: %s"
+
 #: wiz.c:1772
 msgid "Invalid search class+restriction format."
 msgstr "Neispravan format klase i ogranienja za pretragu."
@@ -3125,6 +3195,10 @@
 msgid "Letter for %s %s set to '%c'."
 msgstr "Slovo za %s %s postavljeno na '%c'."
 
+#: atr_tab.c:645
+msgid "Limit"
+msgstr "Granica"
+
 #: conf.c:554
 msgid "Limits and other constants"
 msgstr "Ogranienja i ostale konstante"
@@ -3803,6 +3877,10 @@
 msgid "No match."
 msgstr "Taj objekt ne postoji."
 
+#: predicat.c:1528 predicat.c:1537
+msgid "No matches."
+msgstr "Nema podudaranja."
+
 #: access.c:431
 msgid "No matching access rule"
 msgstr "Nema podudarajueg pristupnog pravila"
@@ -3981,6 +4059,10 @@
 msgid "Only God can set himself!"
 msgstr "Samo Bog moe definirati samoga sebe!"
 
+#: extchat.c:1904
+msgid "Only players can use that option."
+msgstr "Samo igrai mogu koristiti tu opciju."
+
 #: src/wiz.c:162
 msgid "Only wizards may change a quota."
 msgstr "Samo administratori mogu promijeniti quotu."
@@ -4094,11 +4176,19 @@
 msgid "PennMUSH version %s patchlevel %s %s"
 msgstr "PennMUSH verzija %s patchlevel %s %s"
 
+#: conf.c:1302
+msgid "Pennies"
+msgstr "Novia"
+
 #: wiz.c:1062
 #, c-format
 msgid "Pennies: %d"
 msgstr "Novii: %d"
 
+#: conf.c:1301
+msgid "Penny"
+msgstr "Novi"
+
 #: src/extmail.c:1584
 msgid "Permission denied"
 msgstr "Doputenje uskraeno"
@@ -4547,6 +4637,10 @@
 msgid "That attribute's permissions can not be changed."
 msgstr "Dozvole za taj atribut se ne mogu promijeniti."
 
+#: atr_tab.c:421
+msgid "That attribute's permissions cannot be changed."
+msgstr "Dozvole za taj atribut ne mogu biti promijenjene."
+
 #: destroy.c:436
 msgid "That can't be undestroyed."
 msgstr "To ne moe biti od-uniteno."
@@ -4648,6 +4742,10 @@
 msgid "That object is set WIZARD. You must use @nuke to destroy it."
 msgstr "Taj objekt ima flag WIZARD. Ako ga eli unititi, upotrijebi naredbu @nuke."
 
+#: conf.c:1829
+msgid "That option cannot be altered."
+msgstr "Ta opcija ne moe biti promijenjena."
+
 #: src/look.c:1048
 msgid "That player does not seem to exist."
 msgstr "ini se da taj igra ne postoji."
@@ -4856,6 +4954,10 @@
 msgid "There's nothing left of it to clone!"
 msgstr "Od toga nita nije ostalo pa se ne moe ni klonirati!"
 
+#: player.c:190
+msgid "This IP address has failed too many times. Please try again in 10 minutes."
+msgstr "Prevelik broj neuspjenih spajanja s te IP adrese. Molim, pokuati ponovo za 10 minuta."
+
 #: command.c:1562
 msgid "This command has not been implemented."
 msgstr "Ova naredba se ne koristi."
@@ -5091,6 +5193,10 @@
 msgid "Unknown hook type"
 msgstr "Nepoznata vrsta hooka"
 
+#: atr_tab.c:389
+msgid "Unknown limit type?"
+msgstr "Nepoznata vrsta granice?"
+
 #: src/lock.c:297 src/lock.c:303
 msgid "Unknown lock type."
 msgstr "Nepoznata vrsta brave."
@@ -5178,6 +5284,11 @@
 msgid "Users"
 msgstr "Korisnika"
 
+#: atr_tab.c:268 atr_tab.c:304
+#, c-format
+msgid "Value for %s needs to be one of: %s"
+msgstr "Vrijednost za %s mora biti jedna od: %s"
+
 #: move.c:423
 #, c-format
 msgid "Variable exit destination #%d is invalid or not permitted."
Index: po/nl_NL.pox
===================================================================
--- po/nl_NL.pox	(.../184p1)	(revision 682)
+++ po/nl_NL.pox	(.../184p2)	(revision 682)
@@ -553,10 +553,6 @@
 msgid "#-1 NO SUCH TYPE"
 msgstr "#-1 TYPE BESTAAT NIET"
 
-#: src/funufun.c:310
-msgid "#-1 NO SUCH USER FUNCTION"
-msgstr "#-1 GEBRUIKER FUNCTIE BESTAAT NIET"
-
 #: extchat.c:2279
 msgid "#-1 NO TEXT GIVEN"
 msgstr "#-1 GEEN TEXT OPGEGEVEN"
@@ -2488,22 +2484,6 @@
 msgid "GAME: Database consistency check complete."
 msgstr "SPEL: Bezig database consistentie controle uit te voeren."
 
-#: src/conf.c:570
-msgid "GAME: Database will be dumped in 1 minute."
-msgstr "SPEL: Database wordt over 1 minuut opgeslagen."
-
-#: src/conf.c:572
-msgid "GAME: Database will be dumped in 5 minutes."
-msgstr "SPEL: Database wordt over 5 minuten opgeslagen."
-
-#: src/conf.c:502
-msgid "GAME: Dump complete. Time in."
-msgstr "SPEL: Dump voltooid."
-
-#: src/conf.c:501
-msgid "GAME: Dumping database. Game may freeze for a minute"
-msgstr "SPEL: Database wordt opgeslagen. Spel kan tijdelijk blijven hangen."
-
 #: game.c:311
 msgid "GAME: ERROR! Database save failed!"
 msgstr "SPEL: FOUT! Opslaan van database mislukt!"
Index: po/pl_PL.pox
===================================================================
--- po/pl_PL.pox	(.../184p1)	(revision 682)
+++ po/pl_PL.pox	(.../184p2)	(revision 682)
@@ -488,10 +488,6 @@
 msgid "#-1 NO SUCH TYPE"
 msgstr "#-1 NIE MA TAKIEGO TYPU"
 
-#: src/funufun.c:310
-msgid "#-1 NO SUCH USER FUNCTION"
-msgstr "#-1 NIE MA TAKIEJ FUNKCJI UYTKOWNIKA"
-
 #: extchat.c:2279
 msgid "#-1 NO TEXT GIVEN"
 msgstr "#-1 NIE PODANO TEKSTU"
@@ -2157,22 +2153,6 @@
 msgid "GAME: Database consistency check complete."
 msgstr "GRA: Test spjnoci bazy danych ukoczony."
 
-#: src/conf.c:570
-msgid "GAME: Database will be dumped in 1 minute."
-msgstr "GRA: Kopia zapasowa bazy danych zostanie wykonana za minut."
-
-#: src/conf.c:572
-msgid "GAME: Database will be dumped in 5 minutes."
-msgstr "GRA: Kopia zapasowa bazy danych zostanie wykonana za 5 minut."
-
-#: src/conf.c:502
-msgid "GAME: Dump complete. Time in."
-msgstr "GRA: Kopia zapasowa wykonana. Wracamy."
-
-#: src/conf.c:501
-msgid "GAME: Dumping database. Game may freeze for a minute"
-msgstr "GRA: Zapisywanie bazy danych. Gra moe zatrzyma si na minut."
-
 #: game.c:311
 msgid "GAME: ERROR! Database save failed!"
 msgstr "GRA: BD! Nie udao si zapisa bazy danych!"
Index: po/pt_BR.pox
===================================================================
--- po/pt_BR.pox	(.../184p1)	(revision 682)
+++ po/pt_BR.pox	(.../184p2)	(revision 682)
@@ -184,10 +184,6 @@
 msgid "#-1 NO SUCH TYPE"
 msgstr "#-1 NO EXISTE ESTE TIPO"
 
-#: src/funufun.c:310
-msgid "#-1 NO SUCH USER FUNCTION"
-msgstr "#-1 NO EXISTE ESTE TIPO"
-
 #: src/bsd.c:4485 src/bsd.c:4498
 msgid "#-1 NOT CONNECTED"
 msgstr "#-1 ARG2 NO ENCONTRADO"
Index: po/id_ID.pox
===================================================================
--- po/id_ID.pox	(.../184p1)	(revision 682)
+++ po/id_ID.pox	(.../184p2)	(revision 682)
@@ -23,10 +23,6 @@
 msgid "#-1 NO SUCH CHANNEL"
 msgstr "#-1 CHANNEL TIDAK ADA"
 
-#: src/funufun.c:310
-msgid "#-1 NO SUCH USER FUNCTION"
-msgstr "#-1 TIDAK ADA USER FUNCTION TERSEBU"
-
 #: src/look.c:964
 #, c-format
 msgid "%s (this room) [speech]."
Index: po/hu_HU.pox
===================================================================
--- po/hu_HU.pox	(.../184p1)	(revision 682)
+++ po/hu_HU.pox	(.../184p2)	(revision 682)
@@ -325,10 +325,6 @@
 msgid "#-1 NO SUCH TYPE"
 msgstr "#-1 NINCS ILYEN TPUS"
 
-#: src/funufun.c:310
-msgid "#-1 NO SUCH USER FUNCTION"
-msgstr "#-1 NINCS ILYEN FELHASZNLI FUNKCI"
-
 #: src/bsd.c:4485 src/bsd.c:4498
 msgid "#-1 NOT CONNECTED"
 msgstr "#-1 NINCS KAPCSOLDVA"
@@ -1585,22 +1581,6 @@
 msgid "GAME: Database consistency check complete."
 msgstr "JTK: Adatbzis rvnyessgi teszt befejezve."
 
-#: src/conf.c:570
-msgid "GAME: Database will be dumped in 1 minute."
-msgstr "JTK: Adatbzisments 1 perc mlva."
-
-#: src/conf.c:572
-msgid "GAME: Database will be dumped in 5 minutes."
-msgstr "JTK: Az adatbzis-ments 5 percen bell."
-
-#: src/conf.c:502
-msgid "GAME: Dump complete. Time in."
-msgstr "JTk: Ments vge."
-
-#: src/conf.c:501
-msgid "GAME: Dumping database. Game may freeze for a minute"
-msgstr "JTK: Adatbzisments. A jtk egy idre lellhat"
-
 #: game.c:311
 msgid "GAME: ERROR! Database save failed!"
 msgstr "JTK: HIBA! Adatbzis ments nem sikerlt!"
Index: po/no_NO.pox
===================================================================
--- po/no_NO.pox	(.../184p1)	(revision 682)
+++ po/no_NO.pox	(.../184p2)	(revision 682)
@@ -449,6 +449,10 @@
 msgid "#-1 INVALID SECOND ARGUMENT"
 msgstr "#-1 UGYLDIG ANDREARGUMENT"
 
+#: fundb.c:2124
+msgid "#-1 INVALID SOURCE ROOM"
+msgstr "#-1 UGYLDIG KILDE ROM"
+
 #: funstr.c:369 funstr.c:425
 msgid "#-1 INVALID THIRD ARGUMENT"
 msgstr "#-1 UGYLDIG TREDJE ARGUMENT"
@@ -549,10 +553,6 @@
 msgid "#-1 NO SUCH TYPE"
 msgstr "#-1 INGEN SLIK TYPE"
 
-#: src/funufun.c:310
-msgid "#-1 NO SUCH USER FUNCTION"
-msgstr "#-1 INGEN SLIK BRUKERFUNKSJON"
-
 #: extchat.c:2279
 msgid "#-1 NO TEXT GIVEN"
 msgstr "#-1 INGEN TEKST GITT"
@@ -642,6 +642,10 @@
 msgid "#-1 TOO MANY ITERS"
 msgstr "#-1 FOR MANGE ITER-KALL"
 
+#: funmisc.c:495 funmisc.c:612
+msgid "#-1 TOO MANY SWITCHES"
+msgstr "#-1 FOR MANGE SWITCHER"
+
 #: src/funlist.c:1782
 msgid "#-1 TOO MANY WORDS"
 msgstr "#-1 FOR MANGE ORD"
@@ -789,6 +793,26 @@
 msgid "%s (this room) [speech]."
 msgstr "%s (dette rommet) [tale]."
 
+#: flags.c:1714
+#, c-format
+msgid "%s - %s (already) granted."
+msgstr "%s - %s (allerede) gitt."
+
+#: flags.c:1710
+#, c-format
+msgid "%s - %s (already) removed."
+msgstr "%s - %s (allerede) fjernet."
+
+#: flags.c:1716
+#, c-format
+msgid "%s - %s granted."
+msgstr "%s - %s tillatt."
+
+#: flags.c:1708
+#, c-format
+msgid "%s - %s removed."
+msgstr "%s - %s fjernet."
+
 #: flags.c:1357
 #, c-format
 msgid "%s - I don't recognize that flag."
@@ -1304,6 +1328,11 @@
 msgid "%s: Objects: %d   Limit: UNLIMITED"
 msgstr "%s: Objekter: %d   Begrensning: UBEGRENSET"
 
+#: wiz.c:1327
+#, c-format
+msgid "%sGarbage%s(#%d)"
+msgstr "%sSppel%s(#%d)"
+
 #: attrib.c:1566 attrib.c:1584
 #, c-format
 msgid "'%s' contains too many aliases."
@@ -1314,6 +1343,11 @@
 msgid "'%s' is not a valid alias."
 msgstr "'%s' er ikke et gyldig alias."
 
+#: attrib.c:1851
+#, c-format
+msgid "'%s' is not a valid exit name."
+msgstr "'%s' er ikke et gyldig navn for en utgang."
+
 #: function.c:905
 msgid "(Commas okay in last argument)"
 msgstr "(Komma er OK i siste argument)"
@@ -2449,22 +2483,6 @@
 msgid "GAME: Database consistency check complete."
 msgstr "SPILL: Database konsistenssjekk ferdig."
 
-#: src/conf.c:570
-msgid "GAME: Database will be dumped in 1 minute."
-msgstr "SPILL: Databasedump om 1 minutt."
-
-#: src/conf.c:572
-msgid "GAME: Database will be dumped in 5 minutes."
-msgstr "SPILL: Databasen vil bli dumpet om 5 minutter."
-
-#: src/conf.c:502
-msgid "GAME: Dump complete. Time in."
-msgstr "SPILL: Dump ferdig. Bare fortsett, dere."
-
-#: src/conf.c:501
-msgid "GAME: Dumping database. Game may freeze for a minute"
-msgstr "SPILL: Dumper database. Spillet kan fryse en stund"
-
 #: game.c:311
 msgid "GAME: ERROR! Database save failed!"
 msgstr "SPILL: FEIL! Databaselagring ble ikke fullfrt!"
@@ -2550,6 +2568,11 @@
 msgid "Garbage is garbage."
 msgstr "Sppel er sppel."
 
+#: wiz.c:1329
+#, c-format
+msgid "Garbage(#%d)"
+msgstr "Sppel(#%d)"
+
 #: src/set.c:82
 msgid "Give it what new name?"
 msgstr "Gi det hvilket nytt navn?"
@@ -2907,6 +2930,21 @@
 msgid "Inspecting ansi string"
 msgstr "Inspiserer ANSI-streng"
 
+#: flags.c:1534 flags.c:1697
+#, c-format
+msgid "Internal error: Unable to find flagspace '%s'!"
+msgstr "Intern feil: Kunne ikke finne flaggrom '%s'!"
+
+#: flags.c:2325
+#, c-format
+msgid "Internal error: Unknown flag space '%s'!"
+msgstr "Intern feil: Ukjent flaggrom '%s'!"
+
+#: flags.c:2515
+#, c-format
+msgid "Internal error: Unknown flagspace '%s'!"
+msgstr "Intern feil: Ukjent flaggrom '%s'!"
+
 #: create.c:373
 msgid "Internal error: weird object type."
 msgstr "Intern feil: rar objekt-type."
@@ -2970,6 +3008,11 @@
 msgid "Invalid range argument"
 msgstr "Ugyldig range-argument"
 
+#: predicat.c:1444 predicat.c:1455
+#, c-format
+msgid "Invalid regexp: %s"
+msgstr "Ugyldig regexp: %s"
+
 #: wiz.c:1772
 msgid "Invalid search class+restriction format."
 msgstr "Ugyldig klasse+restriksjonsformat for sk."
@@ -3217,6 +3260,10 @@
 msgid "MAIL: All messages in all folders cleared."
 msgstr "MAIL: Alle meldinger i alle foldere avmerket."
 
+#: extmail.c:481
+msgid "MAIL: All messages in all folders marked as read."
+msgstr "MAIL: Alle meldinger i alle foldere merket som lest."
+
 #: extmail.c:428
 msgid "MAIL: All messages in all folders tagged."
 msgstr "MAIL: Alle meldinger i alle foldere tagget."
@@ -3225,6 +3272,10 @@
 msgid "MAIL: All messages in all folders uncleared."
 msgstr "MAIL: Alle meldinger i alle foldere avmerket."
 
+#: extmail.c:479
+msgid "MAIL: All messages in all folders unread."
+msgstr "MAIL: Alle meldinger i alle foldere ulest."
+
 #: extmail.c:426
 msgid "MAIL: All messages in all folders untagged."
 msgstr "MAIL: Alle meldinger i alle foldere avtagget."
@@ -3346,6 +3397,11 @@
 msgid "MAIL: Msg #%d:%d cleared."
 msgstr "MAIL: Melding #%d:%d fjernet."
 
+#: extmail.c:489
+#, c-format
+msgid "MAIL: Msg #%d:%d marked as read"
+msgstr "MAIL: Melding #%d:%d merket som lest"
+
 #: extmail.c:436
 #, c-format
 msgid "MAIL: Msg #%d:%d tagged"
@@ -3356,6 +3412,11 @@
 msgid "MAIL: Msg #%d:%d uncleared."
 msgstr "MAIL: Melding #%d:%d gjenopprettet."
 
+#: extmail.c:487
+#, c-format
+msgid "MAIL: Msg #%d:%d unread"
+msgstr "MAIL: Melding #%d:%d ules"
+
 #: extmail.c:433
 #, c-format
 msgid "MAIL: Msg #%d:%d untagged"
@@ -3433,6 +3494,10 @@
 msgid "MAIL: To whom should I forward?"
 msgstr "MAIL: Hvem skal jeg videresende meldingen til?"
 
+#: extmail.c:420
+msgid "MAIL: Unknown status."
+msgstr "MAIL: Ukjent status."
+
 #: src/extmail.c:378
 #, c-format
 msgid "MAIL: Unread Msg #%d:%d cleared! Use @mail/unclear %d:%d to recover."
@@ -3447,6 +3512,10 @@
 msgid "MAIL: What alias do you want to create?"
 msgstr "MAIL: Hvilket alias vil du lage?"
 
+#: extmail.c:409
+msgid "MAIL: What do you want to do with the messages?"
+msgstr "MAIL: Hva vil du gjre med meldingene?"
+
 #: src/extmail.c:239 src/extmail.c:279
 msgid "MAIL: What folder is that?"
 msgstr "MAIL: Hvilken folder er det?"
@@ -3713,6 +3782,10 @@
 msgid "No match."
 msgstr "Ingen treff."
 
+#: predicat.c:1528 predicat.c:1537
+msgid "No matches."
+msgstr "Ingen treff."
+
 #: access.c:431
 msgid "No matching access rule"
 msgstr "Ingen tilgangsregel"
@@ -4860,6 +4933,11 @@
 msgid "Totals: Player...%d/%d[%ddel]  Object...%d/%d[%ddel]  Wait...%d/%d[%ddel]  Semaphore...%d/%d"
 msgstr "Totaler: Spillere...%d/5d[%ddel]  Objekt...%d/%d[%ddel]   Vent...%d/%d[%ddel]   Semafor...%d/%d"
 
+#: wiz.c:1337
+#, c-format
+msgid "Totals: Rooms...%d  Exits...%d  Things...%d  Players...%d  Garbage...%d"
+msgstr "Totaler: Rom...%d  Utganger...%d   Ting...%d Spillere...%d  Sppel...%d"
+
 #: wiz.c:1295
 #, c-format
 msgid "Totals: Rooms...%d  Exits...%d  Things...%d  Players...%d"
@@ -5567,6 +5645,10 @@
 msgid "You can't see someone else's quota!"
 msgstr "Du kan ikke se andres kvoter!"
 
+#: look.c:754
+msgid "You can't see that from here."
+msgstr "Du kan ikke se det fra her."
+
 #: src/look.c:534
 msgid "You can't see through that."
 msgstr "Du kan ikke se gjennom det."
@@ -6280,6 +6362,14 @@
 "\n"
 "UTGANGER:"
 
+#: wiz.c:1323
+msgid ""
+"\n"
+"GARBAGE:"
+msgstr ""
+"\n"
+"SPPEL:"
+
 #: src/extmail.c:2507
 msgid ""
 "\n"
Index: CHANGES.184
===================================================================
--- CHANGES.184	(.../184p1)	(revision 682)
+++ CHANGES.184	(.../184p2)	(revision 682)
@@ -16,6 +16,86 @@
 
 ==========================================================================
 
+Version 1.8.4 patchlevel 2                                 Dec 06,  2010
+
+Major Changes:
+ * Wildcard matcher completely rewritten to avoid hangs and to provide
+   ansi-aware capturing. [GM]
+ * connection_fail_limit now lets you limit the # of connection fails in
+   a 10 minute time by any given IP. [GM]
+
+Minor Changes:
+ * update-cnf.pl perl script now handles optional config lines, by placing
+   A # OPTIONAL above them. This is for message translation. [GM]
+ * Config options can now be marked as optional. If they don't exist,
+   Penn will not complain in the log. [MG]
+ * Player names with spaces no longer need to be in given in quotes for
+   @name. Suggested by Minion. [MG]
+ * @decompile no longer shows flags which can't be set by players, like
+   GOING and CONNECTED. [MG]
+ * %il substitution as preparation to get rid of ##. [GM]
+ * hardcode: call_attrib is now a wrapper around call_ufun. [GM]
+ * The %i<n> substitution, and itext()/inum()/ilev() functions, now work
+   for @dolist as well as iter(). [MG]
+ * iter() context (itext(), inum(), etc) is no longer propagated through
+   ufuns. [MG]
+ * @hook/overrides on huh_command are now matched against "huh_command" and
+   "huh_command <input>". From a suggestion by Mercutio. [MG]
+ * Various help fixes.
+ * @list and list() can now show only built-in or only local commands or
+   functions. Suggested by Trelane@M*U*S*H. [MG]
+ * Mortals can now use @search to find any objects they can examine.
+   Suggested by Paige. [MG]
+ * @function names can start with numbers again. Requested by Mercutio. [MG]
+ * @include and @break now work when entered directly from a client. [MG]
+ * The Drop and Give @locks now trigger verb <name>_LOCK`FAILURE attributes
+   when you fail to pass them, as described in 'help failure'. Suggested by 
+   Cas@BeforeTheDarkness. [MG]
+ * Set several attributes used internally AF_NOCOPY so they won't be included
+   in @decompile output. Suggested by Paige. [GM]
+ * The help for the chat system (@channel) has been rewritten. [MG]
+ * autodetect_list now returns 'm' sort for unknown list types instead of
+   alphanum, so sorting on strings will now treat numbers in them as
+   separate comparisons by default. [GM]
+ * setunion(), setdiff(), setinter() now autodetect lists in all cases where
+   no sort type is provided instead of just some cases. [GM]
+ * The pipe (|) character is no longer valid in channel names. [MG]
+
+Functions:
+ * ibreak(), for breaking out of an iter() loop. [Rhost] [MG]
+ * New stext() function and %$N sub, equivilent of #$ in @switch, switch*(),
+   and reswitch*(), but can be used in nested switches/on user input. [MG]
+ * New slev() function, returns the current nesting depth of switches. [MG]
+ * maillist() returns a list of @mail messages matching a range, as per
+   @mail/list. Suggested by AnneLions. [MG]
+ * New sorttype, lattr, sorts a list of attribute names. [MG]
+
+Commands:
+ * @channel/combine and @channel/uncombine let you combine spammy connect
+   messages for channels into one line. [SW] [GM]
+ * @grep now accepts /wild and /regexp switches, for wildcard/globbing and
+   regular expression greps (a la wildgrep() and regrep()). Also /nocase
+   for case-insensitive greps. Suggested by Paige. [MG]
+ * @attribute now allows limiting attribute values through /enum and
+   /limit switches. [GM]
+ * @ps <pid> shows info for a single queue entry. Suggested by Paige. [MG]
+   
+Fixes:
+ * Off-by-one bug in 'm' sort when using embedded numbers fixed. [GM]
+ * Debug output was sometimes sent to the wrong executor. [GM]
+ * A crashbug in @search was fixed. Reported by Paige. [GM]
+ * A crashbug in lpids() was fixed. Reported by Mercutio. Fixed by Javelin.
+ * @search elock class failed to report invalid lock strings. Fixed. [GM]
+ * @cpattr and @mvattr could break attribute trees. Reported by Sketch. [MG]
+ * benchmark() calculated the average incorrectly. Reported by Cheetah. [DC]
+ * map(), iter(), mix() and step() are ansi-aware, now. Using any of the
+   list functions without ansi should also be considerably faster. [GM]
+ * "look <container>'s <object>" incorrectly stopped working in p1 when
+   <object>'s desc was set "nearby". Reported by Yuriko@M*U*SH. [MG]
+ * Attribute names are now sorted better with regard to attribute trees,
+   hopefully fixing the recurring bug of @wipe leaving branch attributes
+   when removing a root attr for good. [MG]
+
 Version 1.8.4 patchlevel 1                                 Sep 05,  2010
 
 Major Changes:
Index: utils/update-cnf.pl
===================================================================
--- utils/update-cnf.pl	(.../184p1)	(revision 682)
+++ utils/update-cnf.pl	(.../184p2)	(revision 682)
@@ -131,7 +131,16 @@
 close IN;
 
 # Now we check for things in dist that haven't been seen in the working file.
-while (my ($key, $dir) = each %{$dist_cnf}) {
+# Sorted using position
+my @keys = keys %{$dist_cnf};
+
+# Unique 'em, I'm seeing duplicates.
+my %useen = ();
+my @ukeys = grep { ! $useen{$_} ++ } @keys;
+
+my @sorted = sort { $dist_cnf->{$a}->[0]->{"position"} <=> $dist_cnf->{$b}->[0]->{"position"} } @ukeys;
+for my $key (@sorted) {
+    my $dir = $dist_cnf->{$key};
     next if $seen{$key};
     dump_directive \*OUT, $dir;
     push @newoptions, $key;   
@@ -152,6 +161,8 @@
 sub read_cnf_file {
     my (%directive, @comment);
     my $file = shift;
+    my $position = 0;
+    my $expectCommentedDirective = 0;
     
     print "*** Reading settings from $file...\n";
     open FILE, "<", $file or die "update-cnf.pl: Unable to open $file: $!\n"; 
@@ -159,19 +170,49 @@
 	# We can have comments, which start with #,
 	# or directives, which start with anything else.
 	chomp;
-	if (/^#/) {
-	    # A comment
-	    push @comment, $_;
+        if (/^#\s*OPTIONAL/) {
+            # The next line is a commented-out directive that is optional.
+            $expectCommentedDirective = 1;
+            push @comment, $_;
+	} elsif (/^#/) {
+            if ($expectCommentedDirective && /^#\s*(\S+)\s+(.+)$/) {
+              # A directive, but an optional one.
+              my ($key, $val) = ($1, $2);
+              my $c = join "\n", @comment;
+              $c .= "\n" if length $c;
+              if (defined $directive{$key}) {
+                  # This is a repeated directive! 
+                  push @{$directive{$key}}, {"key" => $key, "value" => $val, "comment" => $c, "optional" => 1 };
+              } else {
+                  $directive{$key} = [{"position" => $position++, "key" => $key, "value" => $val, "comment" => $c, "optional" => 1}]; 
+              }
+              undef @comment;
+            } elsif ($expectCommentedDirective && /^#\s*(\S+)\s*$/) {
+              # An optional directive that's defined as blank
+              my ($key, $val) = ($1, "");
+              my $c = join "\n", @comment;
+              $c .= "\n" if length $c;
+              if (defined $directive{$key}) {
+                  # These probably won't repeat, but... 
+                  push @{$directive{$key}}, {"key" => $key, "value" => "", "comment" => $c, "optional" => 1 };
+              } else {
+                  $directive{$key} = [{"position" => $position++, "key" => $key, "value" => "", "comment" => $c, "optional" => 1 }];
+              }
+              undef @comment;
+            } else {
+              push @comment, $_;
+            }
 	} elsif (/^(\S+)\s+(.+)$/) {
+            $expectCommentedDirective = 0;
 	    # A directive
 	    my ($key, $val) = ($1, $2);
 	    my $c = join "\n", @comment;
 	    $c .= "\n" if length $c;
 	    if (defined $directive{$key}) {
 		# This is a repeated directive! 
-		push @{$directive{$key}}, { "key" => $key, "value" => $val, "comment" => $c };
+		push @{$directive{$key}}, {"key" => $key, "value" => $val, "comment" => $c };
 	    } else {
-		$directive{$key} = [{"key" => $key, "value" => $val, "comment" => $c}]; 
+		$directive{$key} = [{"position" => $position++, "key" => $key, "value" => $val, "comment" => $c}]; 
 	    }
 	    undef @comment;
         } elsif (/^(\S+)/) {
@@ -183,11 +224,12 @@
 		# These probably won't repeat, but... 
 		push @{$directive{$key}}, {"key" => $key, "value" => "", "comment" => $c };
 	    } else {
-		$directive{$key} = [{"key" => $key, "value" => "", "comment" => $c }];
+		$directive{$key} = [{"position" => $position++, "key" => $key, "value" => "", "comment" => $c }];
 	    }
 	    undef @comment;
     	} elsif (/^$/) {
 	    # A blank line. Ignore comments so far
+            $expectCommentedDirective = 0;
 	    undef @comment;
 	}
     }
@@ -221,6 +263,10 @@
     my $directive = shift;
     foreach my $d (@{$directive}) {
 	print $out $d->{"comment"};
-	print $out $d->{key}, " ", $d->{"value"}, "\n";
+        if ($d->{"optional"}) {
+            print $out "# ", $d->{key}, " ", $d->{"value"}, "\n";
+        } else {
+            print $out $d->{key}, " ", $d->{"value"}, "\n";
+        }
     }
 }
Index: hdrs/switches.h
===================================================================
--- hdrs/switches.h	(.../184p1)	(revision 682)
+++ hdrs/switches.h	(.../184p2)	(revision 682)
@@ -21,142 +21,149 @@
 #define SWITCH_CLEAR 18
 #define SWITCH_CLONE 19
 #define SWITCH_CMD 20
-#define SWITCH_COMMANDS 21
-#define SWITCH_CONN 22
-#define SWITCH_CONNECT 23
-#define SWITCH_CONNECTED 24
-#define SWITCH_CONTENTS 25
-#define SWITCH_COSTS 26
-#define SWITCH_COUNT 27
-#define SWITCH_CREATE 28
-#define SWITCH_DATABASE 29
-#define SWITCH_DB 30
-#define SWITCH_DEBUG 31
-#define SWITCH_DECOMPILE 32
-#define SWITCH_DEFAULTS 33
-#define SWITCH_DELETE 34
-#define SWITCH_DELIMIT 35
-#define SWITCH_DESCRIBE 36
-#define SWITCH_DESTROY 37
-#define SWITCH_DISABLE 38
-#define SWITCH_DOWN 39
-#define SWITCH_DSTATS 40
-#define SWITCH_EMIT 41
-#define SWITCH_ENABLE 42
-#define SWITCH_EQSPLIT 43
-#define SWITCH_ERR 44
-#define SWITCH_EXITS 45
-#define SWITCH_FILE 46
-#define SWITCH_FIRST 47
-#define SWITCH_FLAGS 48
-#define SWITCH_FOLDERS 49
-#define SWITCH_FORWARD 50
-#define SWITCH_FREESPACE 51
-#define SWITCH_FSTATS 52
-#define SWITCH_FULL 53
-#define SWITCH_FUNCTIONS 54
-#define SWITCH_FWD 55
-#define SWITCH_GAG 56
-#define SWITCH_GLOBALS 57
-#define SWITCH_HEADER 58
-#define SWITCH_HERE 59
-#define SWITCH_HIDE 60
-#define SWITCH_IGNORE 61
-#define SWITCH_ILIST 62
-#define SWITCH_INSIDE 63
-#define SWITCH_INVENTORY 64
-#define SWITCH_IPRINT 65
-#define SWITCH_JOIN 66
-#define SWITCH_LETTER 67
-#define SWITCH_LIST 68
-#define SWITCH_LOCKS 69
-#define SWITCH_LOWERCASE 70
-#define SWITCH_LSARGS 71
-#define SWITCH_ME 72
-#define SWITCH_MEMBERS 73
-#define SWITCH_MOD 74
-#define SWITCH_MOGRIFIER 75
-#define SWITCH_MORTAL 76
-#define SWITCH_MOTD 77
-#define SWITCH_MUTE 78
-#define SWITCH_NAME 79
-#define SWITCH_NO 80
-#define SWITCH_NOEVAL 81
-#define SWITCH_NOFLAGCOPY 82
-#define SWITCH_NOISY 83
-#define SWITCH_NOPARSE 84
-#define SWITCH_NOSIG 85
-#define SWITCH_NOSPACE 86
-#define SWITCH_NOTIFY 87
-#define SWITCH_NUKE 88
-#define SWITCH_OFF 89
-#define SWITCH_ON 90
-#define SWITCH_OUTSIDE 91
-#define SWITCH_OVERRIDE 92
-#define SWITCH_PAGING 93
-#define SWITCH_PANIC 94
-#define SWITCH_PARANOID 95
-#define SWITCH_PARENT 96
-#define SWITCH_PLAYERS 97
-#define SWITCH_PORT 98
-#define SWITCH_POWERS 99
-#define SWITCH_PREFIX 100
-#define SWITCH_PRESERVE 101
-#define SWITCH_PRINT 102
-#define SWITCH_PRIVS 103
-#define SWITCH_PURGE 104
-#define SWITCH_QUICK 105
-#define SWITCH_QUIET 106
-#define SWITCH_READ 107
-#define SWITCH_REBOOT 108
-#define SWITCH_RECALL 109
-#define SWITCH_REGEXP 110
-#define SWITCH_REGIONS 111
-#define SWITCH_REGISTER 112
-#define SWITCH_REMOVE 113
-#define SWITCH_RENAME 114
-#define SWITCH_RESTORE 115
-#define SWITCH_RESTRICT 116
-#define SWITCH_RETROACTIVE 117
-#define SWITCH_ROOM 118
-#define SWITCH_ROOMS 119
-#define SWITCH_RSARGS 120
-#define SWITCH_SAVE 121
-#define SWITCH_SEE 122
-#define SWITCH_SEEFLAG 123
-#define SWITCH_SELF 124
-#define SWITCH_SEND 125
-#define SWITCH_SET 126
-#define SWITCH_SILENT 127
-#define SWITCH_SKIPDEFAULTS 128
-#define SWITCH_SPEAK 129
-#define SWITCH_SPOOF 130
-#define SWITCH_STATS 131
-#define SWITCH_STATUS 132
-#define SWITCH_SUMMARY 133
-#define SWITCH_TABLES 134
-#define SWITCH_TAG 135
-#define SWITCH_TELEPORT 136
-#define SWITCH_TF 137
-#define SWITCH_THINGS 138
-#define SWITCH_TITLE 139
-#define SWITCH_TRACE 140
-#define SWITCH_TYPE 141
-#define SWITCH_UNCLEAR 142
-#define SWITCH_UNFOLDER 143
-#define SWITCH_UNGAG 144
-#define SWITCH_UNHIDE 145
-#define SWITCH_UNMUTE 146
-#define SWITCH_UNREAD 147
-#define SWITCH_UNTAG 148
-#define SWITCH_UNTIL 149
-#define SWITCH_URGENT 150
-#define SWITCH_USEFLAG 151
-#define SWITCH_WHAT 152
-#define SWITCH_WHO 153
-#define SWITCH_WIPE 154
-#define SWITCH_WIZ 155
-#define SWITCH_WIZARD 156
-#define SWITCH_YES 157
-#define SWITCH_ZONE 158
+#define SWITCH_COMBINE 21
+#define SWITCH_COMMANDS 22
+#define SWITCH_CONN 23
+#define SWITCH_CONNECT 24
+#define SWITCH_CONNECTED 25
+#define SWITCH_CONTENTS 26
+#define SWITCH_COSTS 27
+#define SWITCH_COUNT 28
+#define SWITCH_CREATE 29
+#define SWITCH_DATABASE 30
+#define SWITCH_DB 31
+#define SWITCH_DEBUG 32
+#define SWITCH_DECOMPILE 33
+#define SWITCH_DEFAULTS 34
+#define SWITCH_DELETE 35
+#define SWITCH_DELIMIT 36
+#define SWITCH_DESCRIBE 37
+#define SWITCH_DESTROY 38
+#define SWITCH_DISABLE 39
+#define SWITCH_DOWN 40
+#define SWITCH_DSTATS 41
+#define SWITCH_EMIT 42
+#define SWITCH_ENABLE 43
+#define SWITCH_ENUM 44
+#define SWITCH_EQSPLIT 45
+#define SWITCH_ERR 46
+#define SWITCH_EXITS 47
+#define SWITCH_FILE 48
+#define SWITCH_FIRST 49
+#define SWITCH_FLAGS 50
+#define SWITCH_FOLDERS 51
+#define SWITCH_FORWARD 52
+#define SWITCH_FREESPACE 53
+#define SWITCH_FSTATS 54
+#define SWITCH_FULL 55
+#define SWITCH_FUNCTIONS 56
+#define SWITCH_FWD 57
+#define SWITCH_GAG 58
+#define SWITCH_GLOBALS 59
+#define SWITCH_HEADER 60
+#define SWITCH_HERE 61
+#define SWITCH_HIDE 62
+#define SWITCH_IGNORE 63
+#define SWITCH_ILIST 64
+#define SWITCH_INSIDE 65
+#define SWITCH_INVENTORY 66
+#define SWITCH_IPRINT 67
+#define SWITCH_JOIN 68
+#define SWITCH_LETTER 69
+#define SWITCH_LIMIT 70
+#define SWITCH_LIST 71
+#define SWITCH_LOCAL 72
+#define SWITCH_LOCKS 73
+#define SWITCH_LOWERCASE 74
+#define SWITCH_LSARGS 75
+#define SWITCH_ME 76
+#define SWITCH_MEMBERS 77
+#define SWITCH_MOD 78
+#define SWITCH_MOGRIFIER 79
+#define SWITCH_MORTAL 80
+#define SWITCH_MOTD 81
+#define SWITCH_MUTE 82
+#define SWITCH_NAME 83
+#define SWITCH_NO 84
+#define SWITCH_NOCASE 85
+#define SWITCH_NOEVAL 86
+#define SWITCH_NOFLAGCOPY 87
+#define SWITCH_NOISY 88
+#define SWITCH_NOPARSE 89
+#define SWITCH_NOSIG 90
+#define SWITCH_NOSPACE 91
+#define SWITCH_NOTIFY 92
+#define SWITCH_NUKE 93
+#define SWITCH_OFF 94
+#define SWITCH_ON 95
+#define SWITCH_OUTSIDE 96
+#define SWITCH_OVERRIDE 97
+#define SWITCH_PAGING 98
+#define SWITCH_PANIC 99
+#define SWITCH_PARANOID 100
+#define SWITCH_PARENT 101
+#define SWITCH_PLAYERS 102
+#define SWITCH_PORT 103
+#define SWITCH_POWERS 104
+#define SWITCH_PREFIX 105
+#define SWITCH_PRESERVE 106
+#define SWITCH_PRINT 107
+#define SWITCH_PRIVS 108
+#define SWITCH_PURGE 109
+#define SWITCH_QUICK 110
+#define SWITCH_QUIET 111
+#define SWITCH_READ 112
+#define SWITCH_REBOOT 113
+#define SWITCH_RECALL 114
+#define SWITCH_REGEXP 115
+#define SWITCH_REGIONS 116
+#define SWITCH_REGISTER 117
+#define SWITCH_REMOVE 118
+#define SWITCH_RENAME 119
+#define SWITCH_RESTORE 120
+#define SWITCH_RESTRICT 121
+#define SWITCH_RETROACTIVE 122
+#define SWITCH_ROOM 123
+#define SWITCH_ROOMS 124
+#define SWITCH_RSARGS 125
+#define SWITCH_SAVE 126
+#define SWITCH_SEE 127
+#define SWITCH_SEEFLAG 128
+#define SWITCH_SELF 129
+#define SWITCH_SEND 130
+#define SWITCH_SET 131
+#define SWITCH_SILENT 132
+#define SWITCH_SKIPDEFAULTS 133
+#define SWITCH_SPEAK 134
+#define SWITCH_SPOOF 135
+#define SWITCH_STATS 136
+#define SWITCH_STATUS 137
+#define SWITCH_SUMMARY 138
+#define SWITCH_TABLES 139
+#define SWITCH_TAG 140
+#define SWITCH_TELEPORT 141
+#define SWITCH_TF 142
+#define SWITCH_THINGS 143
+#define SWITCH_TITLE 144
+#define SWITCH_TRACE 145
+#define SWITCH_TYPE 146
+#define SWITCH_UNCLEAR 147
+#define SWITCH_UNCOMBINE 148
+#define SWITCH_UNFOLDER 149
+#define SWITCH_UNGAG 150
+#define SWITCH_UNHIDE 151
+#define SWITCH_UNMUTE 152
+#define SWITCH_UNREAD 153
+#define SWITCH_UNTAG 154
+#define SWITCH_UNTIL 155
+#define SWITCH_URGENT 156
+#define SWITCH_USEFLAG 157
+#define SWITCH_WHAT 158
+#define SWITCH_WHO 159
+#define SWITCH_WILD 160
+#define SWITCH_WIPE 161
+#define SWITCH_WIZ 162
+#define SWITCH_WIZARD 163
+#define SWITCH_YES 164
+#define SWITCH_ZONE 165
 #endif                          /* SWITCHES_H */
Index: hdrs/ansi.h
===================================================================
--- hdrs/ansi.h	(.../184p1)	(revision 682)
+++ hdrs/ansi.h	(.../184p2)	(revision 682)
@@ -141,6 +141,7 @@
 extern char *remove_markup(const char *orig, size_t * stripped_len);
 extern char *skip_leading_ansi(const char *p);
 
+int has_markup(const char *test);
 extern ansi_string *
 parse_ansi_string(const char *src)
   __attribute_malloc__;
Index: hdrs/extchat.h
===================================================================
--- hdrs/extchat.h	(.../184p1)	(revision 682)
+++ hdrs/extchat.h	(.../184p2)	(revision 682)
@@ -62,18 +62,21 @@
 #define CU_QUIET    0x1         /* Do not hear connection messages */
 #define CU_HIDE     0x2         /* Do not appear on the user list */
 #define CU_GAG      0x4         /* Do not hear any messages */
+#define CU_COMBINE  0x8         /* Combine connect/disconnect messages */
 #define CU_DEFAULT_FLAGS 0x0
 
 /* channel_broadcast flags */
-#define CB_CHECKQUIET 0x01      /* Check for quiet flag on recipients */
-#define CB_NOSPOOF    0x02      /* Use nospoof emits */
-#define CB_PRESENCE   0x04      /* This is a presence message, not sound */
-#define CB_QUIET      0x08      /* Do not prepend the <Channel> name */
-#define CB_SPEECH     0x10      /* This is player speech */
-#define CB_POSE       0x20      /* This is a pose */
-#define CB_SEMIPOSE   0x40      /* This is a semipose */
-#define CB_EMIT       0x80      /* This is an emit */
-#define CB_TYPE       0xF0      /* Type of a message. */
+#define CB_SPEECH     0x01      /* This is player speech */
+#define CB_POSE       0x02      /* This is a pose */
+#define CB_SEMIPOSE   0x04      /* This is a semipose */
+#define CB_EMIT       0x08      /* This is an emit */
+#define CB_TYPE       0x0F      /* Type of a message. */
+#define CB_CHECKQUIET 0x10      /* Check for quiet flag on recipients */
+#define CB_NOSPOOF    0x20      /* Use nospoof emits */
+#define CB_PRESENCE   0x40      /* This is a presence message, not sound */
+#define CB_QUIET      0x80      /* Do not prepend the <Channel> name */
+#define CB_NOCOMBINE  0x100     /* Don't send this message to players with
+                                 * their channels set COMBINE */
 
 #define CUdbref(u) ((u)->who)
 #define CUtype(u) ((u)->type)
@@ -82,6 +85,7 @@
 #define Chanuser_Quiet(u)       (CUtype(u) & CU_QUIET)
 #define Chanuser_Hide(u) ((CUtype(u) & CU_HIDE) || (IsPlayer(CUdbref(u)) && hidden(CUdbref(u))))
 #define Chanuser_Gag(u) (CUtype(u) & CU_GAG)
+#define Chanuser_Combine(u) (CUtype(u) & CU_COMBINE)
 
 /* This is a chat channel */
 #define CHAN_NAME_LEN 31
Index: hdrs/mushtype.h
===================================================================
--- hdrs/mushtype.h	(.../184p1)	(revision 682)
+++ hdrs/mushtype.h	(.../184p2)	(revision 682)
@@ -69,8 +69,14 @@
   Debug_Info *debug_strings;    /**< DEBUG infromation */
   int arg_count;                /**< Number of arguments passed to function */
   int iter_nesting;             /**< Current iter() nesting depth */
+  int local_iter_nesting;       /**< Expression-level iter() nesting depth */
   char *iter_itext[MAX_ITERS];  /**< itext() replacements in iter() */
   int iter_inum[MAX_ITERS];     /**< inum() values in iter() */
+  int iter_break;               /**< number of ibreak()s to break out of iter()s */
+  int dolists;                  /**< Number of @dolist values in iter_itext */
+  int switch_nesting;           /**< switch()/@switch nesting depth */
+  int local_switch_nesting;     /**< Expression-level switch nesting depth */
+  char *switch_text[MAX_ITERS]; /**< #$-values for switch()/@switches */
 };
 
 
Index: hdrs/function.h
===================================================================
--- hdrs/function.h	(.../184p1)	(revision 682)
+++ hdrs/function.h	(.../184p2)	(revision 682)
@@ -99,7 +99,7 @@
 void do_function_restrict(dbref player, const char *name,
                           const char *restrict, int builtin);
 void do_function_restore(dbref player, const char *name);
-void do_list_functions(dbref player, int lc);
+void do_list_functions(dbref player, int lc, char *type);
 char *list_functions(const char *);
 void do_function(dbref player, char *name, char **argv, int preserve);
 void do_function_toggle(dbref player, char *name, int toggle);
Index: hdrs/attrib.h
===================================================================
--- hdrs/attrib.h	(.../184p1)	(revision 682)
+++ hdrs/attrib.h	(.../184p2)	(revision 682)
@@ -26,6 +26,8 @@
 /* Stuff that's actually in atr_tab.c */
 extern ATTR *aname_hash_lookup(const char *name);
 extern int alias_attribute(const char *atr, const char *alias);
+extern void do_attribute_limit
+  (dbref player, char *name, int type, char *pattern);
 extern void do_attribute_access
   (dbref player, char *name, char *perms, int retroactive);
 extern void do_attribute_delete(dbref player, char *name);
@@ -34,6 +36,8 @@
 extern void do_list_attribs(dbref player, int lc);
 extern char *list_attribs(void);
 extern void attr_init_postconfig(void);
+extern const char *check_attr_value
+  (dbref player, const char *name, const char *value);
 
 extern int cnf_attribute_access(char *attrname, char *opts);
 
@@ -115,8 +119,8 @@
 #define AF_CASE         0x800U  /**< Match $/^ patterns case-sensitive */
 #define AF_SAFE         0x1000U /**< This attribute may not be modified */
 #define AF_ROOT         0x2000U /**< Root of an attribute tree */
-#define AF_UNDEF1       0x4000U /**< Undefined; reserved for a future flag */
-#define AF_UNDEF2       0x8000U /**< Undefined; reserved for a future flag */
+#define AF_RLIMIT       0x4000U /**< Undefined; reserved for a future flag */
+#define AF_ENUM         0x8000U /**< Undefined; reserved for a future flag */
 #define AF_STATIC       0x10000U        /**< OBSOLETE! Leave here but don't use */
 #define AF_COMMAND      0x20000U        /**< INTERNAL: value starts with $ */
 #define AF_LISTEN       0x40000U        /**< INTERNAL: value starts with ^ */
@@ -135,7 +139,7 @@
 #define AF_AHEAR        0x40000000U     /**< ^-listens can be triggered by anyone */
 #define AF_UNDEF3       0x80000000U     /**< Undefined; reserved for a future flag */
 
-#define AF_MAXVALUE          0x100000000U     /**< Largest attribute flag value. */
+#define AF_MAXVALUE     0x100000000U     /**< Largest attribute flag value. */
 
     extern ATTR attr[];
                     /**< external predefined attributes. */
Index: hdrs/conf.h
===================================================================
--- hdrs/conf.h	(.../184p1)	(revision 682)
+++ hdrs/conf.h	(.../184p2)	(revision 682)
@@ -88,6 +88,11 @@
 typedef int (*config_func) (const char *opt, const char *val, void *loc,
                             int maxval, int source);
 
+#define CP_OVERRIDDEN 1         /* Set by .cnf file */
+#define CP_OPTIONAL   2         /* Doesn't complain if it's missing. */
+#define CP_CONFIGSET  4         /* Overridden/set by @config/set */
+#define CP_GODONLY    8         /* Only God can see. */
+
 /** Runtime configuration parameter.
  * This structure represents a runtime configuration option.
  */
@@ -97,10 +102,11 @@
   config_func handler;
   void *loc;                    /**< place to put this option. */
   int max;                      /**< max: string length, integer value. */
-  int overridden;               /**< Has the default been overridden? */
+  int flags;                    /**< Has the default been overridden? */
   const char *group;            /**< The option's group name */
 } PENNCONF;
 
+
 /** Runtime configuration options.
  * This large structure stores all of the runtime configuration options
  * that are typically set in mush.cnf.
@@ -120,6 +126,7 @@
   dbref ancestor_exit;  /**< The ultimate parent exit */
   dbref ancestor_thing; /**< The ultimate parent thing */
   dbref ancestor_player; /**< The ultimate parent player */
+  int connect_fail_limit; /**< Maximum number of connect fails in 10 mins. */
   int idle_timeout;     /**< Maximum idle time allowed, in minutes */
   int unconnected_idle_timeout; /**< Maximum idle time for connections without dbrefs, in minutes */
   int keepalive_timeout; /**< Number of seconds between TCP keepalive pings */
@@ -325,6 +332,7 @@
 #define DUMP_INTERVAL       (options.dump_interval)
 #define DUMP_NOFORK_MESSAGE  (options.dump_message)
 #define DUMP_NOFORK_COMPLETE (options.dump_complete)
+#define CONNECT_FAIL_LIMIT   (options.connect_fail_limit)
 #define INACTIVITY_LIMIT    (options.idle_timeout)
 #define UNCONNECTED_LIMIT    (options.unconnected_idle_timeout)
 
Index: hdrs/game.h
===================================================================
--- hdrs/game.h	(.../184p1)	(revision 682)
+++ hdrs/game.h	(.../184p2)	(revision 682)
@@ -35,6 +35,7 @@
 void do_waitpid(dbref, const char *, const char *, bool);
 enum queue_type { QUEUE_ALL, QUEUE_NORMAL, QUEUE_SUMMARY, QUEUE_QUICK };
 void do_queue(dbref player, const char *what, enum queue_type flag);
+void do_queue_single(dbref player, char *pidstr);
 void do_halt1(dbref player, const char *arg1, const char *arg2);
 void do_haltpid(dbref, const char *);
 void do_allhalt(dbref player);
Index: hdrs/parse.h
===================================================================
--- hdrs/parse.h	(.../184p1)	(revision 682)
+++ hdrs/parse.h	(.../184p2)	(revision 682)
@@ -32,6 +32,7 @@
 extern char e_notvis[];         /* #-1 NO SUCH OBJECT VISIBLE */
 extern char e_disabled[];       /* #-1 FUNCTION DISABLED */
 extern char e_range[];          /* #-1 OUT OF RANGE */
+extern char e_argrange[];       /* #-1 ARGUMENT OUT OF RANGE */
 
 /* The following routines all take strings as arguments, and return
  * data of the appropriate types.
Index: hdrs/atr_tab.h
===================================================================
--- hdrs/atr_tab.h	(.../184p1)	(revision 682)
+++ hdrs/atr_tab.h	(.../184p2)	(revision 682)
@@ -45,7 +45,7 @@
   {"BUY", AF_NOPROG | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0, NULL},
   {"CHARGES", AF_NOPROG | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0, NULL},
   {"CHATFORMAT", AF_NOPROG | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0, NULL},
-  {"COMMENT", AF_NOPROG | AF_MDARK | AF_WIZARD | AF_PREFIXMATCH,
+  {"COMMENT", AF_NOPROG | AF_MDARK | AF_WIZARD | AF_PREFIXMATCH | AF_NOCOPY,
    NULL_CHUNK_REFERENCE,
    0, NULL},
   {"CONFORMAT", AF_NOPROG | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0, NULL},
@@ -83,30 +83,30 @@
   {"INPREFIX", AF_NOPROG | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0, NULL},
   {"INVFORMAT", AF_NOPROG | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0, NULL},
   {"LALIAS", AF_NOPROG | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0, NULL},
-  {"LAST", AF_VISUAL | AF_WIZARD | AF_LOCKED | AF_PREFIXMATCH,
-   NULL_CHUNK_REFERENCE, 0,
-   NULL},
-  {"LASTIP", AF_WIZARD | AF_LOCKED | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0,
-   NULL},
-  {"LASTFAILED", AF_WIZARD | AF_LOCKED | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE,
-   0,
-   NULL},
-  {"LASTLOGOUT", AF_WIZARD | AF_LOCKED | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE,
-   0,
-   NULL},
-  {"LASTPAGED", AF_WIZARD | AF_LOCKED | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0,
-   NULL},
-  {"LASTSITE", AF_WIZARD | AF_LOCKED | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0,
-   NULL},
+  {"LAST", AF_VISUAL | AF_WIZARD | AF_NOCOPY | AF_LOCKED | AF_PREFIXMATCH,
+   NULL_CHUNK_REFERENCE, 0, NULL},
+  {"LASTIP", AF_WIZARD | AF_LOCKED | AF_NOCOPY | AF_PREFIXMATCH,
+   NULL_CHUNK_REFERENCE, 0, NULL},
+  {"LASTFAILED", AF_WIZARD | AF_LOCKED | AF_NOCOPY | AF_PREFIXMATCH,
+   NULL_CHUNK_REFERENCE, 0, NULL},
+  {"LASTLOGOUT", AF_WIZARD | AF_LOCKED | AF_NOCOPY | AF_PREFIXMATCH,
+   NULL_CHUNK_REFERENCE, 0, NULL},
+  {"LASTPAGED", AF_WIZARD | AF_LOCKED | AF_NOCOPY | AF_PREFIXMATCH,
+   NULL_CHUNK_REFERENCE, 0, NULL},
+  {"LASTSITE", AF_WIZARD | AF_LOCKED | AF_NOCOPY | AF_PREFIXMATCH,
+   NULL_CHUNK_REFERENCE, 0, NULL},
   {"LEAVE", AF_NOPROG | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0, NULL},
   {"LFAIL", AF_NOPROG | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0, NULL},
   {"LISTEN", AF_NOPROG | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0, NULL},
-  {"MAILCURF", AF_WIZARD | AF_NOPROG | AF_LOCKED | AF_PREFIXMATCH,
+  {"MAILCURF",
+   AF_WIZARD | AF_NOPROG | AF_LOCKED | AF_PREFIXMATCH | AF_NOCOPY,
    NULL_CHUNK_REFERENCE, 0, NULL},
-  {"MAILFILTERS", AF_WIZARD | AF_NOPROG | AF_LOCKED | AF_PREFIXMATCH,
+  {"MAILFILTERS",
+   AF_WIZARD | AF_NOPROG | AF_LOCKED | AF_PREFIXMATCH | AF_NOCOPY,
    NULL_CHUNK_REFERENCE, 0, NULL},
   {"MAILFILTER", AF_NOPROG | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0, NULL},
-  {"MAILFOLDERS", AF_WIZARD | AF_NOPROG | AF_LOCKED | AF_PREFIXMATCH,
+  {"MAILFOLDERS",
+   AF_WIZARD | AF_NOPROG | AF_LOCKED | AF_NOCOPY | AF_PREFIXMATCH,
    NULL_CHUNK_REFERENCE, 0, NULL},
   {"MAILFORWARDLIST", AF_NOPROG | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0,
    NULL},
@@ -250,7 +250,7 @@
   {"XX", 0, NULL_CHUNK_REFERENCE, 0, NULL},
   {"XY", 0, NULL_CHUNK_REFERENCE, 0, NULL},
   {"XZ", 0, NULL_CHUNK_REFERENCE, 0, NULL},
-  {"XYXXY", AF_INTERNAL | AF_NOPROG | AF_LOCKED | AF_WIZARD,
+  {"XYXXY", AF_INTERNAL | AF_NOPROG | AF_LOCKED | AF_NOCOPY | AF_WIZARD,
    NULL_CHUNK_REFERENCE, 0, NULL},
   {"ZENTER", AF_NOPROG | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0, NULL},
   {"ZLEAVE", AF_NOPROG | AF_PREFIXMATCH, NULL_CHUNK_REFERENCE, 0, NULL},
Index: hdrs/command.h
===================================================================
--- hdrs/command.h	(.../184p1)	(revision 682)
+++ hdrs/command.h	(.../184p2)	(revision 682)
@@ -217,8 +217,8 @@
   (dbref player, dbref cause, char **from, char *to, char **argv,
    COMMAND_INFO *cmd, int side, int forcenoparse);
 char *command_parse(dbref player, dbref cause, char *string, int fromport);
-void do_list_commands(dbref player, int lc);
-char *list_commands(void);
+void do_list_commands(dbref player, int lc, int type);
+char *list_commands(int type);
 int command_check(dbref player, COMMAND_INFO *cmd, int noisy);
 int command_check_byname(dbref player, const char *name);
 int command_check_byname_quiet(dbref player, const char *name);
Index: hdrs/svninfo.h
===================================================================
--- hdrs/svninfo.h	(.../184p1)	(revision 682)
+++ hdrs/svninfo.h	(.../184p2)	(revision 682)
@@ -1,3 +1,3 @@
 #define SVNREVISION "$Rev$"
 #define SVNDATE "$Date$"
-/* Built at 20100904211632 */
+/* Built at 20101205073940 */
Index: hdrs/version.h
===================================================================
--- hdrs/version.h	(.../184p1)	(revision 682)
+++ hdrs/version.h	(.../184p2)	(revision 682)
@@ -1,4 +1,4 @@
 #define VERSION "1.8.4"
-#define PATCHLEVEL "1"
-#define PATCHDATE "[09/05/2010]"
-#define NUMVERSION 1008004001
+#define PATCHLEVEL "2"
+#define PATCHDATE "[12/06/2010]"
+#define NUMVERSION 1008004002
Index: hdrs/sort.h
===================================================================
--- hdrs/sort.h	(.../184p1)	(revision 682)
+++ hdrs/sort.h	(.../184p2)	(revision 682)
@@ -6,13 +6,16 @@
 
 #define MAX_SORTSIZE (BUFFER_LEN / 2)  /**< Maximum number of elements to sort */
 
-char *autodetect_list(char **ptrs, int nptrs);
-char *get_list_type(char *args[], int nargs, int type_pos, char *ptrs[],
-                    int nptrs);
-char *get_list_type_noauto(char *args[], int nargs, int type_pos);
-int gencomp(dbref player, char *a, char *b, char *sort_type);
+typedef char *SortType;
+
+SortType autodetect_list(char **ptrs, int nptrs);
+SortType autodetect_2lists(char *ptrs[], int nptrs, char *ptrs2[], int nptrs2);
+SortType get_list_type(char *args[], int nargs, int type_pos, char *ptrs[],
+                       int nptrs);
+SortType get_list_type_noauto(char *args[], int nargs, int type_pos);
+int gencomp(dbref player, char *a, char *b, SortType sort_type);
 void do_gensort(dbref player, char *keys[], char *strs[], int n,
-                char *sort_type);
+                SortType sort_type);
 /** Type definition for a qsort comparison function */
 typedef int (*comp_func) (const void *, const void *);
 void sane_qsort(void **array, int left, int right, comp_func compare);
@@ -25,6 +28,9 @@
 int str_comp(const void *s1, const void *s2);
 int stri_comp(const void *s1, const void *s2);
 int dbref_comp(const void *s1, const void *s2);
+int attr_comp(const void *s1, const void *s2);
 int u_comp(const void *s1, const void *s2);     /* For sortby() */
 
+int compare_attr_names(const char *attr1, const char *attr2);
+
 #endif                          /* __PENNSORT_H */
Index: hdrs/externs.h
===================================================================
--- hdrs/externs.h	(.../184p1)	(revision 682)
+++ hdrs/externs.h	(.../184p2)	(revision 682)
@@ -252,13 +252,15 @@
 void do_second(void);
 int do_top(int ncom);
 void do_halt(dbref owner, const char *ncom, dbref victim);
-void parse_que(dbref player, const char *command, dbref cause);
-int queue_attribute_base
-  (dbref executor, const char *atrname, dbref enactor, int noparent);
+void parse_que(dbref player, const char *command, dbref cause,
+               PE_Info *pe_info);
+int queue_attribute_base(dbref executor, const char *atrname, dbref enactor,
+                         int noparent);
 ATTR *queue_attribute_getatr(dbref executor, const char *atrname, int noparent);
 int queue_attribute_useatr(dbref executor, ATTR *a, dbref enactor);
 int inplace_queue_attribute(dbref thing, const char *atrname,
                             dbref enactor, int rsargs);
+void run_user_input(dbref player, char *input);
 
 /** Queue the code in an attribute, including parent objects */
 #define queue_attribute(a,b,c) queue_attribute_base(a,b,c,0)
@@ -407,12 +409,18 @@
 dbref parse_match_possessor(dbref player, char **str, int exits);
 void page_return(dbref player, dbref target, const char *type,
                  const char *message, const char *def);
-char *grep_util(dbref player, dbref thing, char *pattern,
-                char *lookfor, int sensitive, int wild);
 dbref where_is(dbref thing);
 int charge_action(dbref thing);
 dbref first_visible(dbref player, dbref thing);
 
+#define GREP_NOCASE 1
+#define GREP_WILD 2
+#define GREP_REGEXP 4
+int grep_util(dbref player, dbref thing, char *attrs, char *findstr, char *buff,
+              char **bp, int flags);
+
+
+
 /* From rob.c */
 void s_Pennies(dbref thing, int amount);
 
@@ -575,9 +583,23 @@
       char contents[BUFFER_LEN];
       int pe_flags;
       char *errmess;
+      int ufun_flags;
     } ufun_attrib;
-    bool fetch_ufun_attrib(char *attrname, dbref executor,
-                           ufun_attrib * ufun, bool accept_lambda);
+/* Only 'attr', not 'obj/attr' */
+#define UFUN_NONE 0
+/* Does this string accept obj/attr? */
+#define UFUN_OBJECT 0x01
+/* If it accepts obj/attr, does it accept #lambda/attr? */
+#define UFUN_LAMBDA 0x02
+/* If this is set, a nonexistant attribute is an error, instead of empty. */
+#define UFUN_REQUIRE_ATTR 0x04
+/* When calling the ufun, don't check caller's perms */
+#define UFUN_IGNORE_PERMS 0x08
+/* When calling the ufun, save and restore the Q-registers. */
+#define UFUN_LOCALIZE 0x10
+#define UFUN_DEFAULT (UFUN_OBJECT | UFUN_LAMBDA)
+    bool fetch_ufun_attrib(const char *attrstring, dbref executor,
+                           ufun_attrib * ufun, int flags);
     bool call_ufun(ufun_attrib * ufun, char **wenv_args, int wenv_argc,
                    char *ret, dbref executor, dbref enactor, PE_Info *pe_info);
     bool call_attrib(dbref thing, const char *attrname,
@@ -617,21 +639,26 @@
     warn_type parse_warnings(dbref player, const char *warnings);
 
 /* From wild.c */
+    bool wild_match_test(const char *restrict s, const char *restrict d,
+                         bool cs, int *matches, int nmatches);
     bool local_wild_match_case(const char *restrict s,
                                const char *restrict d, bool cs);
-    bool wildcard(const char *s);
+    int wildcard_count(char *s, bool unescape);
+    /** Return 1 if s contains unescaped wildcards, 0 if not */
+#define wildcard(s) (wildcard_count(s, 0) == -1)
     bool quick_wild_new(const char *restrict tstr,
                         const char *restrict dstr, bool cs);
+    bool wild_match_case_r(const char *restrict s,
+                           const char *restrict d, bool cs,
+                           char **ary, int max, char *ata, int len);
+    bool quick_wild(const char *restrict tsr, const char *restrict dstr);
+    bool atr_wild(const char *restrict tstr, const char *restrict dstr);
+
     bool regexp_match_case_r(const char *restrict s, const char *restrict d,
                              bool cs, char **, size_t, char *restrict, ssize_t);
     bool quick_regexp_match(const char *restrict s,
                             const char *restrict d, bool cs);
     bool qcomp_regexp_match(const pcre * re, const char *s);
-    bool wild_match_case_r(const char *restrict s,
-                           const char *restrict d, bool cs,
-                           char **ary, size_t max, char *ata, ssize_t len);
-    bool quick_wild(const char *restrict tsr, const char *restrict dstr);
-    bool atr_wild(const char *restrict tstr, const char *restrict dstr);
 /** Default (case-insensitive) local wildcard match */
 #define local_wild_match(s,d) local_wild_match_case(s, d, 0)
 
Index: win32/README.cygwin
===================================================================
--- win32/README.cygwin	(.../184p1)	(revision 682)
+++ win32/README.cygwin	(.../184p2)	(revision 682)
@@ -2,7 +2,7 @@
 --------------------------------------------------------------
 by Alan Schwartz <javelin@pennmush.org>
 
-Last update: Monday, 13 February 2006
+Last update: Saturday, 18 September 2010
 
 A note on install locations:
 The entire process goes much more smoothly if you install
@@ -46,28 +46,26 @@
 
 5. cd pennmush then type:
 
-    ./configure
+    ./configure --disable-info_slave --disable-ipv6
+    
+    info_slave does not currently work on Windows, and many people have
+    found that leaving ipv6 enabled results in noone being able to connect.
+    You may also want --disable-sql if you're not planning to use SQL.
+    See ./configure --help for all available options.
 
 6. Now type:
 
-    cp options.h.dist options.h
-
-   and edit options.h as desired, keeping the following
-   suggestions in mind:
-
-    a. Use MALLOC_PACKAGE 0	(probably the default already)
-    b. Do *NOT* define INFO_SLAVE 
-
-   Hopefully the last be changed in the future. 'make update' might
-   work instead of manually copying.
+    make update
+    
+   and choose the desired options.
 
 7. Do a `make install' This will build the necessary files and
    install the necessary symbolic links. 
 
 8. Read game/README and follow those instructions. 
-   You will also need to edit game/restart and explicitly
-   set the GAMEDIR variable to your installation path, an
-   example is:
+   You may also need to edit game/restart and explicitly
+   set the GAMEDIR variable to your installation path, though this is
+   not normally necessary. An example is:
     
     /home/noltar/pennmush/game
 
Index: FAQ
===================================================================
--- FAQ	(.../184p1)	(revision 682)
+++ FAQ	(.../184p2)	(revision 682)
@@ -130,8 +130,8 @@
 
 PennMUSH understands the following signals, and performs the listed action:
 
-  -HUP   Performs a silent @readcache
-  -USR1  Performs an @shutdown/reboot
-  -USR2  Performs an @dump
-  -INT   Performs an @shutdown
-  -TERM  Performs an @shutdown/panic
+  -HUP   ( 1) Performs a silent @readcache
+  -USR1  (16) Performs an @shutdown/reboot
+  -USR2  (17) Performs an @dump
+  -INT   ( 2) Performs an @shutdown
+  -TERM  (15) Performs an @shutdown/panic
